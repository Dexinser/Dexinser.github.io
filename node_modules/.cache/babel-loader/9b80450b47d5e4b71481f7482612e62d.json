{"remainingRequest":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/node_modules/thread-loader/dist/cjs.js!/Users/pengfeixu/Personal/Project/Dexinser.github.io/node_modules/babel-loader/lib/index.js!/Users/pengfeixu/Personal/Project/Dexinser.github.io/src/assets/js/echarts-wordcloud.min.js","dependencies":[{"path":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/src/assets/js/echarts-wordcloud.min.js","mtime":1683562074436},{"path":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/babel.config.js","mtime":1683562074236},{"path":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/pengfeixu/Personal/Project/Dexinser.github.io/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmF0LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWxhc3QuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQtbGFzdC1pbmRleC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lc25leHQudHlwZWQtYXJyYXkudG8tcmV2ZXJzZWQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzbmV4dC50eXBlZC1hcnJheS50by1zb3J0ZWQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzbmV4dC50eXBlZC1hcnJheS53aXRoLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuaW1tZWRpYXRlLmpzIik7CiFmdW5jdGlvbiAodCwgZSkgewogICJvYmplY3QiID09IHR5cGVvZiBleHBvcnRzICYmICJvYmplY3QiID09IHR5cGVvZiBtb2R1bGUgPyBtb2R1bGUuZXhwb3J0cyA9IGUocmVxdWlyZSgiZWNoYXJ0cyIpKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsiZWNoYXJ0cyJdLCBlKSA6ICJvYmplY3QiID09IHR5cGVvZiBleHBvcnRzID8gZXhwb3J0c1siZWNoYXJ0cy13b3JkY2xvdWQiXSA9IGUocmVxdWlyZSgiZWNoYXJ0cyIpKSA6IHRbImVjaGFydHMtd29yZGNsb3VkIl0gPSBlKHQuZWNoYXJ0cyk7Cn0odGhpcywgZnVuY3Rpb24gKHQpIHsKICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgIGZ1bmN0aW9uIGUobikgewogICAgICBpZiAocltuXSkgcmV0dXJuIHJbbl0uZXhwb3J0czsKICAgICAgdmFyIGkgPSByW25dID0gewogICAgICAgIGk6IG4sCiAgICAgICAgbDogITEsCiAgICAgICAgZXhwb3J0czoge30KICAgICAgfTsKICAgICAgcmV0dXJuIHRbbl0uY2FsbChpLmV4cG9ydHMsIGksIGkuZXhwb3J0cywgZSksIGkubCA9ICEwLCBpLmV4cG9ydHM7CiAgICB9CiAgICB2YXIgciA9IHt9OwogICAgcmV0dXJuIGUubSA9IHQsIGUuYyA9IHIsIGUuZCA9IGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgIGUubyh0LCByKSB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgciwgewogICAgICAgIGNvbmZpZ3VyYWJsZTogITEsCiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgZ2V0OiBuCiAgICAgIH0pOwogICAgfSwgZS5uID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIHIgPSB0ICYmIHQuX19lc01vZHVsZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdC5kZWZhdWx0OwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0OwogICAgICB9OwogICAgICByZXR1cm4gZS5kKHIsICJhIiwgciksIHI7CiAgICB9LCBlLm8gPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIGUpOwogICAgfSwgZS5wID0gIiIsIGUoZS5zID0gMjUpOwogIH0oW2Z1bmN0aW9uICh0LCBlKSB7CiAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgR1t0XSA9IGU7CiAgICB9CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgaWYgKG51bGwgPT0gdCB8fCAib2JqZWN0IiAhPSB0eXBlb2YgdCkgcmV0dXJuIHQ7CiAgICAgIHZhciBlID0gdCwKICAgICAgICByID0gVy5jYWxsKHQpOwogICAgICBpZiAoIltvYmplY3QgQXJyYXldIiA9PT0gcikgewogICAgICAgIGUgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgYSA9IHQubGVuZ3RoOyBpIDwgYTsgaSsrKSBlW2ldID0gbih0W2ldKTsKICAgICAgfSBlbHNlIGlmIChFW3JdKSB7CiAgICAgICAgdmFyIG8gPSB0LmNvbnN0cnVjdG9yOwogICAgICAgIGlmICh0LmNvbnN0cnVjdG9yLmZyb20pIGUgPSBvLmZyb20odCk7ZWxzZSB7CiAgICAgICAgICBlID0gbmV3IG8odC5sZW5ndGgpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGEgPSB0Lmxlbmd0aDsgaSA8IGE7IGkrKykgZVtpXSA9IG4odFtpXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCFOW3JdICYmICFGKHQpICYmICFUKHQpKSB7CiAgICAgICAgZSA9IHt9OwogICAgICAgIGZvciAodmFyIHMgaW4gdCkgdC5oYXNPd25Qcm9wZXJ0eShzKSAmJiAoZVtzXSA9IG4odFtzXSkpOwogICAgICB9CiAgICAgIHJldHVybiBlOwogICAgfQogICAgZnVuY3Rpb24gaSh0LCBlLCByKSB7CiAgICAgIGlmICghUyhlKSB8fCAhUyh0KSkgcmV0dXJuIHIgPyBuKGUpIDogdDsKICAgICAgZm9yICh2YXIgYSBpbiBlKSBpZiAoZS5oYXNPd25Qcm9wZXJ0eShhKSkgewogICAgICAgIHZhciBvID0gdFthXSwKICAgICAgICAgIHMgPSBlW2FdOwogICAgICAgICFTKHMpIHx8ICFTKG8pIHx8IHcocykgfHwgdyhvKSB8fCBUKHMpIHx8IFQobykgfHwgTShzKSB8fCBNKG8pIHx8IEYocykgfHwgRihvKSA/ICFyICYmIGEgaW4gdCB8fCAodFthXSA9IG4oZVthXSwgITApKSA6IGkobywgcywgcik7CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgZm9yICh2YXIgciA9IHRbMF0sIG4gPSAxLCBhID0gdC5sZW5ndGg7IG4gPCBhOyBuKyspIHIgPSBpKHIsIHRbbl0sIGUpOwogICAgICByZXR1cm4gcjsKICAgIH0KICAgIGZ1bmN0aW9uIG8odCwgZSkgewogICAgICBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsKICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBzKHQsIGUsIHIpIHsKICAgICAgZm9yICh2YXIgbiBpbiBlKSBlLmhhc093blByb3BlcnR5KG4pICYmIChyID8gbnVsbCAhPSBlW25dIDogbnVsbCA9PSB0W25dKSAmJiAodFtuXSA9IGVbbl0pOwogICAgICByZXR1cm4gdDsKICAgIH0KICAgIGZ1bmN0aW9uIGwoKSB7CiAgICAgIHJldHVybiAkIHx8ICgkID0gVSgpLmdldENvbnRleHQoIjJkIikpLCAkOwogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlKSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgaWYgKHQuaW5kZXhPZikgcmV0dXJuIHQuaW5kZXhPZihlKTsKICAgICAgICBmb3IgKHZhciByID0gMCwgbiA9IHQubGVuZ3RoOyByIDwgbjsgcisrKSBpZiAodFtyXSA9PT0gZSkgcmV0dXJuIHI7CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgZnVuY3Rpb24gdSh0LCBlKSB7CiAgICAgIGZ1bmN0aW9uIHIoKSB7fQogICAgICB2YXIgbiA9IHQucHJvdG90eXBlOwogICAgICByLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCB0LnByb3RvdHlwZSA9IG5ldyByKCk7CiAgICAgIGZvciAodmFyIGkgaW4gbikgdC5wcm90b3R5cGVbaV0gPSBuW2ldOwogICAgICB0LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHQsIHQuc3VwZXJDbGFzcyA9IGU7CiAgICB9CiAgICBmdW5jdGlvbiBjKHQsIGUsIHIpIHsKICAgICAgdCA9ICJwcm90b3R5cGUiIGluIHQgPyB0LnByb3RvdHlwZSA6IHQsIGUgPSAicHJvdG90eXBlIiBpbiBlID8gZS5wcm90b3R5cGUgOiBlLCBzKHQsIGUsIHIpOwogICAgfQogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIGlmICh0KSByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIHQgJiYgIm51bWJlciIgPT0gdHlwZW9mIHQubGVuZ3RoOwogICAgfQogICAgZnVuY3Rpb24gZCh0LCBlLCByKSB7CiAgICAgIGlmICh0ICYmIGUpIGlmICh0LmZvckVhY2ggJiYgdC5mb3JFYWNoID09PSBIKSB0LmZvckVhY2goZSwgcik7ZWxzZSBpZiAodC5sZW5ndGggPT09ICt0Lmxlbmd0aCkgZm9yICh2YXIgbiA9IDAsIGkgPSB0Lmxlbmd0aDsgbiA8IGk7IG4rKykgZS5jYWxsKHIsIHRbbl0sIG4sIHQpO2Vsc2UgZm9yICh2YXIgYSBpbiB0KSB0Lmhhc093blByb3BlcnR5KGEpICYmIGUuY2FsbChyLCB0W2FdLCBhLCB0KTsKICAgIH0KICAgIGZ1bmN0aW9uIHYodCwgZSwgcikgewogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgaWYgKHQubWFwICYmIHQubWFwID09PSBZKSByZXR1cm4gdC5tYXAoZSwgcik7CiAgICAgICAgZm9yICh2YXIgbiA9IFtdLCBpID0gMCwgYSA9IHQubGVuZ3RoOyBpIDwgYTsgaSsrKSBuLnB1c2goZS5jYWxsKHIsIHRbaV0sIGksIHQpKTsKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZyh0LCBlLCByLCBuKSB7CiAgICAgIGlmICh0ICYmIGUpIHsKICAgICAgICBpZiAodC5yZWR1Y2UgJiYgdC5yZWR1Y2UgPT09IFYpIHJldHVybiB0LnJlZHVjZShlLCByLCBuKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgYSA9IHQubGVuZ3RoOyBpIDwgYTsgaSsrKSByID0gZS5jYWxsKG4sIHIsIHRbaV0sIGksIHQpOwogICAgICAgIHJldHVybiByOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwKHQsIGUsIHIpIHsKICAgICAgaWYgKHQgJiYgZSkgewogICAgICAgIGlmICh0LmZpbHRlciAmJiB0LmZpbHRlciA9PT0gaikgcmV0dXJuIHQuZmlsdGVyKGUsIHIpOwogICAgICAgIGZvciAodmFyIG4gPSBbXSwgaSA9IDAsIGEgPSB0Lmxlbmd0aDsgaSA8IGE7IGkrKykgZS5jYWxsKHIsIHRbaV0sIGksIHQpICYmIG4ucHVzaCh0W2ldKTsKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gbSh0LCBlLCByKSB7CiAgICAgIGlmICh0ICYmIGUpIGZvciAodmFyIG4gPSAwLCBpID0gdC5sZW5ndGg7IG4gPCBpOyBuKyspIGlmIChlLmNhbGwociwgdFtuXSwgbiwgdCkpIHJldHVybiB0W25dOwogICAgfQogICAgZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHZhciByID0gWC5jYWxsKGFyZ3VtZW50cywgMik7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHQuYXBwbHkoZSwgci5jb25jYXQoWC5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHkodCkgewogICAgICB2YXIgZSA9IFguY2FsbChhcmd1bWVudHMsIDEpOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0LmFwcGx5KHRoaXMsIGUuY29uY2F0KFguY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiB3KHQpIHsKICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IFcuY2FsbCh0KTsKICAgIH0KICAgIGZ1bmN0aW9uIF8odCkgewogICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGIodCkgewogICAgICByZXR1cm4gIltvYmplY3QgU3RyaW5nXSIgPT09IFcuY2FsbCh0KTsKICAgIH0KICAgIGZ1bmN0aW9uIFModCkgewogICAgICB2YXIgZSA9IHR5cGVvZiB0OwogICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gZSB8fCAhIXQgJiYgIm9iamVjdCIgPT0gZTsKICAgIH0KICAgIGZ1bmN0aW9uIE0odCkgewogICAgICByZXR1cm4gISFOW1cuY2FsbCh0KV07CiAgICB9CiAgICBmdW5jdGlvbiBUKHQpIHsKICAgICAgcmV0dXJuICJvYmplY3QiID09IHR5cGVvZiB0ICYmICJudW1iZXIiID09IHR5cGVvZiB0Lm5vZGVUeXBlICYmICJvYmplY3QiID09IHR5cGVvZiB0Lm93bmVyRG9jdW1lbnQ7CiAgICB9CiAgICBmdW5jdGlvbiBrKHQpIHsKICAgICAgcmV0dXJuIHQgIT09IHQ7CiAgICB9CiAgICBmdW5jdGlvbiBDKHQpIHsKICAgICAgZm9yICh2YXIgZSA9IDAsIHIgPSBhcmd1bWVudHMubGVuZ3RoOyBlIDwgcjsgZSsrKSBpZiAobnVsbCAhPSBhcmd1bWVudHNbZV0pIHJldHVybiBhcmd1bWVudHNbZV07CiAgICB9CiAgICBmdW5jdGlvbiBQKHQsIGUpIHsKICAgICAgcmV0dXJuIG51bGwgIT0gdCA/IHQgOiBlOwogICAgfQogICAgZnVuY3Rpb24gSSh0LCBlLCByKSB7CiAgICAgIHJldHVybiBudWxsICE9IHQgPyB0IDogbnVsbCAhPSBlID8gZSA6IHI7CiAgICB9CiAgICBmdW5jdGlvbiBBKCkgewogICAgICByZXR1cm4gRnVuY3Rpb24uY2FsbC5hcHBseShYLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gTyh0KSB7CiAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgdCkgcmV0dXJuIFt0LCB0LCB0LCB0XTsKICAgICAgdmFyIGUgPSB0Lmxlbmd0aDsKICAgICAgcmV0dXJuIDIgPT09IGUgPyBbdFswXSwgdFsxXSwgdFswXSwgdFsxXV0gOiAzID09PSBlID8gW3RbMF0sIHRbMV0sIHRbMl0sIHRbMV1dIDogdDsKICAgIH0KICAgIGZ1bmN0aW9uIEQodCwgZSkgewogICAgICBpZiAoIXQpIHRocm93IG5ldyBFcnJvcihlKTsKICAgIH0KICAgIGZ1bmN0aW9uIEwodCkgewogICAgICB0W1pdID0gITA7CiAgICB9CiAgICBmdW5jdGlvbiBGKHQpIHsKICAgICAgcmV0dXJuIHRbWl07CiAgICB9CiAgICBmdW5jdGlvbiBSKHQpIHsKICAgICAgdCAmJiBkKHQsIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdGhpcy5zZXQoZSwgdCk7CiAgICAgIH0sIHRoaXMpOwogICAgfQogICAgZnVuY3Rpb24gQih0KSB7CiAgICAgIHJldHVybiBuZXcgUih0KTsKICAgIH0KICAgIGZ1bmN0aW9uIHooKSB7fQogICAgdmFyIE4gPSB7CiAgICAgICAgIltvYmplY3QgRnVuY3Rpb25dIjogMSwKICAgICAgICAiW29iamVjdCBSZWdFeHBdIjogMSwKICAgICAgICAiW29iamVjdCBEYXRlXSI6IDEsCiAgICAgICAgIltvYmplY3QgRXJyb3JdIjogMSwKICAgICAgICAiW29iamVjdCBDYW52YXNHcmFkaWVudF0iOiAxLAogICAgICAgICJbb2JqZWN0IENhbnZhc1BhdHRlcm5dIjogMSwKICAgICAgICAiW29iamVjdCBJbWFnZV0iOiAxLAogICAgICAgICJbb2JqZWN0IENhbnZhc10iOiAxCiAgICAgIH0sCiAgICAgIEUgPSB7CiAgICAgICAgIltvYmplY3QgSW50OEFycmF5XSI6IDEsCiAgICAgICAgIltvYmplY3QgVWludDhBcnJheV0iOiAxLAogICAgICAgICJbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSI6IDEsCiAgICAgICAgIltvYmplY3QgSW50MTZBcnJheV0iOiAxLAogICAgICAgICJbb2JqZWN0IFVpbnQxNkFycmF5XSI6IDEsCiAgICAgICAgIltvYmplY3QgSW50MzJBcnJheV0iOiAxLAogICAgICAgICJbb2JqZWN0IFVpbnQzMkFycmF5XSI6IDEsCiAgICAgICAgIltvYmplY3QgRmxvYXQzMkFycmF5XSI6IDEsCiAgICAgICAgIltvYmplY3QgRmxvYXQ2NEFycmF5XSI6IDEKICAgICAgfSwKICAgICAgVyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsCiAgICAgIHEgPSBBcnJheS5wcm90b3R5cGUsCiAgICAgIEggPSBxLmZvckVhY2gsCiAgICAgIGogPSBxLmZpbHRlciwKICAgICAgWCA9IHEuc2xpY2UsCiAgICAgIFkgPSBxLm1hcCwKICAgICAgViA9IHEucmVkdWNlLAogICAgICBHID0ge30sCiAgICAgIFUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIEcuY3JlYXRlQ2FudmFzKCk7CiAgICAgIH07CiAgICBHLmNyZWF0ZUNhbnZhcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgfTsKICAgIHZhciAkLAogICAgICBaID0gIl9fZWNfcHJpbWl0aXZlX18iOwogICAgUi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBSLAogICAgICBnZXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXNbIl9lY18iICsgdF07CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gdGhpc1siX2VjXyIgKyB0XSA9IGUsIGU7CiAgICAgIH0sCiAgICAgIGVhY2g6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdm9pZCAwICE9PSBlICYmICh0ID0geCh0LCBlKSk7CiAgICAgICAgZm9yICh2YXIgciBpbiB0aGlzKSB0aGlzLmhhc093blByb3BlcnR5KHIpICYmIHQodGhpc1tyXSwgci5zbGljZSg0KSk7CiAgICAgIH0sCiAgICAgIHJlbW92ZUtleTogZnVuY3Rpb24gKHQpIHsKICAgICAgICBkZWxldGUgdGhpc1siX2VjXyIgKyB0XTsKICAgICAgfQogICAgfSwgZS4kb3ZlcnJpZGUgPSByLCBlLmNsb25lID0gbiwgZS5tZXJnZSA9IGksIGUubWVyZ2VBbGwgPSBhLCBlLmV4dGVuZCA9IG8sIGUuZGVmYXVsdHMgPSBzLCBlLmNyZWF0ZUNhbnZhcyA9IFUsIGUuZ2V0Q29udGV4dCA9IGwsIGUuaW5kZXhPZiA9IGgsIGUuaW5oZXJpdHMgPSB1LCBlLm1peGluID0gYywgZS5pc0FycmF5TGlrZSA9IGYsIGUuZWFjaCA9IGQsIGUubWFwID0gdiwgZS5yZWR1Y2UgPSBnLCBlLmZpbHRlciA9IHAsIGUuZmluZCA9IG0sIGUuYmluZCA9IHgsIGUuY3VycnkgPSB5LCBlLmlzQXJyYXkgPSB3LCBlLmlzRnVuY3Rpb24gPSBfLCBlLmlzU3RyaW5nID0gYiwgZS5pc09iamVjdCA9IFMsIGUuaXNCdWlsdEluT2JqZWN0ID0gTSwgZS5pc0RvbSA9IFQsIGUuZXFOYU4gPSBrLCBlLnJldHJpZXZlID0gQywgZS5yZXRyaWV2ZTIgPSBQLCBlLnJldHJpZXZlMyA9IEksIGUuc2xpY2UgPSBBLCBlLm5vcm1hbGl6ZUNzc0FycmF5ID0gTywgZS5hc3NlcnQgPSBELCBlLnNldEFzUHJpbWl0aXZlID0gTCwgZS5pc1ByaW1pdGl2ZSA9IEYsIGUuY3JlYXRlSGFzaE1hcCA9IEIsIGUubm9vcCA9IHo7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICBpLmNhbGwodGhpcywgdCksIHRoaXMucGF0aCA9IG51bGw7CiAgICB9CiAgICB2YXIgaSA9IHIoMTIpLAogICAgICBhID0gcigwKSwKICAgICAgbyA9IHIoNiksCiAgICAgIHMgPSByKDUwKSwKICAgICAgbCA9IHIoNTYpLAogICAgICBoID0gbC5wcm90b3R5cGUuZ2V0Q2FudmFzUGF0dGVybiwKICAgICAgdSA9IE1hdGguYWJzLAogICAgICBjID0gbmV3IG8oITApOwogICAgbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBuLAogICAgICB0eXBlOiAicGF0aCIsCiAgICAgIF9fZGlydHlQYXRoOiAhMCwKICAgICAgc3Ryb2tlQ29udGFpblRocmVzaG9sZDogNSwKICAgICAgYnJ1c2g6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnN0eWxlLAogICAgICAgICAgbiA9IHRoaXMucGF0aCB8fCBjLAogICAgICAgICAgaSA9IHIuaGFzU3Ryb2tlKCksCiAgICAgICAgICBhID0gci5oYXNGaWxsKCksCiAgICAgICAgICBvID0gci5maWxsLAogICAgICAgICAgcyA9IHIuc3Ryb2tlLAogICAgICAgICAgbCA9IGEgJiYgISFvLmNvbG9yU3RvcHMsCiAgICAgICAgICB1ID0gaSAmJiAhIXMuY29sb3JTdG9wcywKICAgICAgICAgIGYgPSBhICYmICEhby5pbWFnZSwKICAgICAgICAgIGQgPSBpICYmICEhcy5pbWFnZTsKICAgICAgICBpZiAoci5iaW5kKHQsIHRoaXMsIGUpLCB0aGlzLnNldFRyYW5zZm9ybSh0KSwgdGhpcy5fX2RpcnR5KSB7CiAgICAgICAgICB2YXIgdjsKICAgICAgICAgIGwgJiYgKHYgPSB2IHx8IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCksIHRoaXMuX2ZpbGxHcmFkaWVudCA9IHIuZ2V0R3JhZGllbnQodCwgbywgdikpLCB1ICYmICh2ID0gdiB8fCB0aGlzLmdldEJvdW5kaW5nUmVjdCgpLCB0aGlzLl9zdHJva2VHcmFkaWVudCA9IHIuZ2V0R3JhZGllbnQodCwgcywgdikpOwogICAgICAgIH0KICAgICAgICBsID8gdC5maWxsU3R5bGUgPSB0aGlzLl9maWxsR3JhZGllbnQgOiBmICYmICh0LmZpbGxTdHlsZSA9IGguY2FsbChvLCB0KSksIHUgPyB0LnN0cm9rZVN0eWxlID0gdGhpcy5fc3Ryb2tlR3JhZGllbnQgOiBkICYmICh0LnN0cm9rZVN0eWxlID0gaC5jYWxsKHMsIHQpKTsKICAgICAgICB2YXIgZyA9IHIubGluZURhc2gsCiAgICAgICAgICBwID0gci5saW5lRGFzaE9mZnNldCwKICAgICAgICAgIG0gPSAhIXQuc2V0TGluZURhc2gsCiAgICAgICAgICB4ID0gdGhpcy5nZXRHbG9iYWxTY2FsZSgpOwogICAgICAgIG4uc2V0U2NhbGUoeFswXSwgeFsxXSksIHRoaXMuX19kaXJ0eVBhdGggfHwgZyAmJiAhbSAmJiBpID8gKG4uYmVnaW5QYXRoKHQpLCBnICYmICFtICYmIChuLnNldExpbmVEYXNoKGcpLCBuLnNldExpbmVEYXNoT2Zmc2V0KHApKSwgdGhpcy5idWlsZFBhdGgobiwgdGhpcy5zaGFwZSwgITEpLCB0aGlzLnBhdGggJiYgKHRoaXMuX19kaXJ0eVBhdGggPSAhMSkpIDogKHQuYmVnaW5QYXRoKCksIHRoaXMucGF0aC5yZWJ1aWxkUGF0aCh0KSksIGEgJiYgbi5maWxsKHQpLCBnICYmIG0gJiYgKHQuc2V0TGluZURhc2goZyksIHQubGluZURhc2hPZmZzZXQgPSBwKSwgaSAmJiBuLnN0cm9rZSh0KSwgZyAmJiBtICYmIHQuc2V0TGluZURhc2goW10pLCB0aGlzLnJlc3RvcmVUcmFuc2Zvcm0odCksIG51bGwgIT0gci50ZXh0ICYmIHRoaXMuZHJhd1JlY3RUZXh0KHQsIHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkpOwogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uICh0LCBlLCByKSB7fSwKICAgICAgY3JlYXRlUGF0aFByb3h5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5wYXRoID0gbmV3IG8oKTsKICAgICAgfSwKICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLl9yZWN0LAogICAgICAgICAgZSA9IHRoaXMuc3R5bGUsCiAgICAgICAgICByID0gIXQ7CiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgIHZhciBuID0gdGhpcy5wYXRoOwogICAgICAgICAgbiB8fCAobiA9IHRoaXMucGF0aCA9IG5ldyBvKCkpLCB0aGlzLl9fZGlydHlQYXRoICYmIChuLmJlZ2luUGF0aCgpLCB0aGlzLmJ1aWxkUGF0aChuLCB0aGlzLnNoYXBlLCAhMSkpLCB0ID0gbi5nZXRCb3VuZGluZ1JlY3QoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX3JlY3QgPSB0LCBlLmhhc1N0cm9rZSgpKSB7CiAgICAgICAgICB2YXIgaSA9IHRoaXMuX3JlY3RXaXRoU3Ryb2tlIHx8ICh0aGlzLl9yZWN0V2l0aFN0cm9rZSA9IHQuY2xvbmUoKSk7CiAgICAgICAgICBpZiAodGhpcy5fX2RpcnR5IHx8IHIpIHsKICAgICAgICAgICAgaS5jb3B5KHQpOwogICAgICAgICAgICB2YXIgYSA9IGUubGluZVdpZHRoLAogICAgICAgICAgICAgIHMgPSBlLnN0cm9rZU5vU2NhbGUgPyB0aGlzLmdldExpbmVTY2FsZSgpIDogMTsKICAgICAgICAgICAgZS5oYXNGaWxsKCkgfHwgKGEgPSBNYXRoLm1heChhLCB0aGlzLnN0cm9rZUNvbnRhaW5UaHJlc2hvbGQgfHwgNCkpLCBzID4gMWUtMTAgJiYgKGkud2lkdGggKz0gYSAvIHMsIGkuaGVpZ2h0ICs9IGEgLyBzLCBpLnggLT0gYSAvIHMgLyAyLCBpLnkgLT0gYSAvIHMgLyAyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgICAgfSwKICAgICAgY29udGFpbjogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMudHJhbnNmb3JtQ29vcmRUb0xvY2FsKHQsIGUpLAogICAgICAgICAgbiA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCksCiAgICAgICAgICBpID0gdGhpcy5zdHlsZTsKICAgICAgICBpZiAodCA9IHJbMF0sIGUgPSByWzFdLCBuLmNvbnRhaW4odCwgZSkpIHsKICAgICAgICAgIHZhciBhID0gdGhpcy5wYXRoLmRhdGE7CiAgICAgICAgICBpZiAoaS5oYXNTdHJva2UoKSkgewogICAgICAgICAgICB2YXIgbyA9IGkubGluZVdpZHRoLAogICAgICAgICAgICAgIGwgPSBpLnN0cm9rZU5vU2NhbGUgPyB0aGlzLmdldExpbmVTY2FsZSgpIDogMTsKICAgICAgICAgICAgaWYgKGwgPiAxZS0xMCAmJiAoaS5oYXNGaWxsKCkgfHwgKG8gPSBNYXRoLm1heChvLCB0aGlzLnN0cm9rZUNvbnRhaW5UaHJlc2hvbGQpKSwgcy5jb250YWluU3Ryb2tlKGEsIG8gLyBsLCB0LCBlKSkpIHJldHVybiAhMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpLmhhc0ZpbGwoKSkgcmV0dXJuIHMuY29udGFpbihhLCB0LCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICExOwogICAgICB9LAogICAgICBkaXJ0eTogZnVuY3Rpb24gKHQpIHsKICAgICAgICBudWxsID09IHQgJiYgKHQgPSAhMCksIHQgJiYgKHRoaXMuX19kaXJ0eVBhdGggPSB0LCB0aGlzLl9yZWN0ID0gbnVsbCksIHRoaXMuX19kaXJ0eSA9ICEwLCB0aGlzLl9fenIgJiYgdGhpcy5fX3pyLnJlZnJlc2goKSwgdGhpcy5fX2NsaXBUYXJnZXQgJiYgdGhpcy5fX2NsaXBUYXJnZXQuZGlydHkoKTsKICAgICAgfSwKICAgICAgYW5pbWF0ZVNoYXBlOiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGUoInNoYXBlIiwgdCk7CiAgICAgIH0sCiAgICAgIGF0dHJLVjogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAic2hhcGUiID09PSB0ID8gKHRoaXMuc2V0U2hhcGUoZSksIHRoaXMuX19kaXJ0eVBhdGggPSAhMCwgdGhpcy5fcmVjdCA9IG51bGwpIDogaS5wcm90b3R5cGUuYXR0cktWLmNhbGwodGhpcywgdCwgZSk7CiAgICAgIH0sCiAgICAgIHNldFNoYXBlOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5zaGFwZTsKICAgICAgICBpZiAocikgewogICAgICAgICAgaWYgKGEuaXNPYmplY3QodCkpIGZvciAodmFyIG4gaW4gdCkgdC5oYXNPd25Qcm9wZXJ0eShuKSAmJiAocltuXSA9IHRbbl0pO2Vsc2Ugclt0XSA9IGU7CiAgICAgICAgICB0aGlzLmRpcnR5KCEwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGdldExpbmVTY2FsZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy50cmFuc2Zvcm07CiAgICAgICAgcmV0dXJuIHQgJiYgdSh0WzBdIC0gMSkgPiAxZS0xMCAmJiB1KHRbM10gLSAxKSA+IDFlLTEwID8gTWF0aC5zcXJ0KHUodFswXSAqIHRbM10gLSB0WzJdICogdFsxXSkpIDogMTsKICAgICAgfQogICAgfSwgbi5leHRlbmQgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbi5jYWxsKHRoaXMsIGUpLCB0LnN0eWxlICYmIHRoaXMuc3R5bGUuZXh0ZW5kRnJvbSh0LnN0eWxlLCAhMSk7CiAgICAgICAgdmFyIHIgPSB0LnNoYXBlOwogICAgICAgIGlmIChyKSB7CiAgICAgICAgICB0aGlzLnNoYXBlID0gdGhpcy5zaGFwZSB8fCB7fTsKICAgICAgICAgIHZhciBpID0gdGhpcy5zaGFwZTsKICAgICAgICAgIGZvciAodmFyIGEgaW4gcikgIWkuaGFzT3duUHJvcGVydHkoYSkgJiYgci5oYXNPd25Qcm9wZXJ0eShhKSAmJiAoaVthXSA9IHJbYV0pOwogICAgICAgIH0KICAgICAgICB0LmluaXQgJiYgdC5pbml0LmNhbGwodGhpcywgZSk7CiAgICAgIH07CiAgICAgIGEuaW5oZXJpdHMoZSwgbik7CiAgICAgIGZvciAodmFyIHIgaW4gdCkgInN0eWxlIiAhPT0gciAmJiAic2hhcGUiICE9PSByICYmIChlLnByb3RvdHlwZVtyXSA9IHRbcl0pOwogICAgICByZXR1cm4gZTsKICAgIH0sIGEuaW5oZXJpdHMobiwgaSk7CiAgICB2YXIgZiA9IG47CiAgICB0LmV4cG9ydHMgPSBmOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgdmFyIHIgPSBuZXcgUygyKTsKICAgICAgcmV0dXJuIG51bGwgPT0gdCAmJiAodCA9IDApLCBudWxsID09IGUgJiYgKGUgPSAwKSwgclswXSA9IHQsIHJbMV0gPSBlLCByOwogICAgfQogICAgZnVuY3Rpb24gbih0LCBlKSB7CiAgICAgIHJldHVybiB0WzBdID0gZVswXSwgdFsxXSA9IGVbMV0sIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgdmFyIGUgPSBuZXcgUygyKTsKICAgICAgcmV0dXJuIGVbMF0gPSB0WzBdLCBlWzFdID0gdFsxXSwgZTsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IGUsIHRbMV0gPSByLCB0OwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIHJldHVybiB0WzBdID0gZVswXSArIHJbMF0sIHRbMV0gPSBlWzFdICsgclsxXSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gKyByWzBdICogbiwgdFsxXSA9IGVbMV0gKyByWzFdICogbiwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gLSByWzBdLCB0WzFdID0gZVsxXSAtIHJbMV0sIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBoKHQpIHsKICAgICAgcmV0dXJuIE1hdGguc3FydCh1KHQpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHUodCkgewogICAgICByZXR1cm4gdFswXSAqIHRbMF0gKyB0WzFdICogdFsxXTsKICAgIH0KICAgIGZ1bmN0aW9uIGModCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gKiByWzBdLCB0WzFdID0gZVsxXSAqIHJbMV0sIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBmKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdIC8gclswXSwgdFsxXSA9IGVbMV0gLyByWzFdLCB0OwogICAgfQogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIHJldHVybiB0WzBdICogZVswXSArIHRbMV0gKiBlWzFdOwogICAgfQogICAgZnVuY3Rpb24gdih0LCBlLCByKSB7CiAgICAgIHJldHVybiB0WzBdID0gZVswXSAqIHIsIHRbMV0gPSBlWzFdICogciwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGcodCwgZSkgewogICAgICB2YXIgciA9IGgoZSk7CiAgICAgIHJldHVybiAwID09PSByID8gKHRbMF0gPSAwLCB0WzFdID0gMCkgOiAodFswXSA9IGVbMF0gLyByLCB0WzFdID0gZVsxXSAvIHIpLCB0OwogICAgfQogICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHRbMF0gLSBlWzBdKSAqICh0WzBdIC0gZVswXSkgKyAodFsxXSAtIGVbMV0pICogKHRbMV0gLSBlWzFdKSk7CiAgICB9CiAgICBmdW5jdGlvbiBtKHQsIGUpIHsKICAgICAgcmV0dXJuICh0WzBdIC0gZVswXSkgKiAodFswXSAtIGVbMF0pICsgKHRbMV0gLSBlWzFdKSAqICh0WzFdIC0gZVsxXSk7CiAgICB9CiAgICBmdW5jdGlvbiB4KHQsIGUpIHsKICAgICAgcmV0dXJuIHRbMF0gPSAtZVswXSwgdFsxXSA9IC1lWzFdLCB0OwogICAgfQogICAgZnVuY3Rpb24geSh0LCBlLCByLCBuKSB7CiAgICAgIHJldHVybiB0WzBdID0gZVswXSArIG4gKiAoclswXSAtIGVbMF0pLCB0WzFdID0gZVsxXSArIG4gKiAoclsxXSAtIGVbMV0pLCB0OwogICAgfQogICAgZnVuY3Rpb24gdyh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gZVswXSwKICAgICAgICBpID0gZVsxXTsKICAgICAgcmV0dXJuIHRbMF0gPSByWzBdICogbiArIHJbMl0gKiBpICsgcls0XSwgdFsxXSA9IHJbMV0gKiBuICsgclszXSAqIGkgKyByWzVdLCB0OwogICAgfQogICAgZnVuY3Rpb24gXyh0LCBlLCByKSB7CiAgICAgIHJldHVybiB0WzBdID0gTWF0aC5taW4oZVswXSwgclswXSksIHRbMV0gPSBNYXRoLm1pbihlWzFdLCByWzFdKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGIodCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IE1hdGgubWF4KGVbMF0sIHJbMF0pLCB0WzFdID0gTWF0aC5tYXgoZVsxXSwgclsxXSksIHQ7CiAgICB9CiAgICB2YXIgUyA9ICJ1bmRlZmluZWQiID09IHR5cGVvZiBGbG9hdDMyQXJyYXkgPyBBcnJheSA6IEZsb2F0MzJBcnJheSwKICAgICAgTSA9IGgsCiAgICAgIFQgPSB1LAogICAgICBrID0gcCwKICAgICAgQyA9IG07CiAgICBlLmNyZWF0ZSA9IHIsIGUuY29weSA9IG4sIGUuY2xvbmUgPSBpLCBlLnNldCA9IGEsIGUuYWRkID0gbywgZS5zY2FsZUFuZEFkZCA9IHMsIGUuc3ViID0gbCwgZS5sZW4gPSBoLCBlLmxlbmd0aCA9IE0sIGUubGVuU3F1YXJlID0gdSwgZS5sZW5ndGhTcXVhcmUgPSBULCBlLm11bCA9IGMsIGUuZGl2ID0gZiwgZS5kb3QgPSBkLCBlLnNjYWxlID0gdiwgZS5ub3JtYWxpemUgPSBnLCBlLmRpc3RhbmNlID0gcCwgZS5kaXN0ID0gaywgZS5kaXN0YW5jZVNxdWFyZSA9IG0sIGUuZGlzdFNxdWFyZSA9IEMsIGUubmVnYXRlID0geCwgZS5sZXJwID0geSwgZS5hcHBseVRyYW5zZm9ybSA9IHcsIGUubWluID0gXywgZS5tYXggPSBiOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIsIG4pIHsKICAgICAgciA8IDAgJiYgKHQgKz0gciwgciA9IC1yKSwgbiA8IDAgJiYgKGUgKz0gbiwgbiA9IC1uKSwgdGhpcy54ID0gdCwgdGhpcy55ID0gZSwgdGhpcy53aWR0aCA9IHIsIHRoaXMuaGVpZ2h0ID0gbjsKICAgIH0KICAgIHZhciBpID0gcigyKSwKICAgICAgYSA9IHIoOCksCiAgICAgIG8gPSBpLmFwcGx5VHJhbnNmb3JtLAogICAgICBzID0gTWF0aC5taW4sCiAgICAgIGwgPSBNYXRoLm1heDsKICAgIG4ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbiwKICAgICAgdW5pb246IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSBzKHQueCwgdGhpcy54KSwKICAgICAgICAgIHIgPSBzKHQueSwgdGhpcy55KTsKICAgICAgICB0aGlzLndpZHRoID0gbCh0LnggKyB0LndpZHRoLCB0aGlzLnggKyB0aGlzLndpZHRoKSAtIGUsIHRoaXMuaGVpZ2h0ID0gbCh0LnkgKyB0LmhlaWdodCwgdGhpcy55ICsgdGhpcy5oZWlnaHQpIC0gciwgdGhpcy54ID0gZSwgdGhpcy55ID0gcjsKICAgICAgfSwKICAgICAgYXBwbHlUcmFuc2Zvcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IFtdLAogICAgICAgICAgZSA9IFtdLAogICAgICAgICAgciA9IFtdLAogICAgICAgICAgbiA9IFtdOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoaSkgewogICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgdFswXSA9IHJbMF0gPSB0aGlzLngsIHRbMV0gPSBuWzFdID0gdGhpcy55LCBlWzBdID0gblswXSA9IHRoaXMueCArIHRoaXMud2lkdGgsIGVbMV0gPSByWzFdID0gdGhpcy55ICsgdGhpcy5oZWlnaHQsIG8odCwgdCwgaSksIG8oZSwgZSwgaSksIG8ociwgciwgaSksIG8obiwgbiwgaSksIHRoaXMueCA9IHModFswXSwgZVswXSwgclswXSwgblswXSksIHRoaXMueSA9IHModFsxXSwgZVsxXSwgclsxXSwgblsxXSk7CiAgICAgICAgICAgIHZhciBhID0gbCh0WzBdLCBlWzBdLCByWzBdLCBuWzBdKSwKICAgICAgICAgICAgICBoID0gbCh0WzFdLCBlWzFdLCByWzFdLCBuWzFdKTsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IGEgLSB0aGlzLngsIHRoaXMuaGVpZ2h0ID0gaCAtIHRoaXMueTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KCksCiAgICAgIGNhbGN1bGF0ZVRyYW5zZm9ybTogZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICByID0gdC53aWR0aCAvIGUud2lkdGgsCiAgICAgICAgICBuID0gdC5oZWlnaHQgLyBlLmhlaWdodCwKICAgICAgICAgIGkgPSBhLmNyZWF0ZSgpOwogICAgICAgIHJldHVybiBhLnRyYW5zbGF0ZShpLCBpLCBbLWUueCwgLWUueV0pLCBhLnNjYWxlKGksIGksIFtyLCBuXSksIGEudHJhbnNsYXRlKGksIGksIFt0LngsIHQueV0pLCBpOwogICAgICB9LAogICAgICBpbnRlcnNlY3Q6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKCF0KSByZXR1cm4gITE7CiAgICAgICAgdCBpbnN0YW5jZW9mIG4gfHwgKHQgPSBuLmNyZWF0ZSh0KSk7CiAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgciA9IGUueCwKICAgICAgICAgIGkgPSBlLnggKyBlLndpZHRoLAogICAgICAgICAgYSA9IGUueSwKICAgICAgICAgIG8gPSBlLnkgKyBlLmhlaWdodCwKICAgICAgICAgIHMgPSB0LngsCiAgICAgICAgICBsID0gdC54ICsgdC53aWR0aCwKICAgICAgICAgIGggPSB0LnksCiAgICAgICAgICB1ID0gdC55ICsgdC5oZWlnaHQ7CiAgICAgICAgcmV0dXJuICEoaSA8IHMgfHwgbCA8IHIgfHwgbyA8IGggfHwgdSA8IGEpOwogICAgICB9LAogICAgICBjb250YWluOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByID0gdGhpczsKICAgICAgICByZXR1cm4gdCA+PSByLnggJiYgdCA8PSByLnggKyByLndpZHRoICYmIGUgPj0gci55ICYmIGUgPD0gci55ICsgci5oZWlnaHQ7CiAgICAgIH0sCiAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBuKHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICAgIH0sCiAgICAgIGNvcHk6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdGhpcy54ID0gdC54LCB0aGlzLnkgPSB0LnksIHRoaXMud2lkdGggPSB0LndpZHRoLCB0aGlzLmhlaWdodCA9IHQuaGVpZ2h0OwogICAgICB9LAogICAgICBwbGFpbjogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiB0aGlzLngsCiAgICAgICAgICB5OiB0aGlzLnksCiAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCwKICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQKICAgICAgICB9OwogICAgICB9CiAgICB9LCBuLmNyZWF0ZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBuZXcgbih0LngsIHQueSwgdC53aWR0aCwgdC5oZWlnaHQpOwogICAgfTsKICAgIHZhciBoID0gbjsKICAgIHQuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCA+IC1iICYmIHQgPCBiOwogICAgfQogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIHJldHVybiB0ID4gYiB8fCB0IDwgLWI7CiAgICB9CiAgICBmdW5jdGlvbiBhKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIGEgPSAxIC0gaTsKICAgICAgcmV0dXJuIGEgKiBhICogKGEgKiB0ICsgMyAqIGkgKiBlKSArIGkgKiBpICogKGkgKiBuICsgMyAqIGEgKiByKTsKICAgIH0KICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IDEgLSBpOwogICAgICByZXR1cm4gMyAqICgoKGUgLSB0KSAqIGEgKyAyICogKHIgLSBlKSAqIGkpICogYSArIChuIC0gcikgKiBpICogaSk7CiAgICB9CiAgICBmdW5jdGlvbiBzKHQsIGUsIHIsIGksIGEsIG8pIHsKICAgICAgdmFyIHMgPSBpICsgMyAqIChlIC0gcikgLSB0LAogICAgICAgIGwgPSAzICogKHIgLSAyICogZSArIHQpLAogICAgICAgIGggPSAzICogKGUgLSB0KSwKICAgICAgICB1ID0gdCAtIGEsCiAgICAgICAgYyA9IGwgKiBsIC0gMyAqIHMgKiBoLAogICAgICAgIGYgPSBsICogaCAtIDkgKiBzICogdSwKICAgICAgICBkID0gaCAqIGggLSAzICogbCAqIHUsCiAgICAgICAgdiA9IDA7CiAgICAgIGlmIChuKGMpICYmIG4oZikpIHsKICAgICAgICBpZiAobihsKSkgb1swXSA9IDA7ZWxzZSB7CiAgICAgICAgICB2YXIgZyA9IC1oIC8gbDsKICAgICAgICAgIGcgPj0gMCAmJiBnIDw9IDEgJiYgKG9bdisrXSA9IGcpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcCA9IGYgKiBmIC0gNCAqIGMgKiBkOwogICAgICAgIGlmIChuKHApKSB7CiAgICAgICAgICB2YXIgbSA9IGYgLyBjLAogICAgICAgICAgICBnID0gLWwgLyBzICsgbSwKICAgICAgICAgICAgeCA9IC1tIC8gMjsKICAgICAgICAgIGcgPj0gMCAmJiBnIDw9IDEgJiYgKG9bdisrXSA9IGcpLCB4ID49IDAgJiYgeCA8PSAxICYmIChvW3YrK10gPSB4KTsKICAgICAgICB9IGVsc2UgaWYgKHAgPiAwKSB7CiAgICAgICAgICB2YXIgeSA9IF8ocCksCiAgICAgICAgICAgIGIgPSBjICogbCArIDEuNSAqIHMgKiAoLWYgKyB5KSwKICAgICAgICAgICAgUyA9IGMgKiBsICsgMS41ICogcyAqICgtZiAtIHkpOwogICAgICAgICAgYiA9IGIgPCAwID8gLXcoLWIsIFQpIDogdyhiLCBUKSwgUyA9IFMgPCAwID8gLXcoLVMsIFQpIDogdyhTLCBUKTsKICAgICAgICAgIHZhciBnID0gKC1sIC0gKGIgKyBTKSkgLyAoMyAqIHMpOwogICAgICAgICAgZyA+PSAwICYmIGcgPD0gMSAmJiAob1t2KytdID0gZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBrID0gKDIgKiBjICogbCAtIDMgKiBzICogZikgLyAoMiAqIF8oYyAqIGMgKiBjKSksCiAgICAgICAgICAgIEMgPSBNYXRoLmFjb3MoaykgLyAzLAogICAgICAgICAgICBQID0gXyhjKSwKICAgICAgICAgICAgSSA9IE1hdGguY29zKEMpLAogICAgICAgICAgICBnID0gKC1sIC0gMiAqIFAgKiBJKSAvICgzICogcyksCiAgICAgICAgICAgIHggPSAoLWwgKyBQICogKEkgKyBNICogTWF0aC5zaW4oQykpKSAvICgzICogcyksCiAgICAgICAgICAgIEEgPSAoLWwgKyBQICogKEkgLSBNICogTWF0aC5zaW4oQykpKSAvICgzICogcyk7CiAgICAgICAgICBnID49IDAgJiYgZyA8PSAxICYmIChvW3YrK10gPSBnKSwgeCA+PSAwICYmIHggPD0gMSAmJiAob1t2KytdID0geCksIEEgPj0gMCAmJiBBIDw9IDEgJiYgKG9bdisrXSA9IEEpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdjsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgciwgYSwgbykgewogICAgICB2YXIgcyA9IDYgKiByIC0gMTIgKiBlICsgNiAqIHQsCiAgICAgICAgbCA9IDkgKiBlICsgMyAqIGEgLSAzICogdCAtIDkgKiByLAogICAgICAgIGggPSAzICogZSAtIDMgKiB0LAogICAgICAgIHUgPSAwOwogICAgICBpZiAobihsKSkgewogICAgICAgIGlmIChpKHMpKSB7CiAgICAgICAgICB2YXIgYyA9IC1oIC8gczsKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZiA9IHMgKiBzIC0gNCAqIGwgKiBoOwogICAgICAgIGlmIChuKGYpKSBvWzBdID0gLXMgLyAoMiAqIGwpO2Vsc2UgaWYgKGYgPiAwKSB7CiAgICAgICAgICB2YXIgZCA9IF8oZiksCiAgICAgICAgICAgIGMgPSAoLXMgKyBkKSAvICgyICogbCksCiAgICAgICAgICAgIHYgPSAoLXMgLSBkKSAvICgyICogbCk7CiAgICAgICAgICBjID49IDAgJiYgYyA8PSAxICYmIChvW3UrK10gPSBjKSwgdiA+PSAwICYmIHYgPD0gMSAmJiAob1t1KytdID0gdik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB1OwogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlLCByLCBuLCBpLCBhKSB7CiAgICAgIHZhciBvID0gKGUgLSB0KSAqIGkgKyB0LAogICAgICAgIHMgPSAociAtIGUpICogaSArIGUsCiAgICAgICAgbCA9IChuIC0gcikgKiBpICsgciwKICAgICAgICBoID0gKHMgLSBvKSAqIGkgKyBvLAogICAgICAgIHUgPSAobCAtIHMpICogaSArIHMsCiAgICAgICAgYyA9ICh1IC0gaCkgKiBpICsgaDsKICAgICAgYVswXSA9IHQsIGFbMV0gPSBvLCBhWzJdID0gaCwgYVszXSA9IGMsIGFbNF0gPSBjLCBhWzVdID0gdSwgYVs2XSA9IGwsIGFbN10gPSBuOwogICAgfQogICAgZnVuY3Rpb24gdSh0LCBlLCByLCBuLCBpLCBvLCBzLCBsLCBoLCB1LCBjKSB7CiAgICAgIHZhciBmLAogICAgICAgIGQsCiAgICAgICAgdiwKICAgICAgICBnLAogICAgICAgIHAsCiAgICAgICAgbSA9IC4wMDUsCiAgICAgICAgeCA9IDEgLyAwOwogICAgICBrWzBdID0gaCwga1sxXSA9IHU7CiAgICAgIGZvciAodmFyIHcgPSAwOyB3IDwgMTsgdyArPSAuMDUpIENbMF0gPSBhKHQsIHIsIGksIHMsIHcpLCBDWzFdID0gYShlLCBuLCBvLCBsLCB3KSwgKGcgPSB5KGssIEMpKSA8IHggJiYgKGYgPSB3LCB4ID0gZyk7CiAgICAgIHggPSAxIC8gMDsKICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCAzMiAmJiAhKG0gPCBTKTsgYisrKSBkID0gZiAtIG0sIHYgPSBmICsgbSwgQ1swXSA9IGEodCwgciwgaSwgcywgZCksIENbMV0gPSBhKGUsIG4sIG8sIGwsIGQpLCBnID0geShDLCBrKSwgZCA+PSAwICYmIGcgPCB4ID8gKGYgPSBkLCB4ID0gZykgOiAoUFswXSA9IGEodCwgciwgaSwgcywgdiksIFBbMV0gPSBhKGUsIG4sIG8sIGwsIHYpLCBwID0geShQLCBrKSwgdiA8PSAxICYmIHAgPCB4ID8gKGYgPSB2LCB4ID0gcCkgOiBtICo9IC41KTsKICAgICAgcmV0dXJuIGMgJiYgKGNbMF0gPSBhKHQsIHIsIGksIHMsIGYpLCBjWzFdID0gYShlLCBuLCBvLCBsLCBmKSksIF8oeCk7CiAgICB9CiAgICBmdW5jdGlvbiBjKHQsIGUsIHIsIG4pIHsKICAgICAgdmFyIGkgPSAxIC0gbjsKICAgICAgcmV0dXJuIGkgKiAoaSAqIHQgKyAyICogbiAqIGUpICsgbiAqIG4gKiByOwogICAgfQogICAgZnVuY3Rpb24gZih0LCBlLCByLCBuKSB7CiAgICAgIHJldHVybiAyICogKCgxIC0gbikgKiAoZSAtIHQpICsgbiAqIChyIC0gZSkpOwogICAgfQogICAgZnVuY3Rpb24gZCh0LCBlLCByLCBhLCBvKSB7CiAgICAgIHZhciBzID0gdCAtIDIgKiBlICsgciwKICAgICAgICBsID0gMiAqIChlIC0gdCksCiAgICAgICAgaCA9IHQgLSBhLAogICAgICAgIHUgPSAwOwogICAgICBpZiAobihzKSkgewogICAgICAgIGlmIChpKGwpKSB7CiAgICAgICAgICB2YXIgYyA9IC1oIC8gbDsKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZiA9IGwgKiBsIC0gNCAqIHMgKiBoOwogICAgICAgIGlmIChuKGYpKSB7CiAgICAgICAgICB2YXIgYyA9IC1sIC8gKDIgKiBzKTsKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpOwogICAgICAgIH0gZWxzZSBpZiAoZiA+IDApIHsKICAgICAgICAgIHZhciBkID0gXyhmKSwKICAgICAgICAgICAgYyA9ICgtbCArIGQpIC8gKDIgKiBzKSwKICAgICAgICAgICAgdiA9ICgtbCAtIGQpIC8gKDIgKiBzKTsKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpLCB2ID49IDAgJiYgdiA8PSAxICYmIChvW3UrK10gPSB2KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHU7CiAgICB9CiAgICBmdW5jdGlvbiB2KHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSB0ICsgciAtIDIgKiBlOwogICAgICByZXR1cm4gMCA9PT0gbiA/IC41IDogKHQgLSBlKSAvIG47CiAgICB9CiAgICBmdW5jdGlvbiBnKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIGEgPSAoZSAtIHQpICogbiArIHQsCiAgICAgICAgbyA9IChyIC0gZSkgKiBuICsgZSwKICAgICAgICBzID0gKG8gLSBhKSAqIG4gKyBhOwogICAgICBpWzBdID0gdCwgaVsxXSA9IGEsIGlbMl0gPSBzLCBpWzNdID0gcywgaVs0XSA9IG8sIGlbNV0gPSByOwogICAgfQogICAgZnVuY3Rpb24gcCh0LCBlLCByLCBuLCBpLCBhLCBvLCBzLCBsKSB7CiAgICAgIHZhciBoLAogICAgICAgIHUgPSAuMDA1LAogICAgICAgIGYgPSAxIC8gMDsKICAgICAga1swXSA9IG8sIGtbMV0gPSBzOwogICAgICBmb3IgKHZhciBkID0gMDsgZCA8IDE7IGQgKz0gLjA1KSB7CiAgICAgICAgQ1swXSA9IGModCwgciwgaSwgZCksIENbMV0gPSBjKGUsIG4sIGEsIGQpOwogICAgICAgIHZhciB2ID0geShrLCBDKTsKICAgICAgICB2IDwgZiAmJiAoaCA9IGQsIGYgPSB2KTsKICAgICAgfQogICAgICBmID0gMSAvIDA7CiAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgMzIgJiYgISh1IDwgUyk7IGcrKykgewogICAgICAgIHZhciBwID0gaCAtIHUsCiAgICAgICAgICBtID0gaCArIHU7CiAgICAgICAgQ1swXSA9IGModCwgciwgaSwgcCksIENbMV0gPSBjKGUsIG4sIGEsIHApOwogICAgICAgIHZhciB2ID0geShDLCBrKTsKICAgICAgICBpZiAocCA+PSAwICYmIHYgPCBmKSBoID0gcCwgZiA9IHY7ZWxzZSB7CiAgICAgICAgICBQWzBdID0gYyh0LCByLCBpLCBtKSwgUFsxXSA9IGMoZSwgbiwgYSwgbSk7CiAgICAgICAgICB2YXIgeCA9IHkoUCwgayk7CiAgICAgICAgICBtIDw9IDEgJiYgeCA8IGYgPyAoaCA9IG0sIGYgPSB4KSA6IHUgKj0gLjU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBsICYmIChsWzBdID0gYyh0LCByLCBpLCBoKSwgbFsxXSA9IGMoZSwgbiwgYSwgaCkpLCBfKGYpOwogICAgfQogICAgdmFyIG0gPSByKDIpLAogICAgICB4ID0gbS5jcmVhdGUsCiAgICAgIHkgPSBtLmRpc3RTcXVhcmUsCiAgICAgIHcgPSBNYXRoLnBvdywKICAgICAgXyA9IE1hdGguc3FydCwKICAgICAgYiA9IDFlLTgsCiAgICAgIFMgPSAxZS00LAogICAgICBNID0gXygzKSwKICAgICAgVCA9IDEgLyAzLAogICAgICBrID0geCgpLAogICAgICBDID0geCgpLAogICAgICBQID0geCgpOwogICAgZS5jdWJpY0F0ID0gYSwgZS5jdWJpY0Rlcml2YXRpdmVBdCA9IG8sIGUuY3ViaWNSb290QXQgPSBzLCBlLmN1YmljRXh0cmVtYSA9IGwsIGUuY3ViaWNTdWJkaXZpZGUgPSBoLCBlLmN1YmljUHJvamVjdFBvaW50ID0gdSwgZS5xdWFkcmF0aWNBdCA9IGMsIGUucXVhZHJhdGljRGVyaXZhdGl2ZUF0ID0gZiwgZS5xdWFkcmF0aWNSb290QXQgPSBkLCBlLnF1YWRyYXRpY0V4dHJlbXVtID0gdiwgZS5xdWFkcmF0aWNTdWJkaXZpZGUgPSBnLCBlLnF1YWRyYXRpY1Byb2plY3RQb2ludCA9IHA7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSkgewogICAgICBMW3RdID0gZTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICBlID0gZSB8fCBEOwogICAgICB2YXIgciA9IHQgKyAiOiIgKyBlOwogICAgICBpZiAoUFtyXSkgcmV0dXJuIFBbcl07CiAgICAgIGZvciAodmFyIG4gPSAodCArICIiKS5zcGxpdCgiXG4iKSwgaSA9IDAsIGEgPSAwLCBvID0gbi5sZW5ndGg7IGEgPCBvOyBhKyspIGkgPSBNYXRoLm1heChwKG5bYV0sIGUpLndpZHRoLCBpKTsKICAgICAgcmV0dXJuIEkgPiBBICYmIChJID0gMCwgUCA9IHt9KSwgSSsrLCBQW3JdID0gaSwgaTsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgaSwgYSwgbCkgewogICAgICByZXR1cm4gYSA/IHModCwgZSwgciwgbiwgaSwgYSwgbCkgOiBvKHQsIGUsIHIsIG4sIGksIGwpOwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByLCBuLCBhLCBvKSB7CiAgICAgIHZhciBzID0gbSh0LCBlLCBhLCBvKSwKICAgICAgICB1ID0gaSh0LCBlKTsKICAgICAgYSAmJiAodSArPSBhWzFdICsgYVszXSk7CiAgICAgIHZhciBjID0gcy5vdXRlckhlaWdodCwKICAgICAgICBmID0gbCgwLCB1LCByKSwKICAgICAgICBkID0gaCgwLCBjLCBuKSwKICAgICAgICB2ID0gbmV3IF8oZiwgZCwgdSwgYyk7CiAgICAgIHJldHVybiB2LmxpbmVIZWlnaHQgPSBzLmxpbmVIZWlnaHQsIHY7CiAgICB9CiAgICBmdW5jdGlvbiBzKHQsIGUsIHIsIG4sIGksIGEsIG8pIHsKICAgICAgdmFyIHMgPSB4KHQsIHsKICAgICAgICAgIHJpY2g6IGEsCiAgICAgICAgICB0cnVuY2F0ZTogbywKICAgICAgICAgIGZvbnQ6IGUsCiAgICAgICAgICB0ZXh0QWxpZ246IHIsCiAgICAgICAgICB0ZXh0UGFkZGluZzogaQogICAgICAgIH0pLAogICAgICAgIHUgPSBzLm91dGVyV2lkdGgsCiAgICAgICAgYyA9IHMub3V0ZXJIZWlnaHQsCiAgICAgICAgZiA9IGwoMCwgdSwgciksCiAgICAgICAgZCA9IGgoMCwgYywgbik7CiAgICAgIHJldHVybiBuZXcgXyhmLCBkLCB1LCBjKTsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICByZXR1cm4gInJpZ2h0IiA9PT0gciA/IHQgLT0gZSA6ICJjZW50ZXIiID09PSByICYmICh0IC09IGUgLyAyKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGgodCwgZSwgcikgewogICAgICByZXR1cm4gIm1pZGRsZSIgPT09IHIgPyB0IC09IGUgLyAyIDogImJvdHRvbSIgPT09IHIgJiYgKHQgLT0gZSksIHQ7CiAgICB9CiAgICBmdW5jdGlvbiB1KHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlLngsCiAgICAgICAgaSA9IGUueSwKICAgICAgICBhID0gZS5oZWlnaHQsCiAgICAgICAgbyA9IGUud2lkdGgsCiAgICAgICAgcyA9IGEgLyAyLAogICAgICAgIGwgPSAibGVmdCIsCiAgICAgICAgaCA9ICJ0b3AiOwogICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgIG4gLT0gciwgaSArPSBzLCBsID0gInJpZ2h0IiwgaCA9ICJtaWRkbGUiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgICAgbiArPSByICsgbywgaSArPSBzLCBoID0gIm1pZGRsZSI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgbiArPSBvIC8gMiwgaSAtPSByLCBsID0gImNlbnRlciIsIGggPSAiYm90dG9tIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICBuICs9IG8gLyAyLCBpICs9IGEgKyByLCBsID0gImNlbnRlciI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbnNpZGUiOgogICAgICAgICAgbiArPSBvIC8gMiwgaSArPSBzLCBsID0gImNlbnRlciIsIGggPSAibWlkZGxlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZUxlZnQiOgogICAgICAgICAgbiArPSByLCBpICs9IHMsIGggPSAibWlkZGxlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZVJpZ2h0IjoKICAgICAgICAgIG4gKz0gbyAtIHIsIGkgKz0gcywgbCA9ICJyaWdodCIsIGggPSAibWlkZGxlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZVRvcCI6CiAgICAgICAgICBuICs9IG8gLyAyLCBpICs9IHIsIGwgPSAiY2VudGVyIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZUJvdHRvbSI6CiAgICAgICAgICBuICs9IG8gLyAyLCBpICs9IGEgLSByLCBsID0gImNlbnRlciIsIGggPSAiYm90dG9tIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZVRvcExlZnQiOgogICAgICAgICAgbiArPSByLCBpICs9IHI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbnNpZGVUb3BSaWdodCI6CiAgICAgICAgICBuICs9IG8gLSByLCBpICs9IHIsIGwgPSAicmlnaHQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaW5zaWRlQm90dG9tTGVmdCI6CiAgICAgICAgICBuICs9IHIsIGkgKz0gYSAtIHIsIGggPSAiYm90dG9tIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluc2lkZUJvdHRvbVJpZ2h0IjoKICAgICAgICAgIG4gKz0gbyAtIHIsIGkgKz0gYSAtIHIsIGwgPSAicmlnaHQiLCBoID0gImJvdHRvbSI7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBuLAogICAgICAgIHk6IGksCiAgICAgICAgdGV4dEFsaWduOiBsLAogICAgICAgIHRleHRWZXJ0aWNhbEFsaWduOiBoCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBjKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgaWYgKCFlKSByZXR1cm4gIiI7CiAgICAgIHZhciBhID0gKHQgKyAiIikuc3BsaXQoIlxuIik7CiAgICAgIGkgPSBmKGUsIHIsIG4sIGkpOwogICAgICBmb3IgKHZhciBvID0gMCwgcyA9IGEubGVuZ3RoOyBvIDwgczsgbysrKSBhW29dID0gZChhW29dLCBpKTsKICAgICAgcmV0dXJuIGEuam9pbigiXG4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGYodCwgZSwgciwgbikgewogICAgICBuID0gVCh7fSwgbiksIG4uZm9udCA9IGU7CiAgICAgIHZhciByID0gayhyLCAiLi4uIik7CiAgICAgIG4ubWF4SXRlcmF0aW9ucyA9IGsobi5tYXhJdGVyYXRpb25zLCAyKTsKICAgICAgdmFyIGEgPSBuLm1pbkNoYXIgPSBrKG4ubWluQ2hhciwgMCk7CiAgICAgIG4uY25DaGFyV2lkdGggPSBpKCLlm70iLCBlKTsKICAgICAgdmFyIG8gPSBuLmFzY0NoYXJXaWR0aCA9IGkoImEiLCBlKTsKICAgICAgbi5wbGFjZWhvbGRlciA9IGsobi5wbGFjZWhvbGRlciwgIiIpOwogICAgICBmb3IgKHZhciBzID0gdCA9IE1hdGgubWF4KDAsIHQgLSAxKSwgbCA9IDA7IGwgPCBhICYmIHMgPj0gbzsgbCsrKSBzIC09IG87CiAgICAgIHZhciBoID0gaShyKTsKICAgICAgcmV0dXJuIGggPiBzICYmIChyID0gIiIsIGggPSAwKSwgcyA9IHQgLSBoLCBuLmVsbGlwc2lzID0gciwgbi5lbGxpcHNpc1dpZHRoID0gaCwgbi5jb250ZW50V2lkdGggPSBzLCBuLmNvbnRhaW5lcldpZHRoID0gdCwgbjsKICAgIH0KICAgIGZ1bmN0aW9uIGQodCwgZSkgewogICAgICB2YXIgciA9IGUuY29udGFpbmVyV2lkdGgsCiAgICAgICAgbiA9IGUuZm9udCwKICAgICAgICBhID0gZS5jb250ZW50V2lkdGg7CiAgICAgIGlmICghcikgcmV0dXJuICIiOwogICAgICB2YXIgbyA9IGkodCwgbik7CiAgICAgIGlmIChvIDw9IHIpIHJldHVybiB0OwogICAgICBmb3IgKHZhciBzID0gMDs7IHMrKykgewogICAgICAgIGlmIChvIDw9IGEgfHwgcyA+PSBlLm1heEl0ZXJhdGlvbnMpIHsKICAgICAgICAgIHQgKz0gZS5lbGxpcHNpczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB2YXIgbCA9IDAgPT09IHMgPyB2KHQsIGEsIGUuYXNjQ2hhcldpZHRoLCBlLmNuQ2hhcldpZHRoKSA6IG8gPiAwID8gTWF0aC5mbG9vcih0Lmxlbmd0aCAqIGEgLyBvKSA6IDA7CiAgICAgICAgdCA9IHQuc3Vic3RyKDAsIGwpLCBvID0gaSh0LCBuKTsKICAgICAgfQogICAgICByZXR1cm4gIiIgPT09IHQgJiYgKHQgPSBlLnBsYWNlaG9sZGVyKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIHYodCwgZSwgciwgbikgewogICAgICBmb3IgKHZhciBpID0gMCwgYSA9IDAsIG8gPSB0Lmxlbmd0aDsgYSA8IG8gJiYgaSA8IGU7IGErKykgewogICAgICAgIHZhciBzID0gdC5jaGFyQ29kZUF0KGEpOwogICAgICAgIGkgKz0gMCA8PSBzICYmIHMgPD0gMTI3ID8gciA6IG47CiAgICAgIH0KICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICBmdW5jdGlvbiBnKHQpIHsKICAgICAgcmV0dXJuIGkoIuWbvSIsIHQpOwogICAgfQogICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgIHJldHVybiBMLm1lYXN1cmVUZXh0KHQsIGUpOwogICAgfQogICAgZnVuY3Rpb24gbSh0LCBlLCByLCBuKSB7CiAgICAgIG51bGwgIT0gdCAmJiAodCArPSAiIik7CiAgICAgIHZhciBpID0gZyhlKSwKICAgICAgICBhID0gdCA/IHQuc3BsaXQoIlxuIikgOiBbXSwKICAgICAgICBvID0gYS5sZW5ndGggKiBpLAogICAgICAgIHMgPSBvOwogICAgICBpZiAociAmJiAocyArPSByWzBdICsgclsyXSksIHQgJiYgbikgewogICAgICAgIHZhciBsID0gbi5vdXRlckhlaWdodCwKICAgICAgICAgIGggPSBuLm91dGVyV2lkdGg7CiAgICAgICAgaWYgKG51bGwgIT0gbCAmJiBzID4gbCkgdCA9ICIiLCBhID0gW107ZWxzZSBpZiAobnVsbCAhPSBoKSBmb3IgKHZhciB1ID0gZihoIC0gKHIgPyByWzFdICsgclszXSA6IDApLCBlLCBuLmVsbGlwc2lzLCB7CiAgICAgICAgICAgIG1pbkNoYXI6IG4ubWluQ2hhciwKICAgICAgICAgICAgcGxhY2Vob2xkZXI6IG4ucGxhY2Vob2xkZXIKICAgICAgICAgIH0pLCBjID0gMCwgdiA9IGEubGVuZ3RoOyBjIDwgdjsgYysrKSBhW2NdID0gZChhW2NdLCB1KTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGxpbmVzOiBhLAogICAgICAgIGhlaWdodDogbywKICAgICAgICBvdXRlckhlaWdodDogcywKICAgICAgICBsaW5lSGVpZ2h0OiBpCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiB4KHQsIGUpIHsKICAgICAgdmFyIHIgPSB7CiAgICAgICAgbGluZXM6IFtdLAogICAgICAgIHdpZHRoOiAwLAogICAgICAgIGhlaWdodDogMAogICAgICB9OwogICAgICBpZiAobnVsbCAhPSB0ICYmICh0ICs9ICIiKSwgIXQpIHJldHVybiByOwogICAgICBmb3IgKHZhciBuLCBhID0gTy5sYXN0SW5kZXggPSAwOyBudWxsICE9IChuID0gTy5leGVjKHQpKTspIHsKICAgICAgICB2YXIgbyA9IG4uaW5kZXg7CiAgICAgICAgbyA+IGEgJiYgeShyLCB0LnN1YnN0cmluZyhhLCBvKSksIHkociwgblsyXSwgblsxXSksIGEgPSBPLmxhc3RJbmRleDsKICAgICAgfQogICAgICBhIDwgdC5sZW5ndGggJiYgeShyLCB0LnN1YnN0cmluZyhhLCB0Lmxlbmd0aCkpOwogICAgICB2YXIgcyA9IHIubGluZXMsCiAgICAgICAgbCA9IDAsCiAgICAgICAgaCA9IDAsCiAgICAgICAgdSA9IFtdLAogICAgICAgIGYgPSBlLnRleHRQYWRkaW5nLAogICAgICAgIGQgPSBlLnRydW5jYXRlLAogICAgICAgIHYgPSBkICYmIGQub3V0ZXJXaWR0aCwKICAgICAgICBwID0gZCAmJiBkLm91dGVySGVpZ2h0OwogICAgICBmICYmIChudWxsICE9IHYgJiYgKHYgLT0gZlsxXSArIGZbM10pLCBudWxsICE9IHAgJiYgKHAgLT0gZlswXSArIGZbMl0pKTsKICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBzLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgZm9yICh2YXIgeCA9IHNbbV0sIHcgPSAwLCBfID0gMCwgUyA9IDA7IFMgPCB4LnRva2Vucy5sZW5ndGg7IFMrKykgewogICAgICAgICAgdmFyIE0gPSB4LnRva2Vuc1tTXSwKICAgICAgICAgICAgVCA9IE0uc3R5bGVOYW1lICYmIGUucmljaFtNLnN0eWxlTmFtZV0gfHwge30sCiAgICAgICAgICAgIFAgPSBNLnRleHRQYWRkaW5nID0gVC50ZXh0UGFkZGluZywKICAgICAgICAgICAgSSA9IE0uZm9udCA9IFQuZm9udCB8fCBlLmZvbnQsCiAgICAgICAgICAgIEEgPSBNLnRleHRIZWlnaHQgPSBrKFQudGV4dEhlaWdodCwgZyhJKSk7CiAgICAgICAgICBpZiAoUCAmJiAoQSArPSBQWzBdICsgUFsyXSksIE0uaGVpZ2h0ID0gQSwgTS5saW5lSGVpZ2h0ID0gQyhULnRleHRMaW5lSGVpZ2h0LCBlLnRleHRMaW5lSGVpZ2h0LCBBKSwgTS50ZXh0QWxpZ24gPSBUICYmIFQudGV4dEFsaWduIHx8IGUudGV4dEFsaWduLCBNLnRleHRWZXJ0aWNhbEFsaWduID0gVCAmJiBULnRleHRWZXJ0aWNhbEFsaWduIHx8ICJtaWRkbGUiLCBudWxsICE9IHAgJiYgbCArIE0ubGluZUhlaWdodCA+IHApIHJldHVybiB7CiAgICAgICAgICAgIGxpbmVzOiBbXSwKICAgICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICAgIGhlaWdodDogMAogICAgICAgICAgfTsKICAgICAgICAgIE0udGV4dFdpZHRoID0gaShNLnRleHQsIEkpOwogICAgICAgICAgdmFyIEQgPSBULnRleHRXaWR0aCwKICAgICAgICAgICAgTCA9IG51bGwgPT0gRCB8fCAiYXV0byIgPT09IEQ7CiAgICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIEQgJiYgIiUiID09PSBELmNoYXJBdChELmxlbmd0aCAtIDEpKSBNLnBlcmNlbnRXaWR0aCA9IEQsIHUucHVzaChNKSwgRCA9IDA7ZWxzZSB7CiAgICAgICAgICAgIGlmIChMKSB7CiAgICAgICAgICAgICAgRCA9IE0udGV4dFdpZHRoOwogICAgICAgICAgICAgIHZhciBGID0gVC50ZXh0QmFja2dyb3VuZENvbG9yLAogICAgICAgICAgICAgICAgUiA9IEYgJiYgRi5pbWFnZTsKICAgICAgICAgICAgICBSICYmIChSID0gYi5maW5kRXhpc3RJbWFnZShSKSwgYi5pc0ltYWdlUmVhZHkoUikgJiYgKEQgPSBNYXRoLm1heChELCBSLndpZHRoICogQSAvIFIuaGVpZ2h0KSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBCID0gUCA/IFBbMV0gKyBQWzNdIDogMDsKICAgICAgICAgICAgRCArPSBCOwogICAgICAgICAgICB2YXIgeiA9IG51bGwgIT0gdiA/IHYgLSBfIDogbnVsbDsKICAgICAgICAgICAgbnVsbCAhPSB6ICYmIHogPCBEICYmICghTCB8fCB6IDwgQiA/IChNLnRleHQgPSAiIiwgTS50ZXh0V2lkdGggPSBEID0gMCkgOiAoTS50ZXh0ID0gYyhNLnRleHQsIHogLSBCLCBJLCBkLmVsbGlwc2lzLCB7CiAgICAgICAgICAgICAgbWluQ2hhcjogZC5taW5DaGFyCiAgICAgICAgICAgIH0pLCBNLnRleHRXaWR0aCA9IGkoTS50ZXh0LCBJKSwgRCA9IE0udGV4dFdpZHRoICsgQikpOwogICAgICAgICAgfQogICAgICAgICAgXyArPSBNLndpZHRoID0gRCwgVCAmJiAodyA9IE1hdGgubWF4KHcsIE0ubGluZUhlaWdodCkpOwogICAgICAgIH0KICAgICAgICB4LndpZHRoID0gXywgeC5saW5lSGVpZ2h0ID0gdywgbCArPSB3LCBoID0gTWF0aC5tYXgoaCwgXyk7CiAgICAgIH0KICAgICAgci5vdXRlcldpZHRoID0gci53aWR0aCA9IGsoZS50ZXh0V2lkdGgsIGgpLCByLm91dGVySGVpZ2h0ID0gci5oZWlnaHQgPSBrKGUudGV4dEhlaWdodCwgbCksIGYgJiYgKHIub3V0ZXJXaWR0aCArPSBmWzFdICsgZlszXSwgci5vdXRlckhlaWdodCArPSBmWzBdICsgZlsyXSk7CiAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgdS5sZW5ndGg7IG0rKykgewogICAgICAgIHZhciBNID0gdVttXSwKICAgICAgICAgIE4gPSBNLnBlcmNlbnRXaWR0aDsKICAgICAgICBNLndpZHRoID0gcGFyc2VJbnQoTiwgMTApIC8gMTAwICogaDsKICAgICAgfQogICAgICByZXR1cm4gcjsKICAgIH0KICAgIGZ1bmN0aW9uIHkodCwgZSwgcikgewogICAgICBmb3IgKHZhciBuID0gIiIgPT09IGUsIGkgPSBlLnNwbGl0KCJcbiIpLCBhID0gdC5saW5lcywgbyA9IDA7IG8gPCBpLmxlbmd0aDsgbysrKSB7CiAgICAgICAgdmFyIHMgPSBpW29dLAogICAgICAgICAgbCA9IHsKICAgICAgICAgICAgc3R5bGVOYW1lOiByLAogICAgICAgICAgICB0ZXh0OiBzLAogICAgICAgICAgICBpc0xpbmVIb2xkZXI6ICFzICYmICFuCiAgICAgICAgICB9OwogICAgICAgIGlmIChvKSBhLnB1c2goewogICAgICAgICAgdG9rZW5zOiBbbF0KICAgICAgICB9KTtlbHNlIHsKICAgICAgICAgIHZhciBoID0gKGFbYS5sZW5ndGggLSAxXSB8fCAoYVswXSA9IHsKICAgICAgICAgICAgICB0b2tlbnM6IFtdCiAgICAgICAgICAgIH0pKS50b2tlbnMsCiAgICAgICAgICAgIHUgPSBoLmxlbmd0aDsKICAgICAgICAgIDEgPT09IHUgJiYgaFswXS5pc0xpbmVIb2xkZXIgPyBoWzBdID0gbCA6IChzIHx8ICF1IHx8IG4pICYmIGgucHVzaChsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHcodCkgewogICAgICByZXR1cm4gKHQuZm9udFNpemUgfHwgdC5mb250RmFtaWx5KSAmJiBbdC5mb250U3R5bGUsIHQuZm9udFdlaWdodCwgKHQuZm9udFNpemUgfHwgMTIpICsgInB4IiwgdC5mb250RmFtaWx5IHx8ICJzYW5zLXNlcmlmIl0uam9pbigiICIpIHx8IHQudGV4dEZvbnQgfHwgdC5mb250OwogICAgfQogICAgdmFyIF8gPSByKDMpLAogICAgICBiID0gcigxMCksCiAgICAgIFMgPSByKDApLAogICAgICBNID0gUy5nZXRDb250ZXh0LAogICAgICBUID0gUy5leHRlbmQsCiAgICAgIGsgPSBTLnJldHJpZXZlMiwKICAgICAgQyA9IFMucmV0cmlldmUzLAogICAgICBQID0ge30sCiAgICAgIEkgPSAwLAogICAgICBBID0gNWUzLAogICAgICBPID0gL1x7KFthLXpBLVowLTlfXSspXHwoW159XSopXH0vZywKICAgICAgRCA9ICIxMnB4IHNhbnMtc2VyaWYiLAogICAgICBMID0ge307CiAgICBMLm1lYXN1cmVUZXh0ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIgPSBNKCk7CiAgICAgIHJldHVybiByLmZvbnQgPSBlIHx8IEQsIHIubWVhc3VyZVRleHQodCk7CiAgICB9LCBlLkRFRkFVTFRfRk9OVCA9IEQsIGUuJG92ZXJyaWRlID0gbiwgZS5nZXRXaWR0aCA9IGksIGUuZ2V0Qm91bmRpbmdSZWN0ID0gYSwgZS5hZGp1c3RUZXh0WCA9IGwsIGUuYWRqdXN0VGV4dFkgPSBoLCBlLmFkanVzdFRleHRQb3NpdGlvbk9uUmVjdCA9IHUsIGUudHJ1bmNhdGVUZXh0ID0gYywgZS5nZXRMaW5lSGVpZ2h0ID0gZywgZS5tZWFzdXJlVGV4dCA9IHAsIGUucGFyc2VQbGFpblRleHQgPSBtLCBlLnBhcnNlUmljaFRleHQgPSB4LCBlLm1ha2VGb250ID0gdzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDQpLAogICAgICBpID0gcigyKSwKICAgICAgYSA9IHIoNDkpLAogICAgICBvID0gcigzKSwKICAgICAgcyA9IHIoMTkpLAogICAgICBsID0gcy5kZXZpY2VQaXhlbFJhdGlvLAogICAgICBoID0gewogICAgICAgIE06IDEsCiAgICAgICAgTDogMiwKICAgICAgICBDOiAzLAogICAgICAgIFE6IDQsCiAgICAgICAgQTogNSwKICAgICAgICBaOiA2LAogICAgICAgIFI6IDcKICAgICAgfSwKICAgICAgdSA9IFtdLAogICAgICBjID0gW10sCiAgICAgIGYgPSBbXSwKICAgICAgZCA9IFtdLAogICAgICB2ID0gTWF0aC5taW4sCiAgICAgIGcgPSBNYXRoLm1heCwKICAgICAgcCA9IE1hdGguY29zLAogICAgICBtID0gTWF0aC5zaW4sCiAgICAgIHggPSBNYXRoLnNxcnQsCiAgICAgIHkgPSBNYXRoLmFicywKICAgICAgdyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBGbG9hdDMyQXJyYXksCiAgICAgIF8gPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMuX3NhdmVEYXRhID0gIXQsIHRoaXMuX3NhdmVEYXRhICYmICh0aGlzLmRhdGEgPSBbXSksIHRoaXMuX2N0eCA9IG51bGw7CiAgICAgIH07CiAgICBfLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IF8sCiAgICAgIF94aTogMCwKICAgICAgX3lpOiAwLAogICAgICBfeDA6IDAsCiAgICAgIF95MDogMCwKICAgICAgX3V4OiAwLAogICAgICBfdXk6IDAsCiAgICAgIF9sZW46IDAsCiAgICAgIF9saW5lRGFzaDogbnVsbCwKICAgICAgX2Rhc2hPZmZzZXQ6IDAsCiAgICAgIF9kYXNoSWR4OiAwLAogICAgICBfZGFzaFN1bTogMCwKICAgICAgc2V0U2NhbGU6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdGhpcy5fdXggPSB5KDEgLyBsIC8gdCkgfHwgMCwgdGhpcy5fdXkgPSB5KDEgLyBsIC8gZSkgfHwgMDsKICAgICAgfSwKICAgICAgZ2V0Q29udGV4dDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdHg7CiAgICAgIH0sCiAgICAgIGJlZ2luUGF0aDogZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3R4ID0gdCwgdCAmJiB0LmJlZ2luUGF0aCgpLCB0ICYmICh0aGlzLmRwciA9IHQuZHByKSwgdGhpcy5fc2F2ZURhdGEgJiYgKHRoaXMuX2xlbiA9IDApLCB0aGlzLl9saW5lRGFzaCAmJiAodGhpcy5fbGluZURhc2ggPSBudWxsLCB0aGlzLl9kYXNoT2Zmc2V0ID0gMCksIHRoaXM7CiAgICAgIH0sCiAgICAgIG1vdmVUbzogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGREYXRhKGguTSwgdCwgZSksIHRoaXMuX2N0eCAmJiB0aGlzLl9jdHgubW92ZVRvKHQsIGUpLCB0aGlzLl94MCA9IHQsIHRoaXMuX3kwID0gZSwgdGhpcy5feGkgPSB0LCB0aGlzLl95aSA9IGUsIHRoaXM7CiAgICAgIH0sCiAgICAgIGxpbmVUbzogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHkodCAtIHRoaXMuX3hpKSA+IHRoaXMuX3V4IHx8IHkoZSAtIHRoaXMuX3lpKSA+IHRoaXMuX3V5IHx8IHRoaXMuX2xlbiA8IDU7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkRGF0YShoLkwsIHQsIGUpLCB0aGlzLl9jdHggJiYgciAmJiAodGhpcy5fbmVlZHNEYXNoKCkgPyB0aGlzLl9kYXNoZWRMaW5lVG8odCwgZSkgOiB0aGlzLl9jdHgubGluZVRvKHQsIGUpKSwgciAmJiAodGhpcy5feGkgPSB0LCB0aGlzLl95aSA9IGUpLCB0aGlzOwogICAgICB9LAogICAgICBiZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSwgYSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZERhdGEoaC5DLCB0LCBlLCByLCBuLCBpLCBhKSwgdGhpcy5fY3R4ICYmICh0aGlzLl9uZWVkc0Rhc2goKSA/IHRoaXMuX2Rhc2hlZEJlemllclRvKHQsIGUsIHIsIG4sIGksIGEpIDogdGhpcy5fY3R4LmJlemllckN1cnZlVG8odCwgZSwgciwgbiwgaSwgYSkpLCB0aGlzLl94aSA9IGksIHRoaXMuX3lpID0gYSwgdGhpczsKICAgICAgfSwKICAgICAgcXVhZHJhdGljQ3VydmVUbzogZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGREYXRhKGguUSwgdCwgZSwgciwgbiksIHRoaXMuX2N0eCAmJiAodGhpcy5fbmVlZHNEYXNoKCkgPyB0aGlzLl9kYXNoZWRRdWFkcmF0aWNUbyh0LCBlLCByLCBuKSA6IHRoaXMuX2N0eC5xdWFkcmF0aWNDdXJ2ZVRvKHQsIGUsIHIsIG4pKSwgdGhpcy5feGkgPSByLCB0aGlzLl95aSA9IG4sIHRoaXM7CiAgICAgIH0sCiAgICAgIGFyYzogZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGksIGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGREYXRhKGguQSwgdCwgZSwgciwgciwgbiwgaSAtIG4sIDAsIGEgPyAwIDogMSksIHRoaXMuX2N0eCAmJiB0aGlzLl9jdHguYXJjKHQsIGUsIHIsIG4sIGksIGEpLCB0aGlzLl94aSA9IHAoaSkgKiByICsgdCwgdGhpcy5feWkgPSBtKGkpICogciArIHQsIHRoaXM7CiAgICAgIH0sCiAgICAgIGFyY1RvOiBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgewogICAgICAgIHJldHVybiB0aGlzLl9jdHggJiYgdGhpcy5fY3R4LmFyY1RvKHQsIGUsIHIsIG4sIGkpLCB0aGlzOwogICAgICB9LAogICAgICByZWN0OiBmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgIHJldHVybiB0aGlzLl9jdHggJiYgdGhpcy5fY3R4LnJlY3QodCwgZSwgciwgbiksIHRoaXMuYWRkRGF0YShoLlIsIHQsIGUsIHIsIG4pLCB0aGlzOwogICAgICB9LAogICAgICBjbG9zZVBhdGg6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmFkZERhdGEoaC5aKTsKICAgICAgICB2YXIgdCA9IHRoaXMuX2N0eCwKICAgICAgICAgIGUgPSB0aGlzLl94MCwKICAgICAgICAgIHIgPSB0aGlzLl95MDsKICAgICAgICByZXR1cm4gdCAmJiAodGhpcy5fbmVlZHNEYXNoKCkgJiYgdGhpcy5fZGFzaGVkTGluZVRvKGUsIHIpLCB0LmNsb3NlUGF0aCgpKSwgdGhpcy5feGkgPSBlLCB0aGlzLl95aSA9IHIsIHRoaXM7CiAgICAgIH0sCiAgICAgIGZpbGw6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdCAmJiB0LmZpbGwoKSwgdGhpcy50b1N0YXRpYygpOwogICAgICB9LAogICAgICBzdHJva2U6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdCAmJiB0LnN0cm9rZSgpLCB0aGlzLnRvU3RhdGljKCk7CiAgICAgIH0sCiAgICAgIHNldExpbmVEYXNoOiBmdW5jdGlvbiAodCkgewogICAgICAgIGlmICh0IGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgIHRoaXMuX2xpbmVEYXNoID0gdCwgdGhpcy5fZGFzaElkeCA9IDA7CiAgICAgICAgICBmb3IgKHZhciBlID0gMCwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSBlICs9IHRbcl07CiAgICAgICAgICB0aGlzLl9kYXNoU3VtID0gZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHNldExpbmVEYXNoT2Zmc2V0OiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0aGlzLl9kYXNoT2Zmc2V0ID0gdCwgdGhpczsKICAgICAgfSwKICAgICAgbGVuOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xlbjsKICAgICAgfSwKICAgICAgc2V0RGF0YTogZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHQubGVuZ3RoOwogICAgICAgIHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoID09IGUgfHwgIXcgfHwgKHRoaXMuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoZSkpOwogICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgZTsgcisrKSB0aGlzLmRhdGFbcl0gPSB0W3JdOwogICAgICAgIHRoaXMuX2xlbiA9IGU7CiAgICAgIH0sCiAgICAgIGFwcGVuZFBhdGg6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdCBpbnN0YW5jZW9mIEFycmF5IHx8ICh0ID0gW3RdKTsKICAgICAgICBmb3IgKHZhciBlID0gdC5sZW5ndGgsIHIgPSAwLCBuID0gdGhpcy5fbGVuLCBpID0gMDsgaSA8IGU7IGkrKykgciArPSB0W2ldLmxlbigpOwogICAgICAgIHcgJiYgdGhpcy5kYXRhIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5ICYmICh0aGlzLmRhdGEgPSBuZXcgRmxvYXQzMkFycmF5KG4gKyByKSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlOyBpKyspIGZvciAodmFyIGEgPSB0W2ldLmRhdGEsIG8gPSAwOyBvIDwgYS5sZW5ndGg7IG8rKykgdGhpcy5kYXRhW24rK10gPSBhW29dOwogICAgICAgIHRoaXMuX2xlbiA9IG47CiAgICAgIH0sCiAgICAgIGFkZERhdGE6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHRoaXMuX3NhdmVEYXRhKSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXMuZGF0YTsKICAgICAgICAgIHRoaXMuX2xlbiArIGFyZ3VtZW50cy5sZW5ndGggPiBlLmxlbmd0aCAmJiAodGhpcy5fZXhwYW5kRGF0YSgpLCBlID0gdGhpcy5kYXRhKTsKICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSBlW3RoaXMuX2xlbisrXSA9IGFyZ3VtZW50c1tyXTsKICAgICAgICAgIHRoaXMuX3ByZXZDbWQgPSB0OwogICAgICAgIH0KICAgICAgfSwKICAgICAgX2V4cGFuZERhdGE6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoISh0aGlzLmRhdGEgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICAgIGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCB0aGlzLl9sZW47IGUrKykgdFtlXSA9IHRoaXMuZGF0YVtlXTsKICAgICAgICAgIHRoaXMuZGF0YSA9IHQ7CiAgICAgICAgfQogICAgICB9LAogICAgICBfbmVlZHNEYXNoOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVEYXNoOwogICAgICB9LAogICAgICBfZGFzaGVkTGluZVRvOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByLAogICAgICAgICAgbiwKICAgICAgICAgIGkgPSB0aGlzLl9kYXNoU3VtLAogICAgICAgICAgYSA9IHRoaXMuX2Rhc2hPZmZzZXQsCiAgICAgICAgICBvID0gdGhpcy5fbGluZURhc2gsCiAgICAgICAgICBzID0gdGhpcy5fY3R4LAogICAgICAgICAgbCA9IHRoaXMuX3hpLAogICAgICAgICAgaCA9IHRoaXMuX3lpLAogICAgICAgICAgdSA9IHQgLSBsLAogICAgICAgICAgYyA9IGUgLSBoLAogICAgICAgICAgZiA9IHgodSAqIHUgKyBjICogYyksCiAgICAgICAgICBkID0gbCwKICAgICAgICAgIHAgPSBoLAogICAgICAgICAgbSA9IG8ubGVuZ3RoOwogICAgICAgIGZvciAodSAvPSBmLCBjIC89IGYsIGEgPCAwICYmIChhID0gaSArIGEpLCBhICU9IGksIGQgLT0gYSAqIHUsIHAgLT0gYSAqIGM7IHUgPiAwICYmIGQgPD0gdCB8fCB1IDwgMCAmJiBkID49IHQgfHwgMCA9PSB1ICYmIChjID4gMCAmJiBwIDw9IGUgfHwgYyA8IDAgJiYgcCA+PSBlKTspIG4gPSB0aGlzLl9kYXNoSWR4LCByID0gb1tuXSwgZCArPSB1ICogciwgcCArPSBjICogciwgdGhpcy5fZGFzaElkeCA9IChuICsgMSkgJSBtLCB1ID4gMCAmJiBkIDwgbCB8fCB1IDwgMCAmJiBkID4gbCB8fCBjID4gMCAmJiBwIDwgaCB8fCBjIDwgMCAmJiBwID4gaCB8fCBzW24gJSAyID8gIm1vdmVUbyIgOiAibGluZVRvIl0odSA+PSAwID8gdihkLCB0KSA6IGcoZCwgdCksIGMgPj0gMCA/IHYocCwgZSkgOiBnKHAsIGUpKTsKICAgICAgICB1ID0gZCAtIHQsIGMgPSBwIC0gZSwgdGhpcy5fZGFzaE9mZnNldCA9IC14KHUgKiB1ICsgYyAqIGMpOwogICAgICB9LAogICAgICBfZGFzaGVkQmV6aWVyVG86IGZ1bmN0aW9uICh0LCBlLCByLCBpLCBhLCBvKSB7CiAgICAgICAgdmFyIHMsCiAgICAgICAgICBsLAogICAgICAgICAgaCwKICAgICAgICAgIHUsCiAgICAgICAgICBjLAogICAgICAgICAgZiA9IHRoaXMuX2Rhc2hTdW0sCiAgICAgICAgICBkID0gdGhpcy5fZGFzaE9mZnNldCwKICAgICAgICAgIHYgPSB0aGlzLl9saW5lRGFzaCwKICAgICAgICAgIGcgPSB0aGlzLl9jdHgsCiAgICAgICAgICBwID0gdGhpcy5feGksCiAgICAgICAgICBtID0gdGhpcy5feWksCiAgICAgICAgICB5ID0gbi5jdWJpY0F0LAogICAgICAgICAgdyA9IDAsCiAgICAgICAgICBfID0gdGhpcy5fZGFzaElkeCwKICAgICAgICAgIGIgPSB2Lmxlbmd0aCwKICAgICAgICAgIFMgPSAwOwogICAgICAgIGZvciAoZCA8IDAgJiYgKGQgPSBmICsgZCksIGQgJT0gZiwgcyA9IDA7IHMgPCAxOyBzICs9IC4xKSBsID0geShwLCB0LCByLCBhLCBzICsgLjEpIC0geShwLCB0LCByLCBhLCBzKSwgaCA9IHkobSwgZSwgaSwgbywgcyArIC4xKSAtIHkobSwgZSwgaSwgbywgcyksIHcgKz0geChsICogbCArIGggKiBoKTsKICAgICAgICBmb3IgKDsgXyA8IGIgJiYgISgoUyArPSB2W19dKSA+IGQpOyBfKyspOwogICAgICAgIGZvciAocyA9IChTIC0gZCkgLyB3OyBzIDw9IDE7KSB1ID0geShwLCB0LCByLCBhLCBzKSwgYyA9IHkobSwgZSwgaSwgbywgcyksIF8gJSAyID8gZy5tb3ZlVG8odSwgYykgOiBnLmxpbmVUbyh1LCBjKSwgcyArPSB2W19dIC8gdywgXyA9IChfICsgMSkgJSBiOwogICAgICAgIF8gJSAyICE9IDAgJiYgZy5saW5lVG8oYSwgbyksIGwgPSBhIC0gdSwgaCA9IG8gLSBjLCB0aGlzLl9kYXNoT2Zmc2V0ID0gLXgobCAqIGwgKyBoICogaCk7CiAgICAgIH0sCiAgICAgIF9kYXNoZWRRdWFkcmF0aWNUbzogZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICB2YXIgaSA9IHIsCiAgICAgICAgICBhID0gbjsKICAgICAgICByID0gKHIgKyAyICogdCkgLyAzLCBuID0gKG4gKyAyICogZSkgLyAzLCB0ID0gKHRoaXMuX3hpICsgMiAqIHQpIC8gMywgZSA9ICh0aGlzLl95aSArIDIgKiBlKSAvIDMsIHRoaXMuX2Rhc2hlZEJlemllclRvKHQsIGUsIHIsIG4sIGksIGEpOwogICAgICB9LAogICAgICB0b1N0YXRpYzogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5kYXRhOwogICAgICAgIHQgaW5zdGFuY2VvZiBBcnJheSAmJiAodC5sZW5ndGggPSB0aGlzLl9sZW4sIHcgJiYgKHRoaXMuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkodCkpKTsKICAgICAgfSwKICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdVswXSA9IHVbMV0gPSBmWzBdID0gZlsxXSA9IE51bWJlci5NQVhfVkFMVUUsIGNbMF0gPSBjWzFdID0gZFswXSA9IGRbMV0gPSAtTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5kYXRhLCBlID0gMCwgciA9IDAsIG4gPSAwLCBzID0gMCwgbCA9IDA7IGwgPCB0Lmxlbmd0aDspIHsKICAgICAgICAgIHZhciB2ID0gdFtsKytdOwogICAgICAgICAgc3dpdGNoICgxID09IGwgJiYgKGUgPSB0W2xdLCByID0gdFtsICsgMV0sIG4gPSBlLCBzID0gciksIHYpIHsKICAgICAgICAgICAgY2FzZSBoLk06CiAgICAgICAgICAgICAgbiA9IHRbbCsrXSwgcyA9IHRbbCsrXSwgZSA9IG4sIHIgPSBzLCBmWzBdID0gbiwgZlsxXSA9IHMsIGRbMF0gPSBuLCBkWzFdID0gczsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBoLkw6CiAgICAgICAgICAgICAgYS5mcm9tTGluZShlLCByLCB0W2xdLCB0W2wgKyAxXSwgZiwgZCksIGUgPSB0W2wrK10sIHIgPSB0W2wrK107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgaC5DOgogICAgICAgICAgICAgIGEuZnJvbUN1YmljKGUsIHIsIHRbbCsrXSwgdFtsKytdLCB0W2wrK10sIHRbbCsrXSwgdFtsXSwgdFtsICsgMV0sIGYsIGQpLCBlID0gdFtsKytdLCByID0gdFtsKytdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguUToKICAgICAgICAgICAgICBhLmZyb21RdWFkcmF0aWMoZSwgciwgdFtsKytdLCB0W2wrK10sIHRbbF0sIHRbbCArIDFdLCBmLCBkKSwgZSA9IHRbbCsrXSwgciA9IHRbbCsrXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBoLkE6CiAgICAgICAgICAgICAgdmFyIGcgPSB0W2wrK10sCiAgICAgICAgICAgICAgICB4ID0gdFtsKytdLAogICAgICAgICAgICAgICAgeSA9IHRbbCsrXSwKICAgICAgICAgICAgICAgIHcgPSB0W2wrK10sCiAgICAgICAgICAgICAgICBfID0gdFtsKytdLAogICAgICAgICAgICAgICAgYiA9IHRbbCsrXSArIF8sCiAgICAgICAgICAgICAgICBTID0gKHRbbCsrXSwgMSAtIHRbbCsrXSk7CiAgICAgICAgICAgICAgMSA9PSBsICYmIChuID0gcChfKSAqIHkgKyBnLCBzID0gbShfKSAqIHcgKyB4KSwgYS5mcm9tQXJjKGcsIHgsIHksIHcsIF8sIGIsIFMsIGYsIGQpLCBlID0gcChiKSAqIHkgKyBnLCByID0gbShiKSAqIHcgKyB4OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguUjoKICAgICAgICAgICAgICBuID0gZSA9IHRbbCsrXSwgcyA9IHIgPSB0W2wrK107CiAgICAgICAgICAgICAgdmFyIE0gPSB0W2wrK10sCiAgICAgICAgICAgICAgICBUID0gdFtsKytdOwogICAgICAgICAgICAgIGEuZnJvbUxpbmUobiwgcywgbiArIE0sIHMgKyBULCBmLCBkKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBoLlo6CiAgICAgICAgICAgICAgZSA9IG4sIHIgPSBzOwogICAgICAgICAgfQogICAgICAgICAgaS5taW4odSwgdSwgZiksIGkubWF4KGMsIGMsIGQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMCA9PT0gbCAmJiAodVswXSA9IHVbMV0gPSBjWzBdID0gY1sxXSA9IDApLCBuZXcgbyh1WzBdLCB1WzFdLCBjWzBdIC0gdVswXSwgY1sxXSAtIHVbMV0pOwogICAgICB9LAogICAgICByZWJ1aWxkUGF0aDogZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlLCByLCBuLCBpLCBhLCBvLCBzID0gdGhpcy5kYXRhLCBsID0gdGhpcy5fdXgsIHUgPSB0aGlzLl91eSwgYyA9IHRoaXMuX2xlbiwgZiA9IDA7IGYgPCBjOykgewogICAgICAgICAgdmFyIGQgPSBzW2YrK107CiAgICAgICAgICBzd2l0Y2ggKDEgPT0gZiAmJiAobiA9IHNbZl0sIGkgPSBzW2YgKyAxXSwgZSA9IG4sIHIgPSBpKSwgZCkgewogICAgICAgICAgICBjYXNlIGguTToKICAgICAgICAgICAgICBlID0gbiA9IHNbZisrXSwgciA9IGkgPSBzW2YrK10sIHQubW92ZVRvKG4sIGkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguTDoKICAgICAgICAgICAgICBhID0gc1tmKytdLCBvID0gc1tmKytdLCAoeShhIC0gbikgPiBsIHx8IHkobyAtIGkpID4gdSB8fCBmID09PSBjIC0gMSkgJiYgKHQubGluZVRvKGEsIG8pLCBuID0gYSwgaSA9IG8pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguQzoKICAgICAgICAgICAgICB0LmJlemllckN1cnZlVG8oc1tmKytdLCBzW2YrK10sIHNbZisrXSwgc1tmKytdLCBzW2YrK10sIHNbZisrXSksIG4gPSBzW2YgLSAyXSwgaSA9IHNbZiAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguUToKICAgICAgICAgICAgICB0LnF1YWRyYXRpY0N1cnZlVG8oc1tmKytdLCBzW2YrK10sIHNbZisrXSwgc1tmKytdKSwgbiA9IHNbZiAtIDJdLCBpID0gc1tmIC0gMV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgaC5BOgogICAgICAgICAgICAgIHZhciB2ID0gc1tmKytdLAogICAgICAgICAgICAgICAgZyA9IHNbZisrXSwKICAgICAgICAgICAgICAgIHggPSBzW2YrK10sCiAgICAgICAgICAgICAgICB3ID0gc1tmKytdLAogICAgICAgICAgICAgICAgXyA9IHNbZisrXSwKICAgICAgICAgICAgICAgIGIgPSBzW2YrK10sCiAgICAgICAgICAgICAgICBTID0gc1tmKytdLAogICAgICAgICAgICAgICAgTSA9IHNbZisrXSwKICAgICAgICAgICAgICAgIFQgPSB4ID4gdyA/IHggOiB3LAogICAgICAgICAgICAgICAgayA9IHggPiB3ID8gMSA6IHggLyB3LAogICAgICAgICAgICAgICAgQyA9IHggPiB3ID8gdyAvIHggOiAxLAogICAgICAgICAgICAgICAgUCA9IE1hdGguYWJzKHggLSB3KSA+IC4wMDEsCiAgICAgICAgICAgICAgICBJID0gXyArIGI7CiAgICAgICAgICAgICAgUCA/ICh0LnRyYW5zbGF0ZSh2LCBnKSwgdC5yb3RhdGUoUyksIHQuc2NhbGUoaywgQyksIHQuYXJjKDAsIDAsIFQsIF8sIEksIDEgLSBNKSwgdC5zY2FsZSgxIC8gaywgMSAvIEMpLCB0LnJvdGF0ZSgtUyksIHQudHJhbnNsYXRlKC12LCAtZykpIDogdC5hcmModiwgZywgVCwgXywgSSwgMSAtIE0pLCAxID09IGYgJiYgKGUgPSBwKF8pICogeCArIHYsIHIgPSBtKF8pICogdyArIGcpLCBuID0gcChJKSAqIHggKyB2LCBpID0gbShJKSAqIHcgKyBnOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguUjoKICAgICAgICAgICAgICBlID0gbiA9IHNbZl0sIHIgPSBpID0gc1tmICsgMV0sIHQucmVjdChzW2YrK10sIHNbZisrXSwgc1tmKytdLCBzW2YrK10pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGguWjoKICAgICAgICAgICAgICB0LmNsb3NlUGF0aCgpLCBuID0gZSwgaSA9IHI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfLkNNRCA9IGg7CiAgICB2YXIgYiA9IF87CiAgICB0LmV4cG9ydHMgPSBiOwogIH0sIGZ1bmN0aW9uIChlLCByKSB7CiAgICBlLmV4cG9ydHMgPSB0OwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICBmdW5jdGlvbiByKCkgewogICAgICB2YXIgdCA9IG5ldyB1KDYpOwogICAgICByZXR1cm4gbih0KSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdFswXSA9IDEsIHRbMV0gPSAwLCB0WzJdID0gMCwgdFszXSA9IDEsIHRbNF0gPSAwLCB0WzVdID0gMCwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0sIHRbMV0gPSBlWzFdLCB0WzJdID0gZVsyXSwgdFszXSA9IGVbM10sIHRbNF0gPSBlWzRdLCB0WzVdID0gZVs1XSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgcikgewogICAgICB2YXIgbiA9IGVbMF0gKiByWzBdICsgZVsyXSAqIHJbMV0sCiAgICAgICAgaSA9IGVbMV0gKiByWzBdICsgZVszXSAqIHJbMV0sCiAgICAgICAgYSA9IGVbMF0gKiByWzJdICsgZVsyXSAqIHJbM10sCiAgICAgICAgbyA9IGVbMV0gKiByWzJdICsgZVszXSAqIHJbM10sCiAgICAgICAgcyA9IGVbMF0gKiByWzRdICsgZVsyXSAqIHJbNV0gKyBlWzRdLAogICAgICAgIGwgPSBlWzFdICogcls0XSArIGVbM10gKiByWzVdICsgZVs1XTsKICAgICAgcmV0dXJuIHRbMF0gPSBuLCB0WzFdID0gaSwgdFsyXSA9IGEsIHRbM10gPSBvLCB0WzRdID0gcywgdFs1XSA9IGwsIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdLCB0WzFdID0gZVsxXSwgdFsyXSA9IGVbMl0sIHRbM10gPSBlWzNdLCB0WzRdID0gZVs0XSArIHJbMF0sIHRbNV0gPSBlWzVdICsgclsxXSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgcikgewogICAgICB2YXIgbiA9IGVbMF0sCiAgICAgICAgaSA9IGVbMl0sCiAgICAgICAgYSA9IGVbNF0sCiAgICAgICAgbyA9IGVbMV0sCiAgICAgICAgcyA9IGVbM10sCiAgICAgICAgbCA9IGVbNV0sCiAgICAgICAgaCA9IE1hdGguc2luKHIpLAogICAgICAgIHUgPSBNYXRoLmNvcyhyKTsKICAgICAgcmV0dXJuIHRbMF0gPSBuICogdSArIG8gKiBoLCB0WzFdID0gLW4gKiBoICsgbyAqIHUsIHRbMl0gPSBpICogdSArIHMgKiBoLCB0WzNdID0gLWkgKiBoICsgdSAqIHMsIHRbNF0gPSB1ICogYSArIGggKiBsLCB0WzVdID0gdSAqIGwgLSBoICogYSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICB2YXIgbiA9IHJbMF0sCiAgICAgICAgaSA9IHJbMV07CiAgICAgIHJldHVybiB0WzBdID0gZVswXSAqIG4sIHRbMV0gPSBlWzFdICogaSwgdFsyXSA9IGVbMl0gKiBuLCB0WzNdID0gZVszXSAqIGksIHRbNF0gPSBlWzRdICogbiwgdFs1XSA9IGVbNV0gKiBpLCB0OwogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlKSB7CiAgICAgIHZhciByID0gZVswXSwKICAgICAgICBuID0gZVsyXSwKICAgICAgICBpID0gZVs0XSwKICAgICAgICBhID0gZVsxXSwKICAgICAgICBvID0gZVszXSwKICAgICAgICBzID0gZVs1XSwKICAgICAgICBsID0gciAqIG8gLSBhICogbjsKICAgICAgcmV0dXJuIGwgPyAobCA9IDEgLyBsLCB0WzBdID0gbyAqIGwsIHRbMV0gPSAtYSAqIGwsIHRbMl0gPSAtbiAqIGwsIHRbM10gPSByICogbCwgdFs0XSA9IChuICogcyAtIG8gKiBpKSAqIGwsIHRbNV0gPSAoYSAqIGkgLSByICogcykgKiBsLCB0KSA6IG51bGw7CiAgICB9CiAgICB2YXIgdSA9ICJ1bmRlZmluZWQiID09IHR5cGVvZiBGbG9hdDMyQXJyYXkgPyBBcnJheSA6IEZsb2F0MzJBcnJheTsKICAgIGUuY3JlYXRlID0gciwgZS5pZGVudGl0eSA9IG4sIGUuY29weSA9IGksIGUubXVsID0gYSwgZS50cmFuc2xhdGUgPSBvLCBlLnJvdGF0ZSA9IHMsIGUuc2NhbGUgPSBsLCBlLmludmVydCA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdC5yZXBsYWNlKC9eXHMrLywgIiIpLnJlcGxhY2UoL1xzKyQvLCAiIik7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQsIGUsIHIsIG4pIHsKICAgICAgdmFyIGkgPSBlWzFdIC0gZVswXSwKICAgICAgICBhID0gclsxXSAtIHJbMF07CiAgICAgIGlmICgwID09PSBpKSByZXR1cm4gMCA9PT0gYSA/IHJbMF0gOiAoclswXSArIHJbMV0pIC8gMjsKICAgICAgaWYgKG4pIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgIGlmICh0IDw9IGVbMF0pIHJldHVybiByWzBdOwogICAgICAgICAgaWYgKHQgPj0gZVsxXSkgcmV0dXJuIHJbMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0ID49IGVbMF0pIHJldHVybiByWzBdOwogICAgICAgICAgaWYgKHQgPD0gZVsxXSkgcmV0dXJuIHJbMV07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0ID09PSBlWzBdKSByZXR1cm4gclswXTsKICAgICAgICBpZiAodCA9PT0gZVsxXSkgcmV0dXJuIHJbMV07CiAgICAgIH0KICAgICAgcmV0dXJuICh0IC0gZVswXSkgLyBpICogYSArIHJbMF07CiAgICB9CiAgICBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgICAgdCA9ICI1MCUiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICAgIHQgPSAiMCUiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICB0ID0gIjEwMCUiOwogICAgICB9CiAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IG4odCkubWF0Y2goLyUkLykgPyBwYXJzZUZsb2F0KHQpIC8gMTAwICogZSA6IHBhcnNlRmxvYXQodCkgOiBudWxsID09IHQgPyBOYU4gOiArdDsKICAgIH0KICAgIGZ1bmN0aW9uIG8odCwgZSwgcikgewogICAgICByZXR1cm4gbnVsbCA9PSBlICYmIChlID0gMTApLCBlID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgZSksIDIwKSwgdCA9ICgrdCkudG9GaXhlZChlKSwgciA/IHQgOiArdDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCkgewogICAgICByZXR1cm4gdC5zb3J0KGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIHQgLSBlOwogICAgICB9KSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCkgewogICAgICBpZiAodCA9ICt0LCBpc05hTih0KSkgcmV0dXJuIDA7CiAgICAgIGZvciAodmFyIGUgPSAxLCByID0gMDsgTWF0aC5yb3VuZCh0ICogZSkgLyBlICE9PSB0OykgZSAqPSAxMCwgcisrOwogICAgICByZXR1cm4gcjsKICAgIH0KICAgIGZ1bmN0aW9uIGgodCkgewogICAgICB2YXIgZSA9IHQudG9TdHJpbmcoKSwKICAgICAgICByID0gZS5pbmRleE9mKCJlIik7CiAgICAgIGlmIChyID4gMCkgewogICAgICAgIHZhciBuID0gK2Uuc2xpY2UociArIDEpOwogICAgICAgIHJldHVybiBuIDwgMCA/IC1uIDogMDsKICAgICAgfQogICAgICB2YXIgaSA9IGUuaW5kZXhPZigiLiIpOwogICAgICByZXR1cm4gaSA8IDAgPyAwIDogZS5sZW5ndGggLSAxIC0gaTsKICAgIH0KICAgIGZ1bmN0aW9uIHUodCwgZSkgewogICAgICB2YXIgciA9IE1hdGgubG9nLAogICAgICAgIG4gPSBNYXRoLkxOMTAsCiAgICAgICAgaSA9IE1hdGguZmxvb3Iocih0WzFdIC0gdFswXSkgLyBuKSwKICAgICAgICBhID0gTWF0aC5yb3VuZChyKE1hdGguYWJzKGVbMV0gLSBlWzBdKSkgLyBuKSwKICAgICAgICBvID0gTWF0aC5taW4oTWF0aC5tYXgoLWkgKyBhLCAwKSwgMjApOwogICAgICByZXR1cm4gaXNGaW5pdGUobykgPyBvIDogMjA7CiAgICB9CiAgICBmdW5jdGlvbiBjKHQsIGUsIHIpIHsKICAgICAgaWYgKCF0W2VdKSByZXR1cm4gMDsKICAgICAgdmFyIG4gPSB3LnJlZHVjZSh0LCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiB0ICsgKGlzTmFOKGUpID8gMCA6IGUpOwogICAgICB9LCAwKTsKICAgICAgaWYgKDAgPT09IG4pIHJldHVybiAwOwogICAgICBmb3IgKHZhciBpID0gTWF0aC5wb3coMTAsIHIpLCBhID0gdy5tYXAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAoaXNOYU4odCkgPyAwIDogdCkgLyBuICogaSAqIDEwMDsKICAgICAgICB9KSwgbyA9IDEwMCAqIGksIHMgPSB3Lm1hcChhLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodCk7CiAgICAgICAgfSksIGwgPSB3LnJlZHVjZShzLCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgcmV0dXJuIHQgKyBlOwogICAgICAgIH0sIDApLCBoID0gdy5tYXAoYSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIHJldHVybiB0IC0gc1tlXTsKICAgICAgICB9KTsgbCA8IG87KSB7CiAgICAgICAgZm9yICh2YXIgdSA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgYyA9IG51bGwsIGYgPSAwLCBkID0gaC5sZW5ndGg7IGYgPCBkOyArK2YpIGhbZl0gPiB1ICYmICh1ID0gaFtmXSwgYyA9IGYpOwogICAgICAgICsrc1tjXSwgaFtjXSA9IDAsICsrbDsKICAgICAgfQogICAgICByZXR1cm4gc1tlXSAvIGk7CiAgICB9CiAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgdmFyIGUgPSAyICogTWF0aC5QSTsKICAgICAgcmV0dXJuICh0ICUgZSArIGUpICUgZTsKICAgIH0KICAgIGZ1bmN0aW9uIGQodCkgewogICAgICByZXR1cm4gdCA+IC1fICYmIHQgPCBfOwogICAgfQogICAgZnVuY3Rpb24gdih0KSB7CiAgICAgIGlmICh0IGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIHQ7CiAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCkgewogICAgICAgIHZhciBlID0gYi5leGVjKHQpOwogICAgICAgIGlmICghZSkgcmV0dXJuIG5ldyBEYXRlKE5hTik7CiAgICAgICAgaWYgKGVbOF0pIHsKICAgICAgICAgIHZhciByID0gK2VbNF0gfHwgMDsKICAgICAgICAgIHJldHVybiAiWiIgIT09IGVbOF0udG9VcHBlckNhc2UoKSAmJiAociAtPSBlWzhdLnNsaWNlKDAsIDMpKSwgbmV3IERhdGUoRGF0ZS5VVEMoK2VbMV0sICsoZVsyXSB8fCAxKSAtIDEsICtlWzNdIHx8IDEsIHIsICsoZVs1XSB8fCAwKSwgK2VbNl0gfHwgMCwgK2VbN10gfHwgMCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IERhdGUoK2VbMV0sICsoZVsyXSB8fCAxKSAtIDEsICtlWzNdIHx8IDEsICtlWzRdIHx8IDAsICsoZVs1XSB8fCAwKSwgK2VbNl0gfHwgMCwgK2VbN10gfHwgMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGwgPT0gdCA/IG5ldyBEYXRlKE5hTikgOiBuZXcgRGF0ZShNYXRoLnJvdW5kKHQpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGcodCkgewogICAgICByZXR1cm4gTWF0aC5wb3coMTAsIHAodCkpOwogICAgfQogICAgZnVuY3Rpb24gcCh0KSB7CiAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgubG9nKHQpIC8gTWF0aC5MTjEwKTsKICAgIH0KICAgIGZ1bmN0aW9uIG0odCwgZSkgewogICAgICB2YXIgciwKICAgICAgICBuID0gcCh0KSwKICAgICAgICBpID0gTWF0aC5wb3coMTAsIG4pLAogICAgICAgIGEgPSB0IC8gaTsKICAgICAgcmV0dXJuIHIgPSBlID8gYSA8IDEuNSA/IDEgOiBhIDwgMi41ID8gMiA6IGEgPCA0ID8gMyA6IGEgPCA3ID8gNSA6IDEwIDogYSA8IDEgPyAxIDogYSA8IDIgPyAyIDogYSA8IDMgPyAzIDogYSA8IDUgPyA1IDogMTAsIHQgPSByICogaSwgbiA+PSAtMjAgPyArdC50b0ZpeGVkKG4gPCAwID8gLW4gOiAwKSA6IHQ7CiAgICB9CiAgICBmdW5jdGlvbiB4KHQpIHsKICAgICAgZnVuY3Rpb24gZSh0LCByLCBuKSB7CiAgICAgICAgcmV0dXJuIHQuaW50ZXJ2YWxbbl0gPCByLmludGVydmFsW25dIHx8IHQuaW50ZXJ2YWxbbl0gPT09IHIuaW50ZXJ2YWxbbl0gJiYgKHQuY2xvc2Vbbl0gLSByLmNsb3NlW25dID09IChuID8gLTEgOiAxKSB8fCAhbiAmJiBlKHQsIHIsIDEpKTsKICAgICAgfQogICAgICB0LnNvcnQoZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICByZXR1cm4gZSh0LCByLCAwKSA/IC0xIDogMTsKICAgICAgfSk7CiAgICAgIGZvciAodmFyIHIgPSAtMSAvIDAsIG4gPSAxLCBpID0gMDsgaSA8IHQubGVuZ3RoOykgewogICAgICAgIGZvciAodmFyIGEgPSB0W2ldLmludGVydmFsLCBvID0gdFtpXS5jbG9zZSwgcyA9IDA7IHMgPCAyOyBzKyspIGFbc10gPD0gciAmJiAoYVtzXSA9IHIsIG9bc10gPSBzID8gMSA6IDEgLSBuKSwgciA9IGFbc10sIG4gPSBvW3NdOwogICAgICAgIGFbMF0gPT09IGFbMV0gJiYgb1swXSAqIG9bMV0gIT0gMSA/IHQuc3BsaWNlKGksIDEpIDogaSsrOwogICAgICB9CiAgICAgIHJldHVybiB0OwogICAgfQogICAgZnVuY3Rpb24geSh0KSB7CiAgICAgIHJldHVybiB0IC0gcGFyc2VGbG9hdCh0KSA+PSAwOwogICAgfQogICAgdmFyIHcgPSByKDApLAogICAgICBfID0gMWUtNCwKICAgICAgYiA9IC9eKD86KFxkezR9KSg/OlstXC9dKFxkezEsMn0pKD86Wy1cL10oXGR7MSwyfSkoPzpbVCBdKFxkezEsMn0pKD86OihcZFxkKSg/OjooXGRcZCkoPzpbLixdKFxkKykpPyk/KT8oWnxbXCtcLV1cZFxkOj9cZFxkKT8pPyk/KT8pPyQvOwogICAgZS5saW5lYXJNYXAgPSBpLCBlLnBhcnNlUGVyY2VudCA9IGEsIGUucm91bmQgPSBvLCBlLmFzYyA9IHMsIGUuZ2V0UHJlY2lzaW9uID0gbCwgZS5nZXRQcmVjaXNpb25TYWZlID0gaCwgZS5nZXRQaXhlbFByZWNpc2lvbiA9IHUsIGUuZ2V0UGVyY2VudFdpdGhQcmVjaXNpb24gPSBjLCBlLk1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxLCBlLnJlbVJhZGlhbiA9IGYsIGUuaXNSYWRpYW5Bcm91bmRaZXJvID0gZCwgZS5wYXJzZURhdGUgPSB2LCBlLnF1YW50aXR5ID0gZywgZS5uaWNlID0gbSwgZS5yZWZvcm1JbnRlcnZhbHMgPSB4LCBlLmlzTnVtZXJpYyA9IHk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHsKICAgICAgICB2YXIgZSA9IGwuZ2V0KHQpOwogICAgICAgIHJldHVybiBlICYmIGUuaW1hZ2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgaWYgKHQpIHsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHsKICAgICAgICAgIGlmIChlICYmIGUuX196ckltYWdlU3JjID09PSB0IHx8ICFyKSByZXR1cm4gZTsKICAgICAgICAgIHZhciBzID0gbC5nZXQodCksCiAgICAgICAgICAgIGggPSB7CiAgICAgICAgICAgICAgaG9zdEVsOiByLAogICAgICAgICAgICAgIGNiOiBuLAogICAgICAgICAgICAgIGNiUGF5bG9hZDogaQogICAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHMgPyAoZSA9IHMuaW1hZ2UsICFvKGUpICYmIHMucGVuZGluZy5wdXNoKGgpKSA6ICghZSAmJiAoZSA9IG5ldyBJbWFnZSgpKSwgZS5vbmxvYWQgPSBhLCBsLnB1dCh0LCBlLl9fY2FjaGVkSW1nT2JqID0gewogICAgICAgICAgICBpbWFnZTogZSwKICAgICAgICAgICAgcGVuZGluZzogW2hdCiAgICAgICAgICB9KSwgZS5zcmMgPSBlLl9fenJJbWFnZVNyYyA9IHQpLCBlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgICAgfQogICAgICByZXR1cm4gZTsKICAgIH0KICAgIGZ1bmN0aW9uIGEoKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fX2NhY2hlZEltZ09iajsKICAgICAgdGhpcy5vbmxvYWQgPSB0aGlzLl9fY2FjaGVkSW1nT2JqID0gbnVsbDsKICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0LnBlbmRpbmcubGVuZ3RoOyBlKyspIHsKICAgICAgICB2YXIgciA9IHQucGVuZGluZ1tlXSwKICAgICAgICAgIG4gPSByLmNiOwogICAgICAgIG4gJiYgbih0aGlzLCByLmNiUGF5bG9hZCksIHIuaG9zdEVsLmRpcnR5KCk7CiAgICAgIH0KICAgICAgdC5wZW5kaW5nLmxlbmd0aCA9IDA7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgcmV0dXJuIHQgJiYgdC53aWR0aCAmJiB0LmhlaWdodDsKICAgIH0KICAgIHZhciBzID0gcigxNCksCiAgICAgIGwgPSBuZXcgcyg1MCk7CiAgICBlLmZpbmRFeGlzdEltYWdlID0gbiwgZS5jcmVhdGVPclVwZGF0ZUltYWdlID0gaSwgZS5pc0ltYWdlUmVhZHkgPSBvOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB0W2VdWzFdIHx8ICh0W2VdWzFdID0gdFtlXVswXSk7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSwgciwgbikgewogICAgICAgIGZvciAodmFyIGEgPSB7fSwgbyA9IDA7IG8gPCB0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICB2YXIgcyA9IHRbb11bMV07CiAgICAgICAgICBpZiAoIShyICYmIGkuaW5kZXhPZihyLCBzKSA+PSAwIHx8IG4gJiYgaS5pbmRleE9mKG4sIHMpIDwgMCkpIHsKICAgICAgICAgICAgdmFyIGwgPSBlLmdldFNoYWxsb3cocyk7CiAgICAgICAgICAgIG51bGwgIT0gbCAmJiAoYVt0W29dWzBdXSA9IGwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYTsKICAgICAgfTsKICAgIH0KICAgIHZhciBpID0gcigwKTsKICAgIHQuZXhwb3J0cyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICB0ID0gdCB8fCB7fSwgby5jYWxsKHRoaXMsIHQpOwogICAgICBmb3IgKHZhciBlIGluIHQpIHQuaGFzT3duUHJvcGVydHkoZSkgJiYgInN0eWxlIiAhPT0gZSAmJiAodGhpc1tlXSA9IHRbZV0pOwogICAgICB0aGlzLnN0eWxlID0gbmV3IGEodC5zdHlsZSwgdGhpcyksIHRoaXMuX3JlY3QgPSBudWxsLCB0aGlzLl9fY2xpcFBhdGhzID0gW107CiAgICB9CiAgICB2YXIgaSA9IHIoMCksCiAgICAgIGEgPSByKDQwKSwKICAgICAgbyA9IHIoMTYpLAogICAgICBzID0gcig0OCk7CiAgICBuLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgIHR5cGU6ICJkaXNwbGF5YWJsZSIsCiAgICAgIF9fZGlydHk6ICEwLAogICAgICBpbnZpc2libGU6ICExLAogICAgICB6OiAwLAogICAgICB6MjogMCwKICAgICAgemxldmVsOiAwLAogICAgICBkcmFnZ2FibGU6ICExLAogICAgICBkcmFnZ2luZzogITEsCiAgICAgIHNpbGVudDogITEsCiAgICAgIGN1bGxpbmc6ICExLAogICAgICBjdXJzb3I6ICJwb2ludGVyIiwKICAgICAgcmVjdEhvdmVyOiAhMSwKICAgICAgcHJvZ3Jlc3NpdmU6IC0xLAogICAgICBiZWZvcmVCcnVzaDogZnVuY3Rpb24gKHQpIHt9LAogICAgICBhZnRlckJydXNoOiBmdW5jdGlvbiAodCkge30sCiAgICAgIGJydXNoOiBmdW5jdGlvbiAodCwgZSkge30sCiAgICAgIGdldEJvdW5kaW5nUmVjdDogZnVuY3Rpb24gKCkge30sCiAgICAgIGNvbnRhaW46IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVjdENvbnRhaW4odCwgZSk7CiAgICAgIH0sCiAgICAgIHRyYXZlcnNlOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHQuY2FsbChlLCB0aGlzKTsKICAgICAgfSwKICAgICAgcmVjdENvbnRhaW46IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnRyYW5zZm9ybUNvb3JkVG9Mb2NhbCh0LCBlKTsKICAgICAgICByZXR1cm4gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKS5jb250YWluKHJbMF0sIHJbMV0pOwogICAgICB9LAogICAgICBkaXJ0eTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX19kaXJ0eSA9ICEwLCB0aGlzLl9yZWN0ID0gbnVsbCwgdGhpcy5fX3pyICYmIHRoaXMuX196ci5yZWZyZXNoKCk7CiAgICAgIH0sCiAgICAgIGFuaW1hdGVTdHlsZTogZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlKCJzdHlsZSIsIHQpOwogICAgICB9LAogICAgICBhdHRyS1Y6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgInN0eWxlIiAhPT0gdCA/IG8ucHJvdG90eXBlLmF0dHJLVi5jYWxsKHRoaXMsIHQsIGUpIDogdGhpcy5zdHlsZS5zZXQoZSk7CiAgICAgIH0sCiAgICAgIHNldFN0eWxlOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiB0aGlzLnN0eWxlLnNldCh0LCBlKSwgdGhpcy5kaXJ0eSghMSksIHRoaXM7CiAgICAgIH0sCiAgICAgIHVzZVN0eWxlOiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0aGlzLnN0eWxlID0gbmV3IGEodCwgdGhpcyksIHRoaXMuZGlydHkoITEpLCB0aGlzOwogICAgICB9CiAgICB9LCBpLmluaGVyaXRzKG4sIG8pLCBpLm1peGluKG4sIHMpOwogICAgdmFyIGwgPSBuOwogICAgdC5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiBpc05hTih0KSA/ICItIiA6ICh0ID0gKHQgKyAiIikuc3BsaXQoIi4iKSwgdFswXS5yZXBsYWNlKC8oXGR7MSwzfSkoPz0oPzpcZHszfSkrKD8hXGQpKS9nLCAiJDEsIikgKyAodC5sZW5ndGggPiAxID8gIi4iICsgdFsxXSA6ICIiKSk7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgcmV0dXJuIHQgPSAodCB8fCAiIikudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8tKC4pL2csIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIGUudG9VcHBlckNhc2UoKTsKICAgICAgfSksIGUgJiYgdCAmJiAodCA9IHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCkgewogICAgICByZXR1cm4gU3RyaW5nKHQpLnJlcGxhY2UoLyYvZywgIiZhbXA7IikucmVwbGFjZSgvPC9nLCAiJmx0OyIpLnJlcGxhY2UoLz4vZywgIiZndDsiKS5yZXBsYWNlKC8iL2csICImcXVvdDsiKS5yZXBsYWNlKC8nL2csICImIzM5OyIpOwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIGMuaXNBcnJheShlKSB8fCAoZSA9IFtlXSk7CiAgICAgIHZhciBuID0gZS5sZW5ndGg7CiAgICAgIGlmICghbikgcmV0dXJuICIiOwogICAgICBmb3IgKHZhciBpID0gZVswXS4kdmFycyB8fCBbXSwgbyA9IDA7IG8gPCBpLmxlbmd0aDsgbysrKSB7CiAgICAgICAgdmFyIHMgPSBnW29dLAogICAgICAgICAgbCA9IHAocywgMCk7CiAgICAgICAgdCA9IHQucmVwbGFjZShwKHMpLCByID8gYShsKSA6IGwpOwogICAgICB9CiAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgbjsgaCsrKSBmb3IgKHZhciB1ID0gMDsgdSA8IGkubGVuZ3RoOyB1KyspIHsKICAgICAgICB2YXIgbCA9IGVbaF1baVt1XV07CiAgICAgICAgdCA9IHQucmVwbGFjZShwKGdbdV0sIGgpLCByID8gYShsKSA6IGwpOwogICAgICB9CiAgICAgIHJldHVybiB0OwogICAgfQogICAgZnVuY3Rpb24gcyh0LCBlLCByKSB7CiAgICAgIHJldHVybiBjLmVhY2goZSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICB0ID0gdC5yZXBsYWNlKCJ7IiArIG4gKyAifSIsIHIgPyBhKGUpIDogZSk7CiAgICAgIH0pLCB0OwogICAgfQogICAgZnVuY3Rpb24gbCh0LCBlKSB7CiAgICAgIHJldHVybiB0ID8gJzxzcGFuIHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6NXB4O2JvcmRlci1yYWRpdXM6MTBweDt3aWR0aDo5cHg7aGVpZ2h0OjlweDtiYWNrZ3JvdW5kLWNvbG9yOicgKyBhKHQpICsgIjsiICsgKGUgfHwgIiIpICsgJyI+PC9zcGFuPicgOiAiIjsKICAgIH0KICAgIGZ1bmN0aW9uIGgodCwgZSwgcikgewogICAgICAid2VlayIgIT09IHQgJiYgIm1vbnRoIiAhPT0gdCAmJiAicXVhcnRlciIgIT09IHQgJiYgImhhbGYteWVhciIgIT09IHQgJiYgInllYXIiICE9PSB0IHx8ICh0ID0gIk1NLWRkXG55eXl5Iik7CiAgICAgIHZhciBuID0gZC5wYXJzZURhdGUoZSksCiAgICAgICAgaSA9IHIgPyAiVVRDIiA6ICIiLAogICAgICAgIGEgPSBuWyJnZXQiICsgaSArICJGdWxsWWVhciJdKCksCiAgICAgICAgbyA9IG5bImdldCIgKyBpICsgIk1vbnRoIl0oKSArIDEsCiAgICAgICAgcyA9IG5bImdldCIgKyBpICsgIkRhdGUiXSgpLAogICAgICAgIGwgPSBuWyJnZXQiICsgaSArICJIb3VycyJdKCksCiAgICAgICAgaCA9IG5bImdldCIgKyBpICsgIk1pbnV0ZXMiXSgpLAogICAgICAgIHUgPSBuWyJnZXQiICsgaSArICJTZWNvbmRzIl0oKTsKICAgICAgcmV0dXJuIHQgPSB0LnJlcGxhY2UoIk1NIiwgbShvKSkucmVwbGFjZSgiTSIsIG8pLnJlcGxhY2UoInl5eXkiLCBhKS5yZXBsYWNlKCJ5eSIsIGEgJSAxMDApLnJlcGxhY2UoImRkIiwgbShzKSkucmVwbGFjZSgiZCIsIHMpLnJlcGxhY2UoImhoIiwgbShsKSkucmVwbGFjZSgiaCIsIGwpLnJlcGxhY2UoIm1tIiwgbShoKSkucmVwbGFjZSgibSIsIGgpLnJlcGxhY2UoInNzIiwgbSh1KSkucmVwbGFjZSgicyIsIHUpOwogICAgfQogICAgZnVuY3Rpb24gdSh0KSB7CiAgICAgIHJldHVybiB0ID8gdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHQuc3Vic3RyKDEpIDogdDsKICAgIH0KICAgIHZhciBjID0gcigwKSwKICAgICAgZiA9IHIoNSksCiAgICAgIGQgPSByKDkpLAogICAgICB2ID0gYy5ub3JtYWxpemVDc3NBcnJheSwKICAgICAgZyA9IFsiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyJdLAogICAgICBwID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gInsiICsgdCArIChudWxsID09IGUgPyAiIiA6IGUpICsgIn0iOwogICAgICB9LAogICAgICBtID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdCA8IDEwID8gIjAiICsgdCA6IHQ7CiAgICAgIH0sCiAgICAgIHggPSBmLnRydW5jYXRlVGV4dCwKICAgICAgeSA9IGYuZ2V0Qm91bmRpbmdSZWN0OwogICAgZS5hZGRDb21tYXMgPSBuLCBlLnRvQ2FtZWxDYXNlID0gaSwgZS5ub3JtYWxpemVDc3NBcnJheSA9IHYsIGUuZW5jb2RlSFRNTCA9IGEsIGUuZm9ybWF0VHBsID0gbywgZS5mb3JtYXRUcGxTaW1wbGUgPSBzLCBlLmdldFRvb2x0aXBNYXJrZXIgPSBsLCBlLmZvcm1hdFRpbWUgPSBoLCBlLmNhcGl0YWxGaXJzdCA9IHUsIGUudHJ1bmNhdGVUZXh0ID0geCwgZS5nZXRUZXh0UmVjdCA9IHk7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuaGVhZCA9IG51bGwsIHRoaXMudGFpbCA9IG51bGwsIHRoaXMuX2xlbiA9IDA7CiAgICAgIH0sCiAgICAgIG4gPSByLnByb3RvdHlwZTsKICAgIG4uaW5zZXJ0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSBuZXcgaSh0KTsKICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0RW50cnkoZSksIGU7CiAgICB9LCBuLmluc2VydEVudHJ5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdGhpcy5oZWFkID8gKHRoaXMudGFpbC5uZXh0ID0gdCwgdC5wcmV2ID0gdGhpcy50YWlsLCB0Lm5leHQgPSBudWxsLCB0aGlzLnRhaWwgPSB0KSA6IHRoaXMuaGVhZCA9IHRoaXMudGFpbCA9IHQsIHRoaXMuX2xlbisrOwogICAgfSwgbi5yZW1vdmUgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHQucHJldiwKICAgICAgICByID0gdC5uZXh0OwogICAgICBlID8gZS5uZXh0ID0gciA6IHRoaXMuaGVhZCA9IHIsIHIgPyByLnByZXYgPSBlIDogdGhpcy50YWlsID0gZSwgdC5uZXh0ID0gdC5wcmV2ID0gbnVsbCwgdGhpcy5fbGVuLS07CiAgICB9LCBuLmxlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xlbjsKICAgIH0sIG4uY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuaGVhZCA9IHRoaXMudGFpbCA9IG51bGwsIHRoaXMuX2xlbiA9IDA7CiAgICB9OwogICAgdmFyIGkgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMudmFsdWUgPSB0LCB0aGlzLm5leHQsIHRoaXMucHJldjsKICAgICAgfSwKICAgICAgYSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdGhpcy5fbGlzdCA9IG5ldyByKCksIHRoaXMuX21hcCA9IHt9LCB0aGlzLl9tYXhTaXplID0gdCB8fCAxMCwgdGhpcy5fbGFzdFJlbW92ZWRFbnRyeSA9IG51bGw7CiAgICAgIH0sCiAgICAgIG8gPSBhLnByb3RvdHlwZTsKICAgIG8ucHV0ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIgPSB0aGlzLl9saXN0LAogICAgICAgIG4gPSB0aGlzLl9tYXAsCiAgICAgICAgYSA9IG51bGw7CiAgICAgIGlmIChudWxsID09IG5bdF0pIHsKICAgICAgICB2YXIgbyA9IHIubGVuKCksCiAgICAgICAgICBzID0gdGhpcy5fbGFzdFJlbW92ZWRFbnRyeTsKICAgICAgICBpZiAobyA+PSB0aGlzLl9tYXhTaXplICYmIG8gPiAwKSB7CiAgICAgICAgICB2YXIgbCA9IHIuaGVhZDsKICAgICAgICAgIHIucmVtb3ZlKGwpLCBkZWxldGUgbltsLmtleV0sIGEgPSBsLnZhbHVlLCB0aGlzLl9sYXN0UmVtb3ZlZEVudHJ5ID0gbDsKICAgICAgICB9CiAgICAgICAgcyA/IHMudmFsdWUgPSBlIDogcyA9IG5ldyBpKGUpLCBzLmtleSA9IHQsIHIuaW5zZXJ0RW50cnkocyksIG5bdF0gPSBzOwogICAgICB9CiAgICAgIHJldHVybiBhOwogICAgfSwgby5nZXQgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHRoaXMuX21hcFt0XSwKICAgICAgICByID0gdGhpcy5fbGlzdDsKICAgICAgaWYgKG51bGwgIT0gZSkgcmV0dXJuIGUgIT09IHIudGFpbCAmJiAoci5yZW1vdmUoZSksIHIuaW5zZXJ0RW50cnkoZSkpLCBlLnZhbHVlOwogICAgfSwgby5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fbGlzdC5jbGVhcigpLCB0aGlzLl9tYXAgPSB7fTsKICAgIH07CiAgICB2YXIgcyA9IGE7CiAgICB0LmV4cG9ydHMgPSBzOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IHt9OwogICAgciA9ICJ1bmRlZmluZWQiID09IHR5cGVvZiBuYXZpZ2F0b3IgPyB7CiAgICAgIGJyb3dzZXI6IHt9LAogICAgICBvczoge30sCiAgICAgIG5vZGU6ICEwLAogICAgICBjYW52YXNTdXBwb3J0ZWQ6ICEwLAogICAgICBzdmdTdXBwb3J0ZWQ6ICEwCiAgICB9IDogZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSB7fSwKICAgICAgICByID0ge30sCiAgICAgICAgbiA9IHQubWF0Y2goL0ZpcmVmb3hcLyhbXGQuXSspLyksCiAgICAgICAgaSA9IHQubWF0Y2goL01TSUVccyhbXGQuXSspLykgfHwgdC5tYXRjaCgvVHJpZGVudFwvLis/cnY6KChbXGQuXSspKS8pLAogICAgICAgIGEgPSB0Lm1hdGNoKC9FZGdlXC8oW1xkLl0rKS8pLAogICAgICAgIG8gPSAvbWljcm9tZXNzZW5nZXIvaS50ZXN0KHQpOwogICAgICByZXR1cm4gbiAmJiAoci5maXJlZm94ID0gITAsIHIudmVyc2lvbiA9IG5bMV0pLCBpICYmIChyLmllID0gITAsIHIudmVyc2lvbiA9IGlbMV0pLCBhICYmIChyLmVkZ2UgPSAhMCwgci52ZXJzaW9uID0gYVsxXSksIG8gJiYgKHIud2VDaGF0ID0gITApLCB7CiAgICAgICAgYnJvd3NlcjogciwKICAgICAgICBvczogZSwKICAgICAgICBub2RlOiAhMSwKICAgICAgICBjYW52YXNTdXBwb3J0ZWQ6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIikuZ2V0Q29udGV4dCwKICAgICAgICBzdmdTdXBwb3J0ZWQ6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTVkdSZWN0LAogICAgICAgIHRvdWNoRXZlbnRzU3VwcG9ydGVkOiAib250b3VjaHN0YXJ0IiBpbiB3aW5kb3cgJiYgIXIuaWUgJiYgIXIuZWRnZSwKICAgICAgICBwb2ludGVyRXZlbnRzU3VwcG9ydGVkOiAib25wb2ludGVyZG93biIgaW4gd2luZG93ICYmIChyLmVkZ2UgfHwgci5pZSAmJiByLnZlcnNpb24gPj0gMTEpCiAgICAgIH07CiAgICB9KG5hdmlnYXRvci51c2VyQWdlbnQpOwogICAgdmFyIG4gPSByOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDQxKSwKICAgICAgaSA9IHIoNDIpLAogICAgICBhID0gcigxNyksCiAgICAgIG8gPSByKDQzKSwKICAgICAgcyA9IHIoMCksCiAgICAgIGwgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGEuY2FsbCh0aGlzLCB0KSwgaS5jYWxsKHRoaXMsIHQpLCBvLmNhbGwodGhpcywgdCksIHRoaXMuaWQgPSB0LmlkIHx8IG4oKTsKICAgICAgfTsKICAgIGwucHJvdG90eXBlID0gewogICAgICB0eXBlOiAiZWxlbWVudCIsCiAgICAgIG5hbWU6ICIiLAogICAgICBfX3pyOiBudWxsLAogICAgICBpZ25vcmU6ICExLAogICAgICBjbGlwUGF0aDogbnVsbCwKICAgICAgZHJpZnQ6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLmRyYWdnYWJsZSkgewogICAgICAgICAgY2FzZSAiaG9yaXpvbnRhbCI6CiAgICAgICAgICAgIGUgPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInZlcnRpY2FsIjoKICAgICAgICAgICAgdCA9IDA7CiAgICAgICAgfQogICAgICAgIHZhciByID0gdGhpcy50cmFuc2Zvcm07CiAgICAgICAgciB8fCAociA9IHRoaXMudHJhbnNmb3JtID0gWzEsIDAsIDAsIDEsIDAsIDBdKSwgcls0XSArPSB0LCByWzVdICs9IGUsIHRoaXMuZGVjb21wb3NlVHJhbnNmb3JtKCksIHRoaXMuZGlydHkoITEpOwogICAgICB9LAogICAgICBiZWZvcmVVcGRhdGU6IGZ1bmN0aW9uICgpIHt9LAogICAgICBhZnRlclVwZGF0ZTogZnVuY3Rpb24gKCkge30sCiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudXBkYXRlVHJhbnNmb3JtKCk7CiAgICAgIH0sCiAgICAgIHRyYXZlcnNlOiBmdW5jdGlvbiAodCwgZSkge30sCiAgICAgIGF0dHJLVjogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBpZiAoInBvc2l0aW9uIiA9PT0gdCB8fCAic2NhbGUiID09PSB0IHx8ICJvcmlnaW4iID09PSB0KSB7CiAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICB2YXIgciA9IHRoaXNbdF07CiAgICAgICAgICAgIHIgfHwgKHIgPSB0aGlzW3RdID0gW10pLCByWzBdID0gZVswXSwgclsxXSA9IGVbMV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHRoaXNbdF0gPSBlOwogICAgICB9LAogICAgICBoaWRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5pZ25vcmUgPSAhMCwgdGhpcy5fX3pyICYmIHRoaXMuX196ci5yZWZyZXNoKCk7CiAgICAgIH0sCiAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmlnbm9yZSA9ICExLCB0aGlzLl9fenIgJiYgdGhpcy5fX3pyLnJlZnJlc2goKTsKICAgICAgfSwKICAgICAgYXR0cjogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHRoaXMuYXR0cktWKHQsIGUpO2Vsc2UgaWYgKHMuaXNPYmplY3QodCkpIGZvciAodmFyIHIgaW4gdCkgdC5oYXNPd25Qcm9wZXJ0eShyKSAmJiB0aGlzLmF0dHJLVihyLCB0W3JdKTsKICAgICAgICByZXR1cm4gdGhpcy5kaXJ0eSghMSksIHRoaXM7CiAgICAgIH0sCiAgICAgIHNldENsaXBQYXRoOiBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gdGhpcy5fX3pyOwogICAgICAgIGUgJiYgdC5hZGRTZWxmVG9acihlKSwgdGhpcy5jbGlwUGF0aCAmJiB0aGlzLmNsaXBQYXRoICE9PSB0ICYmIHRoaXMucmVtb3ZlQ2xpcFBhdGgoKSwgdGhpcy5jbGlwUGF0aCA9IHQsIHQuX196ciA9IGUsIHQuX19jbGlwVGFyZ2V0ID0gdGhpcywgdGhpcy5kaXJ0eSghMSk7CiAgICAgIH0sCiAgICAgIHJlbW92ZUNsaXBQYXRoOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmNsaXBQYXRoOwogICAgICAgIHQgJiYgKHQuX196ciAmJiB0LnJlbW92ZVNlbGZGcm9tWnIodC5fX3pyKSwgdC5fX3pyID0gbnVsbCwgdC5fX2NsaXBUYXJnZXQgPSBudWxsLCB0aGlzLmNsaXBQYXRoID0gbnVsbCwgdGhpcy5kaXJ0eSghMSkpOwogICAgICB9LAogICAgICBhZGRTZWxmVG9acjogZnVuY3Rpb24gKHQpIHsKICAgICAgICB0aGlzLl9fenIgPSB0OwogICAgICAgIHZhciBlID0gdGhpcy5hbmltYXRvcnM7CiAgICAgICAgaWYgKGUpIGZvciAodmFyIHIgPSAwOyByIDwgZS5sZW5ndGg7IHIrKykgdC5hbmltYXRpb24uYWRkQW5pbWF0b3IoZVtyXSk7CiAgICAgICAgdGhpcy5jbGlwUGF0aCAmJiB0aGlzLmNsaXBQYXRoLmFkZFNlbGZUb1pyKHQpOwogICAgICB9LAogICAgICByZW1vdmVTZWxmRnJvbVpyOiBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMuX196ciA9IG51bGw7CiAgICAgICAgdmFyIGUgPSB0aGlzLmFuaW1hdG9yczsKICAgICAgICBpZiAoZSkgZm9yICh2YXIgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB0LmFuaW1hdGlvbi5yZW1vdmVBbmltYXRvcihlW3JdKTsKICAgICAgICB0aGlzLmNsaXBQYXRoICYmIHRoaXMuY2xpcFBhdGgucmVtb3ZlU2VsZkZyb21acih0KTsKICAgICAgfQogICAgfSwgcy5taXhpbihsLCBvKSwgcy5taXhpbihsLCBhKSwgcy5taXhpbihsLCBpKTsKICAgIHZhciBoID0gbDsKICAgIHQuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCA+IHMgfHwgdCA8IC1zOwogICAgfQogICAgdmFyIGkgPSByKDgpLAogICAgICBhID0gcigyKSwKICAgICAgbyA9IGkuaWRlbnRpdHksCiAgICAgIHMgPSA1ZS01LAogICAgICBsID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0ID0gdCB8fCB7fSwgdC5wb3NpdGlvbiB8fCAodGhpcy5wb3NpdGlvbiA9IFswLCAwXSksIG51bGwgPT0gdC5yb3RhdGlvbiAmJiAodGhpcy5yb3RhdGlvbiA9IDApLCB0LnNjYWxlIHx8ICh0aGlzLnNjYWxlID0gWzEsIDFdKSwgdGhpcy5vcmlnaW4gPSB0aGlzLm9yaWdpbiB8fCBudWxsOwogICAgICB9LAogICAgICBoID0gbC5wcm90b3R5cGU7CiAgICBoLnRyYW5zZm9ybSA9IG51bGwsIGgubmVlZExvY2FsVHJhbnNmb3JtID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbih0aGlzLnJvdGF0aW9uKSB8fCBuKHRoaXMucG9zaXRpb25bMF0pIHx8IG4odGhpcy5wb3NpdGlvblsxXSkgfHwgbih0aGlzLnNjYWxlWzBdIC0gMSkgfHwgbih0aGlzLnNjYWxlWzFdIC0gMSk7CiAgICB9LCBoLnVwZGF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQgPSB0aGlzLnBhcmVudCwKICAgICAgICBlID0gdCAmJiB0LnRyYW5zZm9ybSwKICAgICAgICByID0gdGhpcy5uZWVkTG9jYWxUcmFuc2Zvcm0oKSwKICAgICAgICBuID0gdGhpcy50cmFuc2Zvcm07CiAgICAgIGlmICghciAmJiAhZSkgcmV0dXJuIHZvaWQgKG4gJiYgbyhuKSk7CiAgICAgIG4gPSBuIHx8IGkuY3JlYXRlKCksIHIgPyB0aGlzLmdldExvY2FsVHJhbnNmb3JtKG4pIDogbyhuKSwgZSAmJiAociA/IGkubXVsKG4sIHQudHJhbnNmb3JtLCBuKSA6IGkuY29weShuLCB0LnRyYW5zZm9ybSkpLCB0aGlzLnRyYW5zZm9ybSA9IG4sIHRoaXMuaW52VHJhbnNmb3JtID0gdGhpcy5pbnZUcmFuc2Zvcm0gfHwgaS5jcmVhdGUoKSwgaS5pbnZlcnQodGhpcy5pbnZUcmFuc2Zvcm0sIG4pOwogICAgfSwgaC5nZXRMb2NhbFRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBsLmdldExvY2FsVHJhbnNmb3JtKHRoaXMsIHQpOwogICAgfSwgaC5zZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHRoaXMudHJhbnNmb3JtLAogICAgICAgIHIgPSB0LmRwciB8fCAxOwogICAgICBlID8gdC5zZXRUcmFuc2Zvcm0ociAqIGVbMF0sIHIgKiBlWzFdLCByICogZVsyXSwgciAqIGVbM10sIHIgKiBlWzRdLCByICogZVs1XSkgOiB0LnNldFRyYW5zZm9ybShyLCAwLCAwLCByLCAwLCAwKTsKICAgIH0sIGgucmVzdG9yZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gdC5kcHIgfHwgMTsKICAgICAgdC5zZXRUcmFuc2Zvcm0oZSwgMCwgMCwgZSwgMCwgMCk7CiAgICB9OwogICAgdmFyIHUgPSBbXTsKICAgIGguZGVjb21wb3NlVHJhbnNmb3JtID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy50cmFuc2Zvcm0pIHsKICAgICAgICB2YXIgdCA9IHRoaXMucGFyZW50LAogICAgICAgICAgZSA9IHRoaXMudHJhbnNmb3JtOwogICAgICAgIHQgJiYgdC50cmFuc2Zvcm0gJiYgKGkubXVsKHUsIHQuaW52VHJhbnNmb3JtLCBlKSwgZSA9IHUpOwogICAgICAgIHZhciByID0gZVswXSAqIGVbMF0gKyBlWzFdICogZVsxXSwKICAgICAgICAgIGEgPSBlWzJdICogZVsyXSArIGVbM10gKiBlWzNdLAogICAgICAgICAgbyA9IHRoaXMucG9zaXRpb24sCiAgICAgICAgICBzID0gdGhpcy5zY2FsZTsKICAgICAgICBuKHIgLSAxKSAmJiAociA9IE1hdGguc3FydChyKSksIG4oYSAtIDEpICYmIChhID0gTWF0aC5zcXJ0KGEpKSwgZVswXSA8IDAgJiYgKHIgPSAtciksIGVbM10gPCAwICYmIChhID0gLWEpLCBvWzBdID0gZVs0XSwgb1sxXSA9IGVbNV0sIHNbMF0gPSByLCBzWzFdID0gYSwgdGhpcy5yb3RhdGlvbiA9IE1hdGguYXRhbjIoLWVbMV0gLyBhLCBlWzBdIC8gcik7CiAgICAgIH0KICAgIH0sIGguZ2V0R2xvYmFsU2NhbGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gdGhpcy50cmFuc2Zvcm07CiAgICAgIGlmICghdCkgcmV0dXJuIFsxLCAxXTsKICAgICAgdmFyIGUgPSBNYXRoLnNxcnQodFswXSAqIHRbMF0gKyB0WzFdICogdFsxXSksCiAgICAgICAgciA9IE1hdGguc3FydCh0WzJdICogdFsyXSArIHRbM10gKiB0WzNdKTsKICAgICAgcmV0dXJuIHRbMF0gPCAwICYmIChlID0gLWUpLCB0WzNdIDwgMCAmJiAociA9IC1yKSwgW2UsIHJdOwogICAgfSwgaC50cmFuc2Zvcm1Db29yZFRvTG9jYWwgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICB2YXIgciA9IFt0LCBlXSwKICAgICAgICBuID0gdGhpcy5pbnZUcmFuc2Zvcm07CiAgICAgIHJldHVybiBuICYmIGEuYXBwbHlUcmFuc2Zvcm0ociwgciwgbiksIHI7CiAgICB9LCBoLnRyYW5zZm9ybUNvb3JkVG9HbG9iYWwgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICB2YXIgciA9IFt0LCBlXSwKICAgICAgICBuID0gdGhpcy50cmFuc2Zvcm07CiAgICAgIHJldHVybiBuICYmIGEuYXBwbHlUcmFuc2Zvcm0ociwgciwgbiksIHI7CiAgICB9LCBsLmdldExvY2FsVHJhbnNmb3JtID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgZSA9IGUgfHwgW10sIG8oZSk7CiAgICAgIHZhciByID0gdC5vcmlnaW4sCiAgICAgICAgbiA9IHQuc2NhbGUgfHwgWzEsIDFdLAogICAgICAgIGEgPSB0LnJvdGF0aW9uIHx8IDAsCiAgICAgICAgcyA9IHQucG9zaXRpb24gfHwgWzAsIDBdOwogICAgICByZXR1cm4gciAmJiAoZVs0XSAtPSByWzBdLCBlWzVdIC09IHJbMV0pLCBpLnNjYWxlKGUsIGUsIG4pLCBhICYmIGkucm90YXRlKGUsIGUsIGEpLCByICYmIChlWzRdICs9IHJbMF0sIGVbNV0gKz0gclsxXSksIGVbNF0gKz0gc1swXSwgZVs1XSArPSBzWzFdLCBlOwogICAgfTsKICAgIHZhciBjID0gbDsKICAgIHQuZXhwb3J0cyA9IGM7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCA9IE1hdGgucm91bmQodCksIHQgPCAwID8gMCA6IHQgPiAyNTUgPyAyNTUgOiB0OwogICAgfQogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIHJldHVybiB0ID0gTWF0aC5yb3VuZCh0KSwgdCA8IDAgPyAwIDogdCA+IDM2MCA/IDM2MCA6IHQ7CiAgICB9CiAgICBmdW5jdGlvbiBhKHQpIHsKICAgICAgcmV0dXJuIHQgPCAwID8gMCA6IHQgPiAxID8gMSA6IHQ7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgcmV0dXJuIG4odC5sZW5ndGggJiYgIiUiID09PSB0LmNoYXJBdCh0Lmxlbmd0aCAtIDEpID8gcGFyc2VGbG9hdCh0KSAvIDEwMCAqIDI1NSA6IHBhcnNlSW50KHQsIDEwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgcmV0dXJuIGEodC5sZW5ndGggJiYgIiUiID09PSB0LmNoYXJBdCh0Lmxlbmd0aCAtIDEpID8gcGFyc2VGbG9hdCh0KSAvIDEwMCA6IHBhcnNlRmxvYXQodCkpOwogICAgfQogICAgZnVuY3Rpb24gbCh0LCBlLCByKSB7CiAgICAgIHJldHVybiByIDwgMCA/IHIgKz0gMSA6IHIgPiAxICYmIChyIC09IDEpLCA2ICogciA8IDEgPyB0ICsgKGUgLSB0KSAqIHIgKiA2IDogMiAqIHIgPCAxID8gZSA6IDMgKiByIDwgMiA/IHQgKyAoZSAtIHQpICogKDIgLyAzIC0gcikgKiA2IDogdDsKICAgIH0KICAgIGZ1bmN0aW9uIGgodCwgZSwgcikgewogICAgICByZXR1cm4gdCArIChlIC0gdCkgKiByOwogICAgfQogICAgZnVuY3Rpb24gdSh0LCBlLCByLCBuLCBpKSB7CiAgICAgIHJldHVybiB0WzBdID0gZSwgdFsxXSA9IHIsIHRbMl0gPSBuLCB0WzNdID0gaSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGModCwgZSkgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0sIHRbMV0gPSBlWzFdLCB0WzJdID0gZVsyXSwgdFszXSA9IGVbM10sIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBmKHQsIGUpIHsKICAgICAgayAmJiBjKGssIGUpLCBrID0gVC5wdXQodCwgayB8fCBlLnNsaWNlKCkpOwogICAgfQogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgZSA9IGUgfHwgW107CiAgICAgICAgdmFyIHIgPSBULmdldCh0KTsKICAgICAgICBpZiAocikgcmV0dXJuIGMoZSwgcik7CiAgICAgICAgdCArPSAiIjsKICAgICAgICB2YXIgbiA9IHQucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobiBpbiBNKSByZXR1cm4gYyhlLCBNW25dKSwgZih0LCBlKSwgZTsKICAgICAgICBpZiAoIiMiICE9PSBuLmNoYXJBdCgwKSkgewogICAgICAgICAgdmFyIGkgPSBuLmluZGV4T2YoIigiKSwKICAgICAgICAgICAgYSA9IG4uaW5kZXhPZigiKSIpOwogICAgICAgICAgaWYgKC0xICE9PSBpICYmIGEgKyAxID09PSBuLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgbCA9IG4uc3Vic3RyKDAsIGkpLAogICAgICAgICAgICAgIGggPSBuLnN1YnN0cihpICsgMSwgYSAtIChpICsgMSkpLnNwbGl0KCIsIiksCiAgICAgICAgICAgICAgZCA9IDE7CiAgICAgICAgICAgIHN3aXRjaCAobCkgewogICAgICAgICAgICAgIGNhc2UgInJnYmEiOgogICAgICAgICAgICAgICAgaWYgKDQgIT09IGgubGVuZ3RoKSByZXR1cm4gdm9pZCB1KGUsIDAsIDAsIDAsIDEpOwogICAgICAgICAgICAgICAgZCA9IHMoaC5wb3AoKSk7CiAgICAgICAgICAgICAgY2FzZSAicmdiIjoKICAgICAgICAgICAgICAgIHJldHVybiAzICE9PSBoLmxlbmd0aCA/IHZvaWQgdShlLCAwLCAwLCAwLCAxKSA6ICh1KGUsIG8oaFswXSksIG8oaFsxXSksIG8oaFsyXSksIGQpLCBmKHQsIGUpLCBlKTsKICAgICAgICAgICAgICBjYXNlICJoc2xhIjoKICAgICAgICAgICAgICAgIHJldHVybiA0ICE9PSBoLmxlbmd0aCA/IHZvaWQgdShlLCAwLCAwLCAwLCAxKSA6IChoWzNdID0gcyhoWzNdKSwgdihoLCBlKSwgZih0LCBlKSwgZSk7CiAgICAgICAgICAgICAgY2FzZSAiaHNsIjoKICAgICAgICAgICAgICAgIHJldHVybiAzICE9PSBoLmxlbmd0aCA/IHZvaWQgdShlLCAwLCAwLCAwLCAxKSA6ICh2KGgsIGUpLCBmKHQsIGUpLCBlKTsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB1KGUsIDAsIDAsIDAsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoNCA9PT0gbi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGcgPSBwYXJzZUludChuLnN1YnN0cigxKSwgMTYpOwogICAgICAgICAgICByZXR1cm4gZyA+PSAwICYmIGcgPD0gNDA5NSA/ICh1KGUsICgzODQwICYgZykgPj4gNCB8ICgzODQwICYgZykgPj4gOCwgMjQwICYgZyB8ICgyNDAgJiBnKSA+PiA0LCAxNSAmIGcgfCAoMTUgJiBnKSA8PCA0LCAxKSwgZih0LCBlKSwgZSkgOiB2b2lkIHUoZSwgMCwgMCwgMCwgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoNyA9PT0gbi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGcgPSBwYXJzZUludChuLnN1YnN0cigxKSwgMTYpOwogICAgICAgICAgICByZXR1cm4gZyA+PSAwICYmIGcgPD0gMTY3NzcyMTUgPyAodShlLCAoMTY3MTE2ODAgJiBnKSA+PiAxNiwgKDY1MjgwICYgZykgPj4gOCwgMjU1ICYgZywgMSksIGYodCwgZSksIGUpIDogdm9pZCB1KGUsIDAsIDAsIDAsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdih0LCBlKSB7CiAgICAgIHZhciByID0gKHBhcnNlRmxvYXQodFswXSkgJSAzNjAgKyAzNjApICUgMzYwIC8gMzYwLAogICAgICAgIGkgPSBzKHRbMV0pLAogICAgICAgIGEgPSBzKHRbMl0pLAogICAgICAgIG8gPSBhIDw9IC41ID8gYSAqIChpICsgMSkgOiBhICsgaSAtIGEgKiBpLAogICAgICAgIGggPSAyICogYSAtIG87CiAgICAgIHJldHVybiBlID0gZSB8fCBbXSwgdShlLCBuKDI1NSAqIGwoaCwgbywgciArIDEgLyAzKSksIG4oMjU1ICogbChoLCBvLCByKSksIG4oMjU1ICogbChoLCBvLCByIC0gMSAvIDMpKSwgMSksIDQgPT09IHQubGVuZ3RoICYmIChlWzNdID0gdFszXSksIGU7CiAgICB9CiAgICBmdW5jdGlvbiBnKHQpIHsKICAgICAgaWYgKHQpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgIHIsCiAgICAgICAgICBuID0gdFswXSAvIDI1NSwKICAgICAgICAgIGkgPSB0WzFdIC8gMjU1LAogICAgICAgICAgYSA9IHRbMl0gLyAyNTUsCiAgICAgICAgICBvID0gTWF0aC5taW4obiwgaSwgYSksCiAgICAgICAgICBzID0gTWF0aC5tYXgobiwgaSwgYSksCiAgICAgICAgICBsID0gcyAtIG8sCiAgICAgICAgICBoID0gKHMgKyBvKSAvIDI7CiAgICAgICAgaWYgKDAgPT09IGwpIGUgPSAwLCByID0gMDtlbHNlIHsKICAgICAgICAgIHIgPSBoIDwgLjUgPyBsIC8gKHMgKyBvKSA6IGwgLyAoMiAtIHMgLSBvKTsKICAgICAgICAgIHZhciB1ID0gKChzIC0gbikgLyA2ICsgbCAvIDIpIC8gbCwKICAgICAgICAgICAgYyA9ICgocyAtIGkpIC8gNiArIGwgLyAyKSAvIGwsCiAgICAgICAgICAgIGYgPSAoKHMgLSBhKSAvIDYgKyBsIC8gMikgLyBsOwogICAgICAgICAgbiA9PT0gcyA/IGUgPSBmIC0gYyA6IGkgPT09IHMgPyBlID0gMSAvIDMgKyB1IC0gZiA6IGEgPT09IHMgJiYgKGUgPSAyIC8gMyArIGMgLSB1KSwgZSA8IDAgJiYgKGUgKz0gMSksIGUgPiAxICYmIChlIC09IDEpOwogICAgICAgIH0KICAgICAgICB2YXIgZCA9IFszNjAgKiBlLCByLCBoXTsKICAgICAgICByZXR1cm4gbnVsbCAhPSB0WzNdICYmIGQucHVzaCh0WzNdKSwgZDsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgIHZhciByID0gZCh0KTsKICAgICAgaWYgKHIpIHsKICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IDM7IG4rKykgcltuXSA9IGUgPCAwID8gcltuXSAqICgxIC0gZSkgfCAwIDogKDI1NSAtIHJbbl0pICogZSArIHJbbl0gfCAwOwogICAgICAgIHJldHVybiBiKHIsIDQgPT09IHIubGVuZ3RoID8gInJnYmEiIDogInJnYiIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtKHQpIHsKICAgICAgdmFyIGUgPSBkKHQpOwogICAgICBpZiAoZSkgcmV0dXJuICgoMSA8PCAyNCkgKyAoZVswXSA8PCAxNikgKyAoZVsxXSA8PCA4KSArICtlWzJdKS50b1N0cmluZygxNikuc2xpY2UoMSk7CiAgICB9CiAgICBmdW5jdGlvbiB4KHQsIGUsIHIpIHsKICAgICAgaWYgKGUgJiYgZS5sZW5ndGggJiYgdCA+PSAwICYmIHQgPD0gMSkgewogICAgICAgIHIgPSByIHx8IFtdOwogICAgICAgIHZhciBpID0gdCAqIChlLmxlbmd0aCAtIDEpLAogICAgICAgICAgbyA9IE1hdGguZmxvb3IoaSksCiAgICAgICAgICBzID0gTWF0aC5jZWlsKGkpLAogICAgICAgICAgbCA9IGVbb10sCiAgICAgICAgICB1ID0gZVtzXSwKICAgICAgICAgIGMgPSBpIC0gbzsKICAgICAgICByZXR1cm4gclswXSA9IG4oaChsWzBdLCB1WzBdLCBjKSksIHJbMV0gPSBuKGgobFsxXSwgdVsxXSwgYykpLCByWzJdID0gbihoKGxbMl0sIHVbMl0sIGMpKSwgclszXSA9IGEoaChsWzNdLCB1WzNdLCBjKSksIHI7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHkodCwgZSwgcikgewogICAgICBpZiAoZSAmJiBlLmxlbmd0aCAmJiB0ID49IDAgJiYgdCA8PSAxKSB7CiAgICAgICAgdmFyIGkgPSB0ICogKGUubGVuZ3RoIC0gMSksCiAgICAgICAgICBvID0gTWF0aC5mbG9vcihpKSwKICAgICAgICAgIHMgPSBNYXRoLmNlaWwoaSksCiAgICAgICAgICBsID0gZChlW29dKSwKICAgICAgICAgIHUgPSBkKGVbc10pLAogICAgICAgICAgYyA9IGkgLSBvLAogICAgICAgICAgZiA9IGIoW24oaChsWzBdLCB1WzBdLCBjKSksIG4oaChsWzFdLCB1WzFdLCBjKSksIG4oaChsWzJdLCB1WzJdLCBjKSksIGEoaChsWzNdLCB1WzNdLCBjKSldLCAicmdiYSIpOwogICAgICAgIHJldHVybiByID8gewogICAgICAgICAgY29sb3I6IGYsCiAgICAgICAgICBsZWZ0SW5kZXg6IG8sCiAgICAgICAgICByaWdodEluZGV4OiBzLAogICAgICAgICAgdmFsdWU6IGkKICAgICAgICB9IDogZjsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdyh0LCBlLCByLCBuKSB7CiAgICAgIGlmICh0ID0gZCh0KSkgcmV0dXJuIHQgPSBnKHQpLCBudWxsICE9IGUgJiYgKHRbMF0gPSBpKGUpKSwgbnVsbCAhPSByICYmICh0WzFdID0gcyhyKSksIG51bGwgIT0gbiAmJiAodFsyXSA9IHMobikpLCBiKHYodCksICJyZ2JhIik7CiAgICB9CiAgICBmdW5jdGlvbiBfKHQsIGUpIHsKICAgICAgaWYgKCh0ID0gZCh0KSkgJiYgbnVsbCAhPSBlKSByZXR1cm4gdFszXSA9IGEoZSksIGIodCwgInJnYmEiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGIodCwgZSkgewogICAgICBpZiAodCAmJiB0Lmxlbmd0aCkgewogICAgICAgIHZhciByID0gdFswXSArICIsIiArIHRbMV0gKyAiLCIgKyB0WzJdOwogICAgICAgIHJldHVybiAicmdiYSIgIT09IGUgJiYgImhzdmEiICE9PSBlICYmICJoc2xhIiAhPT0gZSB8fCAociArPSAiLCIgKyB0WzNdKSwgZSArICIoIiArIHIgKyAiKSI7CiAgICAgIH0KICAgIH0KICAgIHZhciBTID0gcigxNCksCiAgICAgIE0gPSB7CiAgICAgICAgdHJhbnNwYXJlbnQ6IFswLCAwLCAwLCAwXSwKICAgICAgICBhbGljZWJsdWU6IFsyNDAsIDI0OCwgMjU1LCAxXSwKICAgICAgICBhbnRpcXVld2hpdGU6IFsyNTAsIDIzNSwgMjE1LCAxXSwKICAgICAgICBhcXVhOiBbMCwgMjU1LCAyNTUsIDFdLAogICAgICAgIGFxdWFtYXJpbmU6IFsxMjcsIDI1NSwgMjEyLCAxXSwKICAgICAgICBhenVyZTogWzI0MCwgMjU1LCAyNTUsIDFdLAogICAgICAgIGJlaWdlOiBbMjQ1LCAyNDUsIDIyMCwgMV0sCiAgICAgICAgYmlzcXVlOiBbMjU1LCAyMjgsIDE5NiwgMV0sCiAgICAgICAgYmxhY2s6IFswLCAwLCAwLCAxXSwKICAgICAgICBibGFuY2hlZGFsbW9uZDogWzI1NSwgMjM1LCAyMDUsIDFdLAogICAgICAgIGJsdWU6IFswLCAwLCAyNTUsIDFdLAogICAgICAgIGJsdWV2aW9sZXQ6IFsxMzgsIDQzLCAyMjYsIDFdLAogICAgICAgIGJyb3duOiBbMTY1LCA0MiwgNDIsIDFdLAogICAgICAgIGJ1cmx5d29vZDogWzIyMiwgMTg0LCAxMzUsIDFdLAogICAgICAgIGNhZGV0Ymx1ZTogWzk1LCAxNTgsIDE2MCwgMV0sCiAgICAgICAgY2hhcnRyZXVzZTogWzEyNywgMjU1LCAwLCAxXSwKICAgICAgICBjaG9jb2xhdGU6IFsyMTAsIDEwNSwgMzAsIDFdLAogICAgICAgIGNvcmFsOiBbMjU1LCAxMjcsIDgwLCAxXSwKICAgICAgICBjb3JuZmxvd2VyYmx1ZTogWzEwMCwgMTQ5LCAyMzcsIDFdLAogICAgICAgIGNvcm5zaWxrOiBbMjU1LCAyNDgsIDIyMCwgMV0sCiAgICAgICAgY3JpbXNvbjogWzIyMCwgMjAsIDYwLCAxXSwKICAgICAgICBjeWFuOiBbMCwgMjU1LCAyNTUsIDFdLAogICAgICAgIGRhcmtibHVlOiBbMCwgMCwgMTM5LCAxXSwKICAgICAgICBkYXJrY3lhbjogWzAsIDEzOSwgMTM5LCAxXSwKICAgICAgICBkYXJrZ29sZGVucm9kOiBbMTg0LCAxMzQsIDExLCAxXSwKICAgICAgICBkYXJrZ3JheTogWzE2OSwgMTY5LCAxNjksIDFdLAogICAgICAgIGRhcmtncmVlbjogWzAsIDEwMCwgMCwgMV0sCiAgICAgICAgZGFya2dyZXk6IFsxNjksIDE2OSwgMTY5LCAxXSwKICAgICAgICBkYXJra2hha2k6IFsxODksIDE4MywgMTA3LCAxXSwKICAgICAgICBkYXJrbWFnZW50YTogWzEzOSwgMCwgMTM5LCAxXSwKICAgICAgICBkYXJrb2xpdmVncmVlbjogWzg1LCAxMDcsIDQ3LCAxXSwKICAgICAgICBkYXJrb3JhbmdlOiBbMjU1LCAxNDAsIDAsIDFdLAogICAgICAgIGRhcmtvcmNoaWQ6IFsxNTMsIDUwLCAyMDQsIDFdLAogICAgICAgIGRhcmtyZWQ6IFsxMzksIDAsIDAsIDFdLAogICAgICAgIGRhcmtzYWxtb246IFsyMzMsIDE1MCwgMTIyLCAxXSwKICAgICAgICBkYXJrc2VhZ3JlZW46IFsxNDMsIDE4OCwgMTQzLCAxXSwKICAgICAgICBkYXJrc2xhdGVibHVlOiBbNzIsIDYxLCAxMzksIDFdLAogICAgICAgIGRhcmtzbGF0ZWdyYXk6IFs0NywgNzksIDc5LCAxXSwKICAgICAgICBkYXJrc2xhdGVncmV5OiBbNDcsIDc5LCA3OSwgMV0sCiAgICAgICAgZGFya3R1cnF1b2lzZTogWzAsIDIwNiwgMjA5LCAxXSwKICAgICAgICBkYXJrdmlvbGV0OiBbMTQ4LCAwLCAyMTEsIDFdLAogICAgICAgIGRlZXBwaW5rOiBbMjU1LCAyMCwgMTQ3LCAxXSwKICAgICAgICBkZWVwc2t5Ymx1ZTogWzAsIDE5MSwgMjU1LCAxXSwKICAgICAgICBkaW1ncmF5OiBbMTA1LCAxMDUsIDEwNSwgMV0sCiAgICAgICAgZGltZ3JleTogWzEwNSwgMTA1LCAxMDUsIDFdLAogICAgICAgIGRvZGdlcmJsdWU6IFszMCwgMTQ0LCAyNTUsIDFdLAogICAgICAgIGZpcmVicmljazogWzE3OCwgMzQsIDM0LCAxXSwKICAgICAgICBmbG9yYWx3aGl0ZTogWzI1NSwgMjUwLCAyNDAsIDFdLAogICAgICAgIGZvcmVzdGdyZWVuOiBbMzQsIDEzOSwgMzQsIDFdLAogICAgICAgIGZ1Y2hzaWE6IFsyNTUsIDAsIDI1NSwgMV0sCiAgICAgICAgZ2FpbnNib3JvOiBbMjIwLCAyMjAsIDIyMCwgMV0sCiAgICAgICAgZ2hvc3R3aGl0ZTogWzI0OCwgMjQ4LCAyNTUsIDFdLAogICAgICAgIGdvbGQ6IFsyNTUsIDIxNSwgMCwgMV0sCiAgICAgICAgZ29sZGVucm9kOiBbMjE4LCAxNjUsIDMyLCAxXSwKICAgICAgICBncmF5OiBbMTI4LCAxMjgsIDEyOCwgMV0sCiAgICAgICAgZ3JlZW46IFswLCAxMjgsIDAsIDFdLAogICAgICAgIGdyZWVueWVsbG93OiBbMTczLCAyNTUsIDQ3LCAxXSwKICAgICAgICBncmV5OiBbMTI4LCAxMjgsIDEyOCwgMV0sCiAgICAgICAgaG9uZXlkZXc6IFsyNDAsIDI1NSwgMjQwLCAxXSwKICAgICAgICBob3RwaW5rOiBbMjU1LCAxMDUsIDE4MCwgMV0sCiAgICAgICAgaW5kaWFucmVkOiBbMjA1LCA5MiwgOTIsIDFdLAogICAgICAgIGluZGlnbzogWzc1LCAwLCAxMzAsIDFdLAogICAgICAgIGl2b3J5OiBbMjU1LCAyNTUsIDI0MCwgMV0sCiAgICAgICAga2hha2k6IFsyNDAsIDIzMCwgMTQwLCAxXSwKICAgICAgICBsYXZlbmRlcjogWzIzMCwgMjMwLCAyNTAsIDFdLAogICAgICAgIGxhdmVuZGVyYmx1c2g6IFsyNTUsIDI0MCwgMjQ1LCAxXSwKICAgICAgICBsYXduZ3JlZW46IFsxMjQsIDI1MiwgMCwgMV0sCiAgICAgICAgbGVtb25jaGlmZm9uOiBbMjU1LCAyNTAsIDIwNSwgMV0sCiAgICAgICAgbGlnaHRibHVlOiBbMTczLCAyMTYsIDIzMCwgMV0sCiAgICAgICAgbGlnaHRjb3JhbDogWzI0MCwgMTI4LCAxMjgsIDFdLAogICAgICAgIGxpZ2h0Y3lhbjogWzIyNCwgMjU1LCAyNTUsIDFdLAogICAgICAgIGxpZ2h0Z29sZGVucm9keWVsbG93OiBbMjUwLCAyNTAsIDIxMCwgMV0sCiAgICAgICAgbGlnaHRncmF5OiBbMjExLCAyMTEsIDIxMSwgMV0sCiAgICAgICAgbGlnaHRncmVlbjogWzE0NCwgMjM4LCAxNDQsIDFdLAogICAgICAgIGxpZ2h0Z3JleTogWzIxMSwgMjExLCAyMTEsIDFdLAogICAgICAgIGxpZ2h0cGluazogWzI1NSwgMTgyLCAxOTMsIDFdLAogICAgICAgIGxpZ2h0c2FsbW9uOiBbMjU1LCAxNjAsIDEyMiwgMV0sCiAgICAgICAgbGlnaHRzZWFncmVlbjogWzMyLCAxNzgsIDE3MCwgMV0sCiAgICAgICAgbGlnaHRza3libHVlOiBbMTM1LCAyMDYsIDI1MCwgMV0sCiAgICAgICAgbGlnaHRzbGF0ZWdyYXk6IFsxMTksIDEzNiwgMTUzLCAxXSwKICAgICAgICBsaWdodHNsYXRlZ3JleTogWzExOSwgMTM2LCAxNTMsIDFdLAogICAgICAgIGxpZ2h0c3RlZWxibHVlOiBbMTc2LCAxOTYsIDIyMiwgMV0sCiAgICAgICAgbGlnaHR5ZWxsb3c6IFsyNTUsIDI1NSwgMjI0LCAxXSwKICAgICAgICBsaW1lOiBbMCwgMjU1LCAwLCAxXSwKICAgICAgICBsaW1lZ3JlZW46IFs1MCwgMjA1LCA1MCwgMV0sCiAgICAgICAgbGluZW46IFsyNTAsIDI0MCwgMjMwLCAxXSwKICAgICAgICBtYWdlbnRhOiBbMjU1LCAwLCAyNTUsIDFdLAogICAgICAgIG1hcm9vbjogWzEyOCwgMCwgMCwgMV0sCiAgICAgICAgbWVkaXVtYXF1YW1hcmluZTogWzEwMiwgMjA1LCAxNzAsIDFdLAogICAgICAgIG1lZGl1bWJsdWU6IFswLCAwLCAyMDUsIDFdLAogICAgICAgIG1lZGl1bW9yY2hpZDogWzE4NiwgODUsIDIxMSwgMV0sCiAgICAgICAgbWVkaXVtcHVycGxlOiBbMTQ3LCAxMTIsIDIxOSwgMV0sCiAgICAgICAgbWVkaXVtc2VhZ3JlZW46IFs2MCwgMTc5LCAxMTMsIDFdLAogICAgICAgIG1lZGl1bXNsYXRlYmx1ZTogWzEyMywgMTA0LCAyMzgsIDFdLAogICAgICAgIG1lZGl1bXNwcmluZ2dyZWVuOiBbMCwgMjUwLCAxNTQsIDFdLAogICAgICAgIG1lZGl1bXR1cnF1b2lzZTogWzcyLCAyMDksIDIwNCwgMV0sCiAgICAgICAgbWVkaXVtdmlvbGV0cmVkOiBbMTk5LCAyMSwgMTMzLCAxXSwKICAgICAgICBtaWRuaWdodGJsdWU6IFsyNSwgMjUsIDExMiwgMV0sCiAgICAgICAgbWludGNyZWFtOiBbMjQ1LCAyNTUsIDI1MCwgMV0sCiAgICAgICAgbWlzdHlyb3NlOiBbMjU1LCAyMjgsIDIyNSwgMV0sCiAgICAgICAgbW9jY2FzaW46IFsyNTUsIDIyOCwgMTgxLCAxXSwKICAgICAgICBuYXZham93aGl0ZTogWzI1NSwgMjIyLCAxNzMsIDFdLAogICAgICAgIG5hdnk6IFswLCAwLCAxMjgsIDFdLAogICAgICAgIG9sZGxhY2U6IFsyNTMsIDI0NSwgMjMwLCAxXSwKICAgICAgICBvbGl2ZTogWzEyOCwgMTI4LCAwLCAxXSwKICAgICAgICBvbGl2ZWRyYWI6IFsxMDcsIDE0MiwgMzUsIDFdLAogICAgICAgIG9yYW5nZTogWzI1NSwgMTY1LCAwLCAxXSwKICAgICAgICBvcmFuZ2VyZWQ6IFsyNTUsIDY5LCAwLCAxXSwKICAgICAgICBvcmNoaWQ6IFsyMTgsIDExMiwgMjE0LCAxXSwKICAgICAgICBwYWxlZ29sZGVucm9kOiBbMjM4LCAyMzIsIDE3MCwgMV0sCiAgICAgICAgcGFsZWdyZWVuOiBbMTUyLCAyNTEsIDE1MiwgMV0sCiAgICAgICAgcGFsZXR1cnF1b2lzZTogWzE3NSwgMjM4LCAyMzgsIDFdLAogICAgICAgIHBhbGV2aW9sZXRyZWQ6IFsyMTksIDExMiwgMTQ3LCAxXSwKICAgICAgICBwYXBheWF3aGlwOiBbMjU1LCAyMzksIDIxMywgMV0sCiAgICAgICAgcGVhY2hwdWZmOiBbMjU1LCAyMTgsIDE4NSwgMV0sCiAgICAgICAgcGVydTogWzIwNSwgMTMzLCA2MywgMV0sCiAgICAgICAgcGluazogWzI1NSwgMTkyLCAyMDMsIDFdLAogICAgICAgIHBsdW06IFsyMjEsIDE2MCwgMjIxLCAxXSwKICAgICAgICBwb3dkZXJibHVlOiBbMTc2LCAyMjQsIDIzMCwgMV0sCiAgICAgICAgcHVycGxlOiBbMTI4LCAwLCAxMjgsIDFdLAogICAgICAgIHJlZDogWzI1NSwgMCwgMCwgMV0sCiAgICAgICAgcm9zeWJyb3duOiBbMTg4LCAxNDMsIDE0MywgMV0sCiAgICAgICAgcm95YWxibHVlOiBbNjUsIDEwNSwgMjI1LCAxXSwKICAgICAgICBzYWRkbGVicm93bjogWzEzOSwgNjksIDE5LCAxXSwKICAgICAgICBzYWxtb246IFsyNTAsIDEyOCwgMTE0LCAxXSwKICAgICAgICBzYW5keWJyb3duOiBbMjQ0LCAxNjQsIDk2LCAxXSwKICAgICAgICBzZWFncmVlbjogWzQ2LCAxMzksIDg3LCAxXSwKICAgICAgICBzZWFzaGVsbDogWzI1NSwgMjQ1LCAyMzgsIDFdLAogICAgICAgIHNpZW5uYTogWzE2MCwgODIsIDQ1LCAxXSwKICAgICAgICBzaWx2ZXI6IFsxOTIsIDE5MiwgMTkyLCAxXSwKICAgICAgICBza3libHVlOiBbMTM1LCAyMDYsIDIzNSwgMV0sCiAgICAgICAgc2xhdGVibHVlOiBbMTA2LCA5MCwgMjA1LCAxXSwKICAgICAgICBzbGF0ZWdyYXk6IFsxMTIsIDEyOCwgMTQ0LCAxXSwKICAgICAgICBzbGF0ZWdyZXk6IFsxMTIsIDEyOCwgMTQ0LCAxXSwKICAgICAgICBzbm93OiBbMjU1LCAyNTAsIDI1MCwgMV0sCiAgICAgICAgc3ByaW5nZ3JlZW46IFswLCAyNTUsIDEyNywgMV0sCiAgICAgICAgc3RlZWxibHVlOiBbNzAsIDEzMCwgMTgwLCAxXSwKICAgICAgICB0YW46IFsyMTAsIDE4MCwgMTQwLCAxXSwKICAgICAgICB0ZWFsOiBbMCwgMTI4LCAxMjgsIDFdLAogICAgICAgIHRoaXN0bGU6IFsyMTYsIDE5MSwgMjE2LCAxXSwKICAgICAgICB0b21hdG86IFsyNTUsIDk5LCA3MSwgMV0sCiAgICAgICAgdHVycXVvaXNlOiBbNjQsIDIyNCwgMjA4LCAxXSwKICAgICAgICB2aW9sZXQ6IFsyMzgsIDEzMCwgMjM4LCAxXSwKICAgICAgICB3aGVhdDogWzI0NSwgMjIyLCAxNzksIDFdLAogICAgICAgIHdoaXRlOiBbMjU1LCAyNTUsIDI1NSwgMV0sCiAgICAgICAgd2hpdGVzbW9rZTogWzI0NSwgMjQ1LCAyNDUsIDFdLAogICAgICAgIHllbGxvdzogWzI1NSwgMjU1LCAwLCAxXSwKICAgICAgICB5ZWxsb3dncmVlbjogWzE1NCwgMjA1LCA1MCwgMV0KICAgICAgfSwKICAgICAgVCA9IG5ldyBTKDIwKSwKICAgICAgayA9IG51bGwsCiAgICAgIEMgPSB4LAogICAgICBQID0geTsKICAgIGUucGFyc2UgPSBkLCBlLmxpZnQgPSBwLCBlLnRvSGV4ID0gbSwgZS5mYXN0TGVycCA9IHgsIGUuZmFzdE1hcFRvQ29sb3IgPSBDLCBlLmxlcnAgPSB5LCBlLm1hcFRvQ29sb3IgPSBQLCBlLm1vZGlmeUhTTCA9IHcsIGUubW9kaWZ5QWxwaGEgPSBfLCBlLnN0cmluZ2lmeSA9IGI7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gMTsKICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgKHIgPSBNYXRoLm1heCh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxLCAxKSk7CiAgICB2YXIgbiA9IHI7CiAgICBlLmRlYnVnTW9kZSA9IDAsIGUuZGV2aWNlUGl4ZWxSYXRpbyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gaSh0KSwgTSh0LnJpY2gsIGkpLCB0OwogICAgfQogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgdC5mb250ID0gUC5tYWtlRm9udCh0KTsKICAgICAgICB2YXIgZSA9IHQudGV4dEFsaWduOwogICAgICAgICJtaWRkbGUiID09PSBlICYmIChlID0gImNlbnRlciIpLCB0LnRleHRBbGlnbiA9IG51bGwgPT0gZSB8fCBPW2VdID8gZSA6ICJsZWZ0IjsKICAgICAgICB2YXIgciA9IHQudGV4dFZlcnRpY2FsQWxpZ24gfHwgdC50ZXh0QmFzZWxpbmU7CiAgICAgICAgImNlbnRlciIgPT09IHIgJiYgKHIgPSAibWlkZGxlIiksIHQudGV4dFZlcnRpY2FsQWxpZ24gPSBudWxsID09IHIgfHwgRFtyXSA/IHIgOiAidG9wIjsKICAgICAgICB0LnRleHRQYWRkaW5nICYmICh0LnRleHRQYWRkaW5nID0gVCh0LnRleHRQYWRkaW5nKSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgaSkgewogICAgICBuLnJpY2ggPyBzKHQsIGUsIHIsIG4sIGkpIDogbyh0LCBlLCByLCBuLCBpKTsKICAgIH0KICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IGcoZSwgImZvbnQiLCBuLmZvbnQgfHwgUC5ERUZBVUxUX0ZPTlQpLAogICAgICAgIG8gPSBuLnRleHRQYWRkaW5nLAogICAgICAgIHMgPSB0Ll9fdGV4dENvdGVudEJsb2NrOwogICAgICBzICYmICF0Ll9fZGlydHkgfHwgKHMgPSB0Ll9fdGV4dENvdGVudEJsb2NrID0gUC5wYXJzZVBsYWluVGV4dChyLCBhLCBvLCBuLnRydW5jYXRlKSk7CiAgICAgIHZhciBsID0gcy5vdXRlckhlaWdodCwKICAgICAgICB1ID0gcy5saW5lcywKICAgICAgICBkID0gcy5saW5lSGVpZ2h0LAogICAgICAgIHggPSB2KGwsIG4sIGkpLAogICAgICAgIHcgPSB4LmJhc2VYLAogICAgICAgIF8gPSB4LmJhc2VZLAogICAgICAgIGIgPSB4LnRleHRBbGlnbiwKICAgICAgICBTID0geC50ZXh0VmVydGljYWxBbGlnbjsKICAgICAgaChlLCBuLCBpLCB3LCBfKTsKICAgICAgdmFyIE0gPSBQLmFkanVzdFRleHRZKF8sIGwsIFMpLAogICAgICAgIFQgPSB3LAogICAgICAgIGsgPSBNLAogICAgICAgIEMgPSBjKG4pOwogICAgICBpZiAoQyB8fCBvKSB7CiAgICAgICAgdmFyIEkgPSBQLmdldFdpZHRoKHIsIGEpLAogICAgICAgICAgQSA9IEk7CiAgICAgICAgbyAmJiAoQSArPSBvWzFdICsgb1szXSk7CiAgICAgICAgdmFyIE8gPSBQLmFkanVzdFRleHRYKHcsIEEsIGIpOwogICAgICAgIEMgJiYgZih0LCBlLCBuLCBPLCBNLCBBLCBsKSwgbyAmJiAoVCA9IHkodywgYiwgbyksIGsgKz0gb1swXSk7CiAgICAgIH0KICAgICAgZyhlLCAidGV4dEFsaWduIiwgYiB8fCAibGVmdCIpLCBnKGUsICJ0ZXh0QmFzZWxpbmUiLCAibWlkZGxlIiksIGcoZSwgInNoYWRvd0JsdXIiLCBuLnRleHRTaGFkb3dCbHVyIHx8IDApLCBnKGUsICJzaGFkb3dDb2xvciIsIG4udGV4dFNoYWRvd0NvbG9yIHx8ICJ0cmFuc3BhcmVudCIpLCBnKGUsICJzaGFkb3dPZmZzZXRYIiwgbi50ZXh0U2hhZG93T2Zmc2V0WCB8fCAwKSwgZyhlLCAic2hhZG93T2Zmc2V0WSIsIG4udGV4dFNoYWRvd09mZnNldFkgfHwgMCksIGsgKz0gZCAvIDI7CiAgICAgIHZhciBEID0gbi50ZXh0U3Ryb2tlV2lkdGgsCiAgICAgICAgTCA9IHAobi50ZXh0U3Ryb2tlLCBEKSwKICAgICAgICBGID0gbShuLnRleHRGaWxsKTsKICAgICAgTCAmJiAoZyhlLCAibGluZVdpZHRoIiwgRCksIGcoZSwgInN0cm9rZVN0eWxlIiwgTCkpLCBGICYmIGcoZSwgImZpbGxTdHlsZSIsIEYpOwogICAgICBmb3IgKHZhciBSID0gMDsgUiA8IHUubGVuZ3RoOyBSKyspIEwgJiYgZS5zdHJva2VUZXh0KHVbUl0sIFQsIGspLCBGICYmIGUuZmlsbFRleHQodVtSXSwgVCwgayksIGsgKz0gZDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IHQuX190ZXh0Q290ZW50QmxvY2s7CiAgICAgIGEgJiYgIXQuX19kaXJ0eSB8fCAoYSA9IHQuX190ZXh0Q290ZW50QmxvY2sgPSBQLnBhcnNlUmljaFRleHQociwgbikpLCBsKHQsIGUsIGEsIG4sIGkpOwogICAgfQogICAgZnVuY3Rpb24gbCh0LCBlLCByLCBuLCBpKSB7CiAgICAgIHZhciBhID0gci53aWR0aCwKICAgICAgICBvID0gci5vdXRlcldpZHRoLAogICAgICAgIHMgPSByLm91dGVySGVpZ2h0LAogICAgICAgIGwgPSBuLnRleHRQYWRkaW5nLAogICAgICAgIGQgPSB2KHMsIG4sIGkpLAogICAgICAgIGcgPSBkLmJhc2VYLAogICAgICAgIHAgPSBkLmJhc2VZLAogICAgICAgIG0gPSBkLnRleHRBbGlnbiwKICAgICAgICB4ID0gZC50ZXh0VmVydGljYWxBbGlnbjsKICAgICAgaChlLCBuLCBpLCBnLCBwKTsKICAgICAgdmFyIHkgPSBQLmFkanVzdFRleHRYKGcsIG8sIG0pLAogICAgICAgIHcgPSBQLmFkanVzdFRleHRZKHAsIHMsIHgpLAogICAgICAgIF8gPSB5LAogICAgICAgIGIgPSB3OwogICAgICBsICYmIChfICs9IGxbM10sIGIgKz0gbFswXSk7CiAgICAgIHZhciBTID0gXyArIGE7CiAgICAgIGMobikgJiYgZih0LCBlLCBuLCB5LCB3LCBvLCBzKTsKICAgICAgZm9yICh2YXIgTSA9IDA7IE0gPCByLmxpbmVzLmxlbmd0aDsgTSsrKSB7CiAgICAgICAgZm9yICh2YXIgVCwgayA9IHIubGluZXNbTV0sIEMgPSBrLnRva2VucywgSSA9IEMubGVuZ3RoLCBBID0gay5saW5lSGVpZ2h0LCBPID0gay53aWR0aCwgRCA9IDAsIEwgPSBfLCBGID0gUywgUiA9IEkgLSAxOyBEIDwgSSAmJiAoVCA9IENbRF0sICFULnRleHRBbGlnbiB8fCAibGVmdCIgPT09IFQudGV4dEFsaWduKTspIHUodCwgZSwgVCwgbiwgQSwgYiwgTCwgImxlZnQiKSwgTyAtPSBULndpZHRoLCBMICs9IFQud2lkdGgsIEQrKzsKICAgICAgICBmb3IgKDsgUiA+PSAwICYmIChUID0gQ1tSXSwgInJpZ2h0IiA9PT0gVC50ZXh0QWxpZ24pOykgdSh0LCBlLCBULCBuLCBBLCBiLCBGLCAicmlnaHQiKSwgTyAtPSBULndpZHRoLCBGIC09IFQud2lkdGgsIFItLTsKICAgICAgICBmb3IgKEwgKz0gKGEgLSAoTCAtIF8pIC0gKFMgLSBGKSAtIE8pIC8gMjsgRCA8PSBSOykgVCA9IENbRF0sIHUodCwgZSwgVCwgbiwgQSwgYiwgTCArIFQud2lkdGggLyAyLCAiY2VudGVyIiksIEwgKz0gVC53aWR0aCwgRCsrOwogICAgICAgIGIgKz0gQTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlLCByLCBuLCBpKSB7CiAgICAgIGlmIChyICYmIGUudGV4dFJvdGF0aW9uKSB7CiAgICAgICAgdmFyIGEgPSBlLnRleHRPcmlnaW47CiAgICAgICAgImNlbnRlciIgPT09IGEgPyAobiA9IHIud2lkdGggLyAyICsgci54LCBpID0gci5oZWlnaHQgLyAyICsgci55KSA6IGEgJiYgKG4gPSBhWzBdICsgci54LCBpID0gYVsxXSArIHIueSksIHQudHJhbnNsYXRlKG4sIGkpLCB0LnJvdGF0ZSgtZS50ZXh0Um90YXRpb24pLCB0LnRyYW5zbGF0ZSgtbiwgLWkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB1KHQsIGUsIHIsIG4sIGksIGEsIG8sIHMpIHsKICAgICAgdmFyIGwgPSBuLnJpY2hbci5zdHlsZU5hbWVdIHx8IHt9LAogICAgICAgIGggPSByLnRleHRWZXJ0aWNhbEFsaWduLAogICAgICAgIHUgPSBhICsgaSAvIDI7CiAgICAgICJ0b3AiID09PSBoID8gdSA9IGEgKyByLmhlaWdodCAvIDIgOiAiYm90dG9tIiA9PT0gaCAmJiAodSA9IGEgKyBpIC0gci5oZWlnaHQgLyAyKSwgIXIuaXNMaW5lSG9sZGVyICYmIGMobCkgJiYgZih0LCBlLCBsLCAicmlnaHQiID09PSBzID8gbyAtIHIud2lkdGggOiAiY2VudGVyIiA9PT0gcyA/IG8gLSByLndpZHRoIC8gMiA6IG8sIHUgLSByLmhlaWdodCAvIDIsIHIud2lkdGgsIHIuaGVpZ2h0KTsKICAgICAgdmFyIGQgPSByLnRleHRQYWRkaW5nOwogICAgICBkICYmIChvID0geShvLCBzLCBkKSwgdSAtPSByLmhlaWdodCAvIDIgLSBkWzJdIC0gci50ZXh0SGVpZ2h0IC8gMiksIGcoZSwgInNoYWRvd0JsdXIiLCBTKGwudGV4dFNoYWRvd0JsdXIsIG4udGV4dFNoYWRvd0JsdXIsIDApKSwgZyhlLCAic2hhZG93Q29sb3IiLCBsLnRleHRTaGFkb3dDb2xvciB8fCBuLnRleHRTaGFkb3dDb2xvciB8fCAidHJhbnNwYXJlbnQiKSwgZyhlLCAic2hhZG93T2Zmc2V0WCIsIFMobC50ZXh0U2hhZG93T2Zmc2V0WCwgbi50ZXh0U2hhZG93T2Zmc2V0WCwgMCkpLCBnKGUsICJzaGFkb3dPZmZzZXRZIiwgUyhsLnRleHRTaGFkb3dPZmZzZXRZLCBuLnRleHRTaGFkb3dPZmZzZXRZLCAwKSksIGcoZSwgInRleHRBbGlnbiIsIHMpLCBnKGUsICJ0ZXh0QmFzZWxpbmUiLCAibWlkZGxlIiksIGcoZSwgImZvbnQiLCByLmZvbnQgfHwgUC5ERUZBVUxUX0ZPTlQpOwogICAgICB2YXIgdiA9IHAobC50ZXh0U3Ryb2tlIHx8IG4udGV4dFN0cm9rZSwgdyksCiAgICAgICAgeCA9IG0obC50ZXh0RmlsbCB8fCBuLnRleHRGaWxsKSwKICAgICAgICB3ID0gYihsLnRleHRTdHJva2VXaWR0aCwgbi50ZXh0U3Ryb2tlV2lkdGgpOwogICAgICB2ICYmIChnKGUsICJsaW5lV2lkdGgiLCB3KSwgZyhlLCAic3Ryb2tlU3R5bGUiLCB2KSwgZS5zdHJva2VUZXh0KHIudGV4dCwgbywgdSkpLCB4ICYmIChnKGUsICJmaWxsU3R5bGUiLCB4KSwgZS5maWxsVGV4dChyLnRleHQsIG8sIHUpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGModCkgewogICAgICByZXR1cm4gdC50ZXh0QmFja2dyb3VuZENvbG9yIHx8IHQudGV4dEJvcmRlcldpZHRoICYmIHQudGV4dEJvcmRlckNvbG9yOwogICAgfQogICAgZnVuY3Rpb24gZih0LCBlLCByLCBuLCBpLCBhLCBvKSB7CiAgICAgIHZhciBzID0gci50ZXh0QmFja2dyb3VuZENvbG9yLAogICAgICAgIGwgPSByLnRleHRCb3JkZXJXaWR0aCwKICAgICAgICBoID0gci50ZXh0Qm9yZGVyQ29sb3IsCiAgICAgICAgdSA9IGsocyk7CiAgICAgIGlmIChnKGUsICJzaGFkb3dCbHVyIiwgci50ZXh0Qm94U2hhZG93Qmx1ciB8fCAwKSwgZyhlLCAic2hhZG93Q29sb3IiLCByLnRleHRCb3hTaGFkb3dDb2xvciB8fCAidHJhbnNwYXJlbnQiKSwgZyhlLCAic2hhZG93T2Zmc2V0WCIsIHIudGV4dEJveFNoYWRvd09mZnNldFggfHwgMCksIGcoZSwgInNoYWRvd09mZnNldFkiLCByLnRleHRCb3hTaGFkb3dPZmZzZXRZIHx8IDApLCB1IHx8IGwgJiYgaCkgewogICAgICAgIGUuYmVnaW5QYXRoKCk7CiAgICAgICAgdmFyIGMgPSByLnRleHRCb3JkZXJSYWRpdXM7CiAgICAgICAgYyA/IEkuYnVpbGRQYXRoKGUsIHsKICAgICAgICAgIHg6IG4sCiAgICAgICAgICB5OiBpLAogICAgICAgICAgd2lkdGg6IGEsCiAgICAgICAgICBoZWlnaHQ6IG8sCiAgICAgICAgICByOiBjCiAgICAgICAgfSkgOiBlLnJlY3QobiwgaSwgYSwgbyksIGUuY2xvc2VQYXRoKCk7CiAgICAgIH0KICAgICAgaWYgKHUpIGcoZSwgImZpbGxTdHlsZSIsIHMpLCBlLmZpbGwoKTtlbHNlIGlmIChDKHMpKSB7CiAgICAgICAgdmFyIGYgPSBzLmltYWdlOwogICAgICAgIGYgPSBBLmNyZWF0ZU9yVXBkYXRlSW1hZ2UoZiwgbnVsbCwgdCwgZCwgcyksIGYgJiYgQS5pc0ltYWdlUmVhZHkoZikgJiYgZS5kcmF3SW1hZ2UoZiwgbiwgaSwgYSwgbyk7CiAgICAgIH0KICAgICAgbCAmJiBoICYmIChnKGUsICJsaW5lV2lkdGgiLCBsKSwgZyhlLCAic3Ryb2tlU3R5bGUiLCBoKSwgZS5zdHJva2UoKSk7CiAgICB9CiAgICBmdW5jdGlvbiBkKHQsIGUpIHsKICAgICAgZS5pbWFnZSA9IHQ7CiAgICB9CiAgICBmdW5jdGlvbiB2KHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlLnggfHwgMCwKICAgICAgICBpID0gZS55IHx8IDAsCiAgICAgICAgYSA9IGUudGV4dEFsaWduLAogICAgICAgIG8gPSBlLnRleHRWZXJ0aWNhbEFsaWduOwogICAgICBpZiAocikgewogICAgICAgIHZhciBzID0gZS50ZXh0UG9zaXRpb247CiAgICAgICAgaWYgKHMgaW5zdGFuY2VvZiBBcnJheSkgbiA9IHIueCArIHgoc1swXSwgci53aWR0aCksIGkgPSByLnkgKyB4KHNbMV0sIHIuaGVpZ2h0KTtlbHNlIHsKICAgICAgICAgIHZhciBsID0gUC5hZGp1c3RUZXh0UG9zaXRpb25PblJlY3QocywgciwgZS50ZXh0RGlzdGFuY2UpOwogICAgICAgICAgbiA9IGwueCwgaSA9IGwueSwgYSA9IGEgfHwgbC50ZXh0QWxpZ24sIG8gPSBvIHx8IGwudGV4dFZlcnRpY2FsQWxpZ247CiAgICAgICAgfQogICAgICAgIHZhciBoID0gZS50ZXh0T2Zmc2V0OwogICAgICAgIGggJiYgKG4gKz0gaFswXSwgaSArPSBoWzFdKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGJhc2VYOiBuLAogICAgICAgIGJhc2VZOiBpLAogICAgICAgIHRleHRBbGlnbjogYSwKICAgICAgICB0ZXh0VmVydGljYWxBbGlnbjogbwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gZyh0LCBlLCByKSB7CiAgICAgIHJldHVybiB0W2VdID0gciwgdFtlXTsKICAgIH0KICAgIGZ1bmN0aW9uIHAodCwgZSkgewogICAgICByZXR1cm4gbnVsbCA9PSB0IHx8IGUgPD0gMCB8fCAidHJhbnNwYXJlbnQiID09PSB0IHx8ICJub25lIiA9PT0gdCA/IG51bGwgOiB0LmltYWdlIHx8IHQuY29sb3JTdG9wcyA/ICIjMDAwIiA6IHQ7CiAgICB9CiAgICBmdW5jdGlvbiBtKHQpIHsKICAgICAgcmV0dXJuIG51bGwgPT0gdCB8fCAibm9uZSIgPT09IHQgPyBudWxsIDogdC5pbWFnZSB8fCB0LmNvbG9yU3RvcHMgPyAiIzAwMCIgOiB0OwogICAgfQogICAgZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IHQubGFzdEluZGV4T2YoIiUiKSA+PSAwID8gcGFyc2VGbG9hdCh0KSAvIDEwMCAqIGUgOiBwYXJzZUZsb2F0KHQpIDogdDsKICAgIH0KICAgIGZ1bmN0aW9uIHkodCwgZSwgcikgewogICAgICByZXR1cm4gInJpZ2h0IiA9PT0gZSA/IHQgLSByWzFdIDogImNlbnRlciIgPT09IGUgPyB0ICsgclszXSAvIDIgLSByWzFdIC8gMiA6IHQgKyByWzNdOwogICAgfQogICAgZnVuY3Rpb24gdyh0LCBlKSB7CiAgICAgIHJldHVybiBudWxsICE9IHQgJiYgKHQgfHwgZS50ZXh0QmFja2dyb3VuZENvbG9yIHx8IGUudGV4dEJvcmRlcldpZHRoICYmIGUudGV4dEJvcmRlckNvbG9yIHx8IGUudGV4dFBhZGRpbmcpOwogICAgfQogICAgdmFyIF8gPSByKDApLAogICAgICBiID0gXy5yZXRyaWV2ZTIsCiAgICAgIFMgPSBfLnJldHJpZXZlMywKICAgICAgTSA9IF8uZWFjaCwKICAgICAgVCA9IF8ubm9ybWFsaXplQ3NzQXJyYXksCiAgICAgIGsgPSBfLmlzU3RyaW5nLAogICAgICBDID0gXy5pc09iamVjdCwKICAgICAgUCA9IHIoNSksCiAgICAgIEkgPSByKDIxKSwKICAgICAgQSA9IHIoMTApLAogICAgICBPID0gewogICAgICAgIGxlZnQ6IDEsCiAgICAgICAgcmlnaHQ6IDEsCiAgICAgICAgY2VudGVyOiAxCiAgICAgIH0sCiAgICAgIEQgPSB7CiAgICAgICAgdG9wOiAxLAogICAgICAgIGJvdHRvbTogMSwKICAgICAgICBtaWRkbGU6IDEKICAgICAgfTsKICAgIGUubm9ybWFsaXplVGV4dFN0eWxlID0gbiwgZS5yZW5kZXJUZXh0ID0gYSwgZS5nZXRTdHJva2UgPSBwLCBlLmdldEZpbGwgPSBtLCBlLm5lZWREcmF3VGV4dCA9IHc7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICB2YXIgciwKICAgICAgICBuLAogICAgICAgIGksCiAgICAgICAgYSwKICAgICAgICBvID0gZS54LAogICAgICAgIHMgPSBlLnksCiAgICAgICAgbCA9IGUud2lkdGgsCiAgICAgICAgaCA9IGUuaGVpZ2h0LAogICAgICAgIHUgPSBlLnI7CiAgICAgIGwgPCAwICYmIChvICs9IGwsIGwgPSAtbCksIGggPCAwICYmIChzICs9IGgsIGggPSAtaCksICJudW1iZXIiID09IHR5cGVvZiB1ID8gciA9IG4gPSBpID0gYSA9IHUgOiB1IGluc3RhbmNlb2YgQXJyYXkgPyAxID09PSB1Lmxlbmd0aCA/IHIgPSBuID0gaSA9IGEgPSB1WzBdIDogMiA9PT0gdS5sZW5ndGggPyAociA9IGkgPSB1WzBdLCBuID0gYSA9IHVbMV0pIDogMyA9PT0gdS5sZW5ndGggPyAociA9IHVbMF0sIG4gPSBhID0gdVsxXSwgaSA9IHVbMl0pIDogKHIgPSB1WzBdLCBuID0gdVsxXSwgaSA9IHVbMl0sIGEgPSB1WzNdKSA6IHIgPSBuID0gaSA9IGEgPSAwOwogICAgICB2YXIgYzsKICAgICAgciArIG4gPiBsICYmIChjID0gciArIG4sIHIgKj0gbCAvIGMsIG4gKj0gbCAvIGMpLCBpICsgYSA+IGwgJiYgKGMgPSBpICsgYSwgaSAqPSBsIC8gYywgYSAqPSBsIC8gYyksIG4gKyBpID4gaCAmJiAoYyA9IG4gKyBpLCBuICo9IGggLyBjLCBpICo9IGggLyBjKSwgciArIGEgPiBoICYmIChjID0gciArIGEsIHIgKj0gaCAvIGMsIGEgKj0gaCAvIGMpLCB0Lm1vdmVUbyhvICsgciwgcyksIHQubGluZVRvKG8gKyBsIC0gbiwgcyksIDAgIT09IG4gJiYgdC5xdWFkcmF0aWNDdXJ2ZVRvKG8gKyBsLCBzLCBvICsgbCwgcyArIG4pLCB0LmxpbmVUbyhvICsgbCwgcyArIGggLSBpKSwgMCAhPT0gaSAmJiB0LnF1YWRyYXRpY0N1cnZlVG8obyArIGwsIHMgKyBoLCBvICsgbCAtIGksIHMgKyBoKSwgdC5saW5lVG8obyArIGEsIHMgKyBoKSwgMCAhPT0gYSAmJiB0LnF1YWRyYXRpY0N1cnZlVG8obywgcyArIGgsIG8sIHMgKyBoIC0gYSksIHQubGluZVRvKG8sIHMgKyByKSwgMCAhPT0gciAmJiB0LnF1YWRyYXRpY0N1cnZlVG8obywgcywgbyArIHIsIHMpOwogICAgfQogICAgZS5idWlsZFBhdGggPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgcmV0dXJuIHQgJT0gbiwgdCA8IDAgJiYgKHQgKz0gbiksIHQ7CiAgICB9CiAgICB2YXIgbiA9IDIgKiBNYXRoLlBJOwogICAgZS5ub3JtYWxpemVSYWRpYW4gPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlLnBvaW50cywKICAgICAgICBvID0gZS5zbW9vdGg7CiAgICAgIGlmIChuICYmIG4ubGVuZ3RoID49IDIpIHsKICAgICAgICBpZiAobyAmJiAic3BsaW5lIiAhPT0gbykgewogICAgICAgICAgdmFyIHMgPSBhKG4sIG8sIHIsIGUuc21vb3RoQ29uc3RyYWludCk7CiAgICAgICAgICB0Lm1vdmVUbyhuWzBdWzBdLCBuWzBdWzFdKTsKICAgICAgICAgIGZvciAodmFyIGwgPSBuLmxlbmd0aCwgaCA9IDA7IGggPCAociA/IGwgOiBsIC0gMSk7IGgrKykgewogICAgICAgICAgICB2YXIgdSA9IHNbMiAqIGhdLAogICAgICAgICAgICAgIGMgPSBzWzIgKiBoICsgMV0sCiAgICAgICAgICAgICAgZiA9IG5bKGggKyAxKSAlIGxdOwogICAgICAgICAgICB0LmJlemllckN1cnZlVG8odVswXSwgdVsxXSwgY1swXSwgY1sxXSwgZlswXSwgZlsxXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICJzcGxpbmUiID09PSBvICYmIChuID0gaShuLCByKSksIHQubW92ZVRvKG5bMF1bMF0sIG5bMF1bMV0pOwogICAgICAgICAgZm9yICh2YXIgaCA9IDEsIGQgPSBuLmxlbmd0aDsgaCA8IGQ7IGgrKykgdC5saW5lVG8obltoXVswXSwgbltoXVsxXSk7CiAgICAgICAgfQogICAgICAgIHIgJiYgdC5jbG9zZVBhdGgoKTsKICAgICAgfQogICAgfQogICAgdmFyIGkgPSByKDY2KSwKICAgICAgYSA9IHIoNjcpOwogICAgZS5idWlsZFBhdGggPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHRoaXMuY29sb3JTdG9wcyA9IHQgfHwgW107CiAgICB9OwogICAgci5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiByLAogICAgICBhZGRDb2xvclN0b3A6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdGhpcy5jb2xvclN0b3BzLnB1c2goewogICAgICAgICAgb2Zmc2V0OiB0LAogICAgICAgICAgY29sb3I6IGUKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIHZhciBuID0gcjsKICAgIHQuZXhwb3J0cyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHQuZXhwb3J0cyA9IHIoMjYpOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgZm9yICh2YXIgZSA9IHQuZ2V0Q29udGV4dCgiMmQiKSwgciA9IGUuZ2V0SW1hZ2VEYXRhKDAsIDAsIHQud2lkdGgsIHQuaGVpZ2h0KSwgbiA9IGUuY3JlYXRlSW1hZ2VEYXRhKHIpLCBpID0gMCwgYSA9IDAsIG8gPSAwOyBvIDwgci5kYXRhLmxlbmd0aDsgbyArPSA0KSB7CiAgICAgICAgdmFyIHMgPSByLmRhdGFbbyArIDNdOwogICAgICAgIGlmIChzID4gMTI4KSB7CiAgICAgICAgICB2YXIgbCA9IHIuZGF0YVtvXSArIHIuZGF0YVtvICsgMV0gKyByLmRhdGFbbyArIDJdOwogICAgICAgICAgaSArPSBsLCArK2E7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIGggPSBpIC8gYSwgbyA9IDA7IG8gPCByLmRhdGEubGVuZ3RoOyBvICs9IDQpIHsKICAgICAgICB2YXIgbCA9IHIuZGF0YVtvXSArIHIuZGF0YVtvICsgMV0gKyByLmRhdGFbbyArIDJdLAogICAgICAgICAgcyA9IHIuZGF0YVtvICsgM107CiAgICAgICAgcyA8IDEyOCB8fCBsID4gaCA/IChuLmRhdGFbb10gPSAwLCBuLmRhdGFbbyArIDFdID0gMCwgbi5kYXRhW28gKyAyXSA9IDAsIG4uZGF0YVtvICsgM10gPSAwKSA6IChuLmRhdGFbb10gPSAyNTUsIG4uZGF0YVtvICsgMV0gPSAyNTUsIG4uZGF0YVtvICsgMl0gPSAyNTUsIG4uZGF0YVtvICsgM10gPSAyNTUpOwogICAgICB9CiAgICAgIGUucHV0SW1hZ2VEYXRhKG4sIDAsIDApOwogICAgfQogICAgdmFyIGkgPSByKDcpLAogICAgICBhID0gcigyNyk7CiAgICByKDI4KSwgcig3Nyk7CiAgICB2YXIgbyA9IHIoNzgpOwogICAgaWYgKCFvLmlzU3VwcG9ydGVkKSB0aHJvdyBuZXcgRXJyb3IoIlNvcnJ5IHlvdXIgYnJvd3NlciBub3Qgc3VwcG9ydCB3b3JkQ2xvdWQiKTsKICAgIGkucmVnaXN0ZXJMYXlvdXQoZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdC5lYWNoU2VyaWVzQnlUeXBlKCJ3b3JkQ2xvdWQiLCBmdW5jdGlvbiAocikgewogICAgICAgIGZ1bmN0aW9uIHModCkgewogICAgICAgICAgdmFyIGUgPSB0LmRldGFpbC5pdGVtOwogICAgICAgICAgdC5kZXRhaWwuZHJhd24gJiYgci5sYXlvdXRJbnN0YW5jZS5vbmRyYXcgJiYgKHQuZGV0YWlsLmRyYXduLmd4ICs9IGwueCAvIG0sIHQuZGV0YWlsLmRyYXduLmd5ICs9IGwueSAvIG0sIHIubGF5b3V0SW5zdGFuY2Uub25kcmF3KGVbMF0sIGVbMV0sIGVbMl0sIHQuZGV0YWlsLmRyYXduKSk7CiAgICAgICAgfQogICAgICAgIHZhciBsID0gYS5nZXRMYXlvdXRSZWN0KHIuZ2V0Qm94TGF5b3V0UGFyYW1zKCksIHsKICAgICAgICAgICAgd2lkdGg6IGUuZ2V0V2lkdGgoKSwKICAgICAgICAgICAgaGVpZ2h0OiBlLmdldEhlaWdodCgpCiAgICAgICAgICB9KSwKICAgICAgICAgIGggPSByLmdldERhdGEoKSwKICAgICAgICAgIHUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICB1LndpZHRoID0gbC53aWR0aCwgdS5oZWlnaHQgPSBsLmhlaWdodDsKICAgICAgICB2YXIgYyA9IHUuZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgIGYgPSByLmdldCgibWFza0ltYWdlIik7CiAgICAgICAgaWYgKGYpIHRyeSB7CiAgICAgICAgICBjLmRyYXdJbWFnZShmLCAwLCAwLCB1LndpZHRoLCB1LmhlaWdodCksIG4odSk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiSW52YWxpZCBtYXNrIGltYWdlIiksIGNvbnNvbGUuZXJyb3IodC50b1N0cmluZygpKTsKICAgICAgICB9CiAgICAgICAgdmFyIGQgPSByLmdldCgic2l6ZVJhbmdlIiksCiAgICAgICAgICB2ID0gci5nZXQoInJvdGF0aW9uUmFuZ2UiKSwKICAgICAgICAgIGcgPSBoLmdldERhdGFFeHRlbnQoInZhbHVlIiksCiAgICAgICAgICBwID0gTWF0aC5QSSAvIDE4MCwKICAgICAgICAgIG0gPSByLmdldCgiZ3JpZFNpemUiKTsKICAgICAgICBvKHUsIHsKICAgICAgICAgIGxpc3Q6IGgubWFwQXJyYXkoInZhbHVlIiwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgdmFyIHIgPSBoLmdldEl0ZW1Nb2RlbChlKTsKICAgICAgICAgICAgcmV0dXJuIFtoLmdldE5hbWUoZSksIHIuZ2V0KCJ0ZXh0U3R5bGUubm9ybWFsLnRleHRTaXplIiwgITApIHx8IGkubnVtYmVyLmxpbmVhck1hcCh0LCBnLCBkKSwgZV07CiAgICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgIHJldHVybiBlWzFdIC0gdFsxXTsKICAgICAgICAgIH0pLAogICAgICAgICAgZm9udEZhbWlseTogci5nZXQoInRleHRTdHlsZS5ub3JtYWwuZm9udEZhbWlseSIpIHx8IHIuZ2V0KCJ0ZXh0U3R5bGUuZW1waGFzaXMuZm9udEZhbWlseSIpIHx8IHQuZ2V0KCJ0ZXh0U3R5bGUuZm9udEZhbWlseSIpLAogICAgICAgICAgZm9udFdlaWdodDogci5nZXQoInRleHRTdHlsZS5ub3JtYWwuZm9udFdlaWdodCIpIHx8IHIuZ2V0KCJ0ZXh0U3R5bGUuZW1waGFzaXMuZm9udFdlaWdodCIpIHx8IHQuZ2V0KCJ0ZXh0U3R5bGUuZm9udFdlaWdodCIpLAogICAgICAgICAgZ3JpZFNpemU6IG0sCiAgICAgICAgICBlbGxpcHRpY2l0eTogbC5oZWlnaHQgLyBsLndpZHRoLAogICAgICAgICAgbWluUm90YXRpb246IHZbMF0gKiBwLAogICAgICAgICAgbWF4Um90YXRpb246IHZbMV0gKiBwLAogICAgICAgICAgY2xlYXJDYW52YXM6ICFmLAogICAgICAgICAgcm90YXRlUmF0aW86IDEsCiAgICAgICAgICByb3RhdGlvblN0ZXA6IHIuZ2V0KCJyb3RhdGlvblN0ZXAiKSAqIHAsCiAgICAgICAgICBkcmF3T3V0T2ZCb3VuZDogci5nZXQoImRyYXdPdXRPZkJvdW5kIiksCiAgICAgICAgICBzaHVmZmxlOiAhMSwKICAgICAgICAgIHNoYXBlOiByLmdldCgic2hhcGUiKQogICAgICAgIH0pLCB1LmFkZEV2ZW50TGlzdGVuZXIoIndvcmRjbG91ZGRyYXduIiwgcyksIHIubGF5b3V0SW5zdGFuY2UgJiYgci5sYXlvdXRJbnN0YW5jZS5kaXNwb3NlKCksIHIubGF5b3V0SW5zdGFuY2UgPSB7CiAgICAgICAgICBvbmRyYXc6IG51bGwsCiAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHUucmVtb3ZlRXZlbnRMaXN0ZW5lcigid29yZGNsb3VkZHJhd24iLCBzKSwgdS5hZGRFdmVudExpc3RlbmVyKCJ3b3JkY2xvdWRkcmF3biIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KTsKICAgIH0pLCBpLnJlZ2lzdGVyUHJlcHJvY2Vzc29yKGZ1bmN0aW9uICh0KSB7CiAgICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgIHQgJiYgaS51dGlsLmVhY2gobiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkoZSkgJiYgKHRbInRleHQiICsgaS5mb3JtYXQuY2FwaXRhbEZpcnN0KGUpXSA9IHRbZV0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciByID0gKHQgfHwge30pLnNlcmllczsKICAgICAgIWkudXRpbC5pc0FycmF5KHIpICYmIChyID0gciA/IFtyXSA6IFtdKTsKICAgICAgdmFyIG4gPSBbInNoYWRvd0NvbG9yIiwgInNoYWRvd0JsdXIiLCAic2hhZG93T2Zmc2V0WCIsICJzaGFkb3dPZmZzZXRZIl07CiAgICAgIGkudXRpbC5lYWNoKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHQgJiYgIndvcmRDbG91ZCIgPT09IHQudHlwZSkgewogICAgICAgICAgdmFyIHIgPSB0LnRleHRTdHlsZSB8fCB7fTsKICAgICAgICAgIGUoci5ub3JtYWwpLCBlKHIuZW1waGFzaXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByLCBuLCBpKSB7CiAgICAgIHZhciBhID0gMCwKICAgICAgICBvID0gMDsKICAgICAgbnVsbCA9PSBuICYmIChuID0gMSAvIDApLCBudWxsID09IGkgJiYgKGkgPSAxIC8gMCk7CiAgICAgIHZhciBzID0gMDsKICAgICAgZS5lYWNoQ2hpbGQoZnVuY3Rpb24gKGwsIGgpIHsKICAgICAgICB2YXIgdSwKICAgICAgICAgIGMsCiAgICAgICAgICBmID0gbC5wb3NpdGlvbiwKICAgICAgICAgIGQgPSBsLmdldEJvdW5kaW5nUmVjdCgpLAogICAgICAgICAgdiA9IGUuY2hpbGRBdChoICsgMSksCiAgICAgICAgICBnID0gdiAmJiB2LmdldEJvdW5kaW5nUmVjdCgpOwogICAgICAgIGlmICgiaG9yaXpvbnRhbCIgPT09IHQpIHsKICAgICAgICAgIHZhciBwID0gZC53aWR0aCArIChnID8gLWcueCArIGQueCA6IDApOwogICAgICAgICAgdSA9IGEgKyBwLCB1ID4gbiB8fCBsLm5ld2xpbmUgPyAoYSA9IDAsIHUgPSBwLCBvICs9IHMgKyByLCBzID0gZC5oZWlnaHQpIDogcyA9IE1hdGgubWF4KHMsIGQuaGVpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIG0gPSBkLmhlaWdodCArIChnID8gLWcueSArIGQueSA6IDApOwogICAgICAgICAgYyA9IG8gKyBtLCBjID4gaSB8fCBsLm5ld2xpbmUgPyAoYSArPSBzICsgciwgbyA9IDAsIGMgPSBtLCBzID0gZC53aWR0aCkgOiBzID0gTWF0aC5tYXgocywgZC53aWR0aCk7CiAgICAgICAgfQogICAgICAgIGwubmV3bGluZSB8fCAoZlswXSA9IGEsIGZbMV0gPSBvLCAiaG9yaXpvbnRhbCIgPT09IHQgPyBhID0gdSArIHIgOiBvID0gYyArIHIpOwogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICB2YXIgbiA9IGUud2lkdGgsCiAgICAgICAgaSA9IGUuaGVpZ2h0LAogICAgICAgIGEgPSB2KHQueCwgbiksCiAgICAgICAgbyA9IHYodC55LCBpKSwKICAgICAgICBzID0gdih0LngyLCBuKSwKICAgICAgICBsID0gdih0LnkyLCBpKTsKICAgICAgcmV0dXJuIChpc05hTihhKSB8fCBpc05hTihwYXJzZUZsb2F0KHQueCkpKSAmJiAoYSA9IDApLCAoaXNOYU4ocykgfHwgaXNOYU4ocGFyc2VGbG9hdCh0LngyKSkpICYmIChzID0gbiksIChpc05hTihvKSB8fCBpc05hTihwYXJzZUZsb2F0KHQueSkpKSAmJiAobyA9IDApLCAoaXNOYU4obCkgfHwgaXNOYU4ocGFyc2VGbG9hdCh0LnkyKSkpICYmIChsID0gaSksIHIgPSBnLm5vcm1hbGl6ZUNzc0FycmF5KHIgfHwgMCksIHsKICAgICAgICB3aWR0aDogTWF0aC5tYXgocyAtIGEgLSByWzFdIC0gclszXSwgMCksCiAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChsIC0gbyAtIHJbMF0gLSByWzJdLCAwKQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gYSh0LCBlLCByKSB7CiAgICAgIHIgPSBnLm5vcm1hbGl6ZUNzc0FycmF5KHIgfHwgMCk7CiAgICAgIHZhciBuID0gZS53aWR0aCwKICAgICAgICBpID0gZS5oZWlnaHQsCiAgICAgICAgYSA9IHYodC5sZWZ0LCBuKSwKICAgICAgICBvID0gdih0LnRvcCwgaSksCiAgICAgICAgcyA9IHYodC5yaWdodCwgbiksCiAgICAgICAgbCA9IHYodC5ib3R0b20sIGkpLAogICAgICAgIGggPSB2KHQud2lkdGgsIG4pLAogICAgICAgIHUgPSB2KHQuaGVpZ2h0LCBpKSwKICAgICAgICBjID0gclsyXSArIHJbMF0sCiAgICAgICAgZCA9IHJbMV0gKyByWzNdLAogICAgICAgIHAgPSB0LmFzcGVjdDsKICAgICAgc3dpdGNoIChpc05hTihoKSAmJiAoaCA9IG4gLSBzIC0gZCAtIGEpLCBpc05hTih1KSAmJiAodSA9IGkgLSBsIC0gYyAtIG8pLCBudWxsICE9IHAgJiYgKGlzTmFOKGgpICYmIGlzTmFOKHUpICYmIChwID4gbiAvIGkgPyBoID0gLjggKiBuIDogdSA9IC44ICogaSksIGlzTmFOKGgpICYmIChoID0gcCAqIHUpLCBpc05hTih1KSAmJiAodSA9IGggLyBwKSksIGlzTmFOKGEpICYmIChhID0gbiAtIHMgLSBoIC0gZCksIGlzTmFOKG8pICYmIChvID0gaSAtIGwgLSB1IC0gYyksIHQubGVmdCB8fCB0LnJpZ2h0KSB7CiAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgIGEgPSBuIC8gMiAtIGggLyAyIC0gclszXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgIGEgPSBuIC0gaCAtIGQ7CiAgICAgIH0KICAgICAgc3dpdGNoICh0LnRvcCB8fCB0LmJvdHRvbSkgewogICAgICAgIGNhc2UgIm1pZGRsZSI6CiAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgIG8gPSBpIC8gMiAtIHUgLyAyIC0gclswXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICBvID0gaSAtIHUgLSBjOwogICAgICB9CiAgICAgIGEgPSBhIHx8IDAsIG8gPSBvIHx8IDAsIGlzTmFOKGgpICYmIChoID0gbiAtIGQgLSBhIC0gKHMgfHwgMCkpLCBpc05hTih1KSAmJiAodSA9IGkgLSBjIC0gbyAtIChsIHx8IDApKTsKICAgICAgdmFyIG0gPSBuZXcgZihhICsgclszXSwgbyArIHJbMF0sIGgsIHUpOwogICAgICByZXR1cm4gbS5tYXJnaW4gPSByLCBtOwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByLCBuLCBpKSB7CiAgICAgIHZhciBvID0gIWkgfHwgIWkuaHYgfHwgaS5odlswXSwKICAgICAgICBzID0gIWkgfHwgIWkuaHYgfHwgaS5odlsxXSwKICAgICAgICBsID0gaSAmJiBpLmJvdW5kaW5nTW9kZSB8fCAiYWxsIjsKICAgICAgaWYgKG8gfHwgcykgewogICAgICAgIHZhciBoOwogICAgICAgIGlmICgicmF3IiA9PT0gbCkgaCA9ICJncm91cCIgPT09IHQudHlwZSA/IG5ldyBmKDAsIDAsICtlLndpZHRoIHx8IDAsICtlLmhlaWdodCB8fCAwKSA6IHQuZ2V0Qm91bmRpbmdSZWN0KCk7ZWxzZSBpZiAoaCA9IHQuZ2V0Qm91bmRpbmdSZWN0KCksIHQubmVlZExvY2FsVHJhbnNmb3JtKCkpIHsKICAgICAgICAgIHZhciB1ID0gdC5nZXRMb2NhbFRyYW5zZm9ybSgpOwogICAgICAgICAgaCA9IGguY2xvbmUoKSwgaC5hcHBseVRyYW5zZm9ybSh1KTsKICAgICAgICB9CiAgICAgICAgZSA9IGEoYy5kZWZhdWx0cyh7CiAgICAgICAgICB3aWR0aDogaC53aWR0aCwKICAgICAgICAgIGhlaWdodDogaC5oZWlnaHQKICAgICAgICB9LCBlKSwgciwgbik7CiAgICAgICAgdmFyIGQgPSB0LnBvc2l0aW9uLAogICAgICAgICAgdiA9IG8gPyBlLnggLSBoLnggOiAwLAogICAgICAgICAgZyA9IHMgPyBlLnkgLSBoLnkgOiAwOwogICAgICAgIHQuYXR0cigicG9zaXRpb24iLCAicmF3IiA9PT0gbCA/IFt2LCBnXSA6IFtkWzBdICsgdiwgZFsxXSArIGddKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICAgIHJldHVybiBudWxsICE9IHRbeFtlXVswXV0gfHwgbnVsbCAhPSB0W3hbZV1bMV1dICYmIG51bGwgIT0gdFt4W2VdWzJdXTsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICBmdW5jdGlvbiBuKHIsIG4pIHsKICAgICAgICB2YXIgbyA9IHt9LAogICAgICAgICAgbCA9IDAsCiAgICAgICAgICBoID0ge30sCiAgICAgICAgICB1ID0gMDsKICAgICAgICBpZiAocChyLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaFtlXSA9IHRbZV07CiAgICAgICAgfSksIHAociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkoZSwgdCkgJiYgKG9bdF0gPSBoW3RdID0gZVt0XSksIGEobywgdCkgJiYgbCsrLCBhKGgsIHQpICYmIHUrKzsKICAgICAgICB9KSwgc1tuXSkgcmV0dXJuIGEoZSwgclsxXSkgPyBoW3JbMl1dID0gbnVsbCA6IGEoZSwgclsyXSkgJiYgKGhbclsxXV0gPSBudWxsKSwgaDsKICAgICAgICBpZiAoMiAhPT0gdSAmJiBsKSB7CiAgICAgICAgICBpZiAobCA+PSAyKSByZXR1cm4gbzsKICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgci5sZW5ndGg7IGMrKykgewogICAgICAgICAgICB2YXIgZiA9IHJbY107CiAgICAgICAgICAgIGlmICghaShvLCBmKSAmJiBpKHQsIGYpKSB7CiAgICAgICAgICAgICAgb1tmXSA9IHRbZl07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaDsKICAgICAgfQogICAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgICByZXR1cm4gdC5oYXNPd25Qcm9wZXJ0eShlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgICByZXR1cm4gbnVsbCAhPSB0W2VdICYmICJhdXRvIiAhPT0gdFtlXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgICBwKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBlW3RdID0gclt0XTsKICAgICAgICB9KTsKICAgICAgfQogICAgICAhYy5pc09iamVjdChyKSAmJiAociA9IHt9KTsKICAgICAgdmFyIHMgPSByLmlnbm9yZVNpemU7CiAgICAgICFjLmlzQXJyYXkocykgJiYgKHMgPSBbcywgc10pOwogICAgICB2YXIgbCA9IG4oeFswXSwgMCksCiAgICAgICAgaCA9IG4oeFsxXSwgMSk7CiAgICAgIG8oeFswXSwgdCwgbCksIG8oeFsxXSwgdCwgaCk7CiAgICB9CiAgICBmdW5jdGlvbiBoKHQpIHsKICAgICAgcmV0dXJuIHUoe30sIHQpOwogICAgfQogICAgZnVuY3Rpb24gdSh0LCBlKSB7CiAgICAgIHJldHVybiBlICYmIHQgJiYgcChtLCBmdW5jdGlvbiAocikgewogICAgICAgIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsKICAgICAgfSksIHQ7CiAgICB9CiAgICB2YXIgYyA9IHIoMCksCiAgICAgIGYgPSByKDMpLAogICAgICBkID0gcig5KSwKICAgICAgdiA9IGQucGFyc2VQZXJjZW50LAogICAgICBnID0gcigxMyksCiAgICAgIHAgPSBjLmVhY2gsCiAgICAgIG0gPSBbImxlZnQiLCAicmlnaHQiLCAidG9wIiwgImJvdHRvbSIsICJ3aWR0aCIsICJoZWlnaHQiXSwKICAgICAgeCA9IFtbIndpZHRoIiwgImxlZnQiLCAicmlnaHQiXSwgWyJoZWlnaHQiLCAidG9wIiwgImJvdHRvbSJdXSwKICAgICAgeSA9IG4sCiAgICAgIHcgPSBjLmN1cnJ5KG4sICJ2ZXJ0aWNhbCIpLAogICAgICBfID0gYy5jdXJyeShuLCAiaG9yaXpvbnRhbCIpOwogICAgZS5MT0NBVElPTl9QQVJBTVMgPSBtLCBlLkhWX05BTUVTID0geCwgZS5ib3ggPSB5LCBlLnZib3ggPSB3LCBlLmhib3ggPSBfLCBlLmdldEF2YWlsYWJsZVNpemUgPSBpLCBlLmdldExheW91dFJlY3QgPSBhLCBlLnBvc2l0aW9uRWxlbWVudCA9IG8sIGUuc2l6ZUNhbGN1bGFibGUgPSBzLCBlLm1lcmdlTGF5b3V0UGFyYW0gPSBsLCBlLmdldExheW91dFBhcmFtcyA9IGgsIGUuY29weUxheW91dFBhcmFtcyA9IHU7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigyOSksCiAgICAgIGkgPSByKDcpOwogICAgaS5leHRlbmRTZXJpZXNNb2RlbCh7CiAgICAgIHR5cGU6ICJzZXJpZXMud29yZENsb3VkIiwKICAgICAgdmlzdWFsQ29sb3JBY2Nlc3NQYXRoOiAidGV4dFN0eWxlLm5vcm1hbC5jb2xvciIsCiAgICAgIG9wdGlvblVwZGF0ZWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMub3B0aW9uOwogICAgICAgIHQuZ3JpZFNpemUgPSBNYXRoLm1heChNYXRoLmZsb29yKHQuZ3JpZFNpemUpLCA0KTsKICAgICAgfSwKICAgICAgZ2V0SW5pdGlhbERhdGE6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSBuKFsidmFsdWUiXSwgdC5kYXRhKSwKICAgICAgICAgIGEgPSBuZXcgaS5MaXN0KHIsIHRoaXMpOwogICAgICAgIHJldHVybiBhLmluaXREYXRhKHQuZGF0YSksIGE7CiAgICAgIH0sCiAgICAgIGRlZmF1bHRPcHRpb246IHsKICAgICAgICBtYXNrSW1hZ2U6IG51bGwsCiAgICAgICAgc2hhcGU6ICJjaXJjbGUiLAogICAgICAgIGxlZnQ6ICJjZW50ZXIiLAogICAgICAgIHRvcDogImNlbnRlciIsCiAgICAgICAgd2lkdGg6ICI3MCUiLAogICAgICAgIGhlaWdodDogIjgwJSIsCiAgICAgICAgc2l6ZVJhbmdlOiBbMTIsIDYwXSwKICAgICAgICByb3RhdGlvblJhbmdlOiBbLTkwLCA5MF0sCiAgICAgICAgcm90YXRpb25TdGVwOiA0NSwKICAgICAgICBncmlkU2l6ZTogOCwKICAgICAgICBkcmF3T3V0T2ZCb3VuZDogITEsCiAgICAgICAgdGV4dFN0eWxlOiB7CiAgICAgICAgICBub3JtYWw6IHsKICAgICAgICAgICAgZm9udFdlaWdodDogIm5vcm1hbCIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgICAgY1tlXSA/IHQub3RoZXJEaW1zW2VdID0gciA6ICh0LmNvb3JkRGltID0gZSwgdC5jb29yZERpbUluZGV4ID0gciwgcC5zZXQoZSwgITApKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgICBpZiAociB8fCBudWxsICE9IGUuZ2V0KHQpKSB7CiAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbnVsbCAhPSBlLmdldCh0ICsgbik7KSBuKys7CiAgICAgICAgICB0ICs9IG47CiAgICAgICAgfQogICAgICAgIHJldHVybiBlLnNldCh0LCAhMCksIHQ7CiAgICAgIH0KICAgICAgZSA9IGUgfHwgW10sIHIgPSByIHx8IHt9LCB0ID0gKHQgfHwgW10pLnNsaWNlKCk7CiAgICAgIHZhciBkID0gKHIuZGltc0RlZiB8fCBbXSkuc2xpY2UoKSwKICAgICAgICB2ID0gYS5jcmVhdGVIYXNoTWFwKHIuZW5jb2RlRGVmKSwKICAgICAgICBnID0gYS5jcmVhdGVIYXNoTWFwKCksCiAgICAgICAgcCA9IGEuY3JlYXRlSGFzaE1hcCgpLAogICAgICAgIG0gPSBbXSwKICAgICAgICB4ID0gci5kaW1Db3VudDsKICAgICAgaWYgKG51bGwgPT0geCkgewogICAgICAgIHZhciB5ID0gaShlWzBdKTsKICAgICAgICB4ID0gTWF0aC5tYXgoYS5pc0FycmF5KHkpICYmIHkubGVuZ3RoIHx8IDEsIHQubGVuZ3RoLCBkLmxlbmd0aCksIGwodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gdC5kaW1zRGVmOwogICAgICAgICAgZSAmJiAoeCA9IE1hdGgubWF4KHgsIGUubGVuZ3RoKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZm9yICh2YXIgdyA9IDA7IHcgPCB4OyB3KyspIHsKICAgICAgICB2YXIgXyA9IGgoZFt3XSkgPyB7CiAgICAgICAgICAgIG5hbWU6IGRbd10KICAgICAgICAgIH0gOiBkW3ddIHx8IHt9LAogICAgICAgICAgYiA9IF8ubmFtZSwKICAgICAgICAgIFMgPSBtW3ddID0gewogICAgICAgICAgICBvdGhlckRpbXM6IHt9CiAgICAgICAgICB9OwogICAgICAgIG51bGwgIT0gYiAmJiBudWxsID09IGcuZ2V0KGIpICYmIChTLm5hbWUgPSBTLnRvb2x0aXBOYW1lID0gYiwgZy5zZXQoYiwgdykpLCBudWxsICE9IF8udHlwZSAmJiAoUy50eXBlID0gXy50eXBlKTsKICAgICAgfQogICAgICB2LmVhY2goZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB0ID0gdi5zZXQoZSwgcyh0KS5zbGljZSgpKSwgbCh0LCBmdW5jdGlvbiAociwgaSkgewogICAgICAgICAgaChyKSAmJiAociA9IGcuZ2V0KHIpKSwgbnVsbCAhPSByICYmIHIgPCB4ICYmICh0W2ldID0gciwgbihtW3JdLCBlLCBpKSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB2YXIgTSA9IDA7CiAgICAgIGwodCwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciwgdCwgaSwgbzsKICAgICAgICBoKHQpID8gKHIgPSB0LCB0ID0ge30pIDogKHIgPSB0Lm5hbWUsIHQgPSBhLmNsb25lKHQpLCBpID0gdC5kaW1zRGVmLCBvID0gdC5vdGhlckRpbXMsIHQubmFtZSA9IHQuY29vcmREaW0gPSB0LmNvb3JkRGltSW5kZXggPSB0LmRpbXNEZWYgPSB0Lm90aGVyRGltcyA9IG51bGwpOwogICAgICAgIHZhciBjID0gcyh2LmdldChyKSk7CiAgICAgICAgaWYgKCFjLmxlbmd0aCkgZm9yICh2YXIgZiA9IDA7IGYgPCAoaSAmJiBpLmxlbmd0aCB8fCAxKTsgZisrKSB7CiAgICAgICAgICBmb3IgKDsgTSA8IG0ubGVuZ3RoICYmIG51bGwgIT0gbVtNXS5jb29yZERpbTspIE0rKzsKICAgICAgICAgIE0gPCBtLmxlbmd0aCAmJiBjLnB1c2goTSsrKTsKICAgICAgICB9CiAgICAgICAgbChjLCBmdW5jdGlvbiAoZSwgYSkgewogICAgICAgICAgdmFyIHMgPSBtW2VdOwogICAgICAgICAgbih1KHMsIHQpLCByLCBhKSwgbnVsbCA9PSBzLm5hbWUgJiYgaSAmJiAocy5uYW1lID0gcy50b29sdGlwTmFtZSA9IGlbYV0pLCBvICYmIHUocy5vdGhlckRpbXMsIG8pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgZm9yICh2YXIgVCA9IHIuZXh0cmFQcmVmaXggfHwgInZhbHVlIiwgayA9IDA7IGsgPCB4OyBrKyspIHsKICAgICAgICB2YXIgUyA9IG1ba10gPSBtW2tdIHx8IHt9OwogICAgICAgIG51bGwgPT0gUy5jb29yZERpbSAmJiAoUy5jb29yZERpbSA9IG8oVCwgcCwgci5leHRyYUZyb21aZXJvKSwgUy5jb29yZERpbUluZGV4ID0gMCwgUy5pc0V4dHJhQ29vcmQgPSAhMCksIG51bGwgPT0gUy5uYW1lICYmIChTLm5hbWUgPSBvKFMuY29vcmREaW0sIGcpKSwgbnVsbCA9PSBTLnR5cGUgJiYgZihlLCBrKSAmJiAoUy50eXBlID0gIm9yZGluYWwiKTsKICAgICAgfQogICAgICByZXR1cm4gbTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCkgewogICAgICByZXR1cm4gYS5pc0FycmF5KHQpID8gdCA6IGEuaXNPYmplY3QodCkgPyB0LnZhbHVlIDogdDsKICAgIH0KICAgIHZhciBhID0gcigwKSwKICAgICAgbyA9IHIoMzApLAogICAgICBzID0gby5ub3JtYWxpemVUb0FycmF5LAogICAgICBsID0gYS5lYWNoLAogICAgICBoID0gYS5pc1N0cmluZywKICAgICAgdSA9IGEuZGVmYXVsdHMsCiAgICAgIGMgPSB7CiAgICAgICAgdG9vbHRpcDogMSwKICAgICAgICBsYWJlbDogMSwKICAgICAgICBpdGVtTmFtZTogMQogICAgICB9LAogICAgICBmID0gbi5ndWVzc09yZGluYWwgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGZvciAodmFyIHIgPSAwLCBuID0gdC5sZW5ndGg7IHIgPCBuOyByKyspIHsKICAgICAgICAgIHZhciBvID0gaSh0W3JdKTsKICAgICAgICAgIGlmICghYS5pc0FycmF5KG8pKSByZXR1cm4gITE7CiAgICAgICAgICB2YXIgbyA9IG9bZV07CiAgICAgICAgICBpZiAobnVsbCAhPSBvICYmIGlzRmluaXRlKG8pICYmICIiICE9PSBvKSByZXR1cm4gITE7CiAgICAgICAgICBpZiAoaChvKSAmJiAiLSIgIT09IG8pIHJldHVybiAhMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICExOwogICAgICB9LAogICAgICBkID0gbjsKICAgIHQuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIEFycmF5ID8gdCA6IG51bGwgPT0gdCA/IFtdIDogW3RdOwogICAgfQogICAgZnVuY3Rpb24gaSh0LCBlKSB7CiAgICAgIGlmICh0KSBmb3IgKHZhciByID0gdC5lbXBoYXNpcyA9IHQuZW1waGFzaXMgfHwge30sIG4gPSB0Lm5vcm1hbCA9IHQubm9ybWFsIHx8IHt9LCBpID0gMCwgYSA9IGUubGVuZ3RoOyBpIDwgYTsgaSsrKSB7CiAgICAgICAgdmFyIG8gPSBlW2ldOwogICAgICAgICFyLmhhc093blByb3BlcnR5KG8pICYmIG4uaGFzT3duUHJvcGVydHkobykgJiYgKHJbb10gPSBuW29dKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgIHJldHVybiB0ICYmIChudWxsID09IHQudmFsdWUgPyB0IDogdC52YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgcmV0dXJuIE0odCkgJiYgISh0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgfQogICAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICAgIHZhciByID0gZSAmJiBlLnR5cGU7CiAgICAgIHJldHVybiAib3JkaW5hbCIgPT09IHIgPyB0IDogKCJ0aW1lIiA9PT0gciAmJiAibnVtYmVyIiAhPSB0eXBlb2YgdCAmJiBudWxsICE9IHQgJiYgIi0iICE9PSB0ICYmICh0ID0gK18ucGFyc2VEYXRlKHQpKSwgbnVsbCA9PSB0IHx8ICIiID09PSB0ID8gTmFOIDogK3QpOwogICAgfQogICAgZnVuY3Rpb24gbCh0LCBlKSB7CiAgICAgIHZhciByID0gbmV3IGIoKTsKICAgICAgcmV0dXJuIHkubWl4aW4ociwgayksIHIuc2VyaWVzSW5kZXggPSBlLnNlcmllc0luZGV4LCByLm5hbWUgPSBlLm5hbWUgfHwgIiIsIHIubWFpblR5cGUgPSBlLm1haW5UeXBlLCByLnN1YlR5cGUgPSBlLnN1YlR5cGUsIHIuZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdDsKICAgICAgfSwgcjsKICAgIH0KICAgIGZ1bmN0aW9uIGgodCwgZSkgewogICAgICBlID0gKGUgfHwgW10pLnNsaWNlKCk7CiAgICAgIHZhciByID0geS5tYXAodCB8fCBbXSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZXhpc3Q6IHQKICAgICAgICB9OwogICAgICB9KTsKICAgICAgcmV0dXJuIFMoZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBpZiAoTSh0KSkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKSBpZiAoIXJbaV0ub3B0aW9uICYmIG51bGwgIT0gdC5pZCAmJiByW2ldLmV4aXN0LmlkID09PSB0LmlkICsgIiIpIHJldHVybiByW2ldLm9wdGlvbiA9IHQsIHZvaWQgKGVbbl0gPSBudWxsKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYSA9IHJbaV0uZXhpc3Q7CiAgICAgICAgICAgIGlmICghKHJbaV0ub3B0aW9uIHx8IG51bGwgIT0gYS5pZCAmJiBudWxsICE9IHQuaWQgfHwgbnVsbCA9PSB0Lm5hbWUgfHwgYyh0KSB8fCBjKGEpIHx8IGEubmFtZSAhPT0gdC5uYW1lICsgIiIpKSByZXR1cm4gcltpXS5vcHRpb24gPSB0LCB2b2lkIChlW25dID0gbnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSwgUyhlLCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmIChNKHQpKSB7CiAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHIubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgdmFyIGkgPSByW25dLmV4aXN0OwogICAgICAgICAgICBpZiAoIXJbbl0ub3B0aW9uICYmICFjKGkpICYmIG51bGwgPT0gdC5pZCkgewogICAgICAgICAgICAgIHJbbl0ub3B0aW9uID0gdDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbiA+PSByLmxlbmd0aCAmJiByLnB1c2goewogICAgICAgICAgICBvcHRpb246IHQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSksIHI7CiAgICB9CiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgdmFyIGUgPSB5LmNyZWF0ZUhhc2hNYXAoKTsKICAgICAgUyh0LCBmdW5jdGlvbiAodCwgcikgewogICAgICAgIHZhciBuID0gdC5leGlzdDsKICAgICAgICBuICYmIGUuc2V0KG4uaWQsIHQpOwogICAgICB9KSwgUyh0LCBmdW5jdGlvbiAodCwgcikgewogICAgICAgIHZhciBuID0gdC5vcHRpb247CiAgICAgICAgeS5hc3NlcnQoIW4gfHwgbnVsbCA9PSBuLmlkIHx8ICFlLmdldChuLmlkKSB8fCBlLmdldChuLmlkKSA9PT0gdCwgImlkIGR1cGxpY2F0ZXM6ICIgKyAobiAmJiBuLmlkKSksIG4gJiYgbnVsbCAhPSBuLmlkICYmIGUuc2V0KG4uaWQsIHQpLCAhdC5rZXlJbmZvICYmICh0LmtleUluZm8gPSB7fSk7CiAgICAgIH0pLCBTKHQsIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgdmFyIG4gPSB0LmV4aXN0LAogICAgICAgICAgaSA9IHQub3B0aW9uLAogICAgICAgICAgYSA9IHQua2V5SW5mbzsKICAgICAgICBpZiAoTShpKSkgewogICAgICAgICAgaWYgKGEubmFtZSA9IG51bGwgIT0gaS5uYW1lID8gaS5uYW1lICsgIiIgOiBuID8gbi5uYW1lIDogIlwwLSIsIG4pIGEuaWQgPSBuLmlkO2Vsc2UgaWYgKG51bGwgIT0gaS5pZCkgYS5pZCA9IGkuaWQgKyAiIjtlbHNlIHsKICAgICAgICAgICAgdmFyIG8gPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgYS5pZCA9ICJcMCIgKyBhLm5hbWUgKyAiXDAiICsgbysrOwogICAgICAgICAgICB9IHdoaWxlIChlLmdldChhLmlkKSk7CiAgICAgICAgICB9CiAgICAgICAgICBlLnNldChhLmlkLCB0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgIHJldHVybiBNKHQpICYmIHQuaWQgJiYgMCA9PT0gKHQuaWQgKyAiIikuaW5kZXhPZigiXDBfZWNfXDAiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGYodCwgZSkgewogICAgICBmdW5jdGlvbiByKHQsIGUsIHIpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgYSA9IHQubGVuZ3RoOyBpIDwgYTsgaSsrKSBmb3IgKHZhciBvID0gdFtpXS5zZXJpZXNJZCwgcyA9IG4odFtpXS5kYXRhSW5kZXgpLCBsID0gciAmJiByW29dLCBoID0gMCwgdSA9IHMubGVuZ3RoOyBoIDwgdTsgaCsrKSB7CiAgICAgICAgICB2YXIgYyA9IHNbaF07CiAgICAgICAgICBsICYmIGxbY10gPyBsW2NdID0gbnVsbCA6IChlW29dIHx8IChlW29dID0ge30pKVtjXSA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICAgIHZhciByID0gW107CiAgICAgICAgZm9yICh2YXIgbiBpbiB0KSBpZiAodC5oYXNPd25Qcm9wZXJ0eShuKSAmJiBudWxsICE9IHRbbl0pIGlmIChlKSByLnB1c2goK24pO2Vsc2UgewogICAgICAgICAgdmFyIGEgPSBpKHRbbl0sICEwKTsKICAgICAgICAgIGEubGVuZ3RoICYmIHIucHVzaCh7CiAgICAgICAgICAgIHNlcmllc0lkOiBuLAogICAgICAgICAgICBkYXRhSW5kZXg6IGEKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfQogICAgICB2YXIgYSA9IHt9LAogICAgICAgIG8gPSB7fTsKICAgICAgcmV0dXJuIHIodCB8fCBbXSwgYSksIHIoZSB8fCBbXSwgbywgYSksIFtpKGEpLCBpKG8pXTsKICAgIH0KICAgIGZ1bmN0aW9uIGQodCwgZSkgewogICAgICByZXR1cm4gbnVsbCAhPSBlLmRhdGFJbmRleEluc2lkZSA/IGUuZGF0YUluZGV4SW5zaWRlIDogbnVsbCAhPSBlLmRhdGFJbmRleCA/IHkuaXNBcnJheShlLmRhdGFJbmRleCkgPyB5Lm1hcChlLmRhdGFJbmRleCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdC5pbmRleE9mUmF3SW5kZXgoZSk7CiAgICAgIH0pIDogdC5pbmRleE9mUmF3SW5kZXgoZS5kYXRhSW5kZXgpIDogbnVsbCAhPSBlLm5hbWUgPyB5LmlzQXJyYXkoZS5uYW1lKSA/IHkubWFwKGUubmFtZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gdC5pbmRleE9mTmFtZShlKTsKICAgICAgfSkgOiB0LmluZGV4T2ZOYW1lKGUubmFtZSkgOiB2b2lkIDA7CiAgICB9CiAgICBmdW5jdGlvbiB2KHQsIGUsIHIpIHsKICAgICAgaWYgKHkuaXNTdHJpbmcoZSkpIHsKICAgICAgICB2YXIgbiA9IHt9OwogICAgICAgIG5bZSArICJJbmRleCJdID0gMCwgZSA9IG47CiAgICAgIH0KICAgICAgdmFyIGkgPSByICYmIHIuZGVmYXVsdE1haW5UeXBlOwogICAgICAhaSB8fCB4KGUsIGkgKyAiSW5kZXgiKSB8fCB4KGUsIGkgKyAiSWQiKSB8fCB4KGUsIGkgKyAiTmFtZSIpIHx8IChlW2kgKyAiSW5kZXgiXSA9IDApOwogICAgICB2YXIgYSA9IHt9OwogICAgICByZXR1cm4gUyhlLCBmdW5jdGlvbiAobiwgaSkgewogICAgICAgIHZhciBuID0gZVtpXTsKICAgICAgICBpZiAoImRhdGFJbmRleCIgPT09IGkgfHwgImRhdGFJbmRleEluc2lkZSIgPT09IGkpIHJldHVybiB2b2lkIChhW2ldID0gbik7CiAgICAgICAgdmFyIG8gPSBpLm1hdGNoKC9eKFx3KykoSW5kZXh8SWR8TmFtZSkkLykgfHwgW10sCiAgICAgICAgICBzID0gb1sxXSwKICAgICAgICAgIGwgPSAob1syXSB8fCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAoISghcyB8fCAhbCB8fCBudWxsID09IG4gfHwgImluZGV4IiA9PT0gbCAmJiAibm9uZSIgPT09IG4gfHwgciAmJiByLmluY2x1ZGVNYWluVHlwZXMgJiYgeS5pbmRleE9mKHIuaW5jbHVkZU1haW5UeXBlcywgcykgPCAwKSkgewogICAgICAgICAgdmFyIGggPSB7CiAgICAgICAgICAgIG1haW5UeXBlOiBzCiAgICAgICAgICB9OwogICAgICAgICAgImluZGV4IiA9PT0gbCAmJiAiYWxsIiA9PT0gbiB8fCAoaFtsXSA9IG4pOwogICAgICAgICAgdmFyIHUgPSB0LnF1ZXJ5Q29tcG9uZW50cyhoKTsKICAgICAgICAgIGFbcyArICJNb2RlbHMiXSA9IHUsIGFbcyArICJNb2RlbCJdID0gdVswXTsKICAgICAgICB9CiAgICAgIH0pLCBhOwogICAgfQogICAgZnVuY3Rpb24gZyh0LCBlKSB7CiAgICAgIHZhciByID0gdC5kaW1lbnNpb25zOwogICAgICBlID0gdC5nZXREaW1lbnNpb24oZSk7CiAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgci5sZW5ndGg7IG4rKykgewogICAgICAgIHZhciBpID0gdC5nZXREaW1lbnNpb25JbmZvKHJbbl0pOwogICAgICAgIGlmIChpLm5hbWUgPT09IGUpIHJldHVybiBpLmNvb3JkRGltOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwKHQsIGUpIHsKICAgICAgdmFyIHIgPSBbXTsKICAgICAgcmV0dXJuIFModC5kaW1lbnNpb25zLCBmdW5jdGlvbiAobikgewogICAgICAgIHZhciBpID0gdC5nZXREaW1lbnNpb25JbmZvKG4pOwogICAgICAgIGkuY29vcmREaW0gPT09IGUgJiYgKHJbaS5jb29yZERpbUluZGV4XSA9IGkubmFtZSk7CiAgICAgIH0pLCByOwogICAgfQogICAgZnVuY3Rpb24gbSh0LCBlKSB7CiAgICAgIHZhciByID0gW107CiAgICAgIHJldHVybiBTKHQuZGltZW5zaW9ucywgZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgaSA9IHQuZ2V0RGltZW5zaW9uSW5mbyhuKSwKICAgICAgICAgIGEgPSBpLm90aGVyRGltcywKICAgICAgICAgIG8gPSBhW2VdOwogICAgICAgIG51bGwgIT0gbyAmJiAhMSAhPT0gbyAmJiAocltvXSA9IGkubmFtZSk7CiAgICAgIH0pLCByOwogICAgfQogICAgZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHJldHVybiB0ICYmIHQuaGFzT3duUHJvcGVydHkoZSk7CiAgICB9CiAgICB2YXIgeSA9IHIoMCksCiAgICAgIHcgPSByKDEzKSwKICAgICAgXyA9IHIoOSksCiAgICAgIGIgPSByKDMxKSwKICAgICAgUyA9IHkuZWFjaCwKICAgICAgTSA9IHkuaXNPYmplY3QsCiAgICAgIFQgPSBbImZvbnRTdHlsZSIsICJmb250V2VpZ2h0IiwgImZvbnRTaXplIiwgImZvbnRGYW1pbHkiLCAicmljaCIsICJ0YWciLCAiY29sb3IiLCAidGV4dEJvcmRlckNvbG9yIiwgInRleHRCb3JkZXJXaWR0aCIsICJ3aWR0aCIsICJoZWlnaHQiLCAibGluZUhlaWdodCIsICJhbGlnbiIsICJ2ZXJ0aWNhbEFsaWduIiwgImJhc2VsaW5lIiwgInNoYWRvd0NvbG9yIiwgInNoYWRvd0JsdXIiLCAic2hhZG93T2Zmc2V0WCIsICJzaGFkb3dPZmZzZXRZIiwgInRleHRTaGFkb3dDb2xvciIsICJ0ZXh0U2hhZG93Qmx1ciIsICJ0ZXh0U2hhZG93T2Zmc2V0WCIsICJ0ZXh0U2hhZG93T2Zmc2V0WSIsICJiYWNrZ3JvdW5kQ29sb3IiLCAiYm9yZGVyQ29sb3IiLCAiYm9yZGVyV2lkdGgiLCAiYm9yZGVyUmFkaXVzIiwgInBhZGRpbmciXSwKICAgICAgayA9IHsKICAgICAgICBnZXREYXRhUGFyYW1zOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgdmFyIHIgPSB0aGlzLmdldERhdGEoZSksCiAgICAgICAgICAgIG4gPSB0aGlzLmdldFJhd1ZhbHVlKHQsIGUpLAogICAgICAgICAgICBpID0gci5nZXRSYXdJbmRleCh0KSwKICAgICAgICAgICAgYSA9IHIuZ2V0TmFtZSh0LCAhMCksCiAgICAgICAgICAgIG8gPSByLmdldFJhd0RhdGFJdGVtKHQpLAogICAgICAgICAgICBzID0gci5nZXRJdGVtVmlzdWFsKHQsICJjb2xvciIpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY29tcG9uZW50VHlwZTogdGhpcy5tYWluVHlwZSwKICAgICAgICAgICAgY29tcG9uZW50U3ViVHlwZTogdGhpcy5zdWJUeXBlLAogICAgICAgICAgICBzZXJpZXNUeXBlOiAic2VyaWVzIiA9PT0gdGhpcy5tYWluVHlwZSA/IHRoaXMuc3ViVHlwZSA6IG51bGwsCiAgICAgICAgICAgIHNlcmllc0luZGV4OiB0aGlzLnNlcmllc0luZGV4LAogICAgICAgICAgICBzZXJpZXNJZDogdGhpcy5pZCwKICAgICAgICAgICAgc2VyaWVzTmFtZTogdGhpcy5uYW1lLAogICAgICAgICAgICBuYW1lOiBhLAogICAgICAgICAgICBkYXRhSW5kZXg6IGksCiAgICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICAgIGRhdGFUeXBlOiBlLAogICAgICAgICAgICB2YWx1ZTogbiwKICAgICAgICAgICAgY29sb3I6IHMsCiAgICAgICAgICAgIG1hcmtlcjogdy5nZXRUb29sdGlwTWFya2VyKHMpLAogICAgICAgICAgICAkdmFyczogWyJzZXJpZXNOYW1lIiwgIm5hbWUiLCAidmFsdWUiXQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGdldEZvcm1hdHRlZExhYmVsOiBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgewogICAgICAgICAgZSA9IGUgfHwgIm5vcm1hbCI7CiAgICAgICAgICB2YXIgYSA9IHRoaXMuZ2V0RGF0YShyKSwKICAgICAgICAgICAgbyA9IGEuZ2V0SXRlbU1vZGVsKHQpLAogICAgICAgICAgICBzID0gdGhpcy5nZXREYXRhUGFyYW1zKHQsIHIpOwogICAgICAgICAgbnVsbCAhPSBuICYmIHMudmFsdWUgaW5zdGFuY2VvZiBBcnJheSAmJiAocy52YWx1ZSA9IHMudmFsdWVbbl0pOwogICAgICAgICAgdmFyIGwgPSBvLmdldChbaSB8fCAibGFiZWwiLCBlLCAiZm9ybWF0dGVyIl0pOwogICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGwgPyAocy5zdGF0dXMgPSBlLCBsKHMpKSA6ICJzdHJpbmciID09IHR5cGVvZiBsID8gdy5mb3JtYXRUcGwobCwgcykgOiB2b2lkIDA7CiAgICAgICAgfSwKICAgICAgICBnZXRSYXdWYWx1ZTogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIHZhciByID0gdGhpcy5nZXREYXRhKGUpLAogICAgICAgICAgICBuID0gci5nZXRSYXdEYXRhSXRlbSh0KTsKICAgICAgICAgIGlmIChudWxsICE9IG4pIHJldHVybiAhTShuKSB8fCBuIGluc3RhbmNlb2YgQXJyYXkgPyBuIDogbi52YWx1ZTsKICAgICAgICB9LAogICAgICAgIGZvcm1hdFRvb2x0aXA6IHkubm9vcAogICAgICB9LAogICAgICBDID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gMDsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGUgPSAiXDBfX2VjX3Byb3BfZ2V0dGVyXyIgKyB0Kys7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRbZV0gfHwgKHRbZV0gPSB7fSk7CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgIH0oKTsKICAgIGUubm9ybWFsaXplVG9BcnJheSA9IG4sIGUuZGVmYXVsdEVtcGhhc2lzID0gaSwgZS5URVhUX1NUWUxFX09QVElPTlMgPSBULCBlLmdldERhdGFJdGVtVmFsdWUgPSBhLCBlLmlzRGF0YUl0ZW1PcHRpb24gPSBvLCBlLmNvbnZlckRhdGFWYWx1ZSA9IHMsIGUuY3JlYXRlRGF0YUZvcm1hdE1vZGVsID0gbCwgZS5kYXRhRm9ybWF0TWl4aW4gPSBrLCBlLm1hcHBpbmdUb0V4aXN0cyA9IGgsIGUubWFrZUlkQW5kTmFtZSA9IHUsIGUuaXNJZElubmVyID0gYywgZS5jb21wcmVzc0JhdGNoZXMgPSBmLCBlLnF1ZXJ5RGF0YUluZGV4ID0gZCwgZS5tYWtlR2V0dGVyID0gQywgZS5wYXJzZUZpbmRlciA9IHYsIGUuZGF0YURpbVRvQ29vcmREaW0gPSBnLCBlLmNvb3JkRGltVG9EYXRhRGltID0gcCwgZS5vdGhlckRpbVRvRGF0YURpbSA9IG07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgcikgewogICAgICB0aGlzLnBhcmVudE1vZGVsID0gZSwgdGhpcy5lY01vZGVsID0gciwgdGhpcy5vcHRpb24gPSB0OwogICAgfQogICAgZnVuY3Rpb24gaSh0LCBlLCByKSB7CiAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgZS5sZW5ndGggJiYgKCFlW25dIHx8IG51bGwgIT0gKHQgPSB0ICYmICJvYmplY3QiID09IHR5cGVvZiB0ID8gdFtlW25dXSA6IG51bGwpKTsgbisrKTsKICAgICAgcmV0dXJuIG51bGwgPT0gdCAmJiByICYmICh0ID0gci5nZXQoZSkpLCB0OwogICAgfQogICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgIHZhciByID0gbC5nZXQodCwgImdldFBhcmVudCIpOwogICAgICByZXR1cm4gciA/IHIuY2FsbCh0LCBlKSA6IHQucGFyZW50TW9kZWw7CiAgICB9CiAgICB2YXIgbyA9IHIoMCksCiAgICAgIHMgPSByKDE1KSwKICAgICAgbCA9IHIoMzIpLAogICAgICBoID0gcigzNSksCiAgICAgIHUgPSByKDM2KSwKICAgICAgYyA9IHIoMzcpLAogICAgICBmID0gcig3NiksCiAgICAgIGQgPSBvLm1peGluOwogICAgbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBuLAogICAgICBpbml0OiBudWxsLAogICAgICBtZXJnZU9wdGlvbjogZnVuY3Rpb24gKHQpIHsKICAgICAgICBvLm1lcmdlKHRoaXMub3B0aW9uLCB0LCAhMCk7CiAgICAgIH0sCiAgICAgIGdldDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0ID8gdGhpcy5vcHRpb24gOiBpKHRoaXMub3B0aW9uLCB0aGlzLnBhcnNlUGF0aCh0KSwgIWUgJiYgYSh0aGlzLCB0KSk7CiAgICAgIH0sCiAgICAgIGdldFNoYWxsb3c6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLm9wdGlvbiwKICAgICAgICAgIG4gPSBudWxsID09IHIgPyByIDogclt0XSwKICAgICAgICAgIGkgPSAhZSAmJiBhKHRoaXMsIHQpOwogICAgICAgIHJldHVybiBudWxsID09IG4gJiYgaSAmJiAobiA9IGkuZ2V0U2hhbGxvdyh0KSksIG47CiAgICAgIH0sCiAgICAgIGdldE1vZGVsOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByLAogICAgICAgICAgbyA9IG51bGwgPT0gdCA/IHRoaXMub3B0aW9uIDogaSh0aGlzLm9wdGlvbiwgdCA9IHRoaXMucGFyc2VQYXRoKHQpKTsKICAgICAgICByZXR1cm4gZSA9IGUgfHwgKHIgPSBhKHRoaXMsIHQpKSAmJiByLmdldE1vZGVsKHQpLCBuZXcgbihvLCBlLCB0aGlzLmVjTW9kZWwpOwogICAgICB9LAogICAgICBpc0VtcHR5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdGhpcy5vcHRpb247CiAgICAgIH0sCiAgICAgIHJlc3RvcmVEYXRhOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3ICgwLCB0aGlzLmNvbnN0cnVjdG9yKShvLmNsb25lKHRoaXMub3B0aW9uKSk7CiAgICAgIH0sCiAgICAgIHNldFJlYWRPbmx5OiBmdW5jdGlvbiAodCkgewogICAgICAgIGwuc2V0UmVhZE9ubHkodGhpcywgdCk7CiAgICAgIH0sCiAgICAgIHBhcnNlUGF0aDogZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKHQgPSB0LnNwbGl0KCIuIikpLCB0OwogICAgICB9LAogICAgICBjdXN0b21pemVHZXRQYXJlbnQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgbC5zZXQodGhpcywgImdldFBhcmVudCIsIHQpOwogICAgICB9LAogICAgICBpc0FuaW1hdGlvbkVuYWJsZWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXMubm9kZSkgewogICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5vcHRpb24uYW5pbWF0aW9uKSByZXR1cm4gISF0aGlzLm9wdGlvbi5hbmltYXRpb247CiAgICAgICAgICBpZiAodGhpcy5wYXJlbnRNb2RlbCkgcmV0dXJuIHRoaXMucGFyZW50TW9kZWwuaXNBbmltYXRpb25FbmFibGVkKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBsLmVuYWJsZUNsYXNzRXh0ZW5kKG4pLCBkKG4sIGgpLCBkKG4sIHUpLCBkKG4sIGMpLCBkKG4sIGYpOwogICAgdmFyIHYgPSBuOwogICAgdC5leHBvcnRzID0gdjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgIHJldHVybiB0W20gKyBlXSA9IHI7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgcmV0dXJuIHRbbSArIGVdOwogICAgfQogICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgIHJldHVybiB0Lmhhc093blByb3BlcnR5KG0gKyBlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG8odCkgewogICAgICB2YXIgZSA9IHsKICAgICAgICBtYWluOiAiIiwKICAgICAgICBzdWI6ICIiCiAgICAgIH07CiAgICAgIHJldHVybiB0ICYmICh0ID0gdC5zcGxpdChnKSwgZS5tYWluID0gdFswXSB8fCAiIiwgZS5zdWIgPSB0WzFdIHx8ICIiKSwgZTsKICAgIH0KICAgIGZ1bmN0aW9uIHModCkgewogICAgICB2LmFzc2VydCgvXlthLXpBLVowLTlfXSsoWy5dW2EtekEtWjAtOV9dKyk/JC8udGVzdCh0KSwgJ2NvbXBvbmVudFR5cGUgIicgKyB0ICsgJyIgaWxsZWdhbCcpOwogICAgfQogICAgZnVuY3Rpb24gbCh0LCBlKSB7CiAgICAgIHQuJGNvbnN0cnVjdG9yID0gdCwgdC5leHRlbmQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgIHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHQuJGNvbnN0cnVjdG9yID8gdC4kY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH07CiAgICAgICAgcmV0dXJuIHYuZXh0ZW5kKHIucHJvdG90eXBlLCB0KSwgci5leHRlbmQgPSB0aGlzLmV4dGVuZCwgci5zdXBlckNhbGwgPSBoLCByLnN1cGVyQXBwbHkgPSB1LCB2LmluaGVyaXRzKHIsIHRoaXMpLCByLnN1cGVyQ2xhc3MgPSBlLCByOwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlKSB7CiAgICAgIHZhciByID0gdi5zbGljZShhcmd1bWVudHMsIDIpOwogICAgICByZXR1cm4gdGhpcy5zdXBlckNsYXNzLnByb3RvdHlwZVtlXS5hcHBseSh0LCByKTsKICAgIH0KICAgIGZ1bmN0aW9uIHUodCwgZSwgcikgewogICAgICByZXR1cm4gdGhpcy5zdXBlckNsYXNzLnByb3RvdHlwZVtlXS5hcHBseSh0LCByKTsKICAgIH0KICAgIGZ1bmN0aW9uIGModCwgZSkgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB2YXIgZSA9IG5bdC5tYWluXTsKICAgICAgICByZXR1cm4gZSAmJiBlW3BdIHx8IChlID0gblt0Lm1haW5dID0ge30sIGVbcF0gPSAhMCksIGU7CiAgICAgIH0KICAgICAgZSA9IGUgfHwge307CiAgICAgIHZhciBuID0ge307CiAgICAgIGlmICh0LnJlZ2lzdGVyQ2xhc3MgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmIChlKSBpZiAocyhlKSwgZSA9IG8oZSksIGUuc3ViKSB7CiAgICAgICAgICBpZiAoZS5zdWIgIT09IHApIHsKICAgICAgICAgICAgdmFyIGkgPSByKGUpOwogICAgICAgICAgICBpW2Uuc3ViXSA9IHQ7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIG5bZS5tYWluXSA9IHQ7CiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0sIHQuZ2V0Q2xhc3MgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHZhciBpID0gblt0XTsKICAgICAgICBpZiAoaSAmJiBpW3BdICYmIChpID0gZSA/IGlbZV0gOiBudWxsKSwgciAmJiAhaSkgdGhyb3cgbmV3IEVycm9yKGUgPyAiQ29tcG9uZW50ICIgKyB0ICsgIi4iICsgKGUgfHwgIiIpICsgIiBub3QgZXhpc3RzLiBMb2FkIGl0IGZpcnN0LiIgOiB0ICsgIi50eXBlIHNob3VsZCBiZSBzcGVjaWZpZWQuIik7CiAgICAgICAgcmV0dXJuIGk7CiAgICAgIH0sIHQuZ2V0Q2xhc3Nlc0J5TWFpblR5cGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHQgPSBvKHQpOwogICAgICAgIHZhciBlID0gW10sCiAgICAgICAgICByID0gblt0Lm1haW5dOwogICAgICAgIHJldHVybiByICYmIHJbcF0gPyB2LmVhY2gociwgZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHIgIT09IHAgJiYgZS5wdXNoKHQpOwogICAgICAgIH0pIDogZS5wdXNoKHIpLCBlOwogICAgICB9LCB0Lmhhc0NsYXNzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdCA9IG8odCksICEhblt0Lm1haW5dOwogICAgICB9LCB0LmdldEFsbENsYXNzTWFpblR5cGVzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gW107CiAgICAgICAgcmV0dXJuIHYuZWFjaChuLCBmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgdC5wdXNoKHIpOwogICAgICAgIH0pLCB0OwogICAgICB9LCB0Lmhhc1N1YlR5cGVzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0ID0gbyh0KTsKICAgICAgICB2YXIgZSA9IG5bdC5tYWluXTsKICAgICAgICByZXR1cm4gZSAmJiBlW3BdOwogICAgICB9LCB0LnBhcnNlQ2xhc3NUeXBlID0gbywgZS5yZWdpc3RlcldoZW5FeHRlbmQpIHsKICAgICAgICB2YXIgaSA9IHQuZXh0ZW5kOwogICAgICAgIGkgJiYgKHQuZXh0ZW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gaS5jYWxsKHRoaXMsIGUpOwogICAgICAgICAgcmV0dXJuIHQucmVnaXN0ZXJDbGFzcyhyLCBlLnR5cGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB0OwogICAgfQogICAgZnVuY3Rpb24gZih0LCBlKSB7fQogICAgdmFyIGQgPSByKDMzKSwKICAgICAgdiA9IChkLl9fREVWX18sIHIoMCkpLAogICAgICBnID0gIi4iLAogICAgICBwID0gIl9fX0VDX19DT01QT05FTlRfX0NPTlRBSU5FUl9fXyIsCiAgICAgIG0gPSAiXDBlY19cMCI7CiAgICBlLnNldCA9IG4sIGUuZ2V0ID0gaSwgZS5oYXNPd24gPSBhLCBlLnBhcnNlQ2xhc3NUeXBlID0gbywgZS5lbmFibGVDbGFzc0V4dGVuZCA9IGwsIGUuZW5hYmxlQ2xhc3NNYW5hZ2VtZW50ID0gYywgZS5zZXRSZWFkT25seSA9IGY7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgcjsKICAgICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHIgPSB3aW5kb3cuX19ERVZfXyA6IHZvaWQgMCAhPT0gdCAmJiAociA9IHQuX19ERVZfXyksIHZvaWQgMCA9PT0gciAmJiAociA9ICEwKTsKICAgICAgdmFyIG4gPSByOwogICAgICBlLl9fREVWX18gPSBuOwogICAgfSkuY2FsbChlLCByKDM0KSk7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByOwogICAgciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KCk7CiAgICB0cnkgewogICAgICByID0gciB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpIHx8ICgwLCBldmFsKSgidGhpcyIpOwogICAgfSBjYXRjaCAodCkgewogICAgICAib2JqZWN0IiA9PSB0eXBlb2Ygd2luZG93ICYmIChyID0gd2luZG93KTsKICAgIH0KICAgIHQuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxMSksCiAgICAgIGkgPSBuKFtbImxpbmVXaWR0aCIsICJ3aWR0aCJdLCBbInN0cm9rZSIsICJjb2xvciJdLCBbIm9wYWNpdHkiXSwgWyJzaGFkb3dCbHVyIl0sIFsic2hhZG93T2Zmc2V0WCJdLCBbInNoYWRvd09mZnNldFkiXSwgWyJzaGFkb3dDb2xvciJdXSksCiAgICAgIGEgPSB7CiAgICAgICAgZ2V0TGluZVN0eWxlOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSBpKHRoaXMsIHQpLAogICAgICAgICAgICByID0gdGhpcy5nZXRMaW5lRGFzaChlLmxpbmVXaWR0aCk7CiAgICAgICAgICByZXR1cm4gciAmJiAoZS5saW5lRGFzaCA9IHIpLCBlOwogICAgICAgIH0sCiAgICAgICAgZ2V0TGluZURhc2g6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBudWxsID09IHQgJiYgKHQgPSAxKTsKICAgICAgICAgIHZhciBlID0gdGhpcy5nZXQoInR5cGUiKSwKICAgICAgICAgICAgciA9IE1hdGgubWF4KHQsIDIpLAogICAgICAgICAgICBuID0gNCAqIHQ7CiAgICAgICAgICByZXR1cm4gInNvbGlkIiA9PT0gZSB8fCBudWxsID09IGUgPyBudWxsIDogImRhc2hlZCIgPT09IGUgPyBbbiwgbl0gOiBbciwgcl07CiAgICAgICAgfQogICAgICB9OwogICAgdC5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDExKSwKICAgICAgaSA9IG4oW1siZmlsbCIsICJjb2xvciJdLCBbInNoYWRvd0JsdXIiXSwgWyJzaGFkb3dPZmZzZXRYIl0sIFsic2hhZG93T2Zmc2V0WSJdLCBbIm9wYWNpdHkiXSwgWyJzaGFkb3dDb2xvciJdXSksCiAgICAgIGEgPSB7CiAgICAgICAgZ2V0QXJlYVN0eWxlOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgcmV0dXJuIGkodGhpcywgdCwgZSk7CiAgICAgICAgfQogICAgICB9OwogICAgdC5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDUpLAogICAgICBpID0gcigzOCksCiAgICAgIGEgPSBbInRleHRTdHlsZSIsICJjb2xvciJdLAogICAgICBvID0gewogICAgICAgIGdldFRleHRDb2xvcjogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gdGhpcy5lY01vZGVsOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2hhbGxvdygiY29sb3IiKSB8fCAoIXQgJiYgZSA/IGUuZ2V0KGEpIDogbnVsbCk7CiAgICAgICAgfSwKICAgICAgICBnZXRGb250OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gaS5nZXRGb250KHsKICAgICAgICAgICAgZm9udFN0eWxlOiB0aGlzLmdldFNoYWxsb3coImZvbnRTdHlsZSIpLAogICAgICAgICAgICBmb250V2VpZ2h0OiB0aGlzLmdldFNoYWxsb3coImZvbnRXZWlnaHQiKSwKICAgICAgICAgICAgZm9udFNpemU6IHRoaXMuZ2V0U2hhbGxvdygiZm9udFNpemUiKSwKICAgICAgICAgICAgZm9udEZhbWlseTogdGhpcy5nZXRTaGFsbG93KCJmb250RmFtaWx5IikKICAgICAgICAgIH0sIHRoaXMuZWNNb2RlbCk7CiAgICAgICAgfSwKICAgICAgICBnZXRUZXh0UmVjdDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBuLmdldEJvdW5kaW5nUmVjdCh0LCB0aGlzLmdldEZvbnQoKSwgdGhpcy5nZXRTaGFsbG93KCJhbGlnbiIpLCB0aGlzLmdldFNoYWxsb3coInZlcnRpY2FsQWxpZ24iKSB8fCB0aGlzLmdldFNoYWxsb3coImJhc2VsaW5lIiksIHRoaXMuZ2V0U2hhbGxvdygicGFkZGluZyIpLCB0aGlzLmdldFNoYWxsb3coInJpY2giKSwgdGhpcy5nZXRTaGFsbG93KCJ0cnVuY2F0ZVRleHQiKSk7CiAgICAgICAgfQogICAgICB9OwogICAgdC5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiBaLmV4dGVuZCh0KTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICByZXR1cm4gVi5leHRlbmRGcm9tU3RyaW5nKHQsIGUpOwogICAgfQogICAgZnVuY3Rpb24gYSh0LCBlLCByLCBuKSB7CiAgICAgIHZhciBpID0gVi5jcmVhdGVGcm9tU3RyaW5nKHQsIGUpLAogICAgICAgIGEgPSBpLmdldEJvdW5kaW5nUmVjdCgpOwogICAgICByZXR1cm4gciAmJiAoImNlbnRlciIgPT09IG4gJiYgKHIgPSBzKHIsIGEpKSwgbChpLCByKSksIGk7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBuZXcgSyh7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIGltYWdlOiB0LAogICAgICAgICAgeDogZS54LAogICAgICAgICAgeTogZS55LAogICAgICAgICAgd2lkdGg6IGUud2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGUuaGVpZ2h0CiAgICAgICAgfSwKICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpZiAoImNlbnRlciIgPT09IHIpIHsKICAgICAgICAgICAgdmFyIGkgPSB7CiAgICAgICAgICAgICAgd2lkdGg6IHQud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0OiB0LmhlaWdodAogICAgICAgICAgICB9OwogICAgICAgICAgICBuLnNldFN0eWxlKHMoZSwgaSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBuOwogICAgfQogICAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICAgIHZhciByLAogICAgICAgIG4gPSBlLndpZHRoIC8gZS5oZWlnaHQsCiAgICAgICAgaSA9IHQuaGVpZ2h0ICogbjsKICAgICAgcmV0dXJuIGkgPD0gdC53aWR0aCA/IHIgPSB0LmhlaWdodCA6IChpID0gdC53aWR0aCwgciA9IGkgLyBuKSwgewogICAgICAgIHg6IHQueCArIHQud2lkdGggLyAyIC0gaSAvIDIsCiAgICAgICAgeTogdC55ICsgdC5oZWlnaHQgLyAyIC0gciAvIDIsCiAgICAgICAgd2lkdGg6IGksCiAgICAgICAgaGVpZ2h0OiByCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBsKHQsIGUpIHsKICAgICAgaWYgKHQuYXBwbHlUcmFuc2Zvcm0pIHsKICAgICAgICB2YXIgciA9IHQuZ2V0Qm91bmRpbmdSZWN0KCksCiAgICAgICAgICBuID0gci5jYWxjdWxhdGVUcmFuc2Zvcm0oZSk7CiAgICAgICAgdC5hcHBseVRyYW5zZm9ybShuKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaCh0KSB7CiAgICAgIHZhciBlID0gdC5zaGFwZSwKICAgICAgICByID0gdC5zdHlsZS5saW5lV2lkdGg7CiAgICAgIHJldHVybiB2dCgyICogZS54MSkgPT09IHZ0KDIgKiBlLngyKSAmJiAoZS54MSA9IGUueDIgPSBjKGUueDEsIHIsICEwKSksIHZ0KDIgKiBlLnkxKSA9PT0gdnQoMiAqIGUueTIpICYmIChlLnkxID0gZS55MiA9IGMoZS55MSwgciwgITApKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIHUodCkgewogICAgICB2YXIgZSA9IHQuc2hhcGUsCiAgICAgICAgciA9IHQuc3R5bGUubGluZVdpZHRoLAogICAgICAgIG4gPSBlLngsCiAgICAgICAgaSA9IGUueSwKICAgICAgICBhID0gZS53aWR0aCwKICAgICAgICBvID0gZS5oZWlnaHQ7CiAgICAgIHJldHVybiBlLnggPSBjKGUueCwgciwgITApLCBlLnkgPSBjKGUueSwgciwgITApLCBlLndpZHRoID0gTWF0aC5tYXgoYyhuICsgYSwgciwgITEpIC0gZS54LCAwID09PSBhID8gMCA6IDEpLCBlLmhlaWdodCA9IE1hdGgubWF4KGMoaSArIG8sIHIsICExKSAtIGUueSwgMCA9PT0gbyA/IDAgOiAxKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIGModCwgZSwgcikgewogICAgICB2YXIgbiA9IHZ0KDIgKiB0KTsKICAgICAgcmV0dXJuIChuICsgdnQoZSkpICUgMiA9PSAwID8gbiAvIDIgOiAobiArIChyID8gMSA6IC0xKSkgLyAyOwogICAgfQogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIHJldHVybiBudWxsICE9IHQgJiYgIm5vbmUiICE9IHQ7CiAgICB9CiAgICBmdW5jdGlvbiBkKHQpIHsKICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiB0ID8gRy5saWZ0KHQsIC0uMSkgOiB0OwogICAgfQogICAgZnVuY3Rpb24gdih0KSB7CiAgICAgIGlmICh0Ll9faG92ZXJTdGxEaXJ0eSkgewogICAgICAgIHZhciBlID0gdC5zdHlsZS5zdHJva2UsCiAgICAgICAgICByID0gdC5zdHlsZS5maWxsLAogICAgICAgICAgbiA9IHQuX19ob3ZlclN0bDsKICAgICAgICBuLmZpbGwgPSBuLmZpbGwgfHwgKGYocikgPyBkKHIpIDogbnVsbCksIG4uc3Ryb2tlID0gbi5zdHJva2UgfHwgKGYoZSkgPyBkKGUpIDogbnVsbCk7CiAgICAgICAgdmFyIGkgPSB7fTsKICAgICAgICBmb3IgKHZhciBhIGluIG4pIG51bGwgIT0gblthXSAmJiAoaVthXSA9IHQuc3R5bGVbYV0pOwogICAgICAgIHQuX19ub3JtYWxTdGwgPSBpLCB0Ll9faG92ZXJTdGxEaXJ0eSA9ICExOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnKHQpIHsKICAgICAgaWYgKCF0Ll9faXNIb3ZlcikgewogICAgICAgIGlmICh2KHQpLCB0LnVzZUhvdmVyTGF5ZXIpIHQuX196ciAmJiB0Ll9fenIuYWRkSG92ZXIodCwgdC5fX2hvdmVyU3RsKTtlbHNlIHsKICAgICAgICAgIHZhciBlID0gdC5zdHlsZSwKICAgICAgICAgICAgciA9IGUuaW5zaWRlUm9sbGJhY2tPcHQ7CiAgICAgICAgICByICYmIEwoZSksIGUuZXh0ZW5kRnJvbSh0Ll9faG92ZXJTdGwpLCByICYmIChEKGUsIGUuaW5zaWRlT3JpZ2luYWxUZXh0UG9zaXRpb24sIHIpLCBudWxsID09IGUudGV4dEZpbGwgJiYgKGUudGV4dEZpbGwgPSByLmF1dG9Db2xvcikpLCB0LmRpcnR5KCExKSwgdC56MiArPSAxOwogICAgICAgIH0KICAgICAgICB0Ll9faXNIb3ZlciA9ICEwOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwKHQpIHsKICAgICAgaWYgKHQuX19pc0hvdmVyKSB7CiAgICAgICAgdmFyIGUgPSB0Ll9fbm9ybWFsU3RsOwogICAgICAgIHQudXNlSG92ZXJMYXllciA/IHQuX196ciAmJiB0Ll9fenIucmVtb3ZlSG92ZXIodCkgOiAoZSAmJiB0LnNldFN0eWxlKGUpLCB0LnoyIC09IDEpLCB0Ll9faXNIb3ZlciA9ICExOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtKHQpIHsKICAgICAgImdyb3VwIiA9PT0gdC50eXBlID8gdC50cmF2ZXJzZShmdW5jdGlvbiAodCkgewogICAgICAgICJncm91cCIgIT09IHQudHlwZSAmJiBnKHQpOwogICAgICB9KSA6IGcodCk7CiAgICB9CiAgICBmdW5jdGlvbiB4KHQpIHsKICAgICAgImdyb3VwIiA9PT0gdC50eXBlID8gdC50cmF2ZXJzZShmdW5jdGlvbiAodCkgewogICAgICAgICJncm91cCIgIT09IHQudHlwZSAmJiBwKHQpOwogICAgICB9KSA6IHAodCk7CiAgICB9CiAgICBmdW5jdGlvbiB5KHQsIGUpIHsKICAgICAgdC5fX2hvdmVyU3RsID0gdC5ob3ZlclN0eWxlIHx8IGUgfHwge30sIHQuX19ob3ZlclN0bERpcnR5ID0gITAsIHQuX19pc0hvdmVyICYmIHYodCk7CiAgICB9CiAgICBmdW5jdGlvbiB3KHQpIHsKICAgICAgdGhpcy5fX2hvdmVyU2lsZW50T25Ub3VjaCAmJiB0LnpyQnlUb3VjaCB8fCAhdGhpcy5fX2lzRW1waGFzaXMgJiYgbSh0aGlzKTsKICAgIH0KICAgIGZ1bmN0aW9uIF8odCkgewogICAgICB0aGlzLl9faG92ZXJTaWxlbnRPblRvdWNoICYmIHQuenJCeVRvdWNoIHx8ICF0aGlzLl9faXNFbXBoYXNpcyAmJiB4KHRoaXMpOwogICAgfQogICAgZnVuY3Rpb24gYigpIHsKICAgICAgdGhpcy5fX2lzRW1waGFzaXMgPSAhMCwgbSh0aGlzKTsKICAgIH0KICAgIGZ1bmN0aW9uIFMoKSB7CiAgICAgIHRoaXMuX19pc0VtcGhhc2lzID0gITEsIHgodGhpcyk7CiAgICB9CiAgICBmdW5jdGlvbiBNKHQsIGUsIHIpIHsKICAgICAgdC5fX2hvdmVyU2lsZW50T25Ub3VjaCA9IHIgJiYgci5ob3ZlclNpbGVudE9uVG91Y2gsICJncm91cCIgPT09IHQudHlwZSA/IHQudHJhdmVyc2UoZnVuY3Rpb24gKHQpIHsKICAgICAgICAiZ3JvdXAiICE9PSB0LnR5cGUgJiYgeSh0LCBlKTsKICAgICAgfSkgOiB5KHQsIGUpLCB0Lm9uKCJtb3VzZW92ZXIiLCB3KS5vbigibW91c2VvdXQiLCBfKSwgdC5vbigiZW1waGFzaXMiLCBiKS5vbigibm9ybWFsIiwgUyk7CiAgICB9CiAgICBmdW5jdGlvbiBUKHQsIGUsIHIsIG4sIGksIGEsIG8pIHsKICAgICAgaSA9IGkgfHwgbXQ7CiAgICAgIHZhciBzID0gaS5sYWJlbEZldGNoZXIsCiAgICAgICAgbCA9IGkubGFiZWxEYXRhSW5kZXgsCiAgICAgICAgaCA9IGkubGFiZWxEaW1JbmRleCwKICAgICAgICB1ID0gci5nZXRTaGFsbG93KCJzaG93IiksCiAgICAgICAgYyA9IG4uZ2V0U2hhbGxvdygic2hvdyIpLAogICAgICAgIGYgPSB1IHx8IGMgPyBZLnJldHJpZXZlMihzID8gcy5nZXRGb3JtYXR0ZWRMYWJlbChsLCAibm9ybWFsIiwgbnVsbCwgaCkgOiBudWxsLCBpLmRlZmF1bHRUZXh0KSA6IG51bGwsCiAgICAgICAgZCA9IHUgPyBmIDogbnVsbCwKICAgICAgICB2ID0gYyA/IFkucmV0cmlldmUyKHMgPyBzLmdldEZvcm1hdHRlZExhYmVsKGwsICJlbXBoYXNpcyIsIG51bGwsIGgpIDogbnVsbCwgZikgOiBudWxsOwogICAgICBudWxsID09IGQgJiYgbnVsbCA9PSB2IHx8IChrKHQsIHIsIGEsIGkpLCBrKGUsIG4sIG8sIGksICEwKSksIHQudGV4dCA9IGQsIGUudGV4dCA9IHY7CiAgICB9CiAgICBmdW5jdGlvbiBrKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgcmV0dXJuIFAodCwgZSwgbiwgaSksIHIgJiYgWS5leHRlbmQodCwgciksIHQuaG9zdCAmJiB0Lmhvc3QuZGlydHkgJiYgdC5ob3N0LmRpcnR5KCExKSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIEModCwgZSwgcikgewogICAgICB2YXIgbiwKICAgICAgICBpID0gewogICAgICAgICAgaXNSZWN0VGV4dDogITAKICAgICAgICB9OwogICAgICAhMSA9PT0gciA/IG4gPSAhMCA6IGkuYXV0b0NvbG9yID0gciwgUCh0LCBlLCBpLCBuKSwgdC5ob3N0ICYmIHQuaG9zdC5kaXJ0eSAmJiB0Lmhvc3QuZGlydHkoITEpOwogICAgfQogICAgZnVuY3Rpb24gUCh0LCBlLCByLCBuKSB7CiAgICAgIGlmIChyID0gciB8fCBtdCwgci5pc1JlY3RUZXh0KSB7CiAgICAgICAgdmFyIGkgPSBlLmdldFNoYWxsb3coInBvc2l0aW9uIikgfHwgKG4gPyBudWxsIDogImluc2lkZSIpOwogICAgICAgICJvdXRzaWRlIiA9PT0gaSAmJiAoaSA9ICJ0b3AiKSwgdC50ZXh0UG9zaXRpb24gPSBpLCB0LnRleHRPZmZzZXQgPSBlLmdldFNoYWxsb3coIm9mZnNldCIpOwogICAgICAgIHZhciBhID0gZS5nZXRTaGFsbG93KCJyb3RhdGUiKTsKICAgICAgICBudWxsICE9IGEgJiYgKGEgKj0gTWF0aC5QSSAvIDE4MCksIHQudGV4dFJvdGF0aW9uID0gYSwgdC50ZXh0RGlzdGFuY2UgPSBZLnJldHJpZXZlMihlLmdldFNoYWxsb3coImRpc3RhbmNlIiksIG4gPyBudWxsIDogNSk7CiAgICAgIH0KICAgICAgdmFyIG8sCiAgICAgICAgcyA9IGUuZWNNb2RlbCwKICAgICAgICBsID0gcyAmJiBzLm9wdGlvbi50ZXh0U3R5bGUsCiAgICAgICAgaCA9IEkoZSk7CiAgICAgIGlmIChoKSB7CiAgICAgICAgbyA9IHt9OwogICAgICAgIGZvciAodmFyIHUgaW4gaCkgaWYgKGguaGFzT3duUHJvcGVydHkodSkpIHsKICAgICAgICAgIHZhciBjID0gZS5nZXRNb2RlbChbInJpY2giLCB1XSk7CiAgICAgICAgICBBKG9bdV0gPSB7fSwgYywgbCwgciwgbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0LnJpY2ggPSBvLCBBKHQsIGUsIGwsIHIsIG4sICEwKSwgci5mb3JjZVJpY2ggJiYgIXIudGV4dFN0eWxlICYmIChyLnRleHRTdHlsZSA9IHt9KSwgdDsKICAgIH0KICAgIGZ1bmN0aW9uIEkodCkgewogICAgICBmb3IgKHZhciBlOyB0ICYmIHQgIT09IHQuZWNNb2RlbDspIHsKICAgICAgICB2YXIgciA9ICh0Lm9wdGlvbiB8fCBtdCkucmljaDsKICAgICAgICBpZiAocikgewogICAgICAgICAgZSA9IGUgfHwge307CiAgICAgICAgICBmb3IgKHZhciBuIGluIHIpIHIuaGFzT3duUHJvcGVydHkobikgJiYgKGVbbl0gPSAxKTsKICAgICAgICB9CiAgICAgICAgdCA9IHQucGFyZW50TW9kZWw7CiAgICAgIH0KICAgICAgcmV0dXJuIGU7CiAgICB9CiAgICBmdW5jdGlvbiBBKHQsIGUsIHIsIG4sIGksIGEpIHsKICAgICAgaWYgKHIgPSAhaSAmJiByIHx8IG10LCB0LnRleHRGaWxsID0gTyhlLmdldFNoYWxsb3coImNvbG9yIiksIG4pIHx8IHIuY29sb3IsIHQudGV4dFN0cm9rZSA9IE8oZS5nZXRTaGFsbG93KCJ0ZXh0Qm9yZGVyQ29sb3IiKSwgbikgfHwgci50ZXh0Qm9yZGVyQ29sb3IsIHQudGV4dFN0cm9rZVdpZHRoID0gWS5yZXRyaWV2ZTIoZS5nZXRTaGFsbG93KCJ0ZXh0Qm9yZGVyV2lkdGgiKSwgci50ZXh0Qm9yZGVyV2lkdGgpLCAhaSkgewogICAgICAgIGlmIChhKSB7CiAgICAgICAgICB2YXIgbyA9IHQudGV4dFBvc2l0aW9uOwogICAgICAgICAgdC5pbnNpZGVSb2xsYmFjayA9IEQodCwgbywgbiksIHQuaW5zaWRlT3JpZ2luYWxUZXh0UG9zaXRpb24gPSBvLCB0Lmluc2lkZVJvbGxiYWNrT3B0ID0gbjsKICAgICAgICB9CiAgICAgICAgbnVsbCA9PSB0LnRleHRGaWxsICYmICh0LnRleHRGaWxsID0gbi5hdXRvQ29sb3IpOwogICAgICB9CiAgICAgIHQuZm9udFN0eWxlID0gZS5nZXRTaGFsbG93KCJmb250U3R5bGUiKSB8fCByLmZvbnRTdHlsZSwgdC5mb250V2VpZ2h0ID0gZS5nZXRTaGFsbG93KCJmb250V2VpZ2h0IikgfHwgci5mb250V2VpZ2h0LCB0LmZvbnRTaXplID0gZS5nZXRTaGFsbG93KCJmb250U2l6ZSIpIHx8IHIuZm9udFNpemUsIHQuZm9udEZhbWlseSA9IGUuZ2V0U2hhbGxvdygiZm9udEZhbWlseSIpIHx8IHIuZm9udEZhbWlseSwgdC50ZXh0QWxpZ24gPSBlLmdldFNoYWxsb3coImFsaWduIiksIHQudGV4dFZlcnRpY2FsQWxpZ24gPSBlLmdldFNoYWxsb3coInZlcnRpY2FsQWxpZ24iKSB8fCBlLmdldFNoYWxsb3coImJhc2VsaW5lIiksIHQudGV4dExpbmVIZWlnaHQgPSBlLmdldFNoYWxsb3coImxpbmVIZWlnaHQiKSwgdC50ZXh0V2lkdGggPSBlLmdldFNoYWxsb3coIndpZHRoIiksIHQudGV4dEhlaWdodCA9IGUuZ2V0U2hhbGxvdygiaGVpZ2h0IiksIHQudGV4dFRhZyA9IGUuZ2V0U2hhbGxvdygidGFnIiksIGEgJiYgbi5kaXNhYmxlQm94IHx8ICh0LnRleHRCYWNrZ3JvdW5kQ29sb3IgPSBPKGUuZ2V0U2hhbGxvdygiYmFja2dyb3VuZENvbG9yIiksIG4pLCB0LnRleHRQYWRkaW5nID0gZS5nZXRTaGFsbG93KCJwYWRkaW5nIiksIHQudGV4dEJvcmRlckNvbG9yID0gTyhlLmdldFNoYWxsb3coImJvcmRlckNvbG9yIiksIG4pLCB0LnRleHRCb3JkZXJXaWR0aCA9IGUuZ2V0U2hhbGxvdygiYm9yZGVyV2lkdGgiKSwgdC50ZXh0Qm9yZGVyUmFkaXVzID0gZS5nZXRTaGFsbG93KCJib3JkZXJSYWRpdXMiKSwgdC50ZXh0Qm94U2hhZG93Q29sb3IgPSBlLmdldFNoYWxsb3coInNoYWRvd0NvbG9yIiksIHQudGV4dEJveFNoYWRvd0JsdXIgPSBlLmdldFNoYWxsb3coInNoYWRvd0JsdXIiKSwgdC50ZXh0Qm94U2hhZG93T2Zmc2V0WCA9IGUuZ2V0U2hhbGxvdygic2hhZG93T2Zmc2V0WCIpLCB0LnRleHRCb3hTaGFkb3dPZmZzZXRZID0gZS5nZXRTaGFsbG93KCJzaGFkb3dPZmZzZXRZIikpLCB0LnRleHRTaGFkb3dDb2xvciA9IGUuZ2V0U2hhbGxvdygidGV4dFNoYWRvd0NvbG9yIikgfHwgci50ZXh0U2hhZG93Q29sb3IsIHQudGV4dFNoYWRvd0JsdXIgPSBlLmdldFNoYWxsb3coInRleHRTaGFkb3dCbHVyIikgfHwgci50ZXh0U2hhZG93Qmx1ciwgdC50ZXh0U2hhZG93T2Zmc2V0WCA9IGUuZ2V0U2hhbGxvdygidGV4dFNoYWRvd09mZnNldFgiKSB8fCByLnRleHRTaGFkb3dPZmZzZXRYLCB0LnRleHRTaGFkb3dPZmZzZXRZID0gZS5nZXRTaGFsbG93KCJ0ZXh0U2hhZG93T2Zmc2V0WSIpIHx8IHIudGV4dFNoYWRvd09mZnNldFk7CiAgICB9CiAgICBmdW5jdGlvbiBPKHQsIGUpIHsKICAgICAgcmV0dXJuICJhdXRvIiAhPT0gdCA/IHQgOiBlICYmIGUuYXV0b0NvbG9yID8gZS5hdXRvQ29sb3IgOiBudWxsOwogICAgfQogICAgZnVuY3Rpb24gRCh0LCBlLCByKSB7CiAgICAgIHZhciBuLAogICAgICAgIGkgPSByLnVzZUluc2lkZVN0eWxlOwogICAgICByZXR1cm4gbnVsbCA9PSB0LnRleHRGaWxsICYmICExICE9PSBpICYmICghMCA9PT0gaSB8fCByLmlzUmVjdFRleHQgJiYgZSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiBlLmluZGV4T2YoImluc2lkZSIpID49IDApICYmIChuID0gewogICAgICAgIHRleHRGaWxsOiBudWxsLAogICAgICAgIHRleHRTdHJva2U6IHQudGV4dFN0cm9rZSwKICAgICAgICB0ZXh0U3Ryb2tlV2lkdGg6IHQudGV4dFN0cm9rZVdpZHRoCiAgICAgIH0sIHQudGV4dEZpbGwgPSAiI2ZmZiIsIG51bGwgPT0gdC50ZXh0U3Ryb2tlICYmICh0LnRleHRTdHJva2UgPSByLmF1dG9Db2xvciwgbnVsbCA9PSB0LnRleHRTdHJva2VXaWR0aCAmJiAodC50ZXh0U3Ryb2tlV2lkdGggPSAyKSkpLCBuOwogICAgfQogICAgZnVuY3Rpb24gTCh0KSB7CiAgICAgIHZhciBlID0gdC5pbnNpZGVSb2xsYmFjazsKICAgICAgZSAmJiAodC50ZXh0RmlsbCA9IGUudGV4dEZpbGwsIHQudGV4dFN0cm9rZSA9IGUudGV4dFN0cm9rZSwgdC50ZXh0U3Ryb2tlV2lkdGggPSBlLnRleHRTdHJva2VXaWR0aCk7CiAgICB9CiAgICBmdW5jdGlvbiBGKHQsIGUpIHsKICAgICAgdmFyIHIgPSBlIHx8IGUuZ2V0TW9kZWwoInRleHRTdHlsZSIpOwogICAgICByZXR1cm4gW3QuZm9udFN0eWxlIHx8IHIgJiYgci5nZXRTaGFsbG93KCJmb250U3R5bGUiKSB8fCAiIiwgdC5mb250V2VpZ2h0IHx8IHIgJiYgci5nZXRTaGFsbG93KCJmb250V2VpZ2h0IikgfHwgIiIsICh0LmZvbnRTaXplIHx8IHIgJiYgci5nZXRTaGFsbG93KCJmb250U2l6ZSIpIHx8IDEyKSArICJweCIsIHQuZm9udEZhbWlseSB8fCByICYmIHIuZ2V0U2hhbGxvdygiZm9udEZhbWlseSIpIHx8ICJzYW5zLXNlcmlmIl0uam9pbigiICIpOwogICAgfQogICAgZnVuY3Rpb24gUih0LCBlLCByLCBuLCBpLCBhKSB7CiAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBpICYmIChhID0gaSwgaSA9IG51bGwpLCBuICYmIG4uaXNBbmltYXRpb25FbmFibGVkKCkpIHsKICAgICAgICB2YXIgbyA9IHQgPyAiVXBkYXRlIiA6ICIiLAogICAgICAgICAgcyA9IG4uZ2V0U2hhbGxvdygiYW5pbWF0aW9uRHVyYXRpb24iICsgbyksCiAgICAgICAgICBsID0gbi5nZXRTaGFsbG93KCJhbmltYXRpb25FYXNpbmciICsgbyksCiAgICAgICAgICBoID0gbi5nZXRTaGFsbG93KCJhbmltYXRpb25EZWxheSIgKyBvKTsKICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBoICYmIChoID0gaChpLCBuLmdldEFuaW1hdGlvbkRlbGF5UGFyYW1zID8gbi5nZXRBbmltYXRpb25EZWxheVBhcmFtcyhlLCBpKSA6IG51bGwpKSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgcyAmJiAocyA9IHMoaSkpLCBzID4gMCA/IGUuYW5pbWF0ZVRvKHIsIHMsIGggfHwgMCwgbCwgYSwgISFhKSA6IChlLnN0b3BBbmltYXRpb24oKSwgZS5hdHRyKHIpLCBhICYmIGEoKSk7CiAgICAgIH0gZWxzZSBlLnN0b3BBbmltYXRpb24oKSwgZS5hdHRyKHIpLCBhICYmIGEoKTsKICAgIH0KICAgIGZ1bmN0aW9uIEIodCwgZSwgciwgbiwgaSkgewogICAgICBSKCEwLCB0LCBlLCByLCBuLCBpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHoodCwgZSwgciwgbiwgaSkgewogICAgICBSKCExLCB0LCBlLCByLCBuLCBpKTsKICAgIH0KICAgIGZ1bmN0aW9uIE4odCwgZSkgewogICAgICBmb3IgKHZhciByID0gVS5pZGVudGl0eShbXSk7IHQgJiYgdCAhPT0gZTspIFUubXVsKHIsIHQuZ2V0TG9jYWxUcmFuc2Zvcm0oKSwgciksIHQgPSB0LnBhcmVudDsKICAgICAgcmV0dXJuIHI7CiAgICB9CiAgICBmdW5jdGlvbiBFKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIGUgJiYgIVkuaXNBcnJheUxpa2UoZSkgJiYgKGUgPSBRLmdldExvY2FsVHJhbnNmb3JtKGUpKSwgciAmJiAoZSA9IFUuaW52ZXJ0KFtdLCBlKSksICQuYXBwbHlUcmFuc2Zvcm0oW10sIHQsIGUpOwogICAgfQogICAgZnVuY3Rpb24gVyh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gMCA9PT0gZVs0XSB8fCAwID09PSBlWzVdIHx8IDAgPT09IGVbMF0gPyAxIDogTWF0aC5hYnMoMiAqIGVbNF0gLyBlWzBdKSwKICAgICAgICBpID0gMCA9PT0gZVs0XSB8fCAwID09PSBlWzVdIHx8IDAgPT09IGVbMl0gPyAxIDogTWF0aC5hYnMoMiAqIGVbNF0gLyBlWzJdKSwKICAgICAgICBhID0gWyJsZWZ0IiA9PT0gdCA/IC1uIDogInJpZ2h0IiA9PT0gdCA/IG4gOiAwLCAidG9wIiA9PT0gdCA/IC1pIDogImJvdHRvbSIgPT09IHQgPyBpIDogMF07CiAgICAgIHJldHVybiBhID0gRShhLCBlLCByKSwgTWF0aC5hYnMoYVswXSkgPiBNYXRoLmFicyhhWzFdKSA/IGFbMF0gPiAwID8gInJpZ2h0IiA6ICJsZWZ0IiA6IGFbMV0gPiAwID8gImJvdHRvbSIgOiAidG9wIjsKICAgIH0KICAgIGZ1bmN0aW9uIHEodCwgZSwgciwgbikgewogICAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgICB2YXIgZSA9IHsKICAgICAgICAgIHBvc2l0aW9uOiAkLmNsb25lKHQucG9zaXRpb24pLAogICAgICAgICAgcm90YXRpb246IHQucm90YXRpb24KICAgICAgICB9OwogICAgICAgIHJldHVybiB0LnNoYXBlICYmIChlLnNoYXBlID0gWS5leHRlbmQoe30sIHQuc2hhcGUpKSwgZTsKICAgICAgfQogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgdmFyIGEgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSB7fTsKICAgICAgICAgIHJldHVybiB0LnRyYXZlcnNlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICF0LmlzR3JvdXAgJiYgdC5hbmlkICYmIChlW3QuYW5pZF0gPSB0KTsKICAgICAgICAgIH0pLCBlOwogICAgICAgIH0odCk7CiAgICAgICAgZS50cmF2ZXJzZShmdW5jdGlvbiAodCkgewogICAgICAgICAgaWYgKCF0LmlzR3JvdXAgJiYgdC5hbmlkKSB7CiAgICAgICAgICAgIHZhciBlID0gYVt0LmFuaWRdOwogICAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICAgIHZhciBuID0gaSh0KTsKICAgICAgICAgICAgICB0LmF0dHIoaShlKSksIEIodCwgbiwgciwgdC5kYXRhSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIEgodCwgZSkgewogICAgICByZXR1cm4gWS5tYXAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgciA9IHRbMF07CiAgICAgICAgciA9IGd0KHIsIGUueCksIHIgPSBwdChyLCBlLnggKyBlLndpZHRoKTsKICAgICAgICB2YXIgbiA9IHRbMV07CiAgICAgICAgcmV0dXJuIG4gPSBndChuLCBlLnkpLCBuID0gcHQobiwgZS55ICsgZS5oZWlnaHQpLCBbciwgbl07CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gaih0LCBlKSB7CiAgICAgIHZhciByID0gZ3QodC54LCBlLngpLAogICAgICAgIG4gPSBwdCh0LnggKyB0LndpZHRoLCBlLnggKyBlLndpZHRoKSwKICAgICAgICBpID0gZ3QodC55LCBlLnkpLAogICAgICAgIGEgPSBwdCh0LnkgKyB0LmhlaWdodCwgZS55ICsgZS5oZWlnaHQpOwogICAgICBpZiAobiA+PSByICYmIGEgPj0gaSkgcmV0dXJuIHsKICAgICAgICB4OiByLAogICAgICAgIHk6IGksCiAgICAgICAgd2lkdGg6IG4gLSByLAogICAgICAgIGhlaWdodDogYSAtIGkKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIFgodCwgZSwgcikgewogICAgICBlID0gWS5leHRlbmQoewogICAgICAgIHJlY3RIb3ZlcjogITAKICAgICAgfSwgZSk7CiAgICAgIHZhciBuID0gZS5zdHlsZSA9IHsKICAgICAgICBzdHJva2VOb1NjYWxlOiAhMAogICAgICB9OwogICAgICBpZiAociA9IHIgfHwgewogICAgICAgIHg6IC0xLAogICAgICAgIHk6IC0xLAogICAgICAgIHdpZHRoOiAyLAogICAgICAgIGhlaWdodDogMgogICAgICB9LCB0KSByZXR1cm4gMCA9PT0gdC5pbmRleE9mKCJpbWFnZTovLyIpID8gKG4uaW1hZ2UgPSB0LnNsaWNlKDgpLCBZLmRlZmF1bHRzKG4sIHIpLCBuZXcgSyhlKSkgOiBhKHQucmVwbGFjZSgicGF0aDovLyIsICIiKSwgZSwgciwgImNlbnRlciIpOwogICAgfQogICAgdmFyIFkgPSByKDApLAogICAgICBWID0gcigzOSksCiAgICAgIEcgPSByKDE4KSwKICAgICAgVSA9IHIoOCksCiAgICAgICQgPSByKDIpLAogICAgICBaID0gcigxKSwKICAgICAgUSA9IHIoMTcpLAogICAgICBLID0gcig1OCk7CiAgICBlLkltYWdlID0gSzsKICAgIHZhciBKID0gcig1OSk7CiAgICBlLkdyb3VwID0gSjsKICAgIHZhciB0dCA9IHIoNjApOwogICAgZS5UZXh0ID0gdHQ7CiAgICB2YXIgZXQgPSByKDYxKTsKICAgIGUuQ2lyY2xlID0gZXQ7CiAgICB2YXIgcnQgPSByKDYyKTsKICAgIGUuU2VjdG9yID0gcnQ7CiAgICB2YXIgbnQgPSByKDY0KTsKICAgIGUuUmluZyA9IG50OwogICAgdmFyIGl0ID0gcig2NSk7CiAgICBlLlBvbHlnb24gPSBpdDsKICAgIHZhciBhdCA9IHIoNjgpOwogICAgZS5Qb2x5bGluZSA9IGF0OwogICAgdmFyIG90ID0gcig2OSk7CiAgICBlLlJlY3QgPSBvdDsKICAgIHZhciBzdCA9IHIoNzApOwogICAgZS5MaW5lID0gc3Q7CiAgICB2YXIgbHQgPSByKDcxKTsKICAgIGUuQmV6aWVyQ3VydmUgPSBsdDsKICAgIHZhciBodCA9IHIoNzIpOwogICAgZS5BcmMgPSBodDsKICAgIHZhciB1dCA9IHIoNzMpOwogICAgZS5Db21wb3VuZFBhdGggPSB1dDsKICAgIHZhciBjdCA9IHIoNzQpOwogICAgZS5MaW5lYXJHcmFkaWVudCA9IGN0OwogICAgdmFyIGZ0ID0gcig3NSk7CiAgICBlLlJhZGlhbEdyYWRpZW50ID0gZnQ7CiAgICB2YXIgZHQgPSByKDMpOwogICAgZS5Cb3VuZGluZ1JlY3QgPSBkdDsKICAgIHZhciB2dCA9IE1hdGgucm91bmQsCiAgICAgIGd0ID0gTWF0aC5tYXgsCiAgICAgIHB0ID0gTWF0aC5taW4sCiAgICAgIG10ID0ge30sCiAgICAgIHh0ID0gVi5tZXJnZVBhdGg7CiAgICBlLmV4dGVuZFNoYXBlID0gbiwgZS5leHRlbmRQYXRoID0gaSwgZS5tYWtlUGF0aCA9IGEsIGUubWFrZUltYWdlID0gbywgZS5tZXJnZVBhdGggPSB4dCwgZS5yZXNpemVQYXRoID0gbCwgZS5zdWJQaXhlbE9wdGltaXplTGluZSA9IGgsIGUuc3ViUGl4ZWxPcHRpbWl6ZVJlY3QgPSB1LCBlLnN1YlBpeGVsT3B0aW1pemUgPSBjLCBlLnNldEhvdmVyU3R5bGUgPSBNLCBlLnNldExhYmVsU3R5bGUgPSBULCBlLnNldFRleHRTdHlsZSA9IGssIGUuc2V0VGV4dCA9IEMsIGUuZ2V0Rm9udCA9IEYsIGUudXBkYXRlUHJvcHMgPSBCLCBlLmluaXRQcm9wcyA9IHosIGUuZ2V0VHJhbnNmb3JtID0gTiwgZS5hcHBseVRyYW5zZm9ybSA9IEUsIGUudHJhbnNmb3JtRGlyZWN0aW9uID0gVywgZS5ncm91cFRyYW5zaXRpb24gPSBxLCBlLmNsaXBQb2ludHNCeVJlY3QgPSBILCBlLmNsaXBSZWN0QnlSZWN0ID0gaiwgZS5jcmVhdGVJY29uID0gWDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByLCBuLCBpLCBhLCBvLCBzLCBsLCBoLCB1KSB7CiAgICAgIHZhciBjID0gbCAqIChwIC8gMTgwKSwKICAgICAgICBmID0gZyhjKSAqICh0IC0gcikgLyAyICsgdihjKSAqIChlIC0gbikgLyAyLAogICAgICAgIG0gPSAtMSAqIHYoYykgKiAodCAtIHIpIC8gMiArIGcoYykgKiAoZSAtIG4pIC8gMiwKICAgICAgICB3ID0gZiAqIGYgLyAobyAqIG8pICsgbSAqIG0gLyAocyAqIHMpOwogICAgICB3ID4gMSAmJiAobyAqPSBkKHcpLCBzICo9IGQodykpOwogICAgICB2YXIgXyA9IChpID09PSBhID8gLTEgOiAxKSAqIGQoKG8gKiBvICogKHMgKiBzKSAtIG8gKiBvICogKG0gKiBtKSAtIHMgKiBzICogKGYgKiBmKSkgLyAobyAqIG8gKiAobSAqIG0pICsgcyAqIHMgKiAoZiAqIGYpKSkgfHwgMCwKICAgICAgICBiID0gXyAqIG8gKiBtIC8gcywKICAgICAgICBTID0gXyAqIC1zICogZiAvIG8sCiAgICAgICAgTSA9ICh0ICsgcikgLyAyICsgZyhjKSAqIGIgLSB2KGMpICogUywKICAgICAgICBUID0gKGUgKyBuKSAvIDIgKyB2KGMpICogYiArIGcoYykgKiBTLAogICAgICAgIGsgPSB5KFsxLCAwXSwgWyhmIC0gYikgLyBvLCAobSAtIFMpIC8gc10pLAogICAgICAgIEMgPSBbKGYgLSBiKSAvIG8sIChtIC0gUykgLyBzXSwKICAgICAgICBQID0gWygtMSAqIGYgLSBiKSAvIG8sICgtMSAqIG0gLSBTKSAvIHNdLAogICAgICAgIEkgPSB5KEMsIFApOwogICAgICB4KEMsIFApIDw9IC0xICYmIChJID0gcCksIHgoQywgUCkgPj0gMSAmJiAoSSA9IDApLCAwID09PSBhICYmIEkgPiAwICYmIChJIC09IDIgKiBwKSwgMSA9PT0gYSAmJiBJIDwgMCAmJiAoSSArPSAyICogcCksIHUuYWRkRGF0YShoLCBNLCBULCBvLCBzLCBrLCBJLCBjLCBhKTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCkgewogICAgICBpZiAoIXQpIHJldHVybiBbXTsKICAgICAgdmFyIGUsCiAgICAgICAgciA9IHQucmVwbGFjZSgvLS9nLCAiIC0iKS5yZXBsYWNlKC8gIC9nLCAiICIpLnJlcGxhY2UoLyAvZywgIiwiKS5yZXBsYWNlKC8sLC9nLCAiLCIpOwogICAgICBmb3IgKGUgPSAwOyBlIDwgZi5sZW5ndGg7IGUrKykgciA9IHIucmVwbGFjZShuZXcgUmVnRXhwKGZbZV0sICJnIiksICJ8IiArIGZbZV0pOwogICAgICB2YXIgaSwKICAgICAgICBhID0gci5zcGxpdCgifCIpLAogICAgICAgIG8gPSAwLAogICAgICAgIHMgPSAwLAogICAgICAgIGwgPSBuZXcgdSgpLAogICAgICAgIGggPSB1LkNNRDsKICAgICAgZm9yIChlID0gMTsgZSA8IGEubGVuZ3RoOyBlKyspIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSBhW2VdLAogICAgICAgICAgdiA9IGQuY2hhckF0KDApLAogICAgICAgICAgZyA9IDAsCiAgICAgICAgICBwID0gZC5zbGljZSgxKS5yZXBsYWNlKC9lLC0vZywgImUtIikuc3BsaXQoIiwiKTsKICAgICAgICBwLmxlbmd0aCA+IDAgJiYgIiIgPT09IHBbMF0gJiYgcC5zaGlmdCgpOwogICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgcC5sZW5ndGg7IG0rKykgcFttXSA9IHBhcnNlRmxvYXQocFttXSk7CiAgICAgICAgZm9yICg7IGcgPCBwLmxlbmd0aCAmJiAhaXNOYU4ocFtnXSkgJiYgIWlzTmFOKHBbMF0pOykgewogICAgICAgICAgdmFyIHgsCiAgICAgICAgICAgIHksCiAgICAgICAgICAgIHcsCiAgICAgICAgICAgIF8sCiAgICAgICAgICAgIGIsCiAgICAgICAgICAgIFMsCiAgICAgICAgICAgIE0sCiAgICAgICAgICAgIFQgPSBvLAogICAgICAgICAgICBrID0gczsKICAgICAgICAgIHN3aXRjaCAodikgewogICAgICAgICAgICBjYXNlICJsIjoKICAgICAgICAgICAgICBvICs9IHBbZysrXSwgcyArPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiTCI6CiAgICAgICAgICAgICAgbyA9IHBbZysrXSwgcyA9IHBbZysrXSwgYyA9IGguTCwgbC5hZGREYXRhKGMsIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJtIjoKICAgICAgICAgICAgICBvICs9IHBbZysrXSwgcyArPSBwW2crK10sIGMgPSBoLk0sIGwuYWRkRGF0YShjLCBvLCBzKSwgdiA9ICJsIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiTSI6CiAgICAgICAgICAgICAgbyA9IHBbZysrXSwgcyA9IHBbZysrXSwgYyA9IGguTSwgbC5hZGREYXRhKGMsIG8sIHMpLCB2ID0gIkwiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJoIjoKICAgICAgICAgICAgICBvICs9IHBbZysrXSwgYyA9IGguTCwgbC5hZGREYXRhKGMsIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJIIjoKICAgICAgICAgICAgICBvID0gcFtnKytdLCBjID0gaC5MLCBsLmFkZERhdGEoYywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInYiOgogICAgICAgICAgICAgIHMgKz0gcFtnKytdLCBjID0gaC5MLCBsLmFkZERhdGEoYywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIlYiOgogICAgICAgICAgICAgIHMgPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiQyI6CiAgICAgICAgICAgICAgYyA9IGguQywgbC5hZGREYXRhKGMsIHBbZysrXSwgcFtnKytdLCBwW2crK10sIHBbZysrXSwgcFtnKytdLCBwW2crK10pLCBvID0gcFtnIC0gMl0sIHMgPSBwW2cgLSAxXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYyI6CiAgICAgICAgICAgICAgYyA9IGguQywgbC5hZGREYXRhKGMsIHBbZysrXSArIG8sIHBbZysrXSArIHMsIHBbZysrXSArIG8sIHBbZysrXSArIHMsIHBbZysrXSArIG8sIHBbZysrXSArIHMpLCBvICs9IHBbZyAtIDJdLCBzICs9IHBbZyAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJTIjoKICAgICAgICAgICAgICB4ID0gbywgeSA9IHM7CiAgICAgICAgICAgICAgdmFyIEMgPSBsLmxlbigpLAogICAgICAgICAgICAgICAgUCA9IGwuZGF0YTsKICAgICAgICAgICAgICBpID09PSBoLkMgJiYgKHggKz0gbyAtIFBbQyAtIDRdLCB5ICs9IHMgLSBQW0MgLSAzXSksIGMgPSBoLkMsIFQgPSBwW2crK10sIGsgPSBwW2crK10sIG8gPSBwW2crK10sIHMgPSBwW2crK10sIGwuYWRkRGF0YShjLCB4LCB5LCBULCBrLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicyI6CiAgICAgICAgICAgICAgeCA9IG8sIHkgPSBzOwogICAgICAgICAgICAgIHZhciBDID0gbC5sZW4oKSwKICAgICAgICAgICAgICAgIFAgPSBsLmRhdGE7CiAgICAgICAgICAgICAgaSA9PT0gaC5DICYmICh4ICs9IG8gLSBQW0MgLSA0XSwgeSArPSBzIC0gUFtDIC0gM10pLCBjID0gaC5DLCBUID0gbyArIHBbZysrXSwgayA9IHMgKyBwW2crK10sIG8gKz0gcFtnKytdLCBzICs9IHBbZysrXSwgbC5hZGREYXRhKGMsIHgsIHksIFQsIGssIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJRIjoKICAgICAgICAgICAgICBUID0gcFtnKytdLCBrID0gcFtnKytdLCBvID0gcFtnKytdLCBzID0gcFtnKytdLCBjID0gaC5RLCBsLmFkZERhdGEoYywgVCwgaywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInEiOgogICAgICAgICAgICAgIFQgPSBwW2crK10gKyBvLCBrID0gcFtnKytdICsgcywgbyArPSBwW2crK10sIHMgKz0gcFtnKytdLCBjID0gaC5RLCBsLmFkZERhdGEoYywgVCwgaywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIlQiOgogICAgICAgICAgICAgIHggPSBvLCB5ID0gczsKICAgICAgICAgICAgICB2YXIgQyA9IGwubGVuKCksCiAgICAgICAgICAgICAgICBQID0gbC5kYXRhOwogICAgICAgICAgICAgIGkgPT09IGguUSAmJiAoeCArPSBvIC0gUFtDIC0gNF0sIHkgKz0gcyAtIFBbQyAtIDNdKSwgbyA9IHBbZysrXSwgcyA9IHBbZysrXSwgYyA9IGguUSwgbC5hZGREYXRhKGMsIHgsIHksIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJ0IjoKICAgICAgICAgICAgICB4ID0gbywgeSA9IHM7CiAgICAgICAgICAgICAgdmFyIEMgPSBsLmxlbigpLAogICAgICAgICAgICAgICAgUCA9IGwuZGF0YTsKICAgICAgICAgICAgICBpID09PSBoLlEgJiYgKHggKz0gbyAtIFBbQyAtIDRdLCB5ICs9IHMgLSBQW0MgLSAzXSksIG8gKz0gcFtnKytdLCBzICs9IHBbZysrXSwgYyA9IGguUSwgbC5hZGREYXRhKGMsIHgsIHksIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJBIjoKICAgICAgICAgICAgICB3ID0gcFtnKytdLCBfID0gcFtnKytdLCBiID0gcFtnKytdLCBTID0gcFtnKytdLCBNID0gcFtnKytdLCBUID0gbywgayA9IHMsIG8gPSBwW2crK10sIHMgPSBwW2crK10sIGMgPSBoLkEsIG4oVCwgaywgbywgcywgUywgTSwgdywgXywgYiwgYywgbCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImEiOgogICAgICAgICAgICAgIHcgPSBwW2crK10sIF8gPSBwW2crK10sIGIgPSBwW2crK10sIFMgPSBwW2crK10sIE0gPSBwW2crK10sIFQgPSBvLCBrID0gcywgbyArPSBwW2crK10sIHMgKz0gcFtnKytdLCBjID0gaC5BLCBuKFQsIGssIG8sIHMsIFMsIE0sIHcsIF8sIGIsIGMsIGwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAieiIgIT09IHYgJiYgIloiICE9PSB2IHx8IChjID0gaC5aLCBsLmFkZERhdGEoYykpLCBpID0gYzsKICAgICAgfQogICAgICByZXR1cm4gbC50b1N0YXRpYygpLCBsOwogICAgfQogICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgIHZhciByID0gaSh0KTsKICAgICAgcmV0dXJuIGUgPSBlIHx8IHt9LCBlLmJ1aWxkUGF0aCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHQuc2V0RGF0YSkgewogICAgICAgICAgdC5zZXREYXRhKHIuZGF0YSk7CiAgICAgICAgICB2YXIgZSA9IHQuZ2V0Q29udGV4dCgpOwogICAgICAgICAgZSAmJiB0LnJlYnVpbGRQYXRoKGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZSA9IHQ7CiAgICAgICAgICByLnJlYnVpbGRQYXRoKGUpOwogICAgICAgIH0KICAgICAgfSwgZS5hcHBseVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgYyhyLCB0KSwgdGhpcy5kaXJ0eSghMCk7CiAgICAgIH0sIGU7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQsIGUpIHsKICAgICAgcmV0dXJuIG5ldyBoKGEodCwgZSkpOwogICAgfQogICAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICAgIHJldHVybiBoLmV4dGVuZChhKHQsIGUpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSkgewogICAgICBmb3IgKHZhciByID0gW10sIG4gPSB0Lmxlbmd0aCwgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICB2YXIgYSA9IHRbaV07CiAgICAgICAgYS5wYXRoIHx8IGEuY3JlYXRlUGF0aFByb3h5KCksIGEuX19kaXJ0eVBhdGggJiYgYS5idWlsZFBhdGgoYS5wYXRoLCBhLnNoYXBlLCAhMCksIHIucHVzaChhLnBhdGgpOwogICAgICB9CiAgICAgIHZhciBvID0gbmV3IGgoZSk7CiAgICAgIHJldHVybiBvLmNyZWF0ZVBhdGhQcm94eSgpLCBvLmJ1aWxkUGF0aCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5hcHBlbmRQYXRoKHIpOwogICAgICAgIHZhciBlID0gdC5nZXRDb250ZXh0KCk7CiAgICAgICAgZSAmJiB0LnJlYnVpbGRQYXRoKGUpOwogICAgICB9LCBvOwogICAgfQogICAgdmFyIGggPSByKDEpLAogICAgICB1ID0gcig2KSwKICAgICAgYyA9IHIoNTcpLAogICAgICBmID0gWyJtIiwgIk0iLCAibCIsICJMIiwgInYiLCAiViIsICJoIiwgIkgiLCAieiIsICJaIiwgImMiLCAiQyIsICJxIiwgIlEiLCAidCIsICJUIiwgInMiLCAiUyIsICJhIiwgIkEiXSwKICAgICAgZCA9IE1hdGguc3FydCwKICAgICAgdiA9IE1hdGguc2luLAogICAgICBnID0gTWF0aC5jb3MsCiAgICAgIHAgPSBNYXRoLlBJLAogICAgICBtID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRbMF0gKiB0WzBdICsgdFsxXSAqIHRbMV0pOwogICAgICB9LAogICAgICB4ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gKHRbMF0gKiBlWzBdICsgdFsxXSAqIGVbMV0pIC8gKG0odCkgKiBtKGUpKTsKICAgICAgfSwKICAgICAgeSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuICh0WzBdICogZVsxXSA8IHRbMV0gKiBlWzBdID8gLTEgOiAxKSAqIE1hdGguYWNvcyh4KHQsIGUpKTsKICAgICAgfTsKICAgIGUuY3JlYXRlRnJvbVN0cmluZyA9IG8sIGUuZXh0ZW5kRnJvbVN0cmluZyA9IHMsIGUubWVyZ2VQYXRoID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0LCBlLCByKSB7CiAgICAgIHZhciBuID0gbnVsbCA9PSBlLnggPyAwIDogZS54LAogICAgICAgIGkgPSBudWxsID09IGUueDIgPyAxIDogZS54MiwKICAgICAgICBhID0gbnVsbCA9PSBlLnkgPyAwIDogZS55LAogICAgICAgIG8gPSBudWxsID09IGUueTIgPyAwIDogZS55MjsKICAgICAgcmV0dXJuIGUuZ2xvYmFsIHx8IChuID0gbiAqIHIud2lkdGggKyByLngsIGkgPSBpICogci53aWR0aCArIHIueCwgYSA9IGEgKiByLmhlaWdodCArIHIueSwgbyA9IG8gKiByLmhlaWdodCArIHIueSksIHQuY3JlYXRlTGluZWFyR3JhZGllbnQobiwgYSwgaSwgbyk7CiAgICB9CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSByLndpZHRoLAogICAgICAgIGkgPSByLmhlaWdodCwKICAgICAgICBhID0gTWF0aC5taW4obiwgaSksCiAgICAgICAgbyA9IG51bGwgPT0gZS54ID8gLjUgOiBlLngsCiAgICAgICAgcyA9IG51bGwgPT0gZS55ID8gLjUgOiBlLnksCiAgICAgICAgbCA9IG51bGwgPT0gZS5yID8gLjUgOiBlLnI7CiAgICAgIHJldHVybiBlLmdsb2JhbCB8fCAobyA9IG8gKiBuICsgci54LCBzID0gcyAqIGkgKyByLnksIGwgKj0gYSksIHQuY3JlYXRlUmFkaWFsR3JhZGllbnQobywgcywgMCwgbywgcywgbCk7CiAgICB9CiAgICB2YXIgaSA9IFtbInNoYWRvd0JsdXIiLCAwXSwgWyJzaGFkb3dPZmZzZXRYIiwgMF0sIFsic2hhZG93T2Zmc2V0WSIsIDBdLCBbInNoYWRvd0NvbG9yIiwgIiMwMDAiXSwgWyJsaW5lQ2FwIiwgImJ1dHQiXSwgWyJsaW5lSm9pbiIsICJtaXRlciJdLCBbIm1pdGVyTGltaXQiLCAxMF1dLAogICAgICBhID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB0aGlzLmV4dGVuZEZyb20odCwgITEpLCB0aGlzLmhvc3QgPSBlOwogICAgICB9OwogICAgYS5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBhLAogICAgICBob3N0OiBudWxsLAogICAgICBmaWxsOiAiIzAwMCIsCiAgICAgIHN0cm9rZTogbnVsbCwKICAgICAgb3BhY2l0eTogMSwKICAgICAgbGluZURhc2g6IG51bGwsCiAgICAgIGxpbmVEYXNoT2Zmc2V0OiAwLAogICAgICBzaGFkb3dCbHVyOiAwLAogICAgICBzaGFkb3dPZmZzZXRYOiAwLAogICAgICBzaGFkb3dPZmZzZXRZOiAwLAogICAgICBsaW5lV2lkdGg6IDEsCiAgICAgIHN0cm9rZU5vU2NhbGU6ICExLAogICAgICB0ZXh0OiBudWxsLAogICAgICBmb250OiBudWxsLAogICAgICB0ZXh0Rm9udDogbnVsbCwKICAgICAgZm9udFN0eWxlOiBudWxsLAogICAgICBmb250V2VpZ2h0OiBudWxsLAogICAgICBmb250U2l6ZTogbnVsbCwKICAgICAgZm9udEZhbWlseTogbnVsbCwKICAgICAgdGV4dFRhZzogbnVsbCwKICAgICAgdGV4dEZpbGw6ICIjMDAwIiwKICAgICAgdGV4dFN0cm9rZTogbnVsbCwKICAgICAgdGV4dFdpZHRoOiBudWxsLAogICAgICB0ZXh0SGVpZ2h0OiBudWxsLAogICAgICB0ZXh0U3Ryb2tlV2lkdGg6IDAsCiAgICAgIHRleHRMaW5lSGVpZ2h0OiBudWxsLAogICAgICB0ZXh0UG9zaXRpb246ICJpbnNpZGUiLAogICAgICB0ZXh0UmVjdDogbnVsbCwKICAgICAgdGV4dE9mZnNldDogbnVsbCwKICAgICAgdGV4dEFsaWduOiBudWxsLAogICAgICB0ZXh0VmVydGljYWxBbGlnbjogbnVsbCwKICAgICAgdGV4dERpc3RhbmNlOiA1LAogICAgICB0ZXh0U2hhZG93Q29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgIHRleHRTaGFkb3dCbHVyOiAwLAogICAgICB0ZXh0U2hhZG93T2Zmc2V0WDogMCwKICAgICAgdGV4dFNoYWRvd09mZnNldFk6IDAsCiAgICAgIHRleHRCb3hTaGFkb3dDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgdGV4dEJveFNoYWRvd0JsdXI6IDAsCiAgICAgIHRleHRCb3hTaGFkb3dPZmZzZXRYOiAwLAogICAgICB0ZXh0Qm94U2hhZG93T2Zmc2V0WTogMCwKICAgICAgdHJhbnNmb3JtVGV4dDogITEsCiAgICAgIHRleHRSb3RhdGlvbjogMCwKICAgICAgdGV4dE9yaWdpbjogbnVsbCwKICAgICAgdGV4dEJhY2tncm91bmRDb2xvcjogbnVsbCwKICAgICAgdGV4dEJvcmRlckNvbG9yOiBudWxsLAogICAgICB0ZXh0Qm9yZGVyV2lkdGg6IDAsCiAgICAgIHRleHRCb3JkZXJSYWRpdXM6IDAsCiAgICAgIHRleHRQYWRkaW5nOiBudWxsLAogICAgICByaWNoOiBudWxsLAogICAgICB0cnVuY2F0ZTogbnVsbCwKICAgICAgYmxlbmQ6IG51bGwsCiAgICAgIGJpbmQ6IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMsIGEgPSByICYmIHIuc3R5bGUsIG8gPSAhYSwgcyA9IDA7IHMgPCBpLmxlbmd0aDsgcysrKSB7CiAgICAgICAgICB2YXIgbCA9IGlbc10sCiAgICAgICAgICAgIGggPSBsWzBdOwogICAgICAgICAgKG8gfHwgbltoXSAhPT0gYVtoXSkgJiYgKHRbaF0gPSBuW2hdIHx8IGxbMV0pOwogICAgICAgIH0KICAgICAgICBpZiAoKG8gfHwgbi5maWxsICE9PSBhLmZpbGwpICYmICh0LmZpbGxTdHlsZSA9IG4uZmlsbCksIChvIHx8IG4uc3Ryb2tlICE9PSBhLnN0cm9rZSkgJiYgKHQuc3Ryb2tlU3R5bGUgPSBuLnN0cm9rZSksIChvIHx8IG4ub3BhY2l0eSAhPT0gYS5vcGFjaXR5KSAmJiAodC5nbG9iYWxBbHBoYSA9IG51bGwgPT0gbi5vcGFjaXR5ID8gMSA6IG4ub3BhY2l0eSksIChvIHx8IG4uYmxlbmQgIT09IGEuYmxlbmQpICYmICh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IG4uYmxlbmQgfHwgInNvdXJjZS1vdmVyIiksIHRoaXMuaGFzU3Ryb2tlKCkpIHsKICAgICAgICAgIHZhciB1ID0gbi5saW5lV2lkdGg7CiAgICAgICAgICB0LmxpbmVXaWR0aCA9IHUgLyAodGhpcy5zdHJva2VOb1NjYWxlICYmIGUgJiYgZS5nZXRMaW5lU2NhbGUgPyBlLmdldExpbmVTY2FsZSgpIDogMSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBoYXNGaWxsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmZpbGw7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gdCAmJiAibm9uZSIgIT09IHQ7CiAgICAgIH0sCiAgICAgIGhhc1N0cm9rZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5zdHJva2U7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gdCAmJiAibm9uZSIgIT09IHQgJiYgdGhpcy5saW5lV2lkdGggPiAwOwogICAgICB9LAogICAgICBleHRlbmRGcm9tOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmICh0KSBmb3IgKHZhciByIGluIHQpICF0Lmhhc093blByb3BlcnR5KHIpIHx8ICEwICE9PSBlICYmICghMSA9PT0gZSA/IHRoaXMuaGFzT3duUHJvcGVydHkocikgOiBudWxsID09IHRbcl0pIHx8ICh0aGlzW3JdID0gdFtyXSk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IHRoaXNbdF0gPSBlIDogdGhpcy5leHRlbmRGcm9tKHQsICEwKTsKICAgICAgfSwKICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKCk7CiAgICAgICAgcmV0dXJuIHQuZXh0ZW5kRnJvbSh0aGlzLCAhMCksIHQ7CiAgICAgIH0sCiAgICAgIGdldEdyYWRpZW50OiBmdW5jdGlvbiAodCwgZSwgaSkgewogICAgICAgIGZvciAodmFyIGEgPSAicmFkaWFsIiA9PT0gZS50eXBlID8gbiA6IHIsIG8gPSBhKHQsIGUsIGkpLCBzID0gZS5jb2xvclN0b3BzLCBsID0gMDsgbCA8IHMubGVuZ3RoOyBsKyspIG8uYWRkQ29sb3JTdG9wKHNbbF0ub2Zmc2V0LCBzW2xdLmNvbG9yKTsKICAgICAgICByZXR1cm4gbzsKICAgICAgfQogICAgfTsKICAgIGZvciAodmFyIG8gPSBhLnByb3RvdHlwZSwgcyA9IDA7IHMgPCBpLmxlbmd0aDsgcysrKSB7CiAgICAgIHZhciBsID0gaVtzXTsKICAgICAgbFswXSBpbiBvIHx8IChvW2xbMF1dID0gbFsxXSk7CiAgICB9CiAgICBhLmdldEdyYWRpZW50ID0gby5nZXRHcmFkaWVudDsKICAgIHZhciBoID0gYTsKICAgIHQuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgIHJldHVybiBuKys7CiAgICB9CiAgICB2YXIgbiA9IDIzMTE7CiAgICB0LmV4cG9ydHMgPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgICAgbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl8kaGFuZGxlcnMgPSB7fTsKICAgICAgfTsKICAgIG4ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbiwKICAgICAgb25lOiBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHZhciBuID0gdGhpcy5fJGhhbmRsZXJzOwogICAgICAgIGlmICghZSB8fCAhdCkgcmV0dXJuIHRoaXM7CiAgICAgICAgblt0XSB8fCAoblt0XSA9IFtdKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5bdF0ubGVuZ3RoOyBpKyspIGlmIChuW3RdW2ldLmggPT09IGUpIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBuW3RdLnB1c2goewogICAgICAgICAgaDogZSwKICAgICAgICAgIG9uZTogITAsCiAgICAgICAgICBjdHg6IHIgfHwgdGhpcwogICAgICAgIH0pLCB0aGlzOwogICAgICB9LAogICAgICBvbjogZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9IHRoaXMuXyRoYW5kbGVyczsKICAgICAgICBpZiAoIWUgfHwgIXQpIHJldHVybiB0aGlzOwogICAgICAgIG5bdF0gfHwgKG5bdF0gPSBbXSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuW3RdLmxlbmd0aDsgaSsrKSBpZiAoblt0XVtpXS5oID09PSBlKSByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4gblt0XS5wdXNoKHsKICAgICAgICAgIGg6IGUsCiAgICAgICAgICBvbmU6ICExLAogICAgICAgICAgY3R4OiByIHx8IHRoaXMKICAgICAgICB9KSwgdGhpczsKICAgICAgfSwKICAgICAgaXNTaWxlbnQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl8kaGFuZGxlcnM7CiAgICAgICAgcmV0dXJuIGVbdF0gJiYgZVt0XS5sZW5ndGg7CiAgICAgIH0sCiAgICAgIG9mZjogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMuXyRoYW5kbGVyczsKICAgICAgICBpZiAoIXQpIHJldHVybiB0aGlzLl8kaGFuZGxlcnMgPSB7fSwgdGhpczsKICAgICAgICBpZiAoZSkgewogICAgICAgICAgaWYgKHJbdF0pIHsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IFtdLCBpID0gMCwgYSA9IHJbdF0ubGVuZ3RoOyBpIDwgYTsgaSsrKSByW3RdW2ldLmggIT0gZSAmJiBuLnB1c2goclt0XVtpXSk7CiAgICAgICAgICAgIHJbdF0gPSBuOwogICAgICAgICAgfQogICAgICAgICAgclt0XSAmJiAwID09PSByW3RdLmxlbmd0aCAmJiBkZWxldGUgclt0XTsKICAgICAgICB9IGVsc2UgZGVsZXRlIHJbdF07CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHRoaXMuXyRoYW5kbGVyc1t0XSkgewogICAgICAgICAgdmFyIGUgPSBhcmd1bWVudHMsCiAgICAgICAgICAgIG4gPSBlLmxlbmd0aDsKICAgICAgICAgIG4gPiAzICYmIChlID0gci5jYWxsKGUsIDEpKTsKICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl8kaGFuZGxlcnNbdF0sIGEgPSBpLmxlbmd0aCwgbyA9IDA7IG8gPCBhOykgewogICAgICAgICAgICBzd2l0Y2ggKG4pIHsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBpW29dLmguY2FsbChpW29dLmN0eCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpW29dLmguY2FsbChpW29dLmN0eCwgZVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpW29dLmguY2FsbChpW29dLmN0eCwgZVsxXSwgZVsyXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaVtvXS5oLmFwcGx5KGlbb10uY3R4LCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpW29dLm9uZSA/IChpLnNwbGljZShvLCAxKSwgYS0tKSA6IG8rKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHRyaWdnZXJXaXRoQ29udGV4dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICBpZiAodGhpcy5fJGhhbmRsZXJzW3RdKSB7CiAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50cywKICAgICAgICAgICAgbiA9IGUubGVuZ3RoOwogICAgICAgICAgbiA+IDQgJiYgKGUgPSByLmNhbGwoZSwgMSwgZS5sZW5ndGggLSAxKSk7CiAgICAgICAgICBmb3IgKHZhciBpID0gZVtlLmxlbmd0aCAtIDFdLCBhID0gdGhpcy5fJGhhbmRsZXJzW3RdLCBvID0gYS5sZW5ndGgsIHMgPSAwOyBzIDwgbzspIHsKICAgICAgICAgICAgc3dpdGNoIChuKSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgYVtzXS5oLmNhbGwoaSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBhW3NdLmguY2FsbChpLCBlWzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGFbc10uaC5jYWxsKGksIGVbMV0sIGVbMl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGFbc10uaC5hcHBseShpLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhW3NdLm9uZSA/IChhLnNwbGljZShzLCAxKSwgby0tKSA6IHMrKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH07CiAgICB2YXIgaSA9IG47CiAgICB0LmV4cG9ydHMgPSBpOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoNDQpLAogICAgICBpID0gcig0NyksCiAgICAgIGEgPSByKDApLAogICAgICBvID0gYS5pc1N0cmluZywKICAgICAgcyA9IGEuaXNGdW5jdGlvbiwKICAgICAgbCA9IGEuaXNPYmplY3QsCiAgICAgIGggPSBhLmlzQXJyYXlMaWtlLAogICAgICB1ID0gYS5pbmRleE9mLAogICAgICBjID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuYW5pbWF0b3JzID0gW107CiAgICAgIH07CiAgICBjLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IGMsCiAgICAgIGFuaW1hdGU6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICBhID0gITEsCiAgICAgICAgICBvID0gdGhpcywKICAgICAgICAgIHMgPSB0aGlzLl9fenI7CiAgICAgICAgaWYgKHQpIHsKICAgICAgICAgIHZhciBsID0gdC5zcGxpdCgiLiIpLAogICAgICAgICAgICBoID0gbzsKICAgICAgICAgIGEgPSAic2hhcGUiID09PSBsWzBdOwogICAgICAgICAgZm9yICh2YXIgYyA9IDAsIGYgPSBsLmxlbmd0aDsgYyA8IGY7IGMrKykgaCAmJiAoaCA9IGhbbFtjXV0pOwogICAgICAgICAgaCAmJiAociA9IGgpOwogICAgICAgIH0gZWxzZSByID0gbzsKICAgICAgICBpZiAoIXIpIHJldHVybiB2b2lkIGkoJ1Byb3BlcnR5ICInICsgdCArICciIGlzIG5vdCBleGlzdGVkIGluIGVsZW1lbnQgJyArIG8uaWQpOwogICAgICAgIHZhciBkID0gby5hbmltYXRvcnMsCiAgICAgICAgICB2ID0gbmV3IG4ociwgZSk7CiAgICAgICAgcmV0dXJuIHYuZHVyaW5nKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBvLmRpcnR5KGEpOwogICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgZC5zcGxpY2UodShkLCB2KSwgMSk7CiAgICAgICAgfSksIGQucHVzaCh2KSwgcyAmJiBzLmFuaW1hdGlvbi5hZGRBbmltYXRvcih2KSwgdjsKICAgICAgfSwKICAgICAgc3RvcEFuaW1hdGlvbjogZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlID0gdGhpcy5hbmltYXRvcnMsIHIgPSBlLmxlbmd0aCwgbiA9IDA7IG4gPCByOyBuKyspIGVbbl0uc3RvcCh0KTsKICAgICAgICByZXR1cm4gZS5sZW5ndGggPSAwLCB0aGlzOwogICAgICB9LAogICAgICBhbmltYXRlVG86IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpLCBhKSB7CiAgICAgICAgZnVuY3Rpb24gbCgpIHsKICAgICAgICAgIC0tdSB8fCBpICYmIGkoKTsKICAgICAgICB9CiAgICAgICAgbyhyKSA/IChpID0gbiwgbiA9IHIsIHIgPSAwKSA6IHMobikgPyAoaSA9IG4sIG4gPSAibGluZWFyIiwgciA9IDApIDogcyhyKSA/IChpID0gciwgciA9IDApIDogcyhlKSA/IChpID0gZSwgZSA9IDUwMCkgOiBlIHx8IChlID0gNTAwKSwgdGhpcy5zdG9wQW5pbWF0aW9uKCksIHRoaXMuX2FuaW1hdGVUb1NoYWxsb3coIiIsIHRoaXMsIHQsIGUsIHIpOwogICAgICAgIHZhciBoID0gdGhpcy5hbmltYXRvcnMuc2xpY2UoKSwKICAgICAgICAgIHUgPSBoLmxlbmd0aDsKICAgICAgICB1IHx8IGkgJiYgaSgpOwogICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgaC5sZW5ndGg7IGMrKykgaFtjXS5kb25lKGwpLnN0YXJ0KG4sIGEpOwogICAgICB9LAogICAgICBfYW5pbWF0ZVRvU2hhbGxvdzogZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgICB2YXIgYSA9IHt9LAogICAgICAgICAgbyA9IDA7CiAgICAgICAgZm9yICh2YXIgcyBpbiByKSBpZiAoci5oYXNPd25Qcm9wZXJ0eShzKSkgaWYgKG51bGwgIT0gZVtzXSkgbChyW3NdKSAmJiAhaChyW3NdKSA/IHRoaXMuX2FuaW1hdGVUb1NoYWxsb3codCA/IHQgKyAiLiIgKyBzIDogcywgZVtzXSwgcltzXSwgbiwgaSkgOiAoYVtzXSA9IHJbc10sIG8rKyk7ZWxzZSBpZiAobnVsbCAhPSByW3NdKSBpZiAodCkgewogICAgICAgICAgdmFyIHUgPSB7fTsKICAgICAgICAgIHVbdF0gPSB7fSwgdVt0XVtzXSA9IHJbc10sIHRoaXMuYXR0cih1KTsKICAgICAgICB9IGVsc2UgdGhpcy5hdHRyKHMsIHJbc10pOwogICAgICAgIHJldHVybiBvID4gMCAmJiB0aGlzLmFuaW1hdGUodCwgITEpLndoZW4obnVsbCA9PSBuID8gNTAwIDogbiwgYSkuZGVsYXkoaSB8fCAwKSwgdGhpczsKICAgICAgfQogICAgfTsKICAgIHZhciBmID0gYzsKICAgIHQuZXhwb3J0cyA9IGY7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSkgewogICAgICByZXR1cm4gdFtlXTsKICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICB0W2VdID0gcjsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgcikgewogICAgICByZXR1cm4gKGUgLSB0KSAqIHIgKyB0OwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIHJldHVybiByID4gLjUgPyBlIDogdDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgbyA9IHQubGVuZ3RoOwogICAgICBpZiAoMSA9PSBpKSBmb3IgKHZhciBzID0gMDsgcyA8IG87IHMrKykgbltzXSA9IGEodFtzXSwgZVtzXSwgcik7ZWxzZSBmb3IgKHZhciBsID0gbyAmJiB0WzBdLmxlbmd0aCwgcyA9IDA7IHMgPCBvOyBzKyspIGZvciAodmFyIGggPSAwOyBoIDwgbDsgaCsrKSBuW3NdW2hdID0gYSh0W3NdW2hdLCBlW3NdW2hdLCByKTsKICAgIH0KICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICB2YXIgbiA9IHQubGVuZ3RoLAogICAgICAgIGkgPSBlLmxlbmd0aDsKICAgICAgaWYgKG4gIT09IGkpIHsKICAgICAgICBpZiAobiA+IGkpIHQubGVuZ3RoID0gaTtlbHNlIGZvciAodmFyIGEgPSBuOyBhIDwgaTsgYSsrKSB0LnB1c2goMSA9PT0gciA/IGVbYV0gOiB3LmNhbGwoZVthXSkpOwogICAgICB9CiAgICAgIGZvciAodmFyIG8gPSB0WzBdICYmIHRbMF0ubGVuZ3RoLCBhID0gMDsgYSA8IHQubGVuZ3RoOyBhKyspIGlmICgxID09PSByKSBpc05hTih0W2FdKSAmJiAodFthXSA9IGVbYV0pO2Vsc2UgZm9yICh2YXIgcyA9IDA7IHMgPCBvOyBzKyspIGlzTmFOKHRbYV1bc10pICYmICh0W2FdW3NdID0gZVthXVtzXSk7CiAgICB9CiAgICBmdW5jdGlvbiBoKHQsIGUsIHIpIHsKICAgICAgaWYgKHQgPT09IGUpIHJldHVybiAhMDsKICAgICAgdmFyIG4gPSB0Lmxlbmd0aDsKICAgICAgaWYgKG4gIT09IGUubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgIGlmICgxID09PSByKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGlmICh0W2ldICE9PSBlW2ldKSByZXR1cm4gITE7CiAgICAgIH0gZWxzZSBmb3IgKHZhciBhID0gdFswXS5sZW5ndGgsIGkgPSAwOyBpIDwgbjsgaSsrKSBmb3IgKHZhciBvID0gMDsgbyA8IGE7IG8rKykgaWYgKHRbaV1bb10gIT09IGVbaV1bb10pIHJldHVybiAhMTsKICAgICAgcmV0dXJuICEwOwogICAgfQogICAgZnVuY3Rpb24gdSh0LCBlLCByLCBuLCBpLCBhLCBvLCBzLCBsKSB7CiAgICAgIHZhciBoID0gdC5sZW5ndGg7CiAgICAgIGlmICgxID09IGwpIGZvciAodmFyIHUgPSAwOyB1IDwgaDsgdSsrKSBzW3VdID0gYyh0W3VdLCBlW3VdLCByW3VdLCBuW3VdLCBpLCBhLCBvKTtlbHNlIGZvciAodmFyIGYgPSB0WzBdLmxlbmd0aCwgdSA9IDA7IHUgPCBoOyB1KyspIGZvciAodmFyIGQgPSAwOyBkIDwgZjsgZCsrKSBzW3VdW2RdID0gYyh0W3VdW2RdLCBlW3VdW2RdLCByW3VdW2RdLCBuW3VdW2RdLCBpLCBhLCBvKTsKICAgIH0KICAgIGZ1bmN0aW9uIGModCwgZSwgciwgbiwgaSwgYSwgbykgewogICAgICB2YXIgcyA9IC41ICogKHIgLSB0KSwKICAgICAgICBsID0gLjUgKiAobiAtIGUpOwogICAgICByZXR1cm4gKDIgKiAoZSAtIHIpICsgcyArIGwpICogbyArICgtMyAqIChlIC0gcikgLSAyICogcyAtIGwpICogYSArIHMgKiBpICsgZTsKICAgIH0KICAgIGZ1bmN0aW9uIGYodCkgewogICAgICBpZiAoeSh0KSkgewogICAgICAgIHZhciBlID0gdC5sZW5ndGg7CiAgICAgICAgaWYgKHkodFswXSkpIHsKICAgICAgICAgIGZvciAodmFyIHIgPSBbXSwgbiA9IDA7IG4gPCBlOyBuKyspIHIucHVzaCh3LmNhbGwodFtuXSkpOwogICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgfQogICAgICAgIHJldHVybiB3LmNhbGwodCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBmdW5jdGlvbiBkKHQpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBNYXRoLmZsb29yKHRbMF0pLCB0WzFdID0gTWF0aC5mbG9vcih0WzFdKSwgdFsyXSA9IE1hdGguZmxvb3IodFsyXSksICJyZ2JhKCIgKyB0LmpvaW4oIiwiKSArICIpIjsKICAgIH0KICAgIGZ1bmN0aW9uIHYodCkgewogICAgICB2YXIgZSA9IHRbdC5sZW5ndGggLSAxXS52YWx1ZTsKICAgICAgcmV0dXJuIHkoZSAmJiBlWzBdKSA/IDIgOiAxOwogICAgfQogICAgZnVuY3Rpb24gZyh0LCBlLCByLCBuLCBpLCBmKSB7CiAgICAgIHZhciBnID0gdC5fZ2V0dGVyLAogICAgICAgIHggPSB0Ll9zZXR0ZXIsCiAgICAgICAgdyA9ICJzcGxpbmUiID09PSBlLAogICAgICAgIF8gPSBuLmxlbmd0aDsKICAgICAgaWYgKF8pIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIFMgPSBuWzBdLnZhbHVlLAogICAgICAgICAgTSA9IHkoUyksCiAgICAgICAgICBUID0gITEsCiAgICAgICAgICBrID0gITEsCiAgICAgICAgICBDID0gTSA/IHYobikgOiAwOwogICAgICAgIG4uc29ydChmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgcmV0dXJuIHQudGltZSAtIGUudGltZTsKICAgICAgICB9KSwgYiA9IG5bXyAtIDFdLnRpbWU7CiAgICAgICAgZm9yICh2YXIgUCA9IFtdLCBJID0gW10sIEEgPSBuWzBdLnZhbHVlLCBPID0gITAsIEQgPSAwOyBEIDwgXzsgRCsrKSB7CiAgICAgICAgICBQLnB1c2gobltEXS50aW1lIC8gYik7CiAgICAgICAgICB2YXIgTCA9IG5bRF0udmFsdWU7CiAgICAgICAgICBpZiAoTSAmJiBoKEwsIEEsIEMpIHx8ICFNICYmIEwgPT09IEEgfHwgKE8gPSAhMSksIEEgPSBMLCAic3RyaW5nIiA9PSB0eXBlb2YgTCkgewogICAgICAgICAgICB2YXIgRiA9IG0ucGFyc2UoTCk7CiAgICAgICAgICAgIEYgPyAoTCA9IEYsIFQgPSAhMCkgOiBrID0gITA7CiAgICAgICAgICB9CiAgICAgICAgICBJLnB1c2goTCk7CiAgICAgICAgfQogICAgICAgIGlmIChmIHx8ICFPKSB7CiAgICAgICAgICBmb3IgKHZhciBSID0gSVtfIC0gMV0sIEQgPSAwOyBEIDwgXyAtIDE7IEQrKykgTSA/IGwoSVtEXSwgUiwgQykgOiAhaXNOYU4oSVtEXSkgfHwgaXNOYU4oUikgfHwgayB8fCBUIHx8IChJW0RdID0gUik7CiAgICAgICAgICBNICYmIGwoZyh0Ll90YXJnZXQsIGkpLCBSLCBDKTsKICAgICAgICAgIHZhciBCLAogICAgICAgICAgICB6LAogICAgICAgICAgICBOLAogICAgICAgICAgICBFLAogICAgICAgICAgICBXLAogICAgICAgICAgICBxLAogICAgICAgICAgICBIID0gMCwKICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICBpZiAoVCkgdmFyIFggPSBbMCwgMCwgMCwgMF07CiAgICAgICAgICB2YXIgWSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgdmFyIHI7CiAgICAgICAgICAgICAgaWYgKGUgPCAwKSByID0gMDtlbHNlIGlmIChlIDwgaikgewogICAgICAgICAgICAgICAgZm9yIChCID0gTWF0aC5taW4oSCArIDEsIF8gLSAxKSwgciA9IEI7IHIgPj0gMCAmJiAhKFBbcl0gPD0gZSk7IHItLSk7CiAgICAgICAgICAgICAgICByID0gTWF0aC5taW4ociwgXyAtIDIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKHIgPSBIOyByIDwgXyAmJiAhKFBbcl0gPiBlKTsgcisrKTsKICAgICAgICAgICAgICAgIHIgPSBNYXRoLm1pbihyIC0gMSwgXyAtIDIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBIID0gciwgaiA9IGU7CiAgICAgICAgICAgICAgdmFyIG4gPSBQW3IgKyAxXSAtIFBbcl07CiAgICAgICAgICAgICAgaWYgKDAgIT09IG4pIGlmICh6ID0gKGUgLSBQW3JdKSAvIG4sIHcpIHsKICAgICAgICAgICAgICAgIGlmIChFID0gSVtyXSwgTiA9IElbMCA9PT0gciA/IHIgOiByIC0gMV0sIFcgPSBJW3IgPiBfIC0gMiA/IF8gLSAxIDogciArIDFdLCBxID0gSVtyID4gXyAtIDMgPyBfIC0gMSA6IHIgKyAyXSwgTSkgdShOLCBFLCBXLCBxLCB6LCB6ICogeiwgeiAqIHogKiB6LCBnKHQsIGkpLCBDKTtlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFyIGw7CiAgICAgICAgICAgICAgICAgIGlmIChUKSBsID0gdShOLCBFLCBXLCBxLCB6LCB6ICogeiwgeiAqIHogKiB6LCBYLCAxKSwgbCA9IGQoWCk7ZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGspIHJldHVybiBvKEUsIFcsIHopOwogICAgICAgICAgICAgICAgICAgIGwgPSBjKE4sIEUsIFcsIHEsIHosIHogKiB6LCB6ICogeiAqIHopOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHgodCwgaSwgbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChNKSBzKElbcl0sIElbciArIDFdLCB6LCBnKHQsIGkpLCBDKTtlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBsOwogICAgICAgICAgICAgICAgaWYgKFQpIHMoSVtyXSwgSVtyICsgMV0sIHosIFgsIDEpLCBsID0gZChYKTtlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKGspIHJldHVybiBvKElbcl0sIElbciArIDFdLCB6KTsKICAgICAgICAgICAgICAgICAgbCA9IGEoSVtyXSwgSVtyICsgMV0sIHopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeCh0LCBpLCBsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFYgPSBuZXcgcCh7CiAgICAgICAgICAgICAgdGFyZ2V0OiB0Ll90YXJnZXQsCiAgICAgICAgICAgICAgbGlmZTogYiwKICAgICAgICAgICAgICBsb29wOiB0Ll9sb29wLAogICAgICAgICAgICAgIGRlbGF5OiB0Ll9kZWxheSwKICAgICAgICAgICAgICBvbmZyYW1lOiBZLAogICAgICAgICAgICAgIG9uZGVzdHJveTogcgogICAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBlICYmICJzcGxpbmUiICE9PSBlICYmIChWLmVhc2luZyA9IGUpLCBWOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdmFyIHAgPSByKDQ1KSwKICAgICAgbSA9IHIoMTgpLAogICAgICB4ID0gcigwKSwKICAgICAgeSA9IHguaXNBcnJheUxpa2UsCiAgICAgIHcgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICAgIF8gPSBmdW5jdGlvbiAodCwgZSwgciwgYSkgewogICAgICAgIHRoaXMuX3RyYWNrcyA9IHt9LCB0aGlzLl90YXJnZXQgPSB0LCB0aGlzLl9sb29wID0gZSB8fCAhMSwgdGhpcy5fZ2V0dGVyID0gciB8fCBuLCB0aGlzLl9zZXR0ZXIgPSBhIHx8IGksIHRoaXMuX2NsaXBDb3VudCA9IDAsIHRoaXMuX2RlbGF5ID0gMCwgdGhpcy5fZG9uZUxpc3QgPSBbXSwgdGhpcy5fb25mcmFtZUxpc3QgPSBbXSwgdGhpcy5fY2xpcExpc3QgPSBbXTsKICAgICAgfTsKICAgIF8ucHJvdG90eXBlID0gewogICAgICB3aGVuOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5fdHJhY2tzOwogICAgICAgIGZvciAodmFyIG4gaW4gZSkgaWYgKGUuaGFzT3duUHJvcGVydHkobikpIHsKICAgICAgICAgIGlmICghcltuXSkgewogICAgICAgICAgICByW25dID0gW107CiAgICAgICAgICAgIHZhciBpID0gdGhpcy5fZ2V0dGVyKHRoaXMuX3RhcmdldCwgbik7CiAgICAgICAgICAgIGlmIChudWxsID09IGkpIGNvbnRpbnVlOwogICAgICAgICAgICAwICE9PSB0ICYmIHJbbl0ucHVzaCh7CiAgICAgICAgICAgICAgdGltZTogMCwKICAgICAgICAgICAgICB2YWx1ZTogZihpKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJbbl0ucHVzaCh7CiAgICAgICAgICAgIHRpbWU6IHQsCiAgICAgICAgICAgIHZhbHVlOiBlW25dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGR1cmluZzogZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb25mcmFtZUxpc3QucHVzaCh0KSwgdGhpczsKICAgICAgfSwKICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuX2NsaXBMaXN0Lmxlbmd0aDsgdCsrKSB0aGlzLl9jbGlwTGlzdFt0XS5wYXVzZSgpOwogICAgICAgIHRoaXMuX3BhdXNlZCA9ICEwOwogICAgICB9LAogICAgICByZXN1bWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuX2NsaXBMaXN0Lmxlbmd0aDsgdCsrKSB0aGlzLl9jbGlwTGlzdFt0XS5yZXN1bWUoKTsKICAgICAgICB0aGlzLl9wYXVzZWQgPSAhMTsKICAgICAgfSwKICAgICAgaXNQYXVzZWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9wYXVzZWQ7CiAgICAgIH0sCiAgICAgIF9kb25lQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl90cmFja3MgPSB7fSwgdGhpcy5fY2xpcExpc3QubGVuZ3RoID0gMDsKICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5fZG9uZUxpc3QsIGUgPSB0Lmxlbmd0aCwgciA9IDA7IHIgPCBlOyByKyspIHRbcl0uY2FsbCh0aGlzKTsKICAgICAgfSwKICAgICAgc3RhcnQ6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICBuID0gdGhpcywKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgYSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLS1pIHx8IG4uX2RvbmVDYWxsYmFjaygpOwogICAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciBvIGluIHRoaXMuX3RyYWNrcykgaWYgKHRoaXMuX3RyYWNrcy5oYXNPd25Qcm9wZXJ0eShvKSkgewogICAgICAgICAgdmFyIHMgPSBnKHRoaXMsIHQsIGEsIHRoaXMuX3RyYWNrc1tvXSwgbywgZSk7CiAgICAgICAgICBzICYmICh0aGlzLl9jbGlwTGlzdC5wdXNoKHMpLCBpKyssIHRoaXMuYW5pbWF0aW9uICYmIHRoaXMuYW5pbWF0aW9uLmFkZENsaXAocyksIHIgPSBzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgIHZhciBsID0gci5vbmZyYW1lOwogICAgICAgICAgci5vbmZyYW1lID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgbCh0LCBlKTsKICAgICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCBuLl9vbmZyYW1lTGlzdC5sZW5ndGg7IHIrKykgbi5fb25mcmFtZUxpc3Rbcl0odCwgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gaSB8fCB0aGlzLl9kb25lQ2FsbGJhY2soKSwgdGhpczsKICAgICAgfSwKICAgICAgc3RvcDogZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlID0gdGhpcy5fY2xpcExpc3QsIHIgPSB0aGlzLmFuaW1hdGlvbiwgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB2YXIgaSA9IGVbbl07CiAgICAgICAgICB0ICYmIGkub25mcmFtZSh0aGlzLl90YXJnZXQsIDEpLCByICYmIHIucmVtb3ZlQ2xpcChpKTsKICAgICAgICB9CiAgICAgICAgZS5sZW5ndGggPSAwOwogICAgICB9LAogICAgICBkZWxheTogZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVsYXkgPSB0LCB0aGlzOwogICAgICB9LAogICAgICBkb25lOiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0ICYmIHRoaXMuX2RvbmVMaXN0LnB1c2godCksIHRoaXM7CiAgICAgIH0sCiAgICAgIGdldENsaXBzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NsaXBMaXN0OwogICAgICB9CiAgICB9OwogICAgdmFyIGIgPSBfOwogICAgdC5leHBvcnRzID0gYjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHRoaXMuX3RhcmdldCA9IHQudGFyZ2V0LCB0aGlzLl9saWZlID0gdC5saWZlIHx8IDFlMywgdGhpcy5fZGVsYXkgPSB0LmRlbGF5IHx8IDAsIHRoaXMuX2luaXRpYWxpemVkID0gITEsIHRoaXMubG9vcCA9IG51bGwgIT0gdC5sb29wICYmIHQubG9vcCwgdGhpcy5nYXAgPSB0LmdhcCB8fCAwLCB0aGlzLmVhc2luZyA9IHQuZWFzaW5nIHx8ICJMaW5lYXIiLCB0aGlzLm9uZnJhbWUgPSB0Lm9uZnJhbWUsIHRoaXMub25kZXN0cm95ID0gdC5vbmRlc3Ryb3ksIHRoaXMub25yZXN0YXJ0ID0gdC5vbnJlc3RhcnQsIHRoaXMuX3BhdXNlZFRpbWUgPSAwLCB0aGlzLl9wYXVzZWQgPSAhMTsKICAgIH0KICAgIHZhciBpID0gcig0Nik7CiAgICBuLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgIHN0ZXA6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgaWYgKHRoaXMuX2luaXRpYWxpemVkIHx8ICh0aGlzLl9zdGFydFRpbWUgPSB0ICsgdGhpcy5fZGVsYXksIHRoaXMuX2luaXRpYWxpemVkID0gITApLCB0aGlzLl9wYXVzZWQpIHJldHVybiB2b2lkICh0aGlzLl9wYXVzZWRUaW1lICs9IGUpOwogICAgICAgIHZhciByID0gKHQgLSB0aGlzLl9zdGFydFRpbWUgLSB0aGlzLl9wYXVzZWRUaW1lKSAvIHRoaXMuX2xpZmU7CiAgICAgICAgaWYgKCEociA8IDApKSB7CiAgICAgICAgICByID0gTWF0aC5taW4ociwgMSk7CiAgICAgICAgICB2YXIgbiA9IHRoaXMuZWFzaW5nLAogICAgICAgICAgICBhID0gInN0cmluZyIgPT0gdHlwZW9mIG4gPyBpW25dIDogbiwKICAgICAgICAgICAgbyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGEgPyBhKHIpIDogcjsKICAgICAgICAgIHJldHVybiB0aGlzLmZpcmUoImZyYW1lIiwgbyksIDEgPT0gciA/IHRoaXMubG9vcCA/ICh0aGlzLnJlc3RhcnQodCksICJyZXN0YXJ0IikgOiAodGhpcy5fbmVlZHNSZW1vdmUgPSAhMCwgImRlc3Ryb3kiKSA6IG51bGw7CiAgICAgICAgfQogICAgICB9LAogICAgICByZXN0YXJ0OiBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gKHQgLSB0aGlzLl9zdGFydFRpbWUgLSB0aGlzLl9wYXVzZWRUaW1lKSAlIHRoaXMuX2xpZmU7CiAgICAgICAgdGhpcy5fc3RhcnRUaW1lID0gdCAtIGUgKyB0aGlzLmdhcCwgdGhpcy5fcGF1c2VkVGltZSA9IDAsIHRoaXMuX25lZWRzUmVtb3ZlID0gITE7CiAgICAgIH0sCiAgICAgIGZpcmU6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdCA9ICJvbiIgKyB0LCB0aGlzW3RdICYmIHRoaXNbdF0odGhpcy5fdGFyZ2V0LCBlKTsKICAgICAgfSwKICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9wYXVzZWQgPSAhMDsKICAgICAgfSwKICAgICAgcmVzdW1lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fcGF1c2VkID0gITE7CiAgICAgIH0KICAgIH07CiAgICB2YXIgYSA9IG47CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IHsKICAgICAgICBsaW5lYXI6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9LAogICAgICAgIHF1YWRyYXRpY0luOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQgKiB0OwogICAgICAgIH0sCiAgICAgICAgcXVhZHJhdGljT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQgKiAoMiAtIHQpOwogICAgICAgIH0sCiAgICAgICAgcXVhZHJhdGljSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gKHQgKj0gMikgPCAxID8gLjUgKiB0ICogdCA6IC0uNSAqICgtLXQgKiAodCAtIDIpIC0gMSk7CiAgICAgICAgfSwKICAgICAgICBjdWJpY0luOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQgKiB0ICogdDsKICAgICAgICB9LAogICAgICAgIGN1YmljT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIC0tdCAqIHQgKiB0ICsgMTsKICAgICAgICB9LAogICAgICAgIGN1YmljSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gKHQgKj0gMikgPCAxID8gLjUgKiB0ICogdCAqIHQgOiAuNSAqICgodCAtPSAyKSAqIHQgKiB0ICsgMik7CiAgICAgICAgfSwKICAgICAgICBxdWFydGljSW46IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdCAqIHQgKiB0ICogdDsKICAgICAgICB9LAogICAgICAgIHF1YXJ0aWNPdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gMSAtIC0tdCAqIHQgKiB0ICogdDsKICAgICAgICB9LAogICAgICAgIHF1YXJ0aWNJbk91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyAuNSAqIHQgKiB0ICogdCAqIHQgOiAtLjUgKiAoKHQgLT0gMikgKiB0ICogdCAqIHQgLSAyKTsKICAgICAgICB9LAogICAgICAgIHF1aW50aWNJbjogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0ICogdCAqIHQgKiB0ICogdDsKICAgICAgICB9LAogICAgICAgIHF1aW50aWNPdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gLS10ICogdCAqIHQgKiB0ICogdCArIDE7CiAgICAgICAgfSwKICAgICAgICBxdWludGljSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gKHQgKj0gMikgPCAxID8gLjUgKiB0ICogdCAqIHQgKiB0ICogdCA6IC41ICogKCh0IC09IDIpICogdCAqIHQgKiB0ICogdCArIDIpOwogICAgICAgIH0sCiAgICAgICAgc2ludXNvaWRhbEluOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIDEgLSBNYXRoLmNvcyh0ICogTWF0aC5QSSAvIDIpOwogICAgICAgIH0sCiAgICAgICAgc2ludXNvaWRhbE91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBNYXRoLnNpbih0ICogTWF0aC5QSSAvIDIpOwogICAgICAgIH0sCiAgICAgICAgc2ludXNvaWRhbEluT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIC41ICogKDEgLSBNYXRoLmNvcyhNYXRoLlBJICogdCkpOwogICAgICAgIH0sCiAgICAgICAgZXhwb25lbnRpYWxJbjogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IE1hdGgucG93KDEwMjQsIHQgLSAxKTsKICAgICAgICB9LAogICAgICAgIGV4cG9uZW50aWFsT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIDEgPT09IHQgPyAxIDogMSAtIE1hdGgucG93KDIsIC0xMCAqIHQpOwogICAgICAgIH0sCiAgICAgICAgZXhwb25lbnRpYWxJbk91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IDEgPT09IHQgPyAxIDogKHQgKj0gMikgPCAxID8gLjUgKiBNYXRoLnBvdygxMDI0LCB0IC0gMSkgOiAuNSAqICgyIC0gTWF0aC5wb3coMiwgLTEwICogKHQgLSAxKSkpOwogICAgICAgIH0sCiAgICAgICAgY2lyY3VsYXJJbjogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAxIC0gTWF0aC5zcXJ0KDEgLSB0ICogdCk7CiAgICAgICAgfSwKICAgICAgICBjaXJjdWxhck91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoMSAtIC0tdCAqIHQpOwogICAgICAgIH0sCiAgICAgICAgY2lyY3VsYXJJbk91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyAtLjUgKiAoTWF0aC5zcXJ0KDEgLSB0ICogdCkgLSAxKSA6IC41ICogKE1hdGguc3FydCgxIC0gKHQgLT0gMikgKiB0KSArIDEpOwogICAgICAgIH0sCiAgICAgICAgZWxhc3RpY0luOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHIgPSAuMTsKICAgICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IDEgPT09IHQgPyAxIDogKCFyIHx8IHIgPCAxID8gKHIgPSAxLCBlID0gLjEpIDogZSA9IC40ICogTWF0aC5hc2luKDEgLyByKSAvICgyICogTWF0aC5QSSksIC1yICogTWF0aC5wb3coMiwgMTAgKiAodCAtPSAxKSkgKiBNYXRoLnNpbigodCAtIGUpICogKDIgKiBNYXRoLlBJKSAvIC40KSk7CiAgICAgICAgfSwKICAgICAgICBlbGFzdGljT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHIgPSAuMTsKICAgICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IDEgPT09IHQgPyAxIDogKCFyIHx8IHIgPCAxID8gKHIgPSAxLCBlID0gLjEpIDogZSA9IC40ICogTWF0aC5hc2luKDEgLyByKSAvICgyICogTWF0aC5QSSksIHIgKiBNYXRoLnBvdygyLCAtMTAgKiB0KSAqIE1hdGguc2luKCh0IC0gZSkgKiAoMiAqIE1hdGguUEkpIC8gLjQpICsgMSk7CiAgICAgICAgfSwKICAgICAgICBlbGFzdGljSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgciA9IC4xOwogICAgICAgICAgcmV0dXJuIDAgPT09IHQgPyAwIDogMSA9PT0gdCA/IDEgOiAoIXIgfHwgciA8IDEgPyAociA9IDEsIGUgPSAuMSkgOiBlID0gLjQgKiBNYXRoLmFzaW4oMSAvIHIpIC8gKDIgKiBNYXRoLlBJKSwgKHQgKj0gMikgPCAxID8gciAqIE1hdGgucG93KDIsIDEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgLSBlKSAqICgyICogTWF0aC5QSSkgLyAuNCkgKiAtLjUgOiByICogTWF0aC5wb3coMiwgLTEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgLSBlKSAqICgyICogTWF0aC5QSSkgLyAuNCkgKiAuNSArIDEpOwogICAgICAgIH0sCiAgICAgICAgYmFja0luOiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSAxLjcwMTU4OwogICAgICAgICAgcmV0dXJuIHQgKiB0ICogKChlICsgMSkgKiB0IC0gZSk7CiAgICAgICAgfSwKICAgICAgICBiYWNrT3V0OiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSAxLjcwMTU4OwogICAgICAgICAgcmV0dXJuIC0tdCAqIHQgKiAoKGUgKyAxKSAqIHQgKyBlKSArIDE7CiAgICAgICAgfSwKICAgICAgICBiYWNrSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgZSA9IDIuNTk0OTA5NTsKICAgICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyB0ICogdCAqICgoZSArIDEpICogdCAtIGUpICogLjUgOiAuNSAqICgodCAtPSAyKSAqIHQgKiAoKGUgKyAxKSAqIHQgKyBlKSArIDIpOwogICAgICAgIH0sCiAgICAgICAgYm91bmNlSW46IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gMSAtIHIuYm91bmNlT3V0KDEgLSB0KTsKICAgICAgICB9LAogICAgICAgIGJvdW5jZU91dDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0IDwgMSAvIDIuNzUgPyA3LjU2MjUgKiB0ICogdCA6IHQgPCAyIC8gMi43NSA/IDcuNTYyNSAqICh0IC09IDEuNSAvIDIuNzUpICogdCArIC43NSA6IHQgPCAyLjUgLyAyLjc1ID8gNy41NjI1ICogKHQgLT0gMi4yNSAvIDIuNzUpICogdCArIC45Mzc1IDogNy41NjI1ICogKHQgLT0gMi42MjUgLyAyLjc1KSAqIHQgKyAuOTg0Mzc1OwogICAgICAgIH0sCiAgICAgICAgYm91bmNlSW5PdXQ6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdCA8IC41ID8gLjUgKiByLmJvdW5jZUluKDIgKiB0KSA6IC41ICogci5ib3VuY2VPdXQoMiAqIHQgLSAxKSArIC41OwogICAgICAgIH0KICAgICAgfSwKICAgICAgbiA9IHI7CiAgICB0LmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMTkpLAogICAgICBpID0gbi5kZWJ1Z01vZGUsCiAgICAgIGEgPSBmdW5jdGlvbiAoKSB7fTsKICAgIDEgPT09IGkgPyBhID0gZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciB0IGluIGFyZ3VtZW50cykgdGhyb3cgbmV3IEVycm9yKGFyZ3VtZW50c1t0XSk7CiAgICB9IDogaSA+IDEgJiYgKGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIHQgaW4gYXJndW1lbnRzKSBjb25zb2xlLmxvZyhhcmd1bWVudHNbdF0pOwogICAgfSk7CiAgICB2YXIgbyA9IGE7CiAgICB0LmV4cG9ydHMgPSBvOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMjApLAogICAgICBpID0gcigzKSwKICAgICAgYSA9IG5ldyBpKCksCiAgICAgIG8gPSBmdW5jdGlvbiAoKSB7fTsKICAgIG8ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbywKICAgICAgZHJhd1JlY3RUZXh0OiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5zdHlsZTsKICAgICAgICBlID0gci50ZXh0UmVjdCB8fCBlLCB0aGlzLl9fZGlydHkgJiYgbi5ub3JtYWxpemVUZXh0U3R5bGUociwgITApOwogICAgICAgIHZhciBpID0gci50ZXh0OwogICAgICAgIGlmIChudWxsICE9IGkgJiYgKGkgKz0gIiIpLCBuLm5lZWREcmF3VGV4dChpLCByKSkgewogICAgICAgICAgdC5zYXZlKCk7CiAgICAgICAgICB2YXIgbyA9IHRoaXMudHJhbnNmb3JtOwogICAgICAgICAgci50cmFuc2Zvcm1UZXh0ID8gdGhpcy5zZXRUcmFuc2Zvcm0odCkgOiBvICYmIChhLmNvcHkoZSksIGEuYXBwbHlUcmFuc2Zvcm0obyksIGUgPSBhKSwgbi5yZW5kZXJUZXh0KHRoaXMsIHQsIGksIHIsIGUpLCB0LnJlc3RvcmUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICB2YXIgcyA9IG87CiAgICB0LmV4cG9ydHMgPSBzOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgaWYgKDAgIT09IHQubGVuZ3RoKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICBpID0gdFswXSwKICAgICAgICAgIGEgPSBpWzBdLAogICAgICAgICAgbyA9IGlbMF0sCiAgICAgICAgICBzID0gaVsxXSwKICAgICAgICAgIGwgPSBpWzFdOwogICAgICAgIGZvciAobiA9IDE7IG4gPCB0Lmxlbmd0aDsgbisrKSBpID0gdFtuXSwgYSA9IHUoYSwgaVswXSksIG8gPSBjKG8sIGlbMF0pLCBzID0gdShzLCBpWzFdKSwgbCA9IGMobCwgaVsxXSk7CiAgICAgICAgZVswXSA9IGEsIGVbMV0gPSBzLCByWzBdID0gbywgclsxXSA9IGw7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGkodCwgZSwgciwgbiwgaSwgYSkgewogICAgICBpWzBdID0gdSh0LCByKSwgaVsxXSA9IHUoZSwgbiksIGFbMF0gPSBjKHQsIHIpLCBhWzFdID0gYyhlLCBuKTsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgaSwgYSwgbywgcywgbCwgZikgewogICAgICB2YXIgZCwKICAgICAgICB2ID0gaC5jdWJpY0V4dHJlbWEsCiAgICAgICAgZyA9IGguY3ViaWNBdCwKICAgICAgICBwID0gdih0LCByLCBpLCBvLCB4KTsKICAgICAgZm9yIChsWzBdID0gMSAvIDAsIGxbMV0gPSAxIC8gMCwgZlswXSA9IC0xIC8gMCwgZlsxXSA9IC0xIC8gMCwgZCA9IDA7IGQgPCBwOyBkKyspIHsKICAgICAgICB2YXIgbSA9IGcodCwgciwgaSwgbywgeFtkXSk7CiAgICAgICAgbFswXSA9IHUobSwgbFswXSksIGZbMF0gPSBjKG0sIGZbMF0pOwogICAgICB9CiAgICAgIGZvciAocCA9IHYoZSwgbiwgYSwgcywgeSksIGQgPSAwOyBkIDwgcDsgZCsrKSB7CiAgICAgICAgdmFyIHcgPSBnKGUsIG4sIGEsIHMsIHlbZF0pOwogICAgICAgIGxbMV0gPSB1KHcsIGxbMV0pLCBmWzFdID0gYyh3LCBmWzFdKTsKICAgICAgfQogICAgICBsWzBdID0gdSh0LCBsWzBdKSwgZlswXSA9IGModCwgZlswXSksIGxbMF0gPSB1KG8sIGxbMF0pLCBmWzBdID0gYyhvLCBmWzBdKSwgbFsxXSA9IHUoZSwgbFsxXSksIGZbMV0gPSBjKGUsIGZbMV0pLCBsWzFdID0gdShzLCBsWzFdKSwgZlsxXSA9IGMocywgZlsxXSk7CiAgICB9CiAgICBmdW5jdGlvbiBvKHQsIGUsIHIsIG4sIGksIGEsIG8sIHMpIHsKICAgICAgdmFyIGwgPSBoLnF1YWRyYXRpY0V4dHJlbXVtLAogICAgICAgIGYgPSBoLnF1YWRyYXRpY0F0LAogICAgICAgIGQgPSBjKHUobCh0LCByLCBpKSwgMSksIDApLAogICAgICAgIHYgPSBjKHUobChlLCBuLCBhKSwgMSksIDApLAogICAgICAgIGcgPSBmKHQsIHIsIGksIGQpLAogICAgICAgIHAgPSBmKGUsIG4sIGEsIHYpOwogICAgICBvWzBdID0gdSh0LCBpLCBnKSwgb1sxXSA9IHUoZSwgYSwgcCksIHNbMF0gPSBjKHQsIGksIGcpLCBzWzFdID0gYyhlLCBhLCBwKTsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSwgYSwgbywgcywgaCkgewogICAgICB2YXIgdSA9IGwubWluLAogICAgICAgIGMgPSBsLm1heCwKICAgICAgICB4ID0gTWF0aC5hYnMoaSAtIGEpOwogICAgICBpZiAoeCAlIHYgPCAxZS00ICYmIHggPiAxZS00KSByZXR1cm4gc1swXSA9IHQgLSByLCBzWzFdID0gZSAtIG4sIGhbMF0gPSB0ICsgciwgdm9pZCAoaFsxXSA9IGUgKyBuKTsKICAgICAgaWYgKGdbMF0gPSBkKGkpICogciArIHQsIGdbMV0gPSBmKGkpICogbiArIGUsIHBbMF0gPSBkKGEpICogciArIHQsIHBbMV0gPSBmKGEpICogbiArIGUsIHUocywgZywgcCksIGMoaCwgZywgcCksIGkgJT0gdiwgaSA8IDAgJiYgKGkgKz0gdiksIGEgJT0gdiwgYSA8IDAgJiYgKGEgKz0gdiksIGkgPiBhICYmICFvID8gYSArPSB2IDogaSA8IGEgJiYgbyAmJiAoaSArPSB2KSwgbykgewogICAgICAgIHZhciB5ID0gYTsKICAgICAgICBhID0gaSwgaSA9IHk7CiAgICAgIH0KICAgICAgZm9yICh2YXIgdyA9IDA7IHcgPCBhOyB3ICs9IE1hdGguUEkgLyAyKSB3ID4gaSAmJiAobVswXSA9IGQodykgKiByICsgdCwgbVsxXSA9IGYodykgKiBuICsgZSwgdShzLCBtLCBzKSwgYyhoLCBtLCBoKSk7CiAgICB9CiAgICB2YXIgbCA9IHIoMiksCiAgICAgIGggPSByKDQpLAogICAgICB1ID0gTWF0aC5taW4sCiAgICAgIGMgPSBNYXRoLm1heCwKICAgICAgZiA9IE1hdGguc2luLAogICAgICBkID0gTWF0aC5jb3MsCiAgICAgIHYgPSAyICogTWF0aC5QSSwKICAgICAgZyA9IGwuY3JlYXRlKCksCiAgICAgIHAgPSBsLmNyZWF0ZSgpLAogICAgICBtID0gbC5jcmVhdGUoKSwKICAgICAgeCA9IFtdLAogICAgICB5ID0gW107CiAgICBlLmZyb21Qb2ludHMgPSBuLCBlLmZyb21MaW5lID0gaSwgZS5mcm9tQ3ViaWMgPSBhLCBlLmZyb21RdWFkcmF0aWMgPSBvLCBlLmZyb21BcmMgPSBzOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgcmV0dXJuIE1hdGguYWJzKHQgLSBlKSA8IGI7CiAgICB9CiAgICBmdW5jdGlvbiBpKCkgewogICAgICB2YXIgdCA9IE1bMF07CiAgICAgIE1bMF0gPSBNWzFdLCBNWzFdID0gdDsKICAgIH0KICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgYSwgbywgcywgbCwgaCwgdSkgewogICAgICBpZiAodSA+IGUgJiYgdSA+IG4gJiYgdSA+IG8gJiYgdSA+IGwgfHwgdSA8IGUgJiYgdSA8IG4gJiYgdSA8IG8gJiYgdSA8IGwpIHJldHVybiAwOwogICAgICB2YXIgYyA9IHguY3ViaWNSb290QXQoZSwgbiwgbywgbCwgdSwgUyk7CiAgICAgIGlmICgwID09PSBjKSByZXR1cm4gMDsKICAgICAgZm9yICh2YXIgZiwgZCwgdiA9IDAsIGcgPSAtMSwgcCA9IDA7IHAgPCBjOyBwKyspIHsKICAgICAgICB2YXIgbSA9IFNbcF0sCiAgICAgICAgICB5ID0gMCA9PT0gbSB8fCAxID09PSBtID8gLjUgOiAxOwogICAgICAgIHguY3ViaWNBdCh0LCByLCBhLCBzLCBtKSA8IGggfHwgKGcgPCAwICYmIChnID0geC5jdWJpY0V4dHJlbWEoZSwgbiwgbywgbCwgTSksIE1bMV0gPCBNWzBdICYmIGcgPiAxICYmIGkoKSwgZiA9IHguY3ViaWNBdChlLCBuLCBvLCBsLCBNWzBdKSwgZyA+IDEgJiYgKGQgPSB4LmN1YmljQXQoZSwgbiwgbywgbCwgTVsxXSkpKSwgMiA9PSBnID8gbSA8IE1bMF0gPyB2ICs9IGYgPCBlID8geSA6IC15IDogbSA8IE1bMV0gPyB2ICs9IGQgPCBmID8geSA6IC15IDogdiArPSBsIDwgZCA/IHkgOiAteSA6IG0gPCBNWzBdID8gdiArPSBmIDwgZSA/IHkgOiAteSA6IHYgKz0gbCA8IGYgPyB5IDogLXkpOwogICAgICB9CiAgICAgIHJldHVybiB2OwogICAgfQogICAgZnVuY3Rpb24gbyh0LCBlLCByLCBuLCBpLCBhLCBvLCBzKSB7CiAgICAgIGlmIChzID4gZSAmJiBzID4gbiAmJiBzID4gYSB8fCBzIDwgZSAmJiBzIDwgbiAmJiBzIDwgYSkgcmV0dXJuIDA7CiAgICAgIHZhciBsID0geC5xdWFkcmF0aWNSb290QXQoZSwgbiwgYSwgcywgUyk7CiAgICAgIGlmICgwID09PSBsKSByZXR1cm4gMDsKICAgICAgdmFyIGggPSB4LnF1YWRyYXRpY0V4dHJlbXVtKGUsIG4sIGEpOwogICAgICBpZiAoaCA+PSAwICYmIGggPD0gMSkgewogICAgICAgIGZvciAodmFyIHUgPSAwLCBjID0geC5xdWFkcmF0aWNBdChlLCBuLCBhLCBoKSwgZiA9IDA7IGYgPCBsOyBmKyspIHsKICAgICAgICAgIHZhciBkID0gMCA9PT0gU1tmXSB8fCAxID09PSBTW2ZdID8gLjUgOiAxLAogICAgICAgICAgICB2ID0geC5xdWFkcmF0aWNBdCh0LCByLCBpLCBTW2ZdKTsKICAgICAgICAgIHYgPCBvIHx8IChTW2ZdIDwgaCA/IHUgKz0gYyA8IGUgPyBkIDogLWQgOiB1ICs9IGEgPCBjID8gZCA6IC1kKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHU7CiAgICAgIH0KICAgICAgdmFyIGQgPSAwID09PSBTWzBdIHx8IDEgPT09IFNbMF0gPyAuNSA6IDEsCiAgICAgICAgdiA9IHgucXVhZHJhdGljQXQodCwgciwgaSwgU1swXSk7CiAgICAgIHJldHVybiB2IDwgbyA/IDAgOiBhIDwgZSA/IGQgOiAtZDsKICAgIH0KICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSwgYSwgbywgcykgewogICAgICBpZiAoKHMgLT0gZSkgPiByIHx8IHMgPCAtcikgcmV0dXJuIDA7CiAgICAgIHZhciBsID0gTWF0aC5zcXJ0KHIgKiByIC0gcyAqIHMpOwogICAgICBTWzBdID0gLWwsIFNbMV0gPSBsOwogICAgICB2YXIgaCA9IE1hdGguYWJzKG4gLSBpKTsKICAgICAgaWYgKGggPCAxZS00KSByZXR1cm4gMDsKICAgICAgaWYgKGggJSBfIDwgMWUtNCkgewogICAgICAgIG4gPSAwLCBpID0gXzsKICAgICAgICB2YXIgdSA9IGEgPyAxIDogLTE7CiAgICAgICAgcmV0dXJuIG8gPj0gU1swXSArIHQgJiYgbyA8PSBTWzFdICsgdCA/IHUgOiAwOwogICAgICB9CiAgICAgIGlmIChhKSB7CiAgICAgICAgdmFyIGwgPSBuOwogICAgICAgIG4gPSBtKGkpLCBpID0gbShsKTsKICAgICAgfSBlbHNlIG4gPSBtKG4pLCBpID0gbShpKTsKICAgICAgbiA+IGkgJiYgKGkgKz0gXyk7CiAgICAgIGZvciAodmFyIGMgPSAwLCBmID0gMDsgZiA8IDI7IGYrKykgewogICAgICAgIHZhciBkID0gU1tmXTsKICAgICAgICBpZiAoZCArIHQgPiBvKSB7CiAgICAgICAgICB2YXIgdiA9IE1hdGguYXRhbjIocywgZCksCiAgICAgICAgICAgIHUgPSBhID8gMSA6IC0xOwogICAgICAgICAgdiA8IDAgJiYgKHYgPSBfICsgdiksICh2ID49IG4gJiYgdiA8PSBpIHx8IHYgKyBfID49IG4gJiYgdiArIF8gPD0gaSkgJiYgKHYgPiBNYXRoLlBJIC8gMiAmJiB2IDwgMS41ICogTWF0aC5QSSAmJiAodSA9IC11KSwgYyArPSB1KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICBmdW5jdGlvbiBsKHQsIGUsIHIsIGksIGwpIHsKICAgICAgZm9yICh2YXIgaCA9IDAsIHUgPSAwLCBjID0gMCwgcCA9IDAsIG0gPSAwLCB4ID0gMDsgeCA8IHQubGVuZ3RoOykgewogICAgICAgIHZhciBfID0gdFt4KytdOwogICAgICAgIHN3aXRjaCAoXyA9PT0gdy5NICYmIHggPiAxICYmIChyIHx8IChoICs9IHkodSwgYywgcCwgbSwgaSwgbCkpKSwgMSA9PSB4ICYmICh1ID0gdFt4XSwgYyA9IHRbeCArIDFdLCBwID0gdSwgbSA9IGMpLCBfKSB7CiAgICAgICAgICBjYXNlIHcuTToKICAgICAgICAgICAgcCA9IHRbeCsrXSwgbSA9IHRbeCsrXSwgdSA9IHAsIGMgPSBtOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugdy5MOgogICAgICAgICAgICBpZiAocikgewogICAgICAgICAgICAgIGlmIChmLmNvbnRhaW5TdHJva2UodSwgYywgdFt4XSwgdFt4ICsgMV0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IHkodSwgYywgdFt4XSwgdFt4ICsgMV0sIGksIGwpIHx8IDA7CiAgICAgICAgICAgIHUgPSB0W3grK10sIGMgPSB0W3grK107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSB3LkM6CiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKGQuY29udGFpblN0cm9rZSh1LCBjLCB0W3grK10sIHRbeCsrXSwgdFt4KytdLCB0W3grK10sIHRbeF0sIHRbeCArIDFdLCBlLCBpLCBsKSkgcmV0dXJuICEwOwogICAgICAgICAgICB9IGVsc2UgaCArPSBhKHUsIGMsIHRbeCsrXSwgdFt4KytdLCB0W3grK10sIHRbeCsrXSwgdFt4XSwgdFt4ICsgMV0sIGksIGwpIHx8IDA7CiAgICAgICAgICAgIHUgPSB0W3grK10sIGMgPSB0W3grK107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSB3LlE6CiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKHYuY29udGFpblN0cm9rZSh1LCBjLCB0W3grK10sIHRbeCsrXSwgdFt4XSwgdFt4ICsgMV0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IG8odSwgYywgdFt4KytdLCB0W3grK10sIHRbeF0sIHRbeCArIDFdLCBpLCBsKSB8fCAwOwogICAgICAgICAgICB1ID0gdFt4KytdLCBjID0gdFt4KytdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugdy5BOgogICAgICAgICAgICB2YXIgYiA9IHRbeCsrXSwKICAgICAgICAgICAgICBTID0gdFt4KytdLAogICAgICAgICAgICAgIE0gPSB0W3grK10sCiAgICAgICAgICAgICAgVCA9IHRbeCsrXSwKICAgICAgICAgICAgICBrID0gdFt4KytdLAogICAgICAgICAgICAgIEMgPSB0W3grK10sCiAgICAgICAgICAgICAgUCA9ICh0W3grK10sIDEgLSB0W3grK10pLAogICAgICAgICAgICAgIEkgPSBNYXRoLmNvcyhrKSAqIE0gKyBiLAogICAgICAgICAgICAgIEEgPSBNYXRoLnNpbihrKSAqIFQgKyBTOwogICAgICAgICAgICB4ID4gMSA/IGggKz0geSh1LCBjLCBJLCBBLCBpLCBsKSA6IChwID0gSSwgbSA9IEEpOwogICAgICAgICAgICB2YXIgTyA9IChpIC0gYikgKiBUIC8gTSArIGI7CiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKGcuY29udGFpblN0cm9rZShiLCBTLCBULCBrLCBrICsgQywgUCwgZSwgTywgbCkpIHJldHVybiAhMDsKICAgICAgICAgICAgfSBlbHNlIGggKz0gcyhiLCBTLCBULCBrLCBrICsgQywgUCwgTywgbCk7CiAgICAgICAgICAgIHUgPSBNYXRoLmNvcyhrICsgQykgKiBNICsgYiwgYyA9IE1hdGguc2luKGsgKyBDKSAqIFQgKyBTOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugdy5SOgogICAgICAgICAgICBwID0gdSA9IHRbeCsrXSwgbSA9IGMgPSB0W3grK107CiAgICAgICAgICAgIHZhciBEID0gdFt4KytdLAogICAgICAgICAgICAgIEwgPSB0W3grK10sCiAgICAgICAgICAgICAgSSA9IHAgKyBELAogICAgICAgICAgICAgIEEgPSBtICsgTDsKICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICBpZiAoZi5jb250YWluU3Ryb2tlKHAsIG0sIEksIG0sIGUsIGksIGwpIHx8IGYuY29udGFpblN0cm9rZShJLCBtLCBJLCBBLCBlLCBpLCBsKSB8fCBmLmNvbnRhaW5TdHJva2UoSSwgQSwgcCwgQSwgZSwgaSwgbCkgfHwgZi5jb250YWluU3Ryb2tlKHAsIEEsIHAsIG0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IHkoSSwgbSwgSSwgQSwgaSwgbCksIGggKz0geShwLCBBLCBwLCBtLCBpLCBsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIHcuWjoKICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICBpZiAoZi5jb250YWluU3Ryb2tlKHUsIGMsIHAsIG0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IHkodSwgYywgcCwgbSwgaSwgbCk7CiAgICAgICAgICAgIHUgPSBwLCBjID0gbTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHIgfHwgbihjLCBtKSB8fCAoaCArPSB5KHUsIGMsIHAsIG0sIGksIGwpIHx8IDApLCAwICE9PSBoOwogICAgfQogICAgZnVuY3Rpb24gaCh0LCBlLCByKSB7CiAgICAgIHJldHVybiBsKHQsIDAsICExLCBlLCByKTsKICAgIH0KICAgIGZ1bmN0aW9uIHUodCwgZSwgciwgbikgewogICAgICByZXR1cm4gbCh0LCBlLCAhMCwgciwgbik7CiAgICB9CiAgICB2YXIgYyA9IHIoNiksCiAgICAgIGYgPSByKDUxKSwKICAgICAgZCA9IHIoNTIpLAogICAgICB2ID0gcig1MyksCiAgICAgIGcgPSByKDU0KSwKICAgICAgcCA9IHIoMjIpLAogICAgICBtID0gcC5ub3JtYWxpemVSYWRpYW4sCiAgICAgIHggPSByKDQpLAogICAgICB5ID0gcig1NSksCiAgICAgIHcgPSBjLkNNRCwKICAgICAgXyA9IDIgKiBNYXRoLlBJLAogICAgICBiID0gMWUtNCwKICAgICAgUyA9IFstMSwgLTEsIC0xXSwKICAgICAgTSA9IFstMSwgLTFdOwogICAgZS5jb250YWluID0gaCwgZS5jb250YWluU3Ryb2tlID0gdTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0LCBlLCByLCBuLCBpLCBhLCBvKSB7CiAgICAgIGlmICgwID09PSBpKSByZXR1cm4gITE7CiAgICAgIHZhciBzID0gaSwKICAgICAgICBsID0gMCwKICAgICAgICBoID0gdDsKICAgICAgaWYgKG8gPiBlICsgcyAmJiBvID4gbiArIHMgfHwgbyA8IGUgLSBzICYmIG8gPCBuIC0gcyB8fCBhID4gdCArIHMgJiYgYSA+IHIgKyBzIHx8IGEgPCB0IC0gcyAmJiBhIDwgciAtIHMpIHJldHVybiAhMTsKICAgICAgaWYgKHQgPT09IHIpIHJldHVybiBNYXRoLmFicyhhIC0gdCkgPD0gcyAvIDI7CiAgICAgIGwgPSAoZSAtIG4pIC8gKHQgLSByKSwgaCA9ICh0ICogbiAtIHIgKiBlKSAvICh0IC0gcik7CiAgICAgIHZhciB1ID0gbCAqIGEgLSBvICsgaDsKICAgICAgcmV0dXJuIHUgKiB1IC8gKGwgKiBsICsgMSkgPD0gcyAvIDIgKiBzIC8gMjsKICAgIH0KICAgIGUuY29udGFpblN0cm9rZSA9IHI7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbiwgYSwgbywgcywgbCwgaCwgdSwgYykgewogICAgICBpZiAoMCA9PT0gaCkgcmV0dXJuICExOwogICAgICB2YXIgZiA9IGg7CiAgICAgIHJldHVybiAhKGMgPiBlICsgZiAmJiBjID4gbiArIGYgJiYgYyA+IG8gKyBmICYmIGMgPiBsICsgZiB8fCBjIDwgZSAtIGYgJiYgYyA8IG4gLSBmICYmIGMgPCBvIC0gZiAmJiBjIDwgbCAtIGYgfHwgdSA+IHQgKyBmICYmIHUgPiByICsgZiAmJiB1ID4gYSArIGYgJiYgdSA+IHMgKyBmIHx8IHUgPCB0IC0gZiAmJiB1IDwgciAtIGYgJiYgdSA8IGEgLSBmICYmIHUgPCBzIC0gZikgJiYgaS5jdWJpY1Byb2plY3RQb2ludCh0LCBlLCByLCBuLCBhLCBvLCBzLCBsLCB1LCBjLCBudWxsKSA8PSBmIC8gMjsKICAgIH0KICAgIHZhciBpID0gcig0KTsKICAgIGUuY29udGFpblN0cm9rZSA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbiwgaSwgbywgcywgbCwgaCkgewogICAgICBpZiAoMCA9PT0gcykgcmV0dXJuICExOwogICAgICB2YXIgdSA9IHM7CiAgICAgIHJldHVybiAhKGggPiBlICsgdSAmJiBoID4gbiArIHUgJiYgaCA+IG8gKyB1IHx8IGggPCBlIC0gdSAmJiBoIDwgbiAtIHUgJiYgaCA8IG8gLSB1IHx8IGwgPiB0ICsgdSAmJiBsID4gciArIHUgJiYgbCA+IGkgKyB1IHx8IGwgPCB0IC0gdSAmJiBsIDwgciAtIHUgJiYgbCA8IGkgLSB1KSAmJiBhKHQsIGUsIHIsIG4sIGksIG8sIGwsIGgsIG51bGwpIDw9IHUgLyAyOwogICAgfQogICAgdmFyIGkgPSByKDQpLAogICAgICBhID0gaS5xdWFkcmF0aWNQcm9qZWN0UG9pbnQ7CiAgICBlLmNvbnRhaW5TdHJva2UgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIsIG4sIGksIHMsIGwsIGgsIHUpIHsKICAgICAgaWYgKDAgPT09IGwpIHJldHVybiAhMTsKICAgICAgdmFyIGMgPSBsOwogICAgICBoIC09IHQsIHUgLT0gZTsKICAgICAgdmFyIGYgPSBNYXRoLnNxcnQoaCAqIGggKyB1ICogdSk7CiAgICAgIGlmIChmIC0gYyA+IHIgfHwgZiArIGMgPCByKSByZXR1cm4gITE7CiAgICAgIGlmIChNYXRoLmFicyhuIC0gaSkgJSBvIDwgMWUtNCkgcmV0dXJuICEwOwogICAgICBpZiAocykgewogICAgICAgIHZhciBkID0gbjsKICAgICAgICBuID0gYShpKSwgaSA9IGEoZCk7CiAgICAgIH0gZWxzZSBuID0gYShuKSwgaSA9IGEoaSk7CiAgICAgIG4gPiBpICYmIChpICs9IG8pOwogICAgICB2YXIgdiA9IE1hdGguYXRhbjIodSwgaCk7CiAgICAgIHJldHVybiB2IDwgMCAmJiAodiArPSBvKSwgdiA+PSBuICYmIHYgPD0gaSB8fCB2ICsgbyA+PSBuICYmIHYgKyBvIDw9IGk7CiAgICB9CiAgICB2YXIgaSA9IHIoMjIpLAogICAgICBhID0gaS5ub3JtYWxpemVSYWRpYW4sCiAgICAgIG8gPSAyICogTWF0aC5QSTsKICAgIGUuY29udGFpblN0cm9rZSA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIodCwgZSwgciwgbiwgaSwgYSkgewogICAgICBpZiAoYSA+IGUgJiYgYSA+IG4gfHwgYSA8IGUgJiYgYSA8IG4pIHJldHVybiAwOwogICAgICBpZiAobiA9PT0gZSkgcmV0dXJuIDA7CiAgICAgIHZhciBvID0gbiA8IGUgPyAxIDogLTEsCiAgICAgICAgcyA9IChhIC0gZSkgLyAobiAtIGUpOwogICAgICByZXR1cm4gMSAhPT0gcyAmJiAwICE9PSBzIHx8IChvID0gbiA8IGUgPyAuNSA6IC0uNSksIHMgKiAociAtIHQpICsgdCA+IGkgPyBvIDogMDsKICAgIH0KICAgIHQuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdGhpcy5pbWFnZSA9IHQsIHRoaXMucmVwZWF0ID0gZSwgdGhpcy50eXBlID0gInBhdHRlcm4iOwogICAgfTsKICAgIHIucHJvdG90eXBlLmdldENhbnZhc1BhdHRlcm4gPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5jcmVhdGVQYXR0ZXJuKHRoaXMuaW1hZ2UsIHRoaXMucmVwZWF0IHx8ICJyZXBlYXQiKTsKICAgIH07CiAgICB2YXIgbiA9IHI7CiAgICB0LmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgdmFyIHIsCiAgICAgICAgbiwKICAgICAgICBpLAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgICBmLAogICAgICAgIGQgPSB0LmRhdGEsCiAgICAgICAgdiA9IHMuTSwKICAgICAgICBnID0gcy5DLAogICAgICAgIHAgPSBzLkwsCiAgICAgICAgbSA9IHMuUiwKICAgICAgICB4ID0gcy5BLAogICAgICAgIHkgPSBzLlE7CiAgICAgIGZvciAoaSA9IDAsIGEgPSAwOyBpIDwgZC5sZW5ndGg7KSB7CiAgICAgICAgc3dpdGNoIChyID0gZFtpKytdLCBhID0gaSwgbiA9IDAsIHIpIHsKICAgICAgICAgIGNhc2UgdjoKICAgICAgICAgIGNhc2UgcDoKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnOgogICAgICAgICAgICBuID0gMzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIHk6CiAgICAgICAgICAgIG4gPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgeDoKICAgICAgICAgICAgdmFyIHcgPSBlWzRdLAogICAgICAgICAgICAgIF8gPSBlWzVdLAogICAgICAgICAgICAgIGIgPSBoKGVbMF0gKiBlWzBdICsgZVsxXSAqIGVbMV0pLAogICAgICAgICAgICAgIFMgPSBoKGVbMl0gKiBlWzJdICsgZVszXSAqIGVbM10pLAogICAgICAgICAgICAgIE0gPSB1KC1lWzFdIC8gUywgZVswXSAvIGIpOwogICAgICAgICAgICBkW2ldICo9IGIsIGRbaSsrXSArPSB3LCBkW2ldICo9IFMsIGRbaSsrXSArPSBfLCBkW2krK10gKj0gYiwgZFtpKytdICo9IFMsIGRbaSsrXSArPSBNLCBkW2krK10gKz0gTSwgaSArPSAyLCBhID0gaTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIG06CiAgICAgICAgICAgIGZbMF0gPSBkW2krK10sIGZbMV0gPSBkW2krK10sIG8oZiwgZiwgZSksIGRbYSsrXSA9IGZbMF0sIGRbYSsrXSA9IGZbMV0sIGZbMF0gKz0gZFtpKytdLCBmWzFdICs9IGRbaSsrXSwgbyhmLCBmLCBlKSwgZFthKytdID0gZlswXSwgZFthKytdID0gZlsxXTsKICAgICAgICB9CiAgICAgICAgZm9yIChjID0gMDsgYyA8IG47IGMrKykgewogICAgICAgICAgdmFyIGYgPSBsW2NdOwogICAgICAgICAgZlswXSA9IGRbaSsrXSwgZlsxXSA9IGRbaSsrXSwgbyhmLCBmLCBlKSwgZFthKytdID0gZlswXSwgZFthKytdID0gZlsxXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHZhciBpID0gcig2KSwKICAgICAgYSA9IHIoMiksCiAgICAgIG8gPSBhLmFwcGx5VHJhbnNmb3JtLAogICAgICBzID0gaS5DTUQsCiAgICAgIGwgPSBbW10sIFtdLCBbXV0sCiAgICAgIGggPSBNYXRoLnNxcnQsCiAgICAgIHUgPSBNYXRoLmF0YW4yOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIGkuY2FsbCh0aGlzLCB0KTsKICAgIH0KICAgIHZhciBpID0gcigxMiksCiAgICAgIGEgPSByKDMpLAogICAgICBvID0gcigwKSwKICAgICAgcyA9IHIoMTApOwogICAgbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBuLAogICAgICB0eXBlOiAiaW1hZ2UiLAogICAgICBicnVzaDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMuc3R5bGUsCiAgICAgICAgICBuID0gci5pbWFnZTsKICAgICAgICByLmJpbmQodCwgdGhpcywgZSk7CiAgICAgICAgdmFyIGkgPSB0aGlzLl9pbWFnZSA9IHMuY3JlYXRlT3JVcGRhdGVJbWFnZShuLCB0aGlzLl9pbWFnZSwgdGhpcywgdGhpcy5vbmxvYWQpOwogICAgICAgIGlmIChpICYmIHMuaXNJbWFnZVJlYWR5KGkpKSB7CiAgICAgICAgICB2YXIgYSA9IHIueCB8fCAwLAogICAgICAgICAgICBvID0gci55IHx8IDAsCiAgICAgICAgICAgIGwgPSByLndpZHRoLAogICAgICAgICAgICBoID0gci5oZWlnaHQsCiAgICAgICAgICAgIHUgPSBpLndpZHRoIC8gaS5oZWlnaHQ7CiAgICAgICAgICBpZiAobnVsbCA9PSBsICYmIG51bGwgIT0gaCA/IGwgPSBoICogdSA6IG51bGwgPT0gaCAmJiBudWxsICE9IGwgPyBoID0gbCAvIHUgOiBudWxsID09IGwgJiYgbnVsbCA9PSBoICYmIChsID0gaS53aWR0aCwgaCA9IGkuaGVpZ2h0KSwgdGhpcy5zZXRUcmFuc2Zvcm0odCksIHIuc1dpZHRoICYmIHIuc0hlaWdodCkgewogICAgICAgICAgICB2YXIgYyA9IHIuc3ggfHwgMCwKICAgICAgICAgICAgICBmID0gci5zeSB8fCAwOwogICAgICAgICAgICB0LmRyYXdJbWFnZShpLCBjLCBmLCByLnNXaWR0aCwgci5zSGVpZ2h0LCBhLCBvLCBsLCBoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoci5zeCAmJiByLnN5KSB7CiAgICAgICAgICAgIHZhciBjID0gci5zeCwKICAgICAgICAgICAgICBmID0gci5zeSwKICAgICAgICAgICAgICBkID0gbCAtIGMsCiAgICAgICAgICAgICAgdiA9IGggLSBmOwogICAgICAgICAgICB0LmRyYXdJbWFnZShpLCBjLCBmLCBkLCB2LCBhLCBvLCBsLCBoKTsKICAgICAgICAgIH0gZWxzZSB0LmRyYXdJbWFnZShpLCBhLCBvLCBsLCBoKTsKICAgICAgICAgIHRoaXMucmVzdG9yZVRyYW5zZm9ybSh0KSwgbnVsbCAhPSByLnRleHQgJiYgdGhpcy5kcmF3UmVjdFRleHQodCwgdGhpcy5nZXRCb3VuZGluZ1JlY3QoKSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRCb3VuZGluZ1JlY3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuc3R5bGU7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlY3QgfHwgKHRoaXMuX3JlY3QgPSBuZXcgYSh0LnggfHwgMCwgdC55IHx8IDAsIHQud2lkdGggfHwgMCwgdC5oZWlnaHQgfHwgMCkpLCB0aGlzLl9yZWN0OwogICAgICB9CiAgICB9LCBvLmluaGVyaXRzKG4sIGkpOwogICAgdmFyIGwgPSBuOwogICAgdC5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDApLAogICAgICBpID0gcigxNiksCiAgICAgIGEgPSByKDMpLAogICAgICBvID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0ID0gdCB8fCB7fSwgaS5jYWxsKHRoaXMsIHQpOwogICAgICAgIGZvciAodmFyIGUgaW4gdCkgdC5oYXNPd25Qcm9wZXJ0eShlKSAmJiAodGhpc1tlXSA9IHRbZV0pOwogICAgICAgIHRoaXMuX2NoaWxkcmVuID0gW10sIHRoaXMuX19zdG9yYWdlID0gbnVsbCwgdGhpcy5fX2RpcnR5ID0gITA7CiAgICAgIH07CiAgICBvLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG8sCiAgICAgIGlzR3JvdXA6ICEwLAogICAgICB0eXBlOiAiZ3JvdXAiLAogICAgICBzaWxlbnQ6ICExLAogICAgICBjaGlsZHJlbjogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5zbGljZSgpOwogICAgICB9LAogICAgICBjaGlsZEF0OiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlblt0XTsKICAgICAgfSwKICAgICAgY2hpbGRPZk5hbWU6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMuX2NoaWxkcmVuLCByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIGlmIChlW3JdLm5hbWUgPT09IHQpIHJldHVybiBlW3JdOwogICAgICB9LAogICAgICBjaGlsZENvdW50OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsKICAgICAgfSwKICAgICAgYWRkOiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0ICYmIHQgIT09IHRoaXMgJiYgdC5wYXJlbnQgIT09IHRoaXMgJiYgKHRoaXMuX2NoaWxkcmVuLnB1c2godCksIHRoaXMuX2RvQWRkKHQpKSwgdGhpczsKICAgICAgfSwKICAgICAgYWRkQmVmb3JlOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmICh0ICYmIHQgIT09IHRoaXMgJiYgdC5wYXJlbnQgIT09IHRoaXMgJiYgZSAmJiBlLnBhcmVudCA9PT0gdGhpcykgewogICAgICAgICAgdmFyIHIgPSB0aGlzLl9jaGlsZHJlbiwKICAgICAgICAgICAgbiA9IHIuaW5kZXhPZihlKTsKICAgICAgICAgIG4gPj0gMCAmJiAoci5zcGxpY2UobiwgMCwgdCksIHRoaXMuX2RvQWRkKHQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIF9kb0FkZDogZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LnBhcmVudCAmJiB0LnBhcmVudC5yZW1vdmUodCksIHQucGFyZW50ID0gdGhpczsKICAgICAgICB2YXIgZSA9IHRoaXMuX19zdG9yYWdlLAogICAgICAgICAgciA9IHRoaXMuX196cjsKICAgICAgICBlICYmIGUgIT09IHQuX19zdG9yYWdlICYmIChlLmFkZFRvU3RvcmFnZSh0KSwgdCBpbnN0YW5jZW9mIG8gJiYgdC5hZGRDaGlsZHJlblRvU3RvcmFnZShlKSksIHIgJiYgci5yZWZyZXNoKCk7CiAgICAgIH0sCiAgICAgIHJlbW92ZTogZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuX196ciwKICAgICAgICAgIHIgPSB0aGlzLl9fc3RvcmFnZSwKICAgICAgICAgIGkgPSB0aGlzLl9jaGlsZHJlbiwKICAgICAgICAgIGEgPSBuLmluZGV4T2YoaSwgdCk7CiAgICAgICAgcmV0dXJuIGEgPCAwID8gdGhpcyA6IChpLnNwbGljZShhLCAxKSwgdC5wYXJlbnQgPSBudWxsLCByICYmIChyLmRlbEZyb21TdG9yYWdlKHQpLCB0IGluc3RhbmNlb2YgbyAmJiB0LmRlbENoaWxkcmVuRnJvbVN0b3JhZ2UocikpLCBlICYmIGUucmVmcmVzaCgpLCB0aGlzKTsKICAgICAgfSwKICAgICAgcmVtb3ZlQWxsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICBlLAogICAgICAgICAgciA9IHRoaXMuX2NoaWxkcmVuLAogICAgICAgICAgbiA9IHRoaXMuX19zdG9yYWdlOwogICAgICAgIGZvciAoZSA9IDA7IGUgPCByLmxlbmd0aDsgZSsrKSB0ID0gcltlXSwgbiAmJiAobi5kZWxGcm9tU3RvcmFnZSh0KSwgdCBpbnN0YW5jZW9mIG8gJiYgdC5kZWxDaGlsZHJlbkZyb21TdG9yYWdlKG4pKSwgdC5wYXJlbnQgPSBudWxsOwogICAgICAgIHJldHVybiByLmxlbmd0aCA9IDAsIHRoaXM7CiAgICAgIH0sCiAgICAgIGVhY2hDaGlsZDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBmb3IgKHZhciByID0gdGhpcy5fY2hpbGRyZW4sIG4gPSAwOyBuIDwgci5sZW5ndGg7IG4rKykgewogICAgICAgICAgdmFyIGkgPSByW25dOwogICAgICAgICAgdC5jYWxsKGUsIGksIG4pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgdHJhdmVyc2U6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0aGlzLl9jaGlsZHJlbi5sZW5ndGg7IHIrKykgewogICAgICAgICAgdmFyIG4gPSB0aGlzLl9jaGlsZHJlbltyXTsKICAgICAgICAgIHQuY2FsbChlLCBuKSwgImdyb3VwIiA9PT0gbi50eXBlICYmIG4udHJhdmVyc2UodCwgZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBhZGRDaGlsZHJlblRvU3RvcmFnZTogZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICB2YXIgciA9IHRoaXMuX2NoaWxkcmVuW2VdOwogICAgICAgICAgdC5hZGRUb1N0b3JhZ2UociksIHIgaW5zdGFuY2VvZiBvICYmIHIuYWRkQ2hpbGRyZW5Ub1N0b3JhZ2UodCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWxDaGlsZHJlbkZyb21TdG9yYWdlOiBmdW5jdGlvbiAodCkgewogICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciByID0gdGhpcy5fY2hpbGRyZW5bZV07CiAgICAgICAgICB0LmRlbEZyb21TdG9yYWdlKHIpLCByIGluc3RhbmNlb2YgbyAmJiByLmRlbENoaWxkcmVuRnJvbVN0b3JhZ2UodCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkaXJ0eTogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9fZGlydHkgPSAhMCwgdGhpcy5fX3pyICYmIHRoaXMuX196ci5yZWZyZXNoKCksIHRoaXM7CiAgICAgIH0sCiAgICAgIGdldEJvdW5kaW5nUmVjdDogZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlID0gbnVsbCwgciA9IG5ldyBhKDAsIDAsIDAsIDApLCBuID0gdCB8fCB0aGlzLl9jaGlsZHJlbiwgaSA9IFtdLCBvID0gMDsgbyA8IG4ubGVuZ3RoOyBvKyspIHsKICAgICAgICAgIHZhciBzID0gbltvXTsKICAgICAgICAgIGlmICghcy5pZ25vcmUgJiYgIXMuaW52aXNpYmxlKSB7CiAgICAgICAgICAgIHZhciBsID0gcy5nZXRCb3VuZGluZ1JlY3QoKSwKICAgICAgICAgICAgICBoID0gcy5nZXRMb2NhbFRyYW5zZm9ybShpKTsKICAgICAgICAgICAgaCA/IChyLmNvcHkobCksIHIuYXBwbHlUcmFuc2Zvcm0oaCksIGUgPSBlIHx8IHIuY2xvbmUoKSwgZS51bmlvbihyKSkgOiAoZSA9IGUgfHwgbC5jbG9uZSgpLCBlLnVuaW9uKGwpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUgfHwgcjsKICAgICAgfQogICAgfSwgbi5pbmhlcml0cyhvLCBpKTsKICAgIHZhciBzID0gbzsKICAgIHQuZXhwb3J0cyA9IHM7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxMiksCiAgICAgIGkgPSByKDApLAogICAgICBhID0gcig1KSwKICAgICAgbyA9IHIoMjApLAogICAgICBzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBuLmNhbGwodGhpcywgdCk7CiAgICAgIH07CiAgICBzLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IHMsCiAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgYnJ1c2g6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnN0eWxlOwogICAgICAgIHRoaXMuX19kaXJ0eSAmJiBvLm5vcm1hbGl6ZVRleHRTdHlsZShyLCAhMCksIHIuZmlsbCA9IHIuc3Ryb2tlID0gci5zaGFkb3dCbHVyID0gci5zaGFkb3dDb2xvciA9IHIuc2hhZG93T2Zmc2V0WCA9IHIuc2hhZG93T2Zmc2V0WSA9IG51bGw7CiAgICAgICAgdmFyIG4gPSByLnRleHQ7CiAgICAgICAgbnVsbCAhPSBuICYmIChuICs9ICIiKSwgci5iaW5kKHQsIHRoaXMsIGUpLCBvLm5lZWREcmF3VGV4dChuLCByKSAmJiAodGhpcy5zZXRUcmFuc2Zvcm0odCksIG8ucmVuZGVyVGV4dCh0aGlzLCB0LCBuLCByKSwgdGhpcy5yZXN0b3JlVHJhbnNmb3JtKHQpKTsKICAgICAgfSwKICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLnN0eWxlOwogICAgICAgIGlmICh0aGlzLl9fZGlydHkgJiYgby5ub3JtYWxpemVUZXh0U3R5bGUodCwgITApLCAhdGhpcy5fcmVjdCkgewogICAgICAgICAgdmFyIGUgPSB0LnRleHQ7CiAgICAgICAgICBudWxsICE9IGUgPyBlICs9ICIiIDogZSA9ICIiOwogICAgICAgICAgdmFyIHIgPSBhLmdldEJvdW5kaW5nUmVjdCh0LnRleHQgKyAiIiwgdC5mb250LCB0LnRleHRBbGlnbiwgdC50ZXh0VmVydGljYWxBbGlnbiwgdC50ZXh0UGFkZGluZywgdC5yaWNoKTsKICAgICAgICAgIGlmIChyLnggKz0gdC54IHx8IDAsIHIueSArPSB0LnkgfHwgMCwgby5nZXRTdHJva2UodC50ZXh0U3Ryb2tlLCB0LnRleHRTdHJva2VXaWR0aCkpIHsKICAgICAgICAgICAgdmFyIG4gPSB0LnRleHRTdHJva2VXaWR0aDsKICAgICAgICAgICAgci54IC09IG4gLyAyLCByLnkgLT0gbiAvIDIsIHIud2lkdGggKz0gbiwgci5oZWlnaHQgKz0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3JlY3QgPSByOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fcmVjdDsKICAgICAgfQogICAgfSwgaS5pbmhlcml0cyhzLCBuKTsKICAgIHZhciBsID0gczsKICAgIHQuZXhwb3J0cyA9IGw7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxKSwKICAgICAgaSA9IG4uZXh0ZW5kKHsKICAgICAgICB0eXBlOiAiY2lyY2xlIiwKICAgICAgICBzaGFwZTogewogICAgICAgICAgY3g6IDAsCiAgICAgICAgICBjeTogMCwKICAgICAgICAgIHI6IDAKICAgICAgICB9LAogICAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgIHIgJiYgdC5tb3ZlVG8oZS5jeCArIGUuciwgZS5jeSksIHQuYXJjKGUuY3gsIGUuY3ksIGUuciwgMCwgMiAqIE1hdGguUEksICEwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgdC5leHBvcnRzID0gaTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICBpID0gcig2MyksCiAgICAgIGEgPSBuLmV4dGVuZCh7CiAgICAgICAgdHlwZTogInNlY3RvciIsCiAgICAgICAgc2hhcGU6IHsKICAgICAgICAgIGN4OiAwLAogICAgICAgICAgY3k6IDAsCiAgICAgICAgICByMDogMCwKICAgICAgICAgIHI6IDAsCiAgICAgICAgICBzdGFydEFuZ2xlOiAwLAogICAgICAgICAgZW5kQW5nbGU6IDIgKiBNYXRoLlBJLAogICAgICAgICAgY2xvY2t3aXNlOiAhMAogICAgICAgIH0sCiAgICAgICAgYnJ1c2g6IGkobi5wcm90b3R5cGUuYnJ1c2gpLAogICAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIHZhciByID0gZS5jeCwKICAgICAgICAgICAgbiA9IGUuY3ksCiAgICAgICAgICAgIGkgPSBNYXRoLm1heChlLnIwIHx8IDAsIDApLAogICAgICAgICAgICBhID0gTWF0aC5tYXgoZS5yLCAwKSwKICAgICAgICAgICAgbyA9IGUuc3RhcnRBbmdsZSwKICAgICAgICAgICAgcyA9IGUuZW5kQW5nbGUsCiAgICAgICAgICAgIGwgPSBlLmNsb2Nrd2lzZSwKICAgICAgICAgICAgaCA9IE1hdGguY29zKG8pLAogICAgICAgICAgICB1ID0gTWF0aC5zaW4obyk7CiAgICAgICAgICB0Lm1vdmVUbyhoICogaSArIHIsIHUgKiBpICsgbiksIHQubGluZVRvKGggKiBhICsgciwgdSAqIGEgKyBuKSwgdC5hcmMociwgbiwgYSwgbywgcywgIWwpLCB0LmxpbmVUbyhNYXRoLmNvcyhzKSAqIGkgKyByLCBNYXRoLnNpbihzKSAqIGkgKyBuKSwgMCAhPT0gaSAmJiB0LmFyYyhyLCBuLCBpLCBzLCBvLCBsKSwgdC5jbG9zZVBhdGgoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgdC5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiBpLmJyb3dzZXIuaWUgJiYgaS5icm93c2VyLnZlcnNpb24gPj0gMTEgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICByID0gdGhpcy5fX2NsaXBQYXRocywKICAgICAgICAgIG4gPSB0aGlzLnN0eWxlOwogICAgICAgIGlmIChyKSBmb3IgKHZhciBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBvID0gcltpXSwKICAgICAgICAgICAgcyA9IG8gJiYgby5zaGFwZSwKICAgICAgICAgICAgbCA9IG8gJiYgby50eXBlOwogICAgICAgICAgaWYgKHMgJiYgKCJzZWN0b3IiID09PSBsICYmIHMuc3RhcnRBbmdsZSA9PT0gcy5lbmRBbmdsZSB8fCAicmVjdCIgPT09IGwgJiYgKCFzLndpZHRoIHx8ICFzLmhlaWdodCkpKSB7CiAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgYS5sZW5ndGg7IGgrKykgYVtoXVsyXSA9IG5bYVtoXVswXV0sIG5bYVtoXVswXV0gPSBhW2hdWzFdOwogICAgICAgICAgICBlID0gITA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBlKSBmb3IgKHZhciBoID0gMDsgaCA8IGEubGVuZ3RoOyBoKyspIG5bYVtoXVswXV0gPSBhW2hdWzJdOwogICAgICB9IDogdDsKICAgIH0KICAgIHZhciBpID0gcigxNSksCiAgICAgIGEgPSBbWyJzaGFkb3dCbHVyIiwgMF0sIFsic2hhZG93Q29sb3IiLCAiIzAwMCJdLCBbInNoYWRvd09mZnNldFgiLCAwXSwgWyJzaGFkb3dPZmZzZXRZIiwgMF1dOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICBpID0gbi5leHRlbmQoewogICAgICAgIHR5cGU6ICJyaW5nIiwKICAgICAgICBzaGFwZTogewogICAgICAgICAgY3g6IDAsCiAgICAgICAgICBjeTogMCwKICAgICAgICAgIHI6IDAsCiAgICAgICAgICByMDogMAogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgdmFyIHIgPSBlLmN4LAogICAgICAgICAgICBuID0gZS5jeSwKICAgICAgICAgICAgaSA9IDIgKiBNYXRoLlBJOwogICAgICAgICAgdC5tb3ZlVG8ociArIGUuciwgbiksIHQuYXJjKHIsIG4sIGUuciwgMCwgaSwgITEpLCB0Lm1vdmVUbyhyICsgZS5yMCwgbiksIHQuYXJjKHIsIG4sIGUucjAsIDAsIGksICEwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgdC5leHBvcnRzID0gaTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICBpID0gcigyMyksCiAgICAgIGEgPSBuLmV4dGVuZCh7CiAgICAgICAgdHlwZTogInBvbHlnb24iLAogICAgICAgIHNoYXBlOiB7CiAgICAgICAgICBwb2ludHM6IG51bGwsCiAgICAgICAgICBzbW9vdGg6ICExLAogICAgICAgICAgc21vb3RoQ29uc3RyYWludDogbnVsbAogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgaS5idWlsZFBhdGgodCwgZSwgITApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIsIG4sIGksIGEsIG8pIHsKICAgICAgdmFyIHMgPSAuNSAqIChyIC0gdCksCiAgICAgICAgbCA9IC41ICogKG4gLSBlKTsKICAgICAgcmV0dXJuICgyICogKGUgLSByKSArIHMgKyBsKSAqIG8gKyAoLTMgKiAoZSAtIHIpIC0gMiAqIHMgLSBsKSAqIGEgKyBzICogaSArIGU7CiAgICB9CiAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgZm9yICh2YXIgciA9IHQubGVuZ3RoLCBpID0gW10sIGEgPSAwLCBzID0gMTsgcyA8IHI7IHMrKykgYSArPSBvKHRbcyAtIDFdLCB0W3NdKTsKICAgICAgdmFyIGwgPSBhIC8gMjsKICAgICAgbCA9IGwgPCByID8gciA6IGw7CiAgICAgIGZvciAodmFyIHMgPSAwOyBzIDwgbDsgcysrKSB7CiAgICAgICAgdmFyIGgsCiAgICAgICAgICB1LAogICAgICAgICAgYywKICAgICAgICAgIGYgPSBzIC8gKGwgLSAxKSAqIChlID8gciA6IHIgLSAxKSwKICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGYpLAogICAgICAgICAgdiA9IGYgLSBkLAogICAgICAgICAgZyA9IHRbZCAlIHJdOwogICAgICAgIGUgPyAoaCA9IHRbKGQgLSAxICsgcikgJSByXSwgdSA9IHRbKGQgKyAxKSAlIHJdLCBjID0gdFsoZCArIDIpICUgcl0pIDogKGggPSB0WzAgPT09IGQgPyBkIDogZCAtIDFdLCB1ID0gdFtkID4gciAtIDIgPyByIC0gMSA6IGQgKyAxXSwgYyA9IHRbZCA+IHIgLSAzID8gciAtIDEgOiBkICsgMl0pOwogICAgICAgIHZhciBwID0gdiAqIHYsCiAgICAgICAgICBtID0gdiAqIHA7CiAgICAgICAgaS5wdXNoKFtuKGhbMF0sIGdbMF0sIHVbMF0sIGNbMF0sIHYsIHAsIG0pLCBuKGhbMV0sIGdbMV0sIHVbMV0sIGNbMV0sIHYsIHAsIG0pXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGk7CiAgICB9CiAgICB2YXIgYSA9IHIoMiksCiAgICAgIG8gPSBhLmRpc3RhbmNlOwogICAgdC5leHBvcnRzID0gaTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByLCBuKSB7CiAgICAgIHZhciBpLAogICAgICAgIGYsCiAgICAgICAgZCwKICAgICAgICB2LAogICAgICAgIGcgPSBbXSwKICAgICAgICBwID0gW10sCiAgICAgICAgbSA9IFtdLAogICAgICAgIHggPSBbXTsKICAgICAgaWYgKG4pIHsKICAgICAgICBkID0gWzEgLyAwLCAxIC8gMF0sIHYgPSBbLTEgLyAwLCAtMSAvIDBdOwogICAgICAgIGZvciAodmFyIHkgPSAwLCB3ID0gdC5sZW5ndGg7IHkgPCB3OyB5KyspIGEoZCwgZCwgdFt5XSksIG8odiwgdiwgdFt5XSk7CiAgICAgICAgYShkLCBkLCBuWzBdKSwgbyh2LCB2LCBuWzFdKTsKICAgICAgfQogICAgICBmb3IgKHZhciB5ID0gMCwgdyA9IHQubGVuZ3RoOyB5IDwgdzsgeSsrKSB7CiAgICAgICAgdmFyIF8gPSB0W3ldOwogICAgICAgIGlmIChyKSBpID0gdFt5ID8geSAtIDEgOiB3IC0gMV0sIGYgPSB0Wyh5ICsgMSkgJSB3XTtlbHNlIHsKICAgICAgICAgIGlmICgwID09PSB5IHx8IHkgPT09IHcgLSAxKSB7CiAgICAgICAgICAgIGcucHVzaCh1KHRbeV0pKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpID0gdFt5IC0gMV0sIGYgPSB0W3kgKyAxXTsKICAgICAgICB9CiAgICAgICAgYyhwLCBmLCBpKSwgcyhwLCBwLCBlKTsKICAgICAgICB2YXIgYiA9IGwoXywgaSksCiAgICAgICAgICBTID0gbChfLCBmKSwKICAgICAgICAgIE0gPSBiICsgUzsKICAgICAgICAwICE9PSBNICYmIChiIC89IE0sIFMgLz0gTSksIHMobSwgcCwgLWIpLCBzKHgsIHAsIFMpOwogICAgICAgIHZhciBUID0gaChbXSwgXywgbSksCiAgICAgICAgICBrID0gaChbXSwgXywgeCk7CiAgICAgICAgbiAmJiAobyhULCBULCBkKSwgYShULCBULCB2KSwgbyhrLCBrLCBkKSwgYShrLCBrLCB2KSksIGcucHVzaChUKSwgZy5wdXNoKGspOwogICAgICB9CiAgICAgIHJldHVybiByICYmIGcucHVzaChnLnNoaWZ0KCkpLCBnOwogICAgfQogICAgdmFyIGkgPSByKDIpLAogICAgICBhID0gaS5taW4sCiAgICAgIG8gPSBpLm1heCwKICAgICAgcyA9IGkuc2NhbGUsCiAgICAgIGwgPSBpLmRpc3RhbmNlLAogICAgICBoID0gaS5hZGQsCiAgICAgIHUgPSBpLmNsb25lLAogICAgICBjID0gaS5zdWI7CiAgICB0LmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMSksCiAgICAgIGkgPSByKDIzKSwKICAgICAgYSA9IG4uZXh0ZW5kKHsKICAgICAgICB0eXBlOiAicG9seWxpbmUiLAogICAgICAgIHNoYXBlOiB7CiAgICAgICAgICBwb2ludHM6IG51bGwsCiAgICAgICAgICBzbW9vdGg6ICExLAogICAgICAgICAgc21vb3RoQ29uc3RyYWludDogbnVsbAogICAgICAgIH0sCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHN0cm9rZTogIiMwMDAiLAogICAgICAgICAgZmlsbDogbnVsbAogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgaS5idWlsZFBhdGgodCwgZSwgITEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMSksCiAgICAgIGkgPSByKDIxKSwKICAgICAgYSA9IG4uZXh0ZW5kKHsKICAgICAgICB0eXBlOiAicmVjdCIsCiAgICAgICAgc2hhcGU6IHsKICAgICAgICAgIHI6IDAsCiAgICAgICAgICB4OiAwLAogICAgICAgICAgeTogMCwKICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgaGVpZ2h0OiAwCiAgICAgICAgfSwKICAgICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICB2YXIgciA9IGUueCwKICAgICAgICAgICAgbiA9IGUueSwKICAgICAgICAgICAgYSA9IGUud2lkdGgsCiAgICAgICAgICAgIG8gPSBlLmhlaWdodDsKICAgICAgICAgIGUuciA/IGkuYnVpbGRQYXRoKHQsIGUpIDogdC5yZWN0KHIsIG4sIGEsIG8pLCB0LmNsb3NlUGF0aCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMSksCiAgICAgIGkgPSBuLmV4dGVuZCh7CiAgICAgICAgdHlwZTogImxpbmUiLAogICAgICAgIHNoYXBlOiB7CiAgICAgICAgICB4MTogMCwKICAgICAgICAgIHkxOiAwLAogICAgICAgICAgeDI6IDAsCiAgICAgICAgICB5MjogMCwKICAgICAgICAgIHBlcmNlbnQ6IDEKICAgICAgICB9LAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBzdHJva2U6ICIjMDAwIiwKICAgICAgICAgIGZpbGw6IG51bGwKICAgICAgICB9LAogICAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIHZhciByID0gZS54MSwKICAgICAgICAgICAgbiA9IGUueTEsCiAgICAgICAgICAgIGkgPSBlLngyLAogICAgICAgICAgICBhID0gZS55MiwKICAgICAgICAgICAgbyA9IGUucGVyY2VudDsKICAgICAgICAgIDAgIT09IG8gJiYgKHQubW92ZVRvKHIsIG4pLCBvIDwgMSAmJiAoaSA9IHIgKiAoMSAtIG8pICsgaSAqIG8sIGEgPSBuICogKDEgLSBvKSArIGEgKiBvKSwgdC5saW5lVG8oaSwgYSkpOwogICAgICAgIH0sCiAgICAgICAgcG9pbnRBdDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gdGhpcy5zaGFwZTsKICAgICAgICAgIHJldHVybiBbZS54MSAqICgxIC0gdCkgKyBlLngyICogdCwgZS55MSAqICgxIC0gdCkgKyBlLnkyICogdF07CiAgICAgICAgfQogICAgICB9KTsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgcikgewogICAgICB2YXIgbiA9IHQuY3B4MiwKICAgICAgICBpID0gdC5jcHkyOwogICAgICByZXR1cm4gbnVsbCA9PT0gbiB8fCBudWxsID09PSBpID8gWyhyID8gZiA6IHUpKHQueDEsIHQuY3B4MSwgdC5jcHgyLCB0LngyLCBlKSwgKHIgPyBmIDogdSkodC55MSwgdC5jcHkxLCB0LmNweTIsIHQueTIsIGUpXSA6IFsociA/IGMgOiBoKSh0LngxLCB0LmNweDEsIHQueDIsIGUpLCAociA/IGMgOiBoKSh0LnkxLCB0LmNweTEsIHQueTIsIGUpXTsKICAgIH0KICAgIHZhciBpID0gcigxKSwKICAgICAgYSA9IHIoMiksCiAgICAgIG8gPSByKDQpLAogICAgICBzID0gby5xdWFkcmF0aWNTdWJkaXZpZGUsCiAgICAgIGwgPSBvLmN1YmljU3ViZGl2aWRlLAogICAgICBoID0gby5xdWFkcmF0aWNBdCwKICAgICAgdSA9IG8uY3ViaWNBdCwKICAgICAgYyA9IG8ucXVhZHJhdGljRGVyaXZhdGl2ZUF0LAogICAgICBmID0gby5jdWJpY0Rlcml2YXRpdmVBdCwKICAgICAgZCA9IFtdLAogICAgICB2ID0gaS5leHRlbmQoewogICAgICAgIHR5cGU6ICJiZXppZXItY3VydmUiLAogICAgICAgIHNoYXBlOiB7CiAgICAgICAgICB4MTogMCwKICAgICAgICAgIHkxOiAwLAogICAgICAgICAgeDI6IDAsCiAgICAgICAgICB5MjogMCwKICAgICAgICAgIGNweDE6IDAsCiAgICAgICAgICBjcHkxOiAwLAogICAgICAgICAgcGVyY2VudDogMQogICAgICAgIH0sCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHN0cm9rZTogIiMwMDAiLAogICAgICAgICAgZmlsbDogbnVsbAogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgdmFyIHIgPSBlLngxLAogICAgICAgICAgICBuID0gZS55MSwKICAgICAgICAgICAgaSA9IGUueDIsCiAgICAgICAgICAgIGEgPSBlLnkyLAogICAgICAgICAgICBvID0gZS5jcHgxLAogICAgICAgICAgICBoID0gZS5jcHkxLAogICAgICAgICAgICB1ID0gZS5jcHgyLAogICAgICAgICAgICBjID0gZS5jcHkyLAogICAgICAgICAgICBmID0gZS5wZXJjZW50OwogICAgICAgICAgMCAhPT0gZiAmJiAodC5tb3ZlVG8ociwgbiksIG51bGwgPT0gdSB8fCBudWxsID09IGMgPyAoZiA8IDEgJiYgKHMociwgbywgaSwgZiwgZCksIG8gPSBkWzFdLCBpID0gZFsyXSwgcyhuLCBoLCBhLCBmLCBkKSwgaCA9IGRbMV0sIGEgPSBkWzJdKSwgdC5xdWFkcmF0aWNDdXJ2ZVRvKG8sIGgsIGksIGEpKSA6IChmIDwgMSAmJiAobChyLCBvLCB1LCBpLCBmLCBkKSwgbyA9IGRbMV0sIHUgPSBkWzJdLCBpID0gZFszXSwgbChuLCBoLCBjLCBhLCBmLCBkKSwgaCA9IGRbMV0sIGMgPSBkWzJdLCBhID0gZFszXSksIHQuYmV6aWVyQ3VydmVUbyhvLCBoLCB1LCBjLCBpLCBhKSkpOwogICAgICAgIH0sCiAgICAgICAgcG9pbnRBdDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBuKHRoaXMuc2hhcGUsIHQsICExKTsKICAgICAgICB9LAogICAgICAgIHRhbmdlbnRBdDogZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gbih0aGlzLnNoYXBlLCB0LCAhMCk7CiAgICAgICAgICByZXR1cm4gYS5ub3JtYWxpemUoZSwgZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIHQuZXhwb3J0cyA9IHY7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxKSwKICAgICAgaSA9IG4uZXh0ZW5kKHsKICAgICAgICB0eXBlOiAiYXJjIiwKICAgICAgICBzaGFwZTogewogICAgICAgICAgY3g6IDAsCiAgICAgICAgICBjeTogMCwKICAgICAgICAgIHI6IDAsCiAgICAgICAgICBzdGFydEFuZ2xlOiAwLAogICAgICAgICAgZW5kQW5nbGU6IDIgKiBNYXRoLlBJLAogICAgICAgICAgY2xvY2t3aXNlOiAhMAogICAgICAgIH0sCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHN0cm9rZTogIiMwMDAiLAogICAgICAgICAgZmlsbDogbnVsbAogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgdmFyIHIgPSBlLmN4LAogICAgICAgICAgICBuID0gZS5jeSwKICAgICAgICAgICAgaSA9IE1hdGgubWF4KGUuciwgMCksCiAgICAgICAgICAgIGEgPSBlLnN0YXJ0QW5nbGUsCiAgICAgICAgICAgIG8gPSBlLmVuZEFuZ2xlLAogICAgICAgICAgICBzID0gZS5jbG9ja3dpc2UsCiAgICAgICAgICAgIGwgPSBNYXRoLmNvcyhhKSwKICAgICAgICAgICAgaCA9IE1hdGguc2luKGEpOwogICAgICAgICAgdC5tb3ZlVG8obCAqIGkgKyByLCBoICogaSArIG4pLCB0LmFyYyhyLCBuLCBpLCBhLCBvLCAhcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxKSwKICAgICAgaSA9IG4uZXh0ZW5kKHsKICAgICAgICB0eXBlOiAiY29tcG91bmQiLAogICAgICAgIHNoYXBlOiB7CiAgICAgICAgICBwYXRoczogbnVsbAogICAgICAgIH0sCiAgICAgICAgX3VwZGF0ZVBhdGhEaXJ0eTogZnVuY3Rpb24gKCkgewogICAgICAgICAgZm9yICh2YXIgdCA9IHRoaXMuX19kaXJ0eVBhdGgsIGUgPSB0aGlzLnNoYXBlLnBhdGhzLCByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIHQgPSB0IHx8IGVbcl0uX19kaXJ0eVBhdGg7CiAgICAgICAgICB0aGlzLl9fZGlydHlQYXRoID0gdCwgdGhpcy5fX2RpcnR5ID0gdGhpcy5fX2RpcnR5IHx8IHQ7CiAgICAgICAgfSwKICAgICAgICBiZWZvcmVCcnVzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy5fdXBkYXRlUGF0aERpcnR5KCk7CiAgICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5zaGFwZS5wYXRocyB8fCBbXSwgZSA9IHRoaXMuZ2V0R2xvYmFsU2NhbGUoKSwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB0W3JdLnBhdGggfHwgdFtyXS5jcmVhdGVQYXRoUHJveHkoKSwgdFtyXS5wYXRoLnNldFNjYWxlKGVbMF0sIGVbMV0pOwogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgZm9yICh2YXIgciA9IGUucGF0aHMgfHwgW10sIG4gPSAwOyBuIDwgci5sZW5ndGg7IG4rKykgcltuXS5idWlsZFBhdGgodCwgcltuXS5zaGFwZSwgITApOwogICAgICAgIH0sCiAgICAgICAgYWZ0ZXJCcnVzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgZm9yICh2YXIgdCA9IHRoaXMuc2hhcGUucGF0aHMgfHwgW10sIGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgdFtlXS5fX2RpcnR5UGF0aCA9ICExOwogICAgICAgIH0sCiAgICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlUGF0aERpcnR5KCksIG4ucHJvdG90eXBlLmdldEJvdW5kaW5nUmVjdC5jYWxsKHRoaXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB0LmV4cG9ydHMgPSBpOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMCksCiAgICAgIGkgPSByKDI0KSwKICAgICAgYSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBhLCBvKSB7CiAgICAgICAgdGhpcy54ID0gbnVsbCA9PSB0ID8gMCA6IHQsIHRoaXMueSA9IG51bGwgPT0gZSA/IDAgOiBlLCB0aGlzLngyID0gbnVsbCA9PSByID8gMSA6IHIsIHRoaXMueTIgPSBudWxsID09IG4gPyAwIDogbiwgdGhpcy50eXBlID0gImxpbmVhciIsIHRoaXMuZ2xvYmFsID0gbyB8fCAhMSwgaS5jYWxsKHRoaXMsIGEpOwogICAgICB9OwogICAgYS5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBhCiAgICB9LCBuLmluaGVyaXRzKGEsIGkpOwogICAgdmFyIG8gPSBhOwogICAgdC5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDApLAogICAgICBpID0gcigyNCksCiAgICAgIGEgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgYSkgewogICAgICAgIHRoaXMueCA9IG51bGwgPT0gdCA/IC41IDogdCwgdGhpcy55ID0gbnVsbCA9PSBlID8gLjUgOiBlLCB0aGlzLnIgPSBudWxsID09IHIgPyAuNSA6IHIsIHRoaXMudHlwZSA9ICJyYWRpYWwiLCB0aGlzLmdsb2JhbCA9IGEgfHwgITEsIGkuY2FsbCh0aGlzLCBuKTsKICAgICAgfTsKICAgIGEucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogYQogICAgfSwgbi5pbmhlcml0cyhhLCBpKTsKICAgIHZhciBvID0gYTsKICAgIHQuZXhwb3J0cyA9IG87CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxMSksCiAgICAgIGkgPSBuKFtbImZpbGwiLCAiY29sb3IiXSwgWyJzdHJva2UiLCAiYm9yZGVyQ29sb3IiXSwgWyJsaW5lV2lkdGgiLCAiYm9yZGVyV2lkdGgiXSwgWyJvcGFjaXR5Il0sIFsic2hhZG93Qmx1ciJdLCBbInNoYWRvd09mZnNldFgiXSwgWyJzaGFkb3dPZmZzZXRZIl0sIFsic2hhZG93Q29sb3IiXSwgWyJ0ZXh0UG9zaXRpb24iXSwgWyJ0ZXh0QWxpZ24iXV0pLAogICAgICBhID0gewogICAgICAgIGdldEl0ZW1TdHlsZTogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIHZhciByID0gaSh0aGlzLCB0LCBlKSwKICAgICAgICAgICAgbiA9IHRoaXMuZ2V0Qm9yZGVyTGluZURhc2goKTsKICAgICAgICAgIHJldHVybiBuICYmIChyLmxpbmVEYXNoID0gbiksIHI7CiAgICAgICAgfSwKICAgICAgICBnZXRCb3JkZXJMaW5lRGFzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLmdldCgiYm9yZGVyVHlwZSIpOwogICAgICAgICAgcmV0dXJuICJzb2xpZCIgPT09IHQgfHwgbnVsbCA9PSB0ID8gbnVsbCA6ICJkYXNoZWQiID09PSB0ID8gWzUsIDVdIDogWzEsIDFdOwogICAgICAgIH0KICAgICAgfTsKICAgIHQuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcig3KTsKICAgIG4uZXh0ZW5kQ2hhcnRWaWV3KHsKICAgICAgdHlwZTogIndvcmRDbG91ZCIsCiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICB2YXIgaSA9IHRoaXMuZ3JvdXA7CiAgICAgICAgaS5yZW1vdmVBbGwoKTsKICAgICAgICB2YXIgYSA9IHQuZ2V0RGF0YSgpLAogICAgICAgICAgbyA9IHQuZ2V0KCJncmlkU2l6ZSIpOwogICAgICAgIHQubGF5b3V0SW5zdGFuY2Uub25kcmF3ID0gZnVuY3Rpb24gKHQsIGUsIHIsIHMpIHsKICAgICAgICAgIHZhciBsID0gYS5nZXRJdGVtTW9kZWwociksCiAgICAgICAgICAgIGggPSBsLmdldE1vZGVsKCJ0ZXh0U3R5bGUubm9ybWFsIiksCiAgICAgICAgICAgIHUgPSBsLmdldE1vZGVsKCJ0ZXh0U3R5bGUuZW1waGFzaXMiKSwKICAgICAgICAgICAgYyA9IG5ldyBuLmdyYXBoaWMuVGV4dCh7CiAgICAgICAgICAgICAgc3R5bGU6IG4uZ3JhcGhpYy5zZXRUZXh0U3R5bGUoe30sIGgsIHsKICAgICAgICAgICAgICAgIHg6IHMuaW5mby5maWxsVGV4dE9mZnNldFgsCiAgICAgICAgICAgICAgICB5OiBzLmluZm8uZmlsbFRleHRPZmZzZXRZICsgLjUgKiBlLAogICAgICAgICAgICAgICAgdGV4dDogdCwKICAgICAgICAgICAgICAgIHRleHRCYXNlbGluZTogIm1pZGRsZSIsCiAgICAgICAgICAgICAgICB0ZXh0RmlsbDogYS5nZXRJdGVtVmlzdWFsKHIsICJjb2xvciIpLAogICAgICAgICAgICAgICAgZm9udFNpemU6IGUKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBzY2FsZTogWzEgLyBzLmluZm8ubXUsIDEgLyBzLmluZm8ubXVdLAogICAgICAgICAgICAgIHBvc2l0aW9uOiBbKHMuZ3ggKyBzLmluZm8uZ3cgLyAyKSAqIG8sIChzLmd5ICsgcy5pbmZvLmdoIC8gMikgKiBvXSwKICAgICAgICAgICAgICByb3RhdGlvbjogcy5yb3QKICAgICAgICAgICAgfSk7CiAgICAgICAgICBpLmFkZChjKSwgYS5zZXRJdGVtR3JhcGhpY0VsKHIsIGMpLCBuLmdyYXBoaWMuc2V0SG92ZXJTdHlsZShjLCBuLmdyYXBoaWMuc2V0VGV4dFN0eWxlKHt9LCB1LCBudWxsLCB7CiAgICAgICAgICAgIGZvck1lcmdlOiAhMAogICAgICAgICAgfSwgITApKTsKICAgICAgICB9LCB0aGlzLl9tb2RlbCA9IHQ7CiAgICAgIH0sCiAgICAgIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuZ3JvdXAucmVtb3ZlQWxsKCksIHRoaXMuX21vZGVsLmxheW91dEluc3RhbmNlLmRpc3Bvc2UoKTsKICAgICAgfSwKICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX21vZGVsLmxheW91dEluc3RhbmNlLmRpc3Bvc2UoKTsKICAgICAgfQogICAgfSk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbiwgaTsgLyohCiAgICAgICAgICAgICAgKiB3b3JkY2xvdWQyLmpzCiAgICAgICAgICAgICAgKiBodHRwOi8vdGltZHJlYW0ub3JnL3dvcmRjbG91ZDIuanMvCiAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICogQ29weXJpZ2h0IDIwMTEgLSAyMDEzIFRpbSBDaGllbgogICAgICAgICAgICAgICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAgICAgICAgICAgICAgKi8KICAgIHdpbmRvdy5zZXRJbW1lZGlhdGUgfHwgKHdpbmRvdy5zZXRJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB3aW5kb3cubXNTZXRJbW1lZGlhdGUgfHwgd2luZG93LndlYmtpdFNldEltbWVkaWF0ZSB8fCB3aW5kb3cubW96U2V0SW1tZWRpYXRlIHx8IHdpbmRvdy5vU2V0SW1tZWRpYXRlIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXdpbmRvdy5wb3N0TWVzc2FnZSB8fCAhd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHJldHVybiBudWxsOwogICAgICAgIHZhciB0ID0gW3ZvaWQgMF0sCiAgICAgICAgICBlID0gInplcm8tdGltZW91dC1tZXNzYWdlIiwKICAgICAgICAgIHIgPSBmdW5jdGlvbiAocikgewogICAgICAgICAgICB2YXIgbiA9IHQubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gdC5wdXNoKHIpLCB3aW5kb3cucG9zdE1lc3NhZ2UoZSArIG4udG9TdHJpbmcoMzYpLCAiKiIpLCBuOwogICAgICAgICAgfTsKICAgICAgICByZXR1cm4gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBmdW5jdGlvbiAocikgewogICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiByLmRhdGEgJiYgci5kYXRhLnN1YnN0cigwLCBlLmxlbmd0aCkgPT09IGUpIHsKICAgICAgICAgICAgci5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgdmFyIG4gPSBwYXJzZUludChyLmRhdGEuc3Vic3RyKGUubGVuZ3RoKSwgMzYpOwogICAgICAgICAgICB0W25dICYmICh0W25dKCksIHRbbl0gPSB2b2lkIDApOwogICAgICAgICAgfQogICAgICAgIH0sICEwKSwgd2luZG93LmNsZWFySW1tZWRpYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHRbZV0gJiYgKHRbZV0gPSB2b2lkIDApOwogICAgICAgIH0sIHI7CiAgICAgIH0oKSB8fCBmdW5jdGlvbiAodCkgewogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHQsIDApOwogICAgICB9OwogICAgfSgpKSwgd2luZG93LmNsZWFySW1tZWRpYXRlIHx8ICh3aW5kb3cuY2xlYXJJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB3aW5kb3cubXNDbGVhckltbWVkaWF0ZSB8fCB3aW5kb3cud2Via2l0Q2xlYXJJbW1lZGlhdGUgfHwgd2luZG93Lm1vekNsZWFySW1tZWRpYXRlIHx8IHdpbmRvdy5vQ2xlYXJJbW1lZGlhdGUgfHwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHQpOwogICAgICB9OwogICAgfSgpKSwgZnVuY3Rpb24gKHIpIHsKICAgICAgdmFyIGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgICAgaWYgKCF0IHx8ICF0LmdldENvbnRleHQpIHJldHVybiAhMTsKICAgICAgICAgIHZhciBlID0gdC5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgcmV0dXJuICEhZS5nZXRJbWFnZURhdGEgJiYgISFlLmZpbGxUZXh0ICYmICEhQXJyYXkucHJvdG90eXBlLnNvbWUgJiYgISFBcnJheS5wcm90b3R5cGUucHVzaDsKICAgICAgICB9KCksCiAgICAgICAgbyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQsIGUsIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKS5nZXRDb250ZXh0KCIyZCIpLCBuID0gMjA7IG47KSB7CiAgICAgICAgICAgICAgaWYgKHIuZm9udCA9IG4udG9TdHJpbmcoMTApICsgInB4IHNhbnMtc2VyaWYiLCByLm1lYXN1cmVUZXh0KCLvvLciKS53aWR0aCA9PT0gdCAmJiByLm1lYXN1cmVUZXh0KCJtIikud2lkdGggPT09IGUpIHJldHVybiBuICsgMTsKICAgICAgICAgICAgICB0ID0gci5tZWFzdXJlVGV4dCgi77y3Iikud2lkdGgsIGUgPSByLm1lYXN1cmVUZXh0KCJtIikud2lkdGgsIG4tLTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KICAgICAgICB9KCksCiAgICAgICAgcyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBmb3IgKHZhciBlLCByLCBuID0gdC5sZW5ndGg7IG47IGUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuKSwgciA9IHRbLS1uXSwgdFtuXSA9IHRbZV0sIHRbZV0gPSByKTsKICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0sCiAgICAgICAgbCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICAgICAgcmV0dXJuICJoc2woIiArICgzNjAgKiBNYXRoLnJhbmRvbSgpKS50b0ZpeGVkKCkgKyAiLCIgKyAoMzAgKiBNYXRoLnJhbmRvbSgpICsgNzApLnRvRml4ZWQoKSArICIlLCIgKyAoTWF0aC5yYW5kb20oKSAqIChlIC0gdCkgKyB0KS50b0ZpeGVkKCkgKyAiJSkiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgQXJyYXkuaXNBcnJheSh0KSB8fCAodCA9IFt0XSksIHQuZm9yRWFjaChmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSkgewogICAgICAgICAgICAgICAgaWYgKHRbcl0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKSwgIXRbcl0pIHRocm93ICJUaGUgZWxlbWVudCBpZCBzcGVjaWZpZWQgaXMgbm90IGZvdW5kLiI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghZS50YWdOYW1lICYmICFlLmFwcGVuZENoaWxkKSB0aHJvdyAiWW91IG11c3QgcGFzcyB2YWxpZCBIVE1MIGVsZW1lbnRzLCBvciBJRCBvZiB0aGUgZWxlbWVudC4iOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG4gPSB7CiAgICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgICAgZm9udEZhbWlseTogJyJUcmVidWNoZXQgTVMiLCAiSGVpdGkgVEMiLCAi5b6u6Luf5q2j6buR6auUIiwgIkFyaWFsIFVuaWNvZGUgTVMiLCAiRHJvaWQgRmFsbGJhY2sgU2FucyIsIHNhbnMtc2VyaWYnLAogICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICJub3JtYWwiLAogICAgICAgICAgICAgIGNvbG9yOiAicmFuZG9tLWRhcmsiLAogICAgICAgICAgICAgIG1pblNpemU6IDAsCiAgICAgICAgICAgICAgd2VpZ2h0RmFjdG9yOiAxLAogICAgICAgICAgICAgIGNsZWFyQ2FudmFzOiAhMCwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICIjZmZmIiwKICAgICAgICAgICAgICBncmlkU2l6ZTogOCwKICAgICAgICAgICAgICBkcmF3T3V0T2ZCb3VuZDogITEsCiAgICAgICAgICAgICAgb3JpZ2luOiBudWxsLAogICAgICAgICAgICAgIGRyYXdNYXNrOiAhMSwKICAgICAgICAgICAgICBtYXNrQ29sb3I6ICJyZ2JhKDI1NSwwLDAsMC4zKSIsCiAgICAgICAgICAgICAgbWFza0dhcFdpZHRoOiAuMywKICAgICAgICAgICAgICB3YWl0OiAwLAogICAgICAgICAgICAgIGFib3J0VGhyZXNob2xkOiAwLAogICAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbiAoKSB7fSwKICAgICAgICAgICAgICBtaW5Sb3RhdGlvbjogLU1hdGguUEkgLyAyLAogICAgICAgICAgICAgIG1heFJvdGF0aW9uOiBNYXRoLlBJIC8gMiwKICAgICAgICAgICAgICByb3RhdGlvblN0ZXA6IC4xLAogICAgICAgICAgICAgIHNodWZmbGU6ICEwLAogICAgICAgICAgICAgIHJvdGF0ZVJhdGlvOiAuMSwKICAgICAgICAgICAgICBzaGFwZTogImNpcmNsZSIsCiAgICAgICAgICAgICAgZWxsaXB0aWNpdHk6IC42NSwKICAgICAgICAgICAgICBjbGFzc2VzOiBudWxsLAogICAgICAgICAgICAgIGhvdmVyOiBudWxsLAogICAgICAgICAgICAgIGNsaWNrOiBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChlKSBmb3IgKHZhciBpIGluIGUpIGkgaW4gbiAmJiAobltpXSA9IGVbaV0pOwogICAgICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2Ygbi53ZWlnaHRGYWN0b3IpIHsKICAgICAgICAgICAgICB2YXIgbCA9IG4ud2VpZ2h0RmFjdG9yOwogICAgICAgICAgICAgIG4ud2VpZ2h0RmFjdG9yID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0ICogbDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBuLnNoYXBlKSBzd2l0Y2ggKG4uc2hhcGUpIHsKICAgICAgICAgICAgICBjYXNlICJjaXJjbGUiOgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBuLnNoYXBlID0gImNpcmNsZSI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJjYXJkaW9pZCI6CiAgICAgICAgICAgICAgICBuLnNoYXBlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgLSBNYXRoLnNpbih0KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJkaWFtb25kIjoKICAgICAgICAgICAgICBjYXNlICJzcXVhcmUiOgogICAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gdCAlICgyICogTWF0aC5QSSAvIDQpOwogICAgICAgICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyhlKSArIE1hdGguc2luKGUpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJ0cmlhbmdsZS1mb3J3YXJkIjoKICAgICAgICAgICAgICAgIG4uc2hhcGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICB2YXIgZSA9IHQgJSAoMiAqIE1hdGguUEkgLyAzKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgLyAoTWF0aC5jb3MoZSkgKyBNYXRoLnNxcnQoMykgKiBNYXRoLnNpbihlKSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAidHJpYW5nbGUiOgogICAgICAgICAgICAgIGNhc2UgInRyaWFuZ2xlLXVwcmlnaHQiOgogICAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gKHQgKyAzICogTWF0aC5QSSAvIDIpICUgKDIgKiBNYXRoLlBJIC8gMyk7CiAgICAgICAgICAgICAgICAgIHJldHVybiAxIC8gKE1hdGguY29zKGUpICsgTWF0aC5zcXJ0KDMpICogTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInBlbnRhZ29uIjoKICAgICAgICAgICAgICAgIG4uc2hhcGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICB2YXIgZSA9ICh0ICsgLjk1NSkgJSAoMiAqIE1hdGguUEkgLyA1KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgLyAoTWF0aC5jb3MoZSkgKyAuNzI2NTQzICogTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInN0YXIiOgogICAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBlID0gKHQgKyAuOTU1KSAlICgyICogTWF0aC5QSSAvIDEwKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuICh0ICsgLjk1NSkgJSAoMiAqIE1hdGguUEkgLyA1KSAtIDIgKiBNYXRoLlBJIC8gMTAgPj0gMCA/IDEgLyAoTWF0aC5jb3MoMiAqIE1hdGguUEkgLyAxMCAtIGUpICsgMy4wNzc2OCAqIE1hdGguc2luKDIgKiBNYXRoLlBJIC8gMTAgLSBlKSkgOiAxIC8gKE1hdGguY29zKGUpICsgMy4wNzc2OCAqIE1hdGguc2luKGUpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbi5ncmlkU2l6ZSA9IE1hdGgubWF4KE1hdGguZmxvb3Iobi5ncmlkU2l6ZSksIDQpOwogICAgICAgICAgICB2YXIgaCwKICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICBwID0gbi5ncmlkU2l6ZSwKICAgICAgICAgICAgICBtID0gcCAtIG4ubWFza0dhcFdpZHRoLAogICAgICAgICAgICAgIHggPSBNYXRoLmFicyhuLm1heFJvdGF0aW9uIC0gbi5taW5Sb3RhdGlvbiksCiAgICAgICAgICAgICAgeSA9IE1hdGgubWluKG4ubWF4Um90YXRpb24sIG4ubWluUm90YXRpb24pLAogICAgICAgICAgICAgIHcgPSBuLnJvdGF0aW9uU3RlcDsKICAgICAgICAgICAgc3dpdGNoIChuLmNvbG9yKSB7CiAgICAgICAgICAgICAgY2FzZSAicmFuZG9tLWRhcmsiOgogICAgICAgICAgICAgICAgZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIoMTAsIDUwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJyYW5kb20tbGlnaHQiOgogICAgICAgICAgICAgICAgZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIoNTAsIDkwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygbi5jb2xvciAmJiAoZyA9IG4uY29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBfID0gbnVsbDsKICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygbi5jbGFzc2VzICYmIChfID0gbi5jbGFzc2VzKTsKICAgICAgICAgICAgdmFyIGIsCiAgICAgICAgICAgICAgUyA9ICExLAogICAgICAgICAgICAgIE0gPSBbXSwKICAgICAgICAgICAgICBUID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBlLAogICAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgICBuID0gdC5jdXJyZW50VGFyZ2V0LAogICAgICAgICAgICAgICAgICBpID0gbi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIHQudG91Y2hlcyA/IChlID0gdC50b3VjaGVzWzBdLmNsaWVudFgsIHIgPSB0LnRvdWNoZXNbMF0uY2xpZW50WSkgOiAoZSA9IHQuY2xpZW50WCwgciA9IHQuY2xpZW50WSk7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGUgLSBpLmxlZnQsCiAgICAgICAgICAgICAgICAgIG8gPSByIC0gaS50b3AsCiAgICAgICAgICAgICAgICAgIHMgPSBNYXRoLmZsb29yKGEgKiAobi53aWR0aCAvIGkud2lkdGggfHwgMSkgLyBwKSwKICAgICAgICAgICAgICAgICAgbCA9IE1hdGguZmxvb3IobyAqIChuLmhlaWdodCAvIGkuaGVpZ2h0IHx8IDEpIC8gcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTVtzXVtsXTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGsgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgdmFyIGUgPSBUKHQpOwogICAgICAgICAgICAgICAgaWYgKGIgIT09IGUpIHsKICAgICAgICAgICAgICAgICAgaWYgKGIgPSBlLCAhZSkgcmV0dXJuIHZvaWQgbi5ob3Zlcih2b2lkIDAsIHZvaWQgMCwgdCk7CiAgICAgICAgICAgICAgICAgIG4uaG92ZXIoZS5pdGVtLCBlLmRpbWVuc2lvbiwgdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBDID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gVCh0KTsKICAgICAgICAgICAgICAgIGUgJiYgKG4uY2xpY2soZS5pdGVtLCBlLmRpbWVuc2lvbiwgdCksIHQucHJldmVudERlZmF1bHQoKSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBQID0gW10sCiAgICAgICAgICAgICAgSSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICBpZiAoUFt0XSkgcmV0dXJuIFBbdF07CiAgICAgICAgICAgICAgICB2YXIgZSA9IDggKiB0LAogICAgICAgICAgICAgICAgICByID0gZSwKICAgICAgICAgICAgICAgICAgaSA9IFtdOwogICAgICAgICAgICAgICAgZm9yICgwID09PSB0ICYmIGkucHVzaChbZlswXSwgZlsxXSwgMF0pOyByLS07KSB7CiAgICAgICAgICAgICAgICAgIHZhciBhID0gMTsKICAgICAgICAgICAgICAgICAgImNpcmNsZSIgIT09IG4uc2hhcGUgJiYgKGEgPSBuLnNoYXBlKHIgLyBlICogMiAqIE1hdGguUEkpKSwgaS5wdXNoKFtmWzBdICsgdCAqIGEgKiBNYXRoLmNvcygtciAvIGUgKiAyICogTWF0aC5QSSksIGZbMV0gKyB0ICogYSAqIE1hdGguc2luKC1yIC8gZSAqIDIgKiBNYXRoLlBJKSAqIG4uZWxsaXB0aWNpdHksIHIgLyBlICogMiAqIE1hdGguUEldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBQW3RdID0gaSwgaTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbi5hYm9ydFRocmVzaG9sZCA+IDAgJiYgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB2ID4gbi5hYm9ydFRocmVzaG9sZDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIE8gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gbi5yb3RhdGVSYXRpbyA/IDAgOiBNYXRoLnJhbmRvbSgpID4gbi5yb3RhdGVSYXRpbyA/IDAgOiAwID09PSB4ID8geSA6IHkgKyBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiB4IC8gdykgKiB3OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgRCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IG4ud2VpZ2h0RmFjdG9yKGUpOwogICAgICAgICAgICAgICAgaWYgKGkgPD0gbi5taW5TaXplKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICB2YXIgYSA9IDE7CiAgICAgICAgICAgICAgICBpIDwgbyAmJiAoYSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IDI7IHQgKiBpIDwgbzspIHQgKz0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKSwKICAgICAgICAgICAgICAgICAgbCA9IHMuZ2V0Q29udGV4dCgiMmQiLCB7CiAgICAgICAgICAgICAgICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiAhMAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGwuZm9udCA9IG4uZm9udFdlaWdodCArICIgIiArIChpICogYSkudG9TdHJpbmcoMTApICsgInB4ICIgKyBuLmZvbnRGYW1pbHk7CiAgICAgICAgICAgICAgICB2YXIgaCA9IGwubWVhc3VyZVRleHQodCkud2lkdGggLyBhLAogICAgICAgICAgICAgICAgICB1ID0gTWF0aC5tYXgoaSAqIGEsIGwubWVhc3VyZVRleHQoIm0iKS53aWR0aCwgbC5tZWFzdXJlVGV4dCgi77y3Iikud2lkdGgpIC8gYSwKICAgICAgICAgICAgICAgICAgYyA9IGggKyAyICogdSwKICAgICAgICAgICAgICAgICAgZiA9IDMgKiB1LAogICAgICAgICAgICAgICAgICBkID0gTWF0aC5jZWlsKGMgLyBwKSwKICAgICAgICAgICAgICAgICAgdiA9IE1hdGguY2VpbChmIC8gcCk7CiAgICAgICAgICAgICAgICBjID0gZCAqIHAsIGYgPSB2ICogcDsKICAgICAgICAgICAgICAgIHZhciBnID0gLWggLyAyLAogICAgICAgICAgICAgICAgICBtID0gLjQgKiAtdSwKICAgICAgICAgICAgICAgICAgeCA9IE1hdGguY2VpbCgoYyAqIE1hdGguYWJzKE1hdGguc2luKHIpKSArIGYgKiBNYXRoLmFicyhNYXRoLmNvcyhyKSkpIC8gcCksCiAgICAgICAgICAgICAgICAgIHkgPSBNYXRoLmNlaWwoKGMgKiBNYXRoLmFicyhNYXRoLmNvcyhyKSkgKyBmICogTWF0aC5hYnMoTWF0aC5zaW4ocikpKSAvIHApLAogICAgICAgICAgICAgICAgICB3ID0geSAqIHAsCiAgICAgICAgICAgICAgICAgIF8gPSB4ICogcDsKICAgICAgICAgICAgICAgIHMuc2V0QXR0cmlidXRlKCJ3aWR0aCIsIHcpLCBzLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgXyksIGwuc2NhbGUoMSAvIGEsIDEgLyBhKSwgbC50cmFuc2xhdGUodyAqIGEgLyAyLCBfICogYSAvIDIpLCBsLnJvdGF0ZSgtciksIGwuZm9udCA9IG4uZm9udFdlaWdodCArICIgIiArIChpICogYSkudG9TdHJpbmcoMTApICsgInB4ICIgKyBuLmZvbnRGYW1pbHksIGwuZmlsbFN0eWxlID0gIiMwMDAiLCBsLnRleHRCYXNlbGluZSA9ICJtaWRkbGUiLCBsLmZpbGxUZXh0KHQsIGcgKiBhLCAobSArIC41ICogaSkgKiBhKTsKICAgICAgICAgICAgICAgIHZhciBiID0gbC5nZXRJbWFnZURhdGEoMCwgMCwgdywgXykuZGF0YTsKICAgICAgICAgICAgICAgIGlmIChBKCkpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgIGZvciAodmFyIFMsIE0sIFQsIGsgPSBbXSwgQyA9IHksIFAgPSBbeCAvIDIsIHkgLyAyLCB4IC8gMiwgeSAvIDJdOyBDLS07KSBmb3IgKFMgPSB4OyBTLS07KSB7CiAgICAgICAgICAgICAgICAgIFQgPSBwOwogICAgICAgICAgICAgICAgICB0OiBmb3IgKDsgVC0tOykgZm9yIChNID0gcDsgTS0tOykgaWYgKGJbNCAqICgoUyAqIHAgKyBUKSAqIHcgKyAoQyAqIHAgKyBNKSkgKyAzXSkgewogICAgICAgICAgICAgICAgICAgIGsucHVzaChbQywgU10pLCBDIDwgUFszXSAmJiAoUFszXSA9IEMpLCBDID4gUFsxXSAmJiAoUFsxXSA9IEMpLCBTIDwgUFswXSAmJiAoUFswXSA9IFMpLCBTID4gUFsyXSAmJiAoUFsyXSA9IFMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIG11OiBhLAogICAgICAgICAgICAgICAgICBvY2N1cGllZDogaywKICAgICAgICAgICAgICAgICAgYm91bmRzOiBQLAogICAgICAgICAgICAgICAgICBndzogeSwKICAgICAgICAgICAgICAgICAgZ2g6IHgsCiAgICAgICAgICAgICAgICAgIGZpbGxUZXh0T2Zmc2V0WDogZywKICAgICAgICAgICAgICAgICAgZmlsbFRleHRPZmZzZXRZOiBtLAogICAgICAgICAgICAgICAgICBmaWxsVGV4dFdpZHRoOiBoLAogICAgICAgICAgICAgICAgICBmaWxsVGV4dEhlaWdodDogdSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IGkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBMID0gZnVuY3Rpb24gKHQsIGUsIHIsIGksIGEpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIG8gPSBhLmxlbmd0aDsgby0tOykgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IHQgKyBhW29dWzBdLAogICAgICAgICAgICAgICAgICAgIGwgPSBlICsgYVtvXVsxXTsKICAgICAgICAgICAgICAgICAgaWYgKHMgPj0gdSB8fCBsID49IGMgfHwgcyA8IDAgfHwgbCA8IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW4uZHJhd091dE9mQm91bmQpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaFtzXVtsXSkgcmV0dXJuICExOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICEwOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgRiA9IGZ1bmN0aW9uIChlLCByLCBpLCBhLCBvLCBzLCBsLCBoLCB1KSB7CiAgICAgICAgICAgICAgICB2YXIgYywKICAgICAgICAgICAgICAgICAgZiA9IGkuZm9udFNpemU7CiAgICAgICAgICAgICAgICBjID0gZyA/IGcoYSwgbywgZiwgcywgbCkgOiBuLmNvbG9yOwogICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICBkID0gXyA/IF8oYSwgbywgZiwgcywgbCkgOiBuLmNsYXNzZXM7CiAgICAgICAgICAgICAgICB2YXIgdiA9IGkuYm91bmRzOwogICAgICAgICAgICAgICAgdlszXSwgdlswXSwgdlsxXSwgdlszXSwgdlsyXSwgdlswXSwgdC5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIGlmICh0LmdldENvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHQuZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgICAgICAgICAgICAgIHMgPSBpLm11OwogICAgICAgICAgICAgICAgICAgIG8uc2F2ZSgpLCBvLnNjYWxlKDEgLyBzLCAxIC8gcyksIG8uZm9udCA9IG4uZm9udFdlaWdodCArICIgIiArIChmICogcykudG9TdHJpbmcoMTApICsgInB4ICIgKyBuLmZvbnRGYW1pbHksIG8uZmlsbFN0eWxlID0gYywgby50cmFuc2xhdGUoKGUgKyBpLmd3IC8gMikgKiBwICogcywgKHIgKyBpLmdoIC8gMikgKiBwICogcyksIDAgIT09IGggJiYgby5yb3RhdGUoLWgpLCBvLnRleHRCYXNlbGluZSA9ICJtaWRkbGUiLCBvLmZpbGxUZXh0KGEsIGkuZmlsbFRleHRPZmZzZXRYICogcywgKGkuZmlsbFRleHRPZmZzZXRZICsgLjUgKiBmKSAqIHMpLCBvLnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSwKICAgICAgICAgICAgICAgICAgICAgIHYgPSAiIjsKICAgICAgICAgICAgICAgICAgICB2ID0gInJvdGF0ZSgiICsgLWggLyBNYXRoLlBJICogMTgwICsgImRlZykgIiwgMSAhPT0gaS5tdSAmJiAodiArPSAidHJhbnNsYXRlWCgtIiArIGkuZmlsbFRleHRXaWR0aCAvIDQgKyAicHgpIHNjYWxlKCIgKyAxIC8gaS5tdSArICIpIik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSB7CiAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIsCiAgICAgICAgICAgICAgICAgICAgICBmb250OiBuLmZvbnRXZWlnaHQgKyAiICIgKyBmICogaS5tdSArICJweCAiICsgbi5mb250RmFtaWx5LAogICAgICAgICAgICAgICAgICAgICAgbGVmdDogKGUgKyBpLmd3IC8gMikgKiBwICsgaS5maWxsVGV4dE9mZnNldFggKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgdG9wOiAociArIGkuZ2ggLyAyKSAqIHAgKyBpLmZpbGxUZXh0T2Zmc2V0WSArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaS5maWxsVGV4dFdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaS5maWxsVGV4dEhlaWdodCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiBmICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3dyYXAiLAogICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB2LAogICAgICAgICAgICAgICAgICAgICAgd2Via2l0VHJhbnNmb3JtOiB2LAogICAgICAgICAgICAgICAgICAgICAgbXNUcmFuc2Zvcm06IHYsCiAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1PcmlnaW46ICI1MCUgNDAlIiwKICAgICAgICAgICAgICAgICAgICAgIHdlYmtpdFRyYW5zZm9ybU9yaWdpbjogIjUwJSA0MCUiLAogICAgICAgICAgICAgICAgICAgICAgbXNUcmFuc2Zvcm1PcmlnaW46ICI1MCUgNDAlIgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYyAmJiAoZy5jb2xvciA9IGMpLCBsLnRleHRDb250ZW50ID0gYTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBtIGluIGcpIGwuc3R5bGVbbV0gPSBnW21dOwogICAgICAgICAgICAgICAgICAgIGlmICh1KSBmb3IgKHZhciB4IGluIHUpIGwuc2V0QXR0cmlidXRlKHgsIHVbeF0pOwogICAgICAgICAgICAgICAgICAgIGQgJiYgKGwuY2xhc3NOYW1lICs9IGQpLCB0LmFwcGVuZENoaWxkKGwpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIFIgPSBmdW5jdGlvbiAoZSwgciwgbiwgaSwgYSkgewogICAgICAgICAgICAgICAgaWYgKCEoZSA+PSB1IHx8IHIgPj0gYyB8fCBlIDwgMCB8fCByIDwgMCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKGhbZV1bcl0gPSAhMSwgbikgewogICAgICAgICAgICAgICAgICAgIHRbMF0uZ2V0Q29udGV4dCgiMmQiKS5maWxsUmVjdChlICogcCwgciAqIHAsIG0sIG0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIFMgJiYgKE1bZV1bcl0gPSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbTogYSwKICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb246IGkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBCID0gZnVuY3Rpb24gKGUsIHIsIGksIGEsIG8sIHMpIHsKICAgICAgICAgICAgICAgIHZhciBsLAogICAgICAgICAgICAgICAgICBoID0gby5vY2N1cGllZCwKICAgICAgICAgICAgICAgICAgZiA9IG4uZHJhd01hc2s7CiAgICAgICAgICAgICAgICBmICYmIChsID0gdFswXS5nZXRDb250ZXh0KCIyZCIpLCBsLnNhdmUoKSwgbC5maWxsU3R5bGUgPSBuLm1hc2tDb2xvcik7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIGlmIChTKSB7CiAgICAgICAgICAgICAgICAgIHZhciB2ID0gby5ib3VuZHM7CiAgICAgICAgICAgICAgICAgIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgeDogKGUgKyB2WzNdKSAqIHAsCiAgICAgICAgICAgICAgICAgICAgeTogKHIgKyB2WzBdKSAqIHAsCiAgICAgICAgICAgICAgICAgICAgdzogKHZbMV0gLSB2WzNdICsgMSkgKiBwLAogICAgICAgICAgICAgICAgICAgIGg6ICh2WzJdIC0gdlswXSArIDEpICogcAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IGgubGVuZ3RoOyBnLS07KSB7CiAgICAgICAgICAgICAgICAgIHZhciBtID0gZSArIGhbZ11bMF0sCiAgICAgICAgICAgICAgICAgICAgeCA9IHIgKyBoW2ddWzFdOwogICAgICAgICAgICAgICAgICBtID49IHUgfHwgeCA+PSBjIHx8IG0gPCAwIHx8IHggPCAwIHx8IFIobSwgeCwgZiwgZCwgcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmICYmIGwucmVzdG9yZSgpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgeiA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSwgciwgaTsKICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkodCkgPyAoZSA9IHRbMF0sIHIgPSB0WzFdKSA6IChlID0gdC53b3JkLCByID0gdC53ZWlnaHQsIGkgPSB0LmF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgdmFyIGEgPSBPKCksCiAgICAgICAgICAgICAgICAgIG8gPSBEKGUsIHIsIGEpOwogICAgICAgICAgICAgICAgaWYgKCFvKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICBpZiAoQSgpKSByZXR1cm4gITE7CiAgICAgICAgICAgICAgICBpZiAoIW4uZHJhd091dE9mQm91bmQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGwgPSBvLmJvdW5kczsKICAgICAgICAgICAgICAgICAgaWYgKGxbMV0gLSBsWzNdICsgMSA+IHUgfHwgbFsyXSAtIGxbMF0gKyAxID4gYykgcmV0dXJuICExOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgaCA9IGQgKyAxOyBoLS07KSB7CiAgICAgICAgICAgICAgICAgIHZhciBmID0gSShkIC0gaCk7CiAgICAgICAgICAgICAgICAgIG4uc2h1ZmZsZSAmJiAoZiA9IFtdLmNvbmNhdChmKSwgcyhmKSk7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHYgPSAwOyB2IDwgZi5sZW5ndGg7IHYrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBnID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzID0gTWF0aC5mbG9vcihuWzBdIC0gby5ndyAvIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBsID0gTWF0aC5mbG9vcihuWzFdIC0gby5naCAvIDIpOwogICAgICAgICAgICAgICAgICAgICAgby5ndywgby5naDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhIUwocywgbCwgMCwgMCwgby5vY2N1cGllZCkgJiYgKEYocywgbCwgbywgZSwgciwgZCAtIGgsIG5bMl0sIGEsIGkpLCBCKHMsIGwsIDAsIDAsIG8sIHQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGd4OiBzLAogICAgICAgICAgICAgICAgICAgICAgICBneTogbCwKICAgICAgICAgICAgICAgICAgICAgICAgcm90OiBhLAogICAgICAgICAgICAgICAgICAgICAgICBpbmZvOiBvCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KGZbdl0pOwogICAgICAgICAgICAgICAgICAgIGlmIChnKSByZXR1cm4gZzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBOID0gZnVuY3Rpb24gKGUsIHIsIG4pIHsKICAgICAgICAgICAgICAgIGlmIChyKSByZXR1cm4gIXQuc29tZShmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJDdXN0b21FdmVudCIpOwogICAgICAgICAgICAgICAgICByZXR1cm4gaS5pbml0Q3VzdG9tRXZlbnQoZSwgITAsIHIsIG4gfHwge30pLCAhdC5kaXNwYXRjaEV2ZW50KGkpOwogICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGkgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiQ3VzdG9tRXZlbnQiKTsKICAgICAgICAgICAgICAgICAgaS5pbml0Q3VzdG9tRXZlbnQoZSwgITAsIHIsIG4gfHwge30pLCB0LmRpc3BhdGNoRXZlbnQoaSk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAhZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBlID0gdFswXTsKICAgICAgICAgICAgICBpZiAoZS5nZXRDb250ZXh0KSB1ID0gTWF0aC5jZWlsKGUud2lkdGggLyBwKSwgYyA9IE1hdGguY2VpbChlLmhlaWdodCAvIHApO2Vsc2UgewogICAgICAgICAgICAgICAgdmFyIHIgPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgdSA9IE1hdGguY2VpbChyLndpZHRoIC8gcCksIGMgPSBNYXRoLmNlaWwoci5oZWlnaHQgLyBwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKE4oIndvcmRjbG91ZHN0YXJ0IiwgITApKSB7CiAgICAgICAgICAgICAgICBmID0gbi5vcmlnaW4gPyBbbi5vcmlnaW5bMF0gLyBwLCBuLm9yaWdpblsxXSAvIHBdIDogW3UgLyAyLCBjIC8gMl0sIGQgPSBNYXRoLmZsb29yKE1hdGguc3FydCh1ICogdSArIGMgKiBjKSksIGggPSBbXTsKICAgICAgICAgICAgICAgIHZhciBpLCBhLCBvOwogICAgICAgICAgICAgICAgaWYgKCFlLmdldENvbnRleHQgfHwgbi5jbGVhckNhbnZhcykgZm9yICh0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHQuZ2V0Q29udGV4dCkgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0gdC5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgIGUuZmlsbFN0eWxlID0gbi5iYWNrZ3JvdW5kQ29sb3IsIGUuY2xlYXJSZWN0KDAsIDAsIHUgKiAocCArIDEpLCBjICogKHAgKyAxKSksIGUuZmlsbFJlY3QoMCwgMCwgdSAqIChwICsgMSksIGMgKiAocCArIDEpKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHQudGV4dENvbnRlbnQgPSAiIiwgdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBuLmJhY2tncm91bmRDb2xvciwgdC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICAgICAgICB9KSwgaSA9IHU7IGktLTspIGZvciAoaFtpXSA9IFtdLCBhID0gYzsgYS0tOykgaFtpXVthXSA9ICEwO2Vsc2UgewogICAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICAgIHMuZmlsbFN0eWxlID0gbi5iYWNrZ3JvdW5kQ29sb3IsIHMuZmlsbFJlY3QoMCwgMCwgMSwgMSk7CiAgICAgICAgICAgICAgICAgIHZhciBsID0gcy5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YSwKICAgICAgICAgICAgICAgICAgICBnID0gZS5nZXRDb250ZXh0KCIyZCIpLmdldEltYWdlRGF0YSgwLCAwLCB1ICogcCwgYyAqIHApLmRhdGE7CiAgICAgICAgICAgICAgICAgIGkgPSB1OwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBtLCB4OyBpLS07KSBmb3IgKGhbaV0gPSBbXSwgYSA9IGM7IGEtLTspIHsKICAgICAgICAgICAgICAgICAgICB4ID0gcDsKICAgICAgICAgICAgICAgICAgICB0OiBmb3IgKDsgeC0tOykgZm9yIChtID0gcDsgbS0tOykgZm9yIChvID0gNDsgby0tOykgaWYgKGdbNCAqICgoYSAqIHAgKyB4KSAqIHUgKiBwICsgKGkgKiBwICsgbSkpICsgb10gIT09IGxbb10pIHsKICAgICAgICAgICAgICAgICAgICAgIGhbaV1bYV0gPSAhMTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICExICE9PSBoW2ldW2FdICYmIChoW2ldW2FdID0gITApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGcgPSBzID0gbCA9IHZvaWQgMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChuLmhvdmVyIHx8IG4uY2xpY2spIHsKICAgICAgICAgICAgICAgICAgZm9yIChTID0gITAsIGkgPSB1ICsgMTsgaS0tOykgTVtpXSA9IFtdOwogICAgICAgICAgICAgICAgICBuLmhvdmVyICYmIGUuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgayksIG4uY2xpY2sgJiYgKGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBDKSwgZS5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwgQyksIGUuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgIHQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgfSksIGUuc3R5bGUud2Via2l0VGFwSGlnaGxpZ2h0Q29sb3IgPSAicmdiYSgwLCAwLCAwLCAwKSIpLCBlLmFkZEV2ZW50TGlzdGVuZXIoIndvcmRjbG91ZHN0YXJ0IiwgZnVuY3Rpb24gdCgpIHsKICAgICAgICAgICAgICAgICAgICBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIndvcmRjbG91ZHN0YXJ0IiwgdCksIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgayksIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBDKSwgYiA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvID0gMDsKICAgICAgICAgICAgICAgIHZhciB5LCB3OwogICAgICAgICAgICAgICAgMCAhPT0gbi53YWl0ID8gKHkgPSB3aW5kb3cuc2V0VGltZW91dCwgdyA9IHdpbmRvdy5jbGVhclRpbWVvdXQpIDogKHkgPSB3aW5kb3cuc2V0SW1tZWRpYXRlLCB3ID0gd2luZG93LmNsZWFySW1tZWRpYXRlKTsKICAgICAgICAgICAgICAgIHZhciBfID0gZnVuY3Rpb24gKGUsIHIpIHsKICAgICAgICAgICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCByKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgVCA9IGZ1bmN0aW9uIHQoKSB7CiAgICAgICAgICAgICAgICAgICAgXygid29yZGNsb3Vkc3RhcnQiLCB0KSwgdyhQKTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICFmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICB0LmFkZEV2ZW50TGlzdGVuZXIoZSwgcik7CiAgICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgICAgfSgid29yZGNsb3Vkc3RhcnQiLCBUKTsKICAgICAgICAgICAgICAgIHZhciBQID0geShmdW5jdGlvbiB0KCkgewogICAgICAgICAgICAgICAgICBpZiAobyA+PSBuLmxpc3QubGVuZ3RoKSByZXR1cm4gdyhQKSwgTigid29yZGNsb3Vkc3RvcCIsICExKSwgdm9pZCBfKCJ3b3JkY2xvdWRzdGFydCIsIFQpOwogICAgICAgICAgICAgICAgICB2ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgIHZhciBlID0geihuLmxpc3Rbb10pLAogICAgICAgICAgICAgICAgICAgIHIgPSAhTigid29yZGNsb3VkZHJhd24iLCAhMCwgewogICAgICAgICAgICAgICAgICAgICAgaXRlbTogbi5saXN0W29dLAogICAgICAgICAgICAgICAgICAgICAgZHJhd246IGUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaWYgKEEoKSB8fCByKSByZXR1cm4gdyhQKSwgbi5hYm9ydCgpLCBOKCJ3b3JkY2xvdWRhYm9ydCIsICExKSwgTigid29yZGNsb3Vkc3RvcCIsICExKSwgdm9pZCBfKCJ3b3JkY2xvdWRzdGFydCIsIFQpOwogICAgICAgICAgICAgICAgICBvKyssIFAgPSB5KHQsIG4ud2FpdCk7CiAgICAgICAgICAgICAgICB9LCBuLndhaXQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSgpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIGwuaXNTdXBwb3J0ZWQgPSBhLCBsLm1pbkZvbnRTaXplID0gbywgbiA9IFtdLCB2b2lkIDAgIT09IChpID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBsOwogICAgICB9LmFwcGx5KGUsIG4pKSAmJiAodC5leHBvcnRzID0gaSk7CiAgICB9KCk7CiAgfV0pOwp9KTs="},null]}